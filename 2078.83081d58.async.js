(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[2078],{64335:function(Or,U,E){"use strict";var le=E(67294),C=(0,le.createContext)({});U.Z=C},21349:function(Or,U,E){"use strict";var le=E(84305),C=E(69224),d=E(17781),A=E.n(d),Q=E(67294),K=E(94184),W=E.n(K),L=E(64335),N=function(Ye){var Je=(0,Q.useContext)(L.Z),rt=Ye.children,Yt=Ye.contentWidth,Vt=Ye.className,tr=Ye.style,zt=(0,Q.useContext)(C.ZP.ConfigContext),Tt=zt.getPrefixCls,xt=Ye.prefixCls||Tt("pro"),yr=Yt||Je.contentWidth,ee="".concat(xt,"-grid-content");return Q.createElement("div",{className:W()(ee,Vt,{wide:yr==="Fixed"}),style:tr},Q.createElement("div",{className:"".concat(xt,"-grid-content-children")},rt))};U.Z=N},46343:function(Or,U,E){"use strict";E.d(U,{zj:function(){return Bt},oI:function(){return Vi},ni:function(){return ge},gg:function(){return yn}});var le=E(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function C(nr,de,Te,Ue){function Le(Ft){return Ft instanceof Te?Ft:new Te(function(er){er(Ft)})}return new(Te||(Te=Promise))(function(Ft,er){function w(Ze){try{Ee(Ue.next(Ze))}catch(Qe){er(Qe)}}function Z(Ze){try{Ee(Ue.throw(Ze))}catch(Qe){er(Qe)}}function Ee(Ze){Ze.done?Ft(Ze.value):Le(Ze.value).then(w,Z)}Ee((Ue=Ue.apply(nr,de||[])).next())})}function d(nr,de){var Te={label:0,sent:function(){if(Ft[0]&1)throw Ft[1];return Ft[1]},trys:[],ops:[]},Ue,Le,Ft,er;return er={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(er[Symbol.iterator]=function(){return this}),er;function w(Ee){return function(Ze){return Z([Ee,Ze])}}function Z(Ee){if(Ue)throw new TypeError("Generator is already executing.");for(;Te;)try{if(Ue=1,Le&&(Ft=Ee[0]&2?Le.return:Ee[0]?Le.throw||((Ft=Le.return)&&Ft.call(Le),0):Le.next)&&!(Ft=Ft.call(Le,Ee[1])).done)return Ft;switch(Le=0,Ft&&(Ee=[Ee[0]&2,Ft.value]),Ee[0]){case 0:case 1:Ft=Ee;break;case 4:return Te.label++,{value:Ee[1],done:!1};case 5:Te.label++,Le=Ee[1],Ee=[0];continue;case 7:Ee=Te.ops.pop(),Te.trys.pop();continue;default:if(Ft=Te.trys,!(Ft=Ft.length>0&&Ft[Ft.length-1])&&(Ee[0]===6||Ee[0]===2)){Te=0;continue}if(Ee[0]===3&&(!Ft||Ee[1]>Ft[0]&&Ee[1]<Ft[3])){Te.label=Ee[1];break}if(Ee[0]===6&&Te.label<Ft[1]){Te.label=Ft[1],Ft=Ee;break}if(Ft&&Te.label<Ft[2]){Te.label=Ft[2],Te.ops.push(Ee);break}Ft[2]&&Te.ops.pop(),Te.trys.pop();continue}Ee=de.call(nr,Te)}catch(Ze){Ee=[6,Ze],Le=0}finally{Ue=Ft=0}if(Ee[0]&5)throw Ee[1];return{value:Ee[0]?Ee[1]:void 0,done:!0}}}function A(nr,de){var Te=typeof Symbol=="function"&&nr[Symbol.iterator];if(!Te)return nr;var Ue=Te.call(nr),Le,Ft=[],er;try{for(;(de===void 0||de-- >0)&&!(Le=Ue.next()).done;)Ft.push(Le.value)}catch(w){er={error:w}}finally{try{Le&&!Le.done&&(Te=Ue.return)&&Te.call(Ue)}finally{if(er)throw er.error}}return Ft}function Q(){for(var nr=[],de=0;de<arguments.length;de++)nr=nr.concat(A(arguments[de]));return nr}function K(nr){return nr&&nr.__esModule&&Object.prototype.hasOwnProperty.call(nr,"default")?nr.default:nr}function W(nr,de){return de={exports:{}},nr(de,de.exports),de.exports}var L=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue){return Ue&&typeof Ue.length=="number"&&Ue.length>=0&&Ue.length%1==0}nr.exports=de.default});K(L);var N=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=function(Te){return function(){for(var Ue=[],Le=arguments.length;Le--;)Ue[Le]=arguments[Le];var Ft=Ue.pop();return Te.call(this,Ue,Ft)}},nr.exports=de.default});K(N);var Ne=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.fallback=Le,de.wrap=Ft;var Te=de.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ue=de.hasNextTick=typeof le=="object"&&typeof le.nextTick=="function";function Le(w){setTimeout(w,0)}function Ft(w){return function(Z){for(var Ee=[],Ze=arguments.length-1;Ze-- >0;)Ee[Ze]=arguments[Ze+1];return w(function(){return Z.apply(void 0,Ee)})}}var er;Te?er=setImmediate:Ue?er=le.nextTick:er=Le,de.default=Ft(er)});K(Ne);var Ye=Ne.fallback,Je=Ne.wrap,rt=Ne.hasSetImmediate,Yt=Ne.hasNextTick,Vt=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Ft;var Te=Le(N),Ue=Le(Ne);function Le(Z){return Z&&Z.__esModule?Z:{default:Z}}function Ft(Z){return(0,tr.isAsync)(Z)?function(){for(var Ee=[],Ze=arguments.length;Ze--;)Ee[Ze]=arguments[Ze];var Qe=Ee.pop(),yt=Z.apply(this,Ee);return er(yt,Qe)}:(0,Te.default)(function(Ee,Ze){var Qe;try{Qe=Z.apply(this,Ee)}catch(yt){return Ze(yt)}if(Qe&&typeof Qe.then=="function")return er(Qe,Ze);Ze(null,Qe)})}function er(Z,Ee){return Z.then(function(Ze){w(Ee,null,Ze)},function(Ze){w(Ee,Ze&&Ze.message?Ze:new Error(Ze))})}function w(Z,Ee,Ze){try{Z(Ee,Ze)}catch(Qe){(0,Ue.default)(function(yt){throw yt},Qe)}}nr.exports=de.default});K(Vt);var tr=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.isAsyncIterable=de.isAsyncGenerator=de.isAsync=void 0;var Te=Ue(Vt);function Ue(Z){return Z&&Z.__esModule?Z:{default:Z}}function Le(Z){return Z[Symbol.toStringTag]==="AsyncFunction"}function Ft(Z){return Z[Symbol.toStringTag]==="AsyncGenerator"}function er(Z){return typeof Z[Symbol.asyncIterator]=="function"}function w(Z){if(typeof Z!="function")throw new Error("expected a function");return Le(Z)?(0,Te.default)(Z):Z}de.default=w,de.isAsync=Le,de.isAsyncGenerator=Ft,de.isAsyncIterable=er});K(tr);var zt=tr.isAsyncIterable,Tt=tr.isAsyncGenerator,xt=tr.isAsync,yr=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue,Le){if(Le===void 0&&(Le=Ue.length),!Le)throw new Error("arity is undefined");function Ft(){for(var er=this,w=[],Z=arguments.length;Z--;)w[Z]=arguments[Z];return typeof w[Le-1]=="function"?Ue.apply(this,w):new Promise(function(Ee,Ze){w[Le-1]=function(Qe){for(var yt=[],St=arguments.length-1;St-- >0;)yt[St]=arguments[St+1];if(Qe)return Ze(Qe);Ee(yt.length>1?yt:yt[0])},Ue.apply(er,w)})}return Object.defineProperty(Ft,"name",{configurable:!0,value:"awaitable("+Ue.name+")"}),Ft}nr.exports=de.default});K(yr);var ee=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=Ft(L),Ue=Ft(tr),Le=Ft(yr);function Ft(er){return er&&er.__esModule?er:{default:er}}de.default=(0,Le.default)(function(er,w,Z){var Ee=(0,Te.default)(w)?[]:{};er(w,function(Ze,Qe,yt){(0,Ue.default)(Ze)(function(St){for(var jt,Et=[],Qt=arguments.length-1;Qt-- >0;)Et[Qt]=arguments[Qt+1];Et.length<2&&(jt=Et,Et=jt[0]),Ee[Qe]=Et,yt(St)})},function(Ze){return Z(Ze,Ee)})},3),nr.exports=de.default});K(ee);var dr=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue){function Le(){for(var Ft=[],er=arguments.length;er--;)Ft[er]=arguments[er];if(Ue!==null){var w=Ue;Ue=null,w.apply(this,Ft)}}return Object.assign(Le,Ue),Le}nr.exports=de.default});K(dr);var Ct=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=function(Te){return Te[Symbol.iterator]&&Te[Symbol.iterator]()},nr.exports=de.default});K(Ct);var Ke=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Z;var Te=Le(L),Ue=Le(Ct);function Le(Ee){return Ee&&Ee.__esModule?Ee:{default:Ee}}function Ft(Ee){var Ze=-1,Qe=Ee.length;return function(){return++Ze<Qe?{value:Ee[Ze],key:Ze}:null}}function er(Ee){var Ze=-1;return function(){var yt=Ee.next();return yt.done?null:(Ze++,{value:yt.value,key:Ze})}}function w(Ee){var Ze=Ee?Object.keys(Ee):[],Qe=-1,yt=Ze.length;return function(){var jt=Ze[++Qe];return Qe<yt?{value:Ee[jt],key:jt}:null}}function Z(Ee){if((0,Te.default)(Ee))return Ft(Ee);var Ze=(0,Ue.default)(Ee);return Ze?er(Ze):w(Ee)}nr.exports=de.default});K(Ke);var Dt=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Te;function Te(Ue){return function(){for(var Le=[],Ft=arguments.length;Ft--;)Le[Ft]=arguments[Ft];if(Ue===null)throw new Error("Callback was already called.");var er=Ue;Ue=null,er.apply(this,Le)}}nr.exports=de.default});K(Dt);var Xe=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0});var Te={};de.default=Te,nr.exports=de.default});K(Xe);var Ut=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Le;var Te=Ue(Xe);function Ue(Ft){return Ft&&Ft.__esModule?Ft:{default:Ft}}function Le(Ft,er,w,Z){var Ee=!1,Ze=!1,Qe=!1,yt=0,St=0;function jt(){yt>=er||Qe||Ee||(Qe=!0,Ft.next().then(function(ie){var sr=ie.value,Br=ie.done;if(!(Ze||Ee)){if(Qe=!1,Br){Ee=!0,yt<=0&&Z(null);return}yt++,w(sr,St,Et),St++,jt()}}).catch(Qt))}function Et(ie,sr){if(yt-=1,!Ze){if(ie)return Qt(ie);if(ie===!1){Ee=!0,Ze=!0;return}if(sr===Te.default||Ee&&yt<=0)return Ee=!0,Z(null);jt()}}function Qt(ie){Ze||(Qe=!1,Ee=!0,Z(ie))}jt()}nr.exports=de.default});K(Ut);var _r=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=w(dr),Ue=w(Ke),Le=w(Dt),Ft=w(Ut),er=w(Xe);function w(Z){return Z&&Z.__esModule?Z:{default:Z}}de.default=function(Z){return function(Ee,Ze,Qe){if(Qe=(0,Te.default)(Qe),Z<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!Ee)return Qe(null);if((0,tr.isAsyncGenerator)(Ee))return(0,Ft.default)(Ee,Z,Ze,Qe);if((0,tr.isAsyncIterable)(Ee))return(0,Ft.default)(Ee[Symbol.asyncIterator](),Z,Ze,Qe);var yt=(0,Ue.default)(Ee),St=!1,jt=!1,Et=0,Qt=!1;function ie(Br,Lr){if(!jt)if(Et-=1,Br)St=!0,Qe(Br);else if(Br===!1)St=!0,jt=!0;else{if(Lr===er.default||St&&Et<=0)return St=!0,Qe(null);Qt||sr()}}function sr(){for(Qt=!0;Et<Z&&!St;){var Br=yt();if(Br===null){St=!0,Et<=0&&Qe(null);return}Et+=1,Ze(Br.value,Br.key,(0,Le.default)(ie))}Qt=!1}sr()}},nr.exports=de.default});K(_r);var ar=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=Ft(_r),Ue=Ft(tr),Le=Ft(yr);function Ft(w){return w&&w.__esModule?w:{default:w}}function er(w,Z,Ee,Ze){return(0,Te.default)(Z)(w,(0,Ue.default)(Ee),Ze)}de.default=(0,Le.default)(er,4),nr.exports=de.default});K(ar);var zr=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=Le(ar),Ue=Le(yr);function Le(er){return er&&er.__esModule?er:{default:er}}function Ft(er,w,Z){return(0,Te.default)(er,1,w,Z)}de.default=(0,Ue.default)(Ft,3),nr.exports=de.default});K(zr);var fe=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Ft;var Te=Le(ee),Ue=Le(zr);function Le(er){return er&&er.__esModule?er:{default:er}}function Ft(er,w){return(0,Te.default)(Ue.default,er,w)}nr.exports=de.default}),Re=K(fe),ge=function(){function nr(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.args=[],this.tasks=[]}return nr.prototype.call=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return this.args=Te,Re(this.tasks)},nr.prototype.tap=function(de,Te){var Ue=this;this.tasks.push(function(Le){Te.apply(void 0,Q(Ue.args)),Le(null,de)})},nr}(),_t=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=Ee(L),Ue=Ee(Xe),Le=Ee(ar),Ft=Ee(dr),er=Ee(Dt),w=Ee(tr),Z=Ee(yr);function Ee(St){return St&&St.__esModule?St:{default:St}}function Ze(St,jt,Et){Et=(0,Ft.default)(Et);var Qt=0,ie=0,sr=St.length,Br=!1;sr===0&&Et(null);function Lr(nt,gt){nt===!1&&(Br=!0),Br!==!0&&(nt?Et(nt):(++ie===sr||gt===Ue.default)&&Et(null))}for(;Qt<sr;Qt++)jt(St[Qt],Qt,(0,er.default)(Lr))}function Qe(St,jt,Et){return(0,Le.default)(St,Infinity,jt,Et)}function yt(St,jt,Et){var Qt=(0,Te.default)(St)?Ze:Qe;return Qt(St,(0,w.default)(jt),Et)}de.default=(0,Z.default)(yt,3),nr.exports=de.default});K(_t);var pt=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0}),de.default=Ft;var Te=Le(_t),Ue=Le(ee);function Le(er){return er&&er.__esModule?er:{default:er}}function Ft(er,w){return(0,Ue.default)(Te.default,er,w)}nr.exports=de.default}),Nt=K(pt),Bt=function(){function nr(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.tasks=[]}return nr.prototype.promise=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return Nt(this.tasks)},nr.prototype.tapPromise=function(de,Te){var Ue=this;this.tasks.push(function(Le){return C(Ue,void 0,void 0,function(){return d(this,function(Ft){switch(Ft.label){case 0:return[4,Te()];case 1:return Ft.sent(),Le(null,de),[2]}})})})},nr}(),kr=W(function(nr,de){Object.defineProperty(de,"__esModule",{value:!0});var Te=er(dr),Ue=er(Dt),Le=er(tr),Ft=er(yr);function er(Z){return Z&&Z.__esModule?Z:{default:Z}}function w(Z,Ee){if(Ee=(0,Te.default)(Ee),!Array.isArray(Z))return Ee(new Error("First argument to waterfall must be an array of functions"));if(!Z.length)return Ee();var Ze=0;function Qe(St){var jt=(0,Le.default)(Z[Ze++]);jt.apply(void 0,St.concat([(0,Ue.default)(yt)]))}function yt(St){for(var jt=[],Et=arguments.length-1;Et-- >0;)jt[Et]=arguments[Et+1];if(St!==!1){if(St||Ze===Z.length)return Ee.apply(void 0,[St].concat(jt));Qe(jt)}}Qe([])}de.default=(0,Ft.default)(w),nr.exports=de.default}),ln=K(kr),yn=function(){function nr(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.tasks=[]}return nr.prototype.call=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return ln(this.tasks)},nr.prototype.tap=function(de,Te){this.tasks.length===0?this.tasks.push(function(Ue){var Le=Te();Ue(Le?null:!1,Le)}):this.tasks.push(function(Ue,Le){var Ft=Te();Le(Ft?null:!1,de)})},nr}(),Vi=function(){function nr(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];this.tasks=[]}return nr.prototype.call=function(){for(var de=arguments,Te=[],Ue=0;Ue<arguments.length;Ue++)Te[Ue]=de[Ue];return Re(this.tasks)},nr.prototype.tap=function(de,Te){this.tasks.push(function(Ue){var Le=Te();Ue(Le,de)})},nr}()},58881:function(Or,U,E){"use strict";E.d(U,{nC:function(){return le.ZP},Hp:function(){return le.Hp},e7:function(){return le.e7},yT:function(){return le.yT},vK:function(){return d.v},BlendType:function(){return Q.h},AttributeType:function(){return K.GC},ScaleTypes:function(){return K.vY},StyleScaleType:function(){return K.ee},MapServiceEvent:function(){return N.I},CoordinateSystem:function(){return Ne.l},CoordinateUniform:function(){return Ne.k},CameraUniform:function(){return rt.l},SceneEventList:function(){return tr.P},PositionType:function(){return Ct.d},gl:function(){return er.gl}});var le=E(12250),C=E(69530),d=E(72302),A=E(76915),Q=E(77252),K=E(31251),W=E(8628),L=E.n(W);E.o(W,"CameraUniform")&&E.d(U,{CameraUniform:function(){return W.CameraUniform}}),E.o(W,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return W.CityBuildingLayer}}),E.o(W,"CoordinateSystem")&&E.d(U,{CoordinateSystem:function(){return W.CoordinateSystem}}),E.o(W,"CoordinateUniform")&&E.d(U,{CoordinateUniform:function(){return W.CoordinateUniform}}),E.o(W,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return W.HeatmapLayer}}),E.o(W,"ImageLayer")&&E.d(U,{ImageLayer:function(){return W.ImageLayer}}),E.o(W,"LineLayer")&&E.d(U,{LineLayer:function(){return W.LineLayer}}),E.o(W,"MapServiceEvent")&&E.d(U,{MapServiceEvent:function(){return W.MapServiceEvent}}),E.o(W,"Marker")&&E.d(U,{Marker:function(){return W.Marker}}),E.o(W,"PointLayer")&&E.d(U,{PointLayer:function(){return W.PointLayer}}),E.o(W,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return W.PolygonLayer}}),E.o(W,"Popup")&&E.d(U,{Popup:function(){return W.Popup}}),E.o(W,"PositionType")&&E.d(U,{PositionType:function(){return W.PositionType}}),E.o(W,"RasterLayer")&&E.d(U,{RasterLayer:function(){return W.RasterLayer}}),E.o(W,"Scene")&&E.d(U,{Scene:function(){return W.Scene}}),E.o(W,"SceneEventList")&&E.d(U,{SceneEventList:function(){return W.SceneEventList}}),E.o(W,"gl")&&E.d(U,{gl:function(){return W.gl}});var N=E(16606),Ne=E(47282),Ye=E(41906),Je=E.n(Ye);E.o(Ye,"CameraUniform")&&E.d(U,{CameraUniform:function(){return Ye.CameraUniform}}),E.o(Ye,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Ye.CityBuildingLayer}}),E.o(Ye,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Ye.HeatmapLayer}}),E.o(Ye,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Ye.ImageLayer}}),E.o(Ye,"LineLayer")&&E.d(U,{LineLayer:function(){return Ye.LineLayer}}),E.o(Ye,"Marker")&&E.d(U,{Marker:function(){return Ye.Marker}}),E.o(Ye,"PointLayer")&&E.d(U,{PointLayer:function(){return Ye.PointLayer}}),E.o(Ye,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Ye.PolygonLayer}}),E.o(Ye,"Popup")&&E.d(U,{Popup:function(){return Ye.Popup}}),E.o(Ye,"PositionType")&&E.d(U,{PositionType:function(){return Ye.PositionType}}),E.o(Ye,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Ye.RasterLayer}}),E.o(Ye,"Scene")&&E.d(U,{Scene:function(){return Ye.Scene}}),E.o(Ye,"SceneEventList")&&E.d(U,{SceneEventList:function(){return Ye.SceneEventList}}),E.o(Ye,"gl")&&E.d(U,{gl:function(){return Ye.gl}});var rt=E(4594),Yt=E(1910),Vt=E.n(Yt);E.o(Yt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Yt.CityBuildingLayer}}),E.o(Yt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Yt.HeatmapLayer}}),E.o(Yt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Yt.ImageLayer}}),E.o(Yt,"LineLayer")&&E.d(U,{LineLayer:function(){return Yt.LineLayer}}),E.o(Yt,"Marker")&&E.d(U,{Marker:function(){return Yt.Marker}}),E.o(Yt,"PointLayer")&&E.d(U,{PointLayer:function(){return Yt.PointLayer}}),E.o(Yt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Yt.PolygonLayer}}),E.o(Yt,"Popup")&&E.d(U,{Popup:function(){return Yt.Popup}}),E.o(Yt,"PositionType")&&E.d(U,{PositionType:function(){return Yt.PositionType}}),E.o(Yt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Yt.RasterLayer}}),E.o(Yt,"Scene")&&E.d(U,{Scene:function(){return Yt.Scene}}),E.o(Yt,"SceneEventList")&&E.d(U,{SceneEventList:function(){return Yt.SceneEventList}}),E.o(Yt,"gl")&&E.d(U,{gl:function(){return Yt.gl}});var tr=E(19793),zt=E(93102),Tt=E.n(zt);E.o(zt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return zt.CityBuildingLayer}}),E.o(zt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return zt.HeatmapLayer}}),E.o(zt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return zt.ImageLayer}}),E.o(zt,"LineLayer")&&E.d(U,{LineLayer:function(){return zt.LineLayer}}),E.o(zt,"Marker")&&E.d(U,{Marker:function(){return zt.Marker}}),E.o(zt,"PointLayer")&&E.d(U,{PointLayer:function(){return zt.PointLayer}}),E.o(zt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return zt.PolygonLayer}}),E.o(zt,"Popup")&&E.d(U,{Popup:function(){return zt.Popup}}),E.o(zt,"PositionType")&&E.d(U,{PositionType:function(){return zt.PositionType}}),E.o(zt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return zt.RasterLayer}}),E.o(zt,"Scene")&&E.d(U,{Scene:function(){return zt.Scene}}),E.o(zt,"gl")&&E.d(U,{gl:function(){return zt.gl}});var xt=E(64532),yr=E.n(xt);E.o(xt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return xt.CityBuildingLayer}}),E.o(xt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return xt.HeatmapLayer}}),E.o(xt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return xt.ImageLayer}}),E.o(xt,"LineLayer")&&E.d(U,{LineLayer:function(){return xt.LineLayer}}),E.o(xt,"Marker")&&E.d(U,{Marker:function(){return xt.Marker}}),E.o(xt,"PointLayer")&&E.d(U,{PointLayer:function(){return xt.PointLayer}}),E.o(xt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return xt.PolygonLayer}}),E.o(xt,"Popup")&&E.d(U,{Popup:function(){return xt.Popup}}),E.o(xt,"PositionType")&&E.d(U,{PositionType:function(){return xt.PositionType}}),E.o(xt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return xt.RasterLayer}}),E.o(xt,"Scene")&&E.d(U,{Scene:function(){return xt.Scene}}),E.o(xt,"gl")&&E.d(U,{gl:function(){return xt.gl}});var ee=E(2811),dr=E.n(ee);E.o(ee,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ee.CityBuildingLayer}}),E.o(ee,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ee.HeatmapLayer}}),E.o(ee,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ee.ImageLayer}}),E.o(ee,"LineLayer")&&E.d(U,{LineLayer:function(){return ee.LineLayer}}),E.o(ee,"Marker")&&E.d(U,{Marker:function(){return ee.Marker}}),E.o(ee,"PointLayer")&&E.d(U,{PointLayer:function(){return ee.PointLayer}}),E.o(ee,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ee.PolygonLayer}}),E.o(ee,"Popup")&&E.d(U,{Popup:function(){return ee.Popup}}),E.o(ee,"PositionType")&&E.d(U,{PositionType:function(){return ee.PositionType}}),E.o(ee,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ee.RasterLayer}}),E.o(ee,"Scene")&&E.d(U,{Scene:function(){return ee.Scene}}),E.o(ee,"gl")&&E.d(U,{gl:function(){return ee.gl}});var Ct=E(66690),Ke=E(81732),Dt=E.n(Ke);E.o(Ke,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Ke.CityBuildingLayer}}),E.o(Ke,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Ke.HeatmapLayer}}),E.o(Ke,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Ke.ImageLayer}}),E.o(Ke,"LineLayer")&&E.d(U,{LineLayer:function(){return Ke.LineLayer}}),E.o(Ke,"Marker")&&E.d(U,{Marker:function(){return Ke.Marker}}),E.o(Ke,"PointLayer")&&E.d(U,{PointLayer:function(){return Ke.PointLayer}}),E.o(Ke,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Ke.PolygonLayer}}),E.o(Ke,"Popup")&&E.d(U,{Popup:function(){return Ke.Popup}}),E.o(Ke,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Ke.RasterLayer}}),E.o(Ke,"Scene")&&E.d(U,{Scene:function(){return Ke.Scene}}),E.o(Ke,"gl")&&E.d(U,{gl:function(){return Ke.gl}});var Xe=E(84007),Ut=E.n(Xe);E.o(Xe,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Xe.CityBuildingLayer}}),E.o(Xe,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Xe.HeatmapLayer}}),E.o(Xe,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Xe.ImageLayer}}),E.o(Xe,"LineLayer")&&E.d(U,{LineLayer:function(){return Xe.LineLayer}}),E.o(Xe,"Marker")&&E.d(U,{Marker:function(){return Xe.Marker}}),E.o(Xe,"PointLayer")&&E.d(U,{PointLayer:function(){return Xe.PointLayer}}),E.o(Xe,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Xe.PolygonLayer}}),E.o(Xe,"Popup")&&E.d(U,{Popup:function(){return Xe.Popup}}),E.o(Xe,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Xe.RasterLayer}}),E.o(Xe,"Scene")&&E.d(U,{Scene:function(){return Xe.Scene}}),E.o(Xe,"gl")&&E.d(U,{gl:function(){return Xe.gl}});var _r=E(89648),ar=E(90919),zr=E.n(ar);E.o(ar,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ar.CityBuildingLayer}}),E.o(ar,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ar.HeatmapLayer}}),E.o(ar,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ar.ImageLayer}}),E.o(ar,"LineLayer")&&E.d(U,{LineLayer:function(){return ar.LineLayer}}),E.o(ar,"Marker")&&E.d(U,{Marker:function(){return ar.Marker}}),E.o(ar,"PointLayer")&&E.d(U,{PointLayer:function(){return ar.PointLayer}}),E.o(ar,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ar.PolygonLayer}}),E.o(ar,"Popup")&&E.d(U,{Popup:function(){return ar.Popup}}),E.o(ar,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ar.RasterLayer}}),E.o(ar,"Scene")&&E.d(U,{Scene:function(){return ar.Scene}}),E.o(ar,"gl")&&E.d(U,{gl:function(){return ar.gl}});var fe=E(75925),Re=E.n(fe);E.o(fe,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return fe.CityBuildingLayer}}),E.o(fe,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return fe.HeatmapLayer}}),E.o(fe,"ImageLayer")&&E.d(U,{ImageLayer:function(){return fe.ImageLayer}}),E.o(fe,"LineLayer")&&E.d(U,{LineLayer:function(){return fe.LineLayer}}),E.o(fe,"Marker")&&E.d(U,{Marker:function(){return fe.Marker}}),E.o(fe,"PointLayer")&&E.d(U,{PointLayer:function(){return fe.PointLayer}}),E.o(fe,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return fe.PolygonLayer}}),E.o(fe,"Popup")&&E.d(U,{Popup:function(){return fe.Popup}}),E.o(fe,"RasterLayer")&&E.d(U,{RasterLayer:function(){return fe.RasterLayer}}),E.o(fe,"Scene")&&E.d(U,{Scene:function(){return fe.Scene}}),E.o(fe,"gl")&&E.d(U,{gl:function(){return fe.gl}});var ge=E(85040),_t=E.n(ge);E.o(ge,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ge.CityBuildingLayer}}),E.o(ge,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ge.HeatmapLayer}}),E.o(ge,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ge.ImageLayer}}),E.o(ge,"LineLayer")&&E.d(U,{LineLayer:function(){return ge.LineLayer}}),E.o(ge,"Marker")&&E.d(U,{Marker:function(){return ge.Marker}}),E.o(ge,"PointLayer")&&E.d(U,{PointLayer:function(){return ge.PointLayer}}),E.o(ge,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ge.PolygonLayer}}),E.o(ge,"Popup")&&E.d(U,{Popup:function(){return ge.Popup}}),E.o(ge,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ge.RasterLayer}}),E.o(ge,"Scene")&&E.d(U,{Scene:function(){return ge.Scene}}),E.o(ge,"gl")&&E.d(U,{gl:function(){return ge.gl}});var pt=E(8594),Nt=E.n(pt);E.o(pt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return pt.CityBuildingLayer}}),E.o(pt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return pt.HeatmapLayer}}),E.o(pt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return pt.ImageLayer}}),E.o(pt,"LineLayer")&&E.d(U,{LineLayer:function(){return pt.LineLayer}}),E.o(pt,"Marker")&&E.d(U,{Marker:function(){return pt.Marker}}),E.o(pt,"PointLayer")&&E.d(U,{PointLayer:function(){return pt.PointLayer}}),E.o(pt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return pt.PolygonLayer}}),E.o(pt,"Popup")&&E.d(U,{Popup:function(){return pt.Popup}}),E.o(pt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return pt.RasterLayer}}),E.o(pt,"Scene")&&E.d(U,{Scene:function(){return pt.Scene}}),E.o(pt,"gl")&&E.d(U,{gl:function(){return pt.gl}});var Bt=E(67571),kr=E.n(Bt);E.o(Bt,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Bt.CityBuildingLayer}}),E.o(Bt,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Bt.HeatmapLayer}}),E.o(Bt,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Bt.ImageLayer}}),E.o(Bt,"LineLayer")&&E.d(U,{LineLayer:function(){return Bt.LineLayer}}),E.o(Bt,"Marker")&&E.d(U,{Marker:function(){return Bt.Marker}}),E.o(Bt,"PointLayer")&&E.d(U,{PointLayer:function(){return Bt.PointLayer}}),E.o(Bt,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Bt.PolygonLayer}}),E.o(Bt,"Popup")&&E.d(U,{Popup:function(){return Bt.Popup}}),E.o(Bt,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Bt.RasterLayer}}),E.o(Bt,"Scene")&&E.d(U,{Scene:function(){return Bt.Scene}}),E.o(Bt,"gl")&&E.d(U,{gl:function(){return Bt.gl}});var ln=E(66718),yn=E.n(ln);E.o(ln,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return ln.CityBuildingLayer}}),E.o(ln,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return ln.HeatmapLayer}}),E.o(ln,"ImageLayer")&&E.d(U,{ImageLayer:function(){return ln.ImageLayer}}),E.o(ln,"LineLayer")&&E.d(U,{LineLayer:function(){return ln.LineLayer}}),E.o(ln,"Marker")&&E.d(U,{Marker:function(){return ln.Marker}}),E.o(ln,"PointLayer")&&E.d(U,{PointLayer:function(){return ln.PointLayer}}),E.o(ln,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return ln.PolygonLayer}}),E.o(ln,"Popup")&&E.d(U,{Popup:function(){return ln.Popup}}),E.o(ln,"RasterLayer")&&E.d(U,{RasterLayer:function(){return ln.RasterLayer}}),E.o(ln,"Scene")&&E.d(U,{Scene:function(){return ln.Scene}}),E.o(ln,"gl")&&E.d(U,{gl:function(){return ln.gl}});var Vi=E(92364),nr=E(78010),de=E.n(nr);E.o(nr,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return nr.CityBuildingLayer}}),E.o(nr,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return nr.HeatmapLayer}}),E.o(nr,"ImageLayer")&&E.d(U,{ImageLayer:function(){return nr.ImageLayer}}),E.o(nr,"LineLayer")&&E.d(U,{LineLayer:function(){return nr.LineLayer}}),E.o(nr,"Marker")&&E.d(U,{Marker:function(){return nr.Marker}}),E.o(nr,"PointLayer")&&E.d(U,{PointLayer:function(){return nr.PointLayer}}),E.o(nr,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return nr.PolygonLayer}}),E.o(nr,"Popup")&&E.d(U,{Popup:function(){return nr.Popup}}),E.o(nr,"RasterLayer")&&E.d(U,{RasterLayer:function(){return nr.RasterLayer}}),E.o(nr,"Scene")&&E.d(U,{Scene:function(){return nr.Scene}}),E.o(nr,"gl")&&E.d(U,{gl:function(){return nr.gl}});var Te=E(68116),Ue=E.n(Te);E.o(Te,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Te.CityBuildingLayer}}),E.o(Te,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Te.HeatmapLayer}}),E.o(Te,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Te.ImageLayer}}),E.o(Te,"LineLayer")&&E.d(U,{LineLayer:function(){return Te.LineLayer}}),E.o(Te,"Marker")&&E.d(U,{Marker:function(){return Te.Marker}}),E.o(Te,"PointLayer")&&E.d(U,{PointLayer:function(){return Te.PointLayer}}),E.o(Te,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Te.PolygonLayer}}),E.o(Te,"Popup")&&E.d(U,{Popup:function(){return Te.Popup}}),E.o(Te,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Te.RasterLayer}}),E.o(Te,"Scene")&&E.d(U,{Scene:function(){return Te.Scene}}),E.o(Te,"gl")&&E.d(U,{gl:function(){return Te.gl}});var Le=E(23067),Ft=E.n(Le);E.o(Le,"CityBuildingLayer")&&E.d(U,{CityBuildingLayer:function(){return Le.CityBuildingLayer}}),E.o(Le,"HeatmapLayer")&&E.d(U,{HeatmapLayer:function(){return Le.HeatmapLayer}}),E.o(Le,"ImageLayer")&&E.d(U,{ImageLayer:function(){return Le.ImageLayer}}),E.o(Le,"LineLayer")&&E.d(U,{LineLayer:function(){return Le.LineLayer}}),E.o(Le,"Marker")&&E.d(U,{Marker:function(){return Le.Marker}}),E.o(Le,"PointLayer")&&E.d(U,{PointLayer:function(){return Le.PointLayer}}),E.o(Le,"PolygonLayer")&&E.d(U,{PolygonLayer:function(){return Le.PolygonLayer}}),E.o(Le,"Popup")&&E.d(U,{Popup:function(){return Le.Popup}}),E.o(Le,"RasterLayer")&&E.d(U,{RasterLayer:function(){return Le.RasterLayer}}),E.o(Le,"Scene")&&E.d(U,{Scene:function(){return Le.Scene}}),E.o(Le,"gl")&&E.d(U,{gl:function(){return Le.gl}});var er=E(7648)},12250:function(Or,U,E){"use strict";E.d(U,{e7:function(){return gi},Hp:function(){return Un},ZP:function(){return ni},yT:function(){return ri}});var le=E(28660),C=E(26729),d=E.n(C),A=E(86700),Q=E(84879),K=E(72302),W=E(6610),L=E(5991),N=E(96156),Ne=E(6901),Ye=E(49296),Je=E.n(Ye);function rt(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function Yt(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?rt(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):rt(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Vt(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=tr(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,re=function(){};return{s:re,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:re}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,dt=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){dt=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(dt)throw wt}}}}function tr(te,q){if(!!te){if(typeof te=="string")return zt(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return zt(te,q)}}function zt(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}var Tt=30;function xt(te){var q=te.characterSet,R=te.getFontWidth,F=te.fontHeight,re=te.buffer,pe=te.maxCanvasWidth,dt=te.mapping,wt=dt===void 0?{}:dt,At=te.xOffset,qt=At===void 0?0:At,Pr=te.yOffset,mn=Pr===void 0?0:Pr,Zn=0,Jn=qt;Array.from(q).forEach(function(si,ji){if(!wt[si]){var $i=R(si,ji);Jn+Tt>pe&&(Jn=0,Zn++),wt[si]={x:Jn,y:mn+Zn*Tt,width:Tt,height:Tt,advance:$i},Jn+=Tt}});var _i=F+re*2;return{mapping:wt,xOffset:Jn,yOffset:mn+Zn*_i,canvasHeight:dr(mn+(Zn+1)*_i)}}function yr(te,q,R){var F=0,re=0,pe=0,dt=[],wt={},At=Vt(te),qt;try{for(At.s();!(qt=At.n()).done;){var Pr=qt.value;if(!wt[Pr.id]){var mn=Pr.size;F+mn+q>R&&(ee(wt,dt,re),F=0,re=pe+re+q,pe=0,dt=[]),dt.push({icon:Pr,xOffset:F}),F=F+mn+q,pe=Math.max(pe,mn)}}}catch(Jn){At.e(Jn)}finally{At.f()}dt.length>0&&ee(wt,dt,re);var Zn=dr(pe+re+q);return{mapping:wt,canvasHeight:Zn}}function ee(te,q,R){var F=Vt(q),re;try{for(F.s();!(re=F.n()).done;){var pe=re.value,dt=pe.icon,wt=pe.xOffset;te[dt.id]=Yt(Yt({},dt),{},{x:wt,y:R,image:dt.image,width:dt.width,height:dt.height})}}catch(At){F.e(At)}finally{F.f()}}function dr(te){return Math.pow(2,Math.ceil(Math.log2(te)))}var Ct,Ke;function Dt(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=Xe(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,re=function(){};return{s:re,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:re}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,dt=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){dt=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(dt)throw wt}}}}function Xe(te,q){if(!!te){if(typeof te=="string")return Ut(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return Ut(te,q)}}function Ut(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}function _r(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function ar(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?_r(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):_r(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var zr=nr(),fe="sans-serif",Re="normal",ge=24,_t=3,pt=.25,Nt=8,Bt=1024,kr=1,ln=1,yn=3,Vi=null;function nr(){for(var te=[],q=32;q<128;q++)te.push(String.fromCharCode(q));return te}function de(te,q,R,F){te.font="".concat(F," ").concat(R,"px ").concat(q),te.fillStyle="black",te.textBaseline="middle"}function Te(te,q){for(var R=0;R<te.length;R++)q.data[4*R+3]=te[R]}var Ue=(Ct=(0,A.b2)(),Ct(Ke=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"fontAtlas",void 0),(0,N.Z)(this,"iconFontMap",void 0),(0,N.Z)(this,"iconFontGlyphs",{}),(0,N.Z)(this,"fontOptions",void 0),(0,N.Z)(this,"key",void 0),(0,N.Z)(this,"cache",new Ne.z6(yn))}return(0,L.Z)(te,[{key:"scale",get:function(){return ln}},{key:"canvas",get:function(){var R=this.cache.get(this.key);return R&&R.data}},{key:"mapping",get:function(){var R=this.cache.get(this.key);return R&&R.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:fe,fontWeight:Re,characterSet:zr,fontSize:ge,buffer:_t,sdf:!0,cutoff:pt,radius:Nt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(R){var F=this;R.forEach(function(re){F.iconFontGlyphs[re.name]=re.unicode})}},{key:"addIconFont",value:function(R,F){this.iconFontMap.set(R,F)}},{key:"getIconFontKey",value:function(R){return this.iconFontMap.get(R)||R}},{key:"getGlyph",value:function(R){return this.iconFontGlyphs[R]?String.fromCharCode(parseInt(this.iconFontGlyphs[R],16)):""}},{key:"setFontOptions",value:function(R){this.fontOptions=ar(ar({},this.fontOptions),R),this.key=this.getKey();var F=this.getNewChars(this.key,this.fontOptions.characterSet),re=this.cache.get(this.key);if(!(re&&F.length===0)){var pe=this.generateFontAtlas(this.key,F,re);this.fontAtlas=pe,this.cache.set(this.key,pe)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(R,F,re){var pe=this.fontOptions,dt=pe.fontFamily,wt=pe.fontWeight,At=pe.fontSize,qt=pe.buffer,Pr=pe.sdf,mn=pe.radius,Zn=pe.cutoff,Jn=pe.iconfont,_i=re&&re.data;_i||(_i=document.createElement("canvas"),_i.width=Bt);var si=_i.getContext("2d");de(si,dt,At,wt);var ji=xt(ar({getFontWidth:function(qs){return si.measureText(qs).width},fontHeight:At*ln,buffer:qt,characterSet:F,maxCanvasWidth:Bt},re&&{mapping:re.mapping,xOffset:re.xOffset,yOffset:re.yOffset})),$i=ji.mapping,xa=ji.canvasHeight,ao=ji.xOffset,La=ji.yOffset,co=si.getImageData(0,0,_i.width,_i.height);if(_i.height=xa,si.putImageData(co,0,0),de(si,dt,At,wt),Pr){var Ga=new(Je())(At,qt,mn,Zn,dt,wt),ta=si.getImageData(0,0,Ga.size,Ga.size),va=Dt(F),za;try{for(va.s();!(za=va.n()).done;){var fa=za.value;if(Jn){var Ta=String.fromCharCode(parseInt(fa.replace("&#x","").replace(";",""),16)),bo=Ga.draw(Ta);Te(bo,ta)}else Te(Ga.draw(fa),ta);si.putImageData(ta,$i[fa].x,$i[fa].y)}}catch(fo){va.e(fo)}finally{va.f()}}else{var Fo=Dt(F),ua;try{for(Fo.s();!(ua=Fo.n()).done;){var Zo=ua.value;si.fillText(Zo,$i[Zo].x,$i[Zo].y+At*kr)}}catch(fo){Fo.e(fo)}finally{Fo.f()}}return{xOffset:ao,yOffset:La,mapping:$i,data:_i,width:_i.width,height:_i.height}}},{key:"getKey",value:function(){return"key";var R,F,re,pe,dt,wt,At,qt}},{key:"getNewChars",value:function(R,F){var re=this.cache.get(R);if(!re)return F;var pe=[],dt=re.mapping,wt=new Set(Object.keys(dt)),At=new Set(F);return At.forEach(function(qt){wt.has(qt)||pe.push(qt)}),pe}}]),te}())||Ke),Le=E(63349),Ft=E(10379),er=E(46070),w=E(77608),Z,Ee;function Ze(te){var q=Qe();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Qe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var yt=3,St=1024,jt=64,Et=(Z=(0,A.b2)(),Z(Ee=function(te){(0,Ft.Z)(R,te);var q=Ze(R);function R(){var F;(0,W.Z)(this,R);for(var re=arguments.length,pe=new Array(re),dt=0;dt<re;dt++)pe[dt]=arguments[dt];return F=q.call.apply(q,[this].concat(pe)),(0,N.Z)((0,Le.Z)(F),"canvasHeight",128),(0,N.Z)((0,Le.Z)(F),"texture",void 0),(0,N.Z)((0,Le.Z)(F),"canvas",void 0),(0,N.Z)((0,Le.Z)(F),"iconData",void 0),(0,N.Z)((0,Le.Z)(F),"iconMap",void 0),(0,N.Z)((0,Le.Z)(F),"ctx",void 0),(0,N.Z)((0,Le.Z)(F),"loadingImageCount",0),F}return(0,L.Z)(R,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(re,pe){var dt=this,wt=new Image;if(this.loadingImageCount++,this.hasImage(re))throw new Error("Image Id already exists");this.iconData.push({id:re,size:jt}),this.updateIconMap(),this.loadImage(pe).then(function(At){wt=At;var qt=dt.iconData.find(function(Pr){return Pr.id===re});qt&&(qt.image=wt,qt.width=wt.width,qt.height=wt.height),dt.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(re){return this.iconMap.hasOwnProperty(re)}},{key:"removeImage",value:function(re){this.hasImage(re)&&(this.iconData=this.iconData.filter(function(pe){return pe.id!==re}),delete this.iconMap[re],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var re=this;this.canvas.width=St,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(pe){var dt=re.iconMap[pe],wt=dt.x,At=dt.y,qt=dt.image,Pr=dt.width,mn=Pr===void 0?64:Pr,Zn=dt.height,Jn=Zn===void 0?64:Zn,_i=Math.max(mn,Jn),si=_i/jt,ji=Jn/si,$i=mn/si;qt&&re.ctx.drawImage(qt,wt+(jt-$i)/2,At+(jt-ji)/2,$i,ji)})}},{key:"updateIconMap",value:function(){var re=yr(this.iconData,yt,St),pe=re.mapping,dt=re.canvasHeight;this.iconMap=pe,this.canvasHeight=dt}},{key:"loadImage",value:function(re){return new Promise(function(pe,dt){if(re instanceof HTMLImageElement){pe(re);return}var wt=new Image;wt.crossOrigin="anonymous",wt.onload=function(){pe(wt)},wt.onerror=function(){dt(new Error("Could not load image at "+re))},wt.src=re instanceof File?URL.createObjectURL(re):re})}}]),R}(C.EventEmitter))||Ee),Qt=E(28481),ie=E(85975),sr,Br,Lr=(sr=(0,A.b2)(),sr(Br=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"viewport",void 0),(0,N.Z)(this,"overridedViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,N.Z)(this,"jitteredProjectionMatrix",void 0),(0,N.Z)(this,"viewMatrixInverse",void 0),(0,N.Z)(this,"cameraPosition",void 0)}return(0,L.Z)(te,[{key:"init",value:function(){}},{key:"update",value:function(R){this.viewport=R,this.viewMatrixInverse=ie.create(),ie.invert(this.viewMatrixInverse,R.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var R=this.viewport.getCenter(),F=(0,Qt.Z)(R,2),re=F[0],pe=F[1];return[re,pe]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(R,F){return this.viewport.projectFlat(R,F)}},{key:"setViewProjectionMatrix",value:function(R){this.overridedViewProjectionMatrix=R}},{key:"jitterProjectionMatrix",value:function(R,F){var re=ie.fromTranslation(ie.create(),[R,F,0]);this.jitteredProjectionMatrix=ie.multiply(ie.create(),re,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=ie.multiply(ie.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),te}())||Br),nt,gt;function vt(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=hr(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,re=function(){};return{s:re,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:re}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,dt=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){dt=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(dt)throw wt}}}}function hr(te,q){if(!!te){if(typeof te=="string")return Vr(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return Vr(te,q)}}function Vr(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}var Ur=(nt=(0,A.b2)(),nt(gt=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"controlCorners",void 0),(0,N.Z)(this,"controlContainer",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"controls",[]),(0,N.Z)(this,"unAddControls",[])}return(0,L.Z)(te,[{key:"init",value:function(R,F){this.container=R.container,this.scene=F,this.mapsService=F.get(K.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(R,F){var re=F.get(K.v.IMapService);re.map?(R.addTo(this.scene),this.controls.push(R)):this.unAddControls.push(R)}},{key:"getControlByName",value:function(R){return this.controls.find(function(F){return F.controlOption.name===R})}},{key:"removeControl",value:function(R){var F=this.controls.indexOf(R);return F>-1&&this.controls.splice(F,1),R.remove(),this}},{key:"addControls",value:function(){var R=this;this.unAddControls.forEach(function(F){F.addTo(R.scene),R.controls.push(F)}),this.unAddControls=[]}},{key:"destroy",value:function(){var R=vt(this.controls),F;try{for(R.s();!(F=R.n()).done;){var re=F.value;re.remove()}}catch(pe){R.e(pe)}finally{R.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var R=this.controlCorners={},F="l7-",re=this.controlContainer=Ne.SO.create("div",F+"control-container",this.container);function pe(dt,wt){var At=F+dt+" "+F+wt;R[dt+wt]=Ne.SO.create("div",At,re)}pe("top","left"),pe("top","right"),pe("bottom","left"),pe("bottom","right")}},{key:"clearControlPos",value:function(){for(var R in this.controlCorners)this.controlCorners[R]&&Ne.SO.remove(this.controlCorners[R]);this.controlContainer&&Ne.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),te}())||gt),nn,Jr,Cr=(nn=(0,A.b2)(),nn(Jr=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"container",void 0),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"markers",[]),(0,N.Z)(this,"markerLayers",[]),(0,N.Z)(this,"unAddMarkers",[]),(0,N.Z)(this,"unAddMarkerLayers",[])}return(0,L.Z)(te,[{key:"addMarkerLayer",value:function(R){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(R),R.addTo(this.scene)):this.unAddMarkerLayers.push(R)}},{key:"removeMarkerLayer",value:function(R){R.destroy(),this.markerLayers.indexOf(R);var F=this.markerLayers.indexOf(R);F>-1&&this.markerLayers.splice(F,1)}},{key:"addMarker",value:function(R){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(R),R.addTo(this.scene)):this.unAddMarkers.push(R)}},{key:"addMarkers",value:function(){var R=this;this.unAddMarkers.forEach(function(F){F.addTo(R.scene),R.markers.push(F)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var R=this;this.unAddMarkerLayers.forEach(function(F){R.markerLayers.push(F),F.addTo(R.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(R){R.remove(),this.markers.indexOf(R);var F=this.markers.indexOf(R);F>-1&&this.markers.splice(F,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(R){this.scene=R,this.mapsService=R.get(K.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(R){R.remove()}),this.markers=[],this.markerLayers.forEach(function(R){R.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(R){R.destroy()}}]),te}())||Jr),Dn,Hn,bi=(Dn=(0,A.b2)(),Dn(Hn=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"scene",void 0),(0,N.Z)(this,"popup",void 0),(0,N.Z)(this,"mapsService",void 0),(0,N.Z)(this,"unAddPopup",void 0)}return(0,L.Z)(te,[{key:"removePopup",value:function(R){R.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(R){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(R.addTo(this.scene),this.popup=R):this.unAddPopup=R}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(R){this.scene=R,this.mapsService=R.get(K.v.IMapService)}}]),te}())||Hn),Ui=E(82492),Ji=E.n(Ui),Ri={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Ii=Ri,Y,ce;function ye(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function z(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?ye(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):ye(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var oe={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},me={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Ae=(Y=(0,A.b2)(),Y(ce=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"sceneConfigCache",{}),(0,N.Z)(this,"layerConfigCache",{})}return(0,L.Z)(te,[{key:"getSceneConfig",value:function(R){return this.sceneConfigCache[R]}},{key:"getSceneWarninfo",value:function(R){return Ii[R]}},{key:"setSceneConfig",value:function(R,F){this.sceneConfigCache[R]=z(z({},oe),F)}},{key:"getLayerConfig",value:function(R){return this.layerConfigCache[R]}},{key:"setLayerConfig",value:function(R,F,re){this.layerConfigCache[F]=z({},Ji()({},this.sceneConfigCache[R],me,re))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),te}())||ce),se=E(55770),Ce=E(3473),ct=E(98333),xr=Math.PI/180,Gt=512,Jt=4003e4;function Rr(te){var q=te.latitude,R=q===void 0?0:q,F=te.zoom,re=F===void 0?0:F,pe=te.scale,dt=te.highPrecision,wt=dt===void 0?!1:dt,At=te.flipY,qt=At===void 0?!1:At;pe=pe!==void 0?pe:Math.pow(2,re);var Pr={},mn=Gt*pe,Zn=Math.cos(R*xr),Jn=mn/360,_i=Jn/Zn,si=mn/Jt/Zn;if(Pr.pixelsPerMeter=[si,-si,si],Pr.metersPerPixel=[1/si,-1/si,1/si],Pr.pixelsPerDegree=[Jn,-_i,si],Pr.degreesPerPixel=[1/Jn,-1/_i,1/si],wt){var ji=xr*Math.tan(R*xr)/Zn,$i=Jn*ji/2,xa=mn/Jt*ji,ao=xa/_i*si;Pr.pixelsPerDegree2=[0,-$i,xa],Pr.pixelsPerMeter2=[ao,0,ao],qt&&(Pr.pixelsPerDegree2[1]=-Pr.pixelsPerDegree2[1],Pr.pixelsPerMeter2[1]=-Pr.pixelsPerMeter2[1])}return qt&&(Pr.pixelsPerMeter[1]=-Pr.pixelsPerMeter[1],Pr.metersPerPixel[1]=-Pr.metersPerPixel[1],Pr.pixelsPerDegree[1]=-Pr.pixelsPerDegree[1],Pr.degreesPerPixel[1]=-Pr.degreesPerPixel[1]),Pr}var Ln=E(47282),Mn,$t,bn,on,un,wi=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],xn=(Mn=(0,A.b2)(),$t=(0,A.f3)(K.v.ICameraService),Mn(bn=(on=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"needRefresh",!0),(0,se.Z)(this,"cameraService",un,this),(0,N.Z)(this,"coordinateSystem",void 0),(0,N.Z)(this,"viewportCenter",void 0),(0,N.Z)(this,"viewportCenterProjection",void 0),(0,N.Z)(this,"pixelsPerDegree",void 0),(0,N.Z)(this,"pixelsPerDegree2",void 0),(0,N.Z)(this,"pixelsPerMeter",void 0)}return(0,L.Z)(te,[{key:"refresh",value:function(){var R=this.cameraService.getZoom(),F=this.cameraService.getZoomScale(),re=this.cameraService.getCenter(),pe=Rr({latitude:re[1],zoom:R}),dt=pe.pixelsPerMeter,wt=pe.pixelsPerDegree;this.viewportCenter=re,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=dt,this.pixelsPerDegree=wt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Ln.l.LNGLAT||this.coordinateSystem===Ln.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Ln.l.LNGLAT_OFFSET?this.calculateLnglatOffset(re,R):this.coordinateSystem===Ln.l.P20_OFFSET&&this.calculateLnglatOffset(re,R,F,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(R){this.coordinateSystem=R}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(R,F,re,pe){var dt=Rr({latitude:R[1],zoom:F,scale:re,flipY:pe,highPrecision:!0}),wt=dt.pixelsPerMeter,At=dt.pixelsPerDegree,qt=dt.pixelsPerDegree2,Pr=this.cameraService.getViewMatrix(),mn=this.cameraService.getProjectionMatrix(),Zn=ie.multiply([],mn,Pr),Jn=this.cameraService.projectFlat([Math.fround(R[0]),Math.fround(R[1])],Math.pow(2,F));this.viewportCenterProjection=ct.fF([],[Jn[0],Jn[1],0,1],Zn),Pr=this.cameraService.getViewMatrixUncentered()||Pr,Zn=ie.multiply([],mn,Pr),Zn=ie.multiply([],Zn,wi),this.cameraService.setViewProjectionMatrix(Zn),this.pixelsPerMeter=wt,this.pixelsPerDegree=At,this.pixelsPerDegree2=qt}}]),te}(),un=(0,Ce.Z)(on.prototype,"cameraService",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),on))||bn),Oi=E(50840),Yi=E.n(Oi),oi=E(89648),Ki,zi,Ai,ca,ba;function ai(te){var q=ti();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function ti(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Gi={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},da=(Ki=(0,A.b2)(),zi=(0,A.f3)(K.v.IMapService),Ki(Ai=(ca=function(te){(0,Ft.Z)(R,te);var q=ai(R);function R(){var F;(0,W.Z)(this,R);for(var re=arguments.length,pe=new Array(re),dt=0;dt<re;dt++)pe[dt]=arguments[dt];return F=q.call.apply(q,[this].concat(pe)),(0,se.Z)((0,Le.Z)(F),"mapService",ba,(0,Le.Z)(F)),(0,N.Z)((0,Le.Z)(F),"hammertime",void 0),(0,N.Z)((0,Le.Z)(F),"lastClickTime",0),(0,N.Z)((0,Le.Z)(F),"lastClickXY",[-1,-1]),(0,N.Z)((0,Le.Z)(F),"clickTimer",void 0),(0,N.Z)((0,Le.Z)(F),"$containter",void 0),(0,N.Z)((0,Le.Z)(F),"onDrag",function(wt){var At=F.interactionEvent(wt);At.type=Gi[At.type],F.emit(oi.s.Drag,At)}),(0,N.Z)((0,Le.Z)(F),"onHammer",function(wt){wt.srcEvent.stopPropagation();var At=F.interactionEvent(wt);F.emit(oi.s.Hover,At)}),(0,N.Z)((0,Le.Z)(F),"onTouch",function(wt){var At=wt.touches[0];F.onHover({x:At.pageX,y:At.pageY,type:"touch"})}),(0,N.Z)((0,Le.Z)(F),"onHover",function(wt){var At=wt.clientX,qt=wt.clientY,Pr=At,mn=qt,Zn=wt.type,Jn=F.mapService.getMapContainer();if(Jn){var _i=Jn.getBoundingClientRect(),si=_i.top,ji=_i.left;Pr=Pr-ji-Jn.clientLeft,mn=mn-si-Jn.clientTop}var $i=F.mapService.containerToLngLat([Pr,mn]);if(Zn==="click"){if("ontouchstart"in document.documentElement)return;F.isDoubleTap(Pr,mn,$i);return}if(Zn==="touch"){F.isDoubleTap(Pr,mn,$i);return}Zn!=="click"&&Zn!=="dblclick"&&F.emit(oi.s.Hover,{x:Pr,y:mn,lngLat:$i,type:Zn,target:wt})}),F}return(0,L.Z)(R,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(oi.s.Hover)}},{key:"triggerHover",value:function(re){var pe=re.x,dt=re.y;this.emit(oi.s.Hover,{x:pe,y:dt})}},{key:"triggerSelect",value:function(re){this.emit(oi.s.Select,{featureId:re})}},{key:"triggerActive",value:function(re){this.emit(oi.s.Active,{featureId:re})}},{key:"addEventListenerOnMap",value:function(){var re=this.mapService.getMapContainer();if(re){var pe=new(Yi()).Manager(re);pe.add(new(Yi()).Tap({event:"dblclick",taps:2})),pe.add(new(Yi()).Tap({event:"click"})),pe.add(new(Yi()).Pan({threshold:0,pointers:0})),pe.add(new(Yi()).Press({})),pe.on("dblclick click",this.onHammer),pe.on("panstart panmove panend pancancel",this.onDrag),re.addEventListener("mousemove",this.onHover),re.addEventListener("mousedown",this.onHover,!0),re.addEventListener("mouseup",this.onHover),re.addEventListener("contextmenu",this.onHover),this.hammertime=pe}}},{key:"removeEventListenerOnMap",value:function(){var re=this.mapService.getMapContainer();re&&(re.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),re.removeEventListener("mousedown",this.onHover),re.removeEventListener("mouseup",this.onHover),re.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(re){var pe=re.type,dt=re.pointerType,wt,At;dt==="touch"?(At=Math.floor(re.pointers[0].clientY),wt=Math.floor(re.pointers[0].clientX)):(At=Math.floor(re.srcEvent.y),wt=Math.floor(re.srcEvent.x));var qt=this.mapService.getMapContainer();if(qt){var Pr=qt.getBoundingClientRect(),mn=Pr.top,Zn=Pr.left;wt-=Zn,At-=mn}var Jn=this.mapService.containerToLngLat([wt,At]);return{x:wt,y:At,lngLat:Jn,type:pe,target:re.srcEvent}}},{key:"isDoubleTap",value:function(re,pe,dt){var wt=this,At=new Date().getTime(),qt="click";At-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-re)<10&&Math.abs(this.lastClickXY[1]-pe)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),qt="dblclick",this.emit(oi.s.Hover,{x:re,y:pe,lngLat:dt,type:qt})):(this.lastClickTime=At,this.lastClickXY=[re,pe],this.clickTimer=setTimeout(function(){qt="click",wt.emit(oi.s.Hover,{x:re,y:pe,lngLat:dt,type:qt})},400))}}]),R}(d()),ba=(0,Ce.Z)(ca.prototype,"mapService",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ca))||Ai),Xo=E(92137),ya=E(87757),mi=E.n(ya),ga=E(7648),Gs,Sa,Co,Wa,Xa,Yo,Zi,Ao,Lo,so,Ro;function Hi(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function Da(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Hi(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Hi(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var Ba=(Gs=(0,A.b2)(),Sa=(0,A.f3)(K.v.IRendererService),Co=(0,A.f3)(K.v.IGlobalConfigService),Wa=(0,A.f3)(K.v.IInteractionService),Xa=(0,A.f3)(K.v.ILayerService),Gs(Yo=(Zi=function(){function te(){var q=this;(0,W.Z)(this,te),(0,se.Z)(this,"rendererService",Ao,this),(0,se.Z)(this,"configService",Lo,this),(0,se.Z)(this,"interactionService",so,this),(0,se.Z)(this,"layerService",Ro,this),(0,N.Z)(this,"pickingFBO",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0),(0,N.Z)(this,"alreadyInPicking",!1),(0,N.Z)(this,"pickBufferScale",1),(0,N.Z)(this,"pickFromPickingFBO",function(R,F){var re,pe=F.x,dt=F.y,wt=F.lngLat,At=F.type,qt=F.target,Pr=!1,mn=q.rendererService,Zn=mn.getViewportSize,Jn=mn.readPixels,_i=mn.getContainer,si=_i().getBoundingClientRect(),ji=si.width,$i=si.height;ji*=Ne.SO.DPR,$i*=Ne.SO.DPR;var xa=R.getLayerConfig(),ao=xa.enableHighlight,La=xa.enableSelect,co=pe*Ne.SO.DPR,Ga=dt*Ne.SO.DPR;if(co>ji-1*Ne.SO.DPR||co<0||Ga>$i-1*Ne.SO.DPR||Ga<0)return!1;var ta;if(ta=Jn({x:Math.floor(co/q.pickBufferScale),y:Math.floor(($i-(dt+1)*Ne.SO.DPR)/q.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:q.pickingFBO}),ta[0]!==0||ta[1]!==0||ta[2]!==0){var va=(0,Ne.W0)(ta),za=R.getSource().getFeatureById(va);va!==R.getCurrentPickId()&&At==="mousemove"&&(At="mouseenter");var fa={x:pe,y:dt,type:At,lngLat:wt,featureId:va,feature:za,target:qt};za&&(Pr=!0,R.setCurrentPickId(va),q.triggerHoverOnLayer(R,fa))}else{var Ta={x:pe,y:dt,lngLat:wt,type:R.getCurrentPickId()!==null&&At==="mousemove"?"mouseout":"un"+At,featureId:null,target:qt,feature:null};q.triggerHoverOnLayer(R,Da(Da({},Ta),{},{type:"unpick"})),q.triggerHoverOnLayer(R,Ta),R.setCurrentPickId(null)}if(ao&&q.highlightPickedFeature(R,ta),La&&At==="click"&&((re=ta)===null||re===void 0?void 0:re.toString())!==[0,0,0,0].toString()){var bo=(0,Ne.W0)(ta);R.getCurrentSelectedId()===null||bo!==R.getCurrentSelectedId()?(q.selectFeature(R,ta),R.setCurrentSelectedId(bo)):(q.selectFeature(R,new Uint8Array([0,0,0,0])),R.setCurrentSelectedId(null))}return Pr})}return(0,L.Z)(te,[{key:"init",value:function(R){var F=this.rendererService,re=F.createTexture2D,pe=F.createFramebuffer,dt=F.getViewportSize,wt=F.getContainer,At=wt().getBoundingClientRect(),qt=At.width,Pr=At.height;qt*=Ne.SO.DPR,Pr*=Ne.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(R).pickBufferScale||1,this.pickingFBO=pe({color:re({width:Math.round(qt/this.pickBufferScale),height:Math.round(Pr/this.pickBufferScale),wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.interactionService.on(oi.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var q=(0,Xo.Z)(mi().mark(function F(re,pe,dt){var wt=this,At,qt,Pr,mn;return mi().wrap(function(Jn){for(;;)switch(Jn.prev=Jn.next){case 0:At=this.rendererService,qt=At.useFramebuffer,Pr=At.clear,mn=At.getContainer,this.resizePickingFBO(),qt(this.pickingFBO,function(){Pr({framebuffer:wt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),re.hooks.beforePickingEncode.call(),re.renderModels(),re.hooks.afterPickingEncode.call();var _i=wt.pickBox(re,pe);dt(_i)});case 3:case"end":return Jn.stop()}},F,this)}));function R(F,re,pe){return q.apply(this,arguments)}return R}()},{key:"pickBox",value:function(R,F){var re=this,pe=F.map(function(Ta){var bo=Ta<0?0:Ta;return Math.floor(bo*Ne.SO.DPR/re.pickBufferScale)}),dt=(0,Qt.Z)(pe,4),wt=dt[0],At=dt[1],qt=dt[2],Pr=dt[3],mn=this.rendererService,Zn=mn.getViewportSize,Jn=mn.readPixels,_i=mn.getContainer,si=_i().getBoundingClientRect(),ji=si.width,$i=si.height;if(ji*=Ne.SO.DPR,$i*=Ne.SO.DPR,wt>(ji-1)*Ne.SO.DPR/this.pickBufferScale||qt<0||At>($i-1)*Ne.SO.DPR/this.pickBufferScale||Pr<0)return[];var xa,ao=Math.min(ji/this.pickBufferScale,qt)-wt,La=Math.min($i/this.pickBufferScale,Pr)-At;xa=Jn({x:wt,y:Math.floor($i/this.pickBufferScale-(Pr+1)),width:ao,height:La,data:new Uint8Array(ao*La*4),framebuffer:this.pickingFBO});for(var co=[],Ga={},ta=0;ta<xa.length/4;ta=ta+1){var va=xa.slice(ta*4,ta*4+4),za=(0,Ne.W0)(va);if(za!==-1&&!Ga[za]){var fa=R.getSource().getFeatureById(za);co.push(fa),Ga[za]=!0}}return co}},{key:"pickingAllLayer",value:function(){var q=(0,Xo.Z)(mi().mark(function F(re){return mi().wrap(function(dt){for(;;)switch(dt.prev=dt.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){dt.next=2;break}return dt.abrupt("return");case 2:return this.alreadyInPicking=!0,dt.next=5,this.pickingLayers(re);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return dt.stop()}},F,this)}));function R(F){return q.apply(this,arguments)}return R}()},{key:"resizePickingFBO",value:function(){var R=this.rendererService.getContainer,F=R().getBoundingClientRect(),re=F.width,pe=F.height;re*=Ne.SO.DPR,pe*=Ne.SO.DPR,(this.width!==re||this.height!==pe)&&(this.pickingFBO.resize({width:Math.round(re/this.pickBufferScale),height:Math.round(pe/this.pickBufferScale)}),this.width=re,this.height=pe)}},{key:"pickingLayers",value:function(){var q=(0,Xo.Z)(mi().mark(function F(re){var pe=this,dt,wt,At,qt,Pr;return mi().wrap(function(Zn){for(;;)switch(Zn.prev=Zn.next){case 0:dt=this.rendererService,wt=dt.getViewportSize,At=dt.useFramebuffer,qt=dt.clear,Pr=dt.getContainer,this.resizePickingFBO(),At(this.pickingFBO,function(){var Jn=pe.layerService.getLayers();Jn.filter(function(_i){return _i.needPick(re.type)}).reverse().some(function(_i){qt({framebuffer:pe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),_i.hooks.beforePickingEncode.call(),_i.renderModels(),_i.hooks.afterPickingEncode.call();var si=pe.pickFromPickingFBO(_i,re);return si&&!_i.getLayerConfig().enablePropagation})});case 3:case"end":return Zn.stop()}},F,this)}));function R(F){return q.apply(this,arguments)}return R}()},{key:"triggerHoverOnLayer",value:function(R,F){R.emit(F.type,F)}},{key:"isEventCrash",value:function(R){var F=!0;return R.target.path.map(function(re){re.classList&&re.classList.forEach(function(pe){(pe==="l7-marker"||pe==="l7-popup")&&(F=!1)})}),F}},{key:"highlightPickedFeature",value:function(R,F){var re=(0,Qt.Z)(F,3),pe=re[0],dt=re[1],wt=re[2];R.hooks.beforeHighlight.call([pe,dt,wt])}},{key:"selectFeature",value:function(R,F){var re=(0,Qt.Z)(F,3),pe=re[0],dt=re[1],wt=re[2];R.hooks.beforeSelect.call([pe,dt,wt])}}]),te}(),Ao=(0,Ce.Z)(Zi.prototype,"rendererService",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lo=(0,Ce.Z)(Zi.prototype,"configService",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),so=(0,Ce.Z)(Zi.prototype,"interactionService",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=(0,Ce.Z)(Zi.prototype,"layerService",[Xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zi))||Yo),_s=function(){function te(){var q=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,W.Z)(this,te),(0,N.Z)(this,"autoStart",void 0),(0,N.Z)(this,"startTime",0),(0,N.Z)(this,"oldTime",0),(0,N.Z)(this,"running",!1),(0,N.Z)(this,"elapsedTime",0),this.autoStart=q}return(0,L.Z)(te,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var R=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var F=(typeof performance=="undefined"?Date:performance).now();R=(F-this.oldTime)/1e3,this.oldTime=F,this.elapsedTime+=R}return R}}]),te}(),_a,xe,ke,lt,Xt,Xr,$n,yi=(_a=(0,A.b2)(),xe=(0,A.f3)(K.v.IRendererService),ke=(0,A.f3)(K.v.IGlobalConfigService),_a(lt=(Xt=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"clock",new _s),(0,N.Z)(this,"alreadyInRendering",!1),(0,N.Z)(this,"layers",[]),(0,N.Z)(this,"layerRenderID",void 0),(0,N.Z)(this,"sceneInited",!1),(0,N.Z)(this,"animateInstanceCount",0),(0,se.Z)(this,"renderService",Xr,this),(0,se.Z)(this,"configService",$n,this)}return(0,L.Z)(te,[{key:"add",value:function(R){this.sceneInited&&R.init(),this.layers.push(R)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(R){R.inited||R.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(R){return this.layers.find(function(F){return F.id===R})}},{key:"getLayerByName",value:function(R){return this.layers.find(function(F){return F.name===R})}},{key:"remove",value:function(R){var F=this.layers.indexOf(R);F>-1&&this.layers.splice(F,1),R.emit("remove",null),R.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(R){return R.inited}).filter(function(R){return R.isVisible()}).forEach(function(R){R.hooks.beforeRenderData.call(),R.hooks.beforeRender.call(),R.render(),R.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(R,F){return R.zIndex-F.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(R){return R.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),te}(),Xr=(0,Ce.Z)(Xt.prototype,"renderService",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$n=(0,Ce.Z)(Xt.prototype,"configService",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt))||lt),no=E(81253),Ya=E(85061),uo=E(14293),Ko=E.n(uo),Hs=function(){function te(q){var R=this;(0,W.Z)(this,te),(0,N.Z)(this,"name",void 0),(0,N.Z)(this,"type",void 0),(0,N.Z)(this,"scale",void 0),(0,N.Z)(this,"descriptor",void 0),(0,N.Z)(this,"featureBufferLayout",[]),(0,N.Z)(this,"needRescale",!1),(0,N.Z)(this,"needRemapping",!1),(0,N.Z)(this,"needRegenerateVertices",!1),(0,N.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,N.Z)(this,"vertexAttribute",void 0),(0,N.Z)(this,"defaultCallback",function(F){if(F.length===0){var re;return((re=R.scale)===null||re===void 0?void 0:re.defaultValues)||[]}return F.map(function(pe,dt){var wt,At=(wt=R.scale)===null||wt===void 0?void 0:wt.scalers[dt].func,qt=At(pe);return qt})}),this.setProps(q)}return(0,L.Z)(te,[{key:"setProps",value:function(R){Object.assign(this,R)}},{key:"mapping",value:function(R){var F;if((F=this.scale)!==null&&F!==void 0&&F.callback){var re,pe=(re=this.scale)===null||re===void 0?void 0:re.callback.apply(re,(0,Ya.Z)(R));if(!Ko()(pe))return[pe]}return this.defaultCallback(R)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),te}(),xs,po,fs,zo,$o,yo;function Si(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function Ts(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Si(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Si(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Ps(te){return new Promise(function(q){return setTimeout(q,te)})}var bs=(xs={},(0,N.Z)(xs,ga.gl.FLOAT,4),(0,N.Z)(xs,ga.gl.UNSIGNED_BYTE,1),(0,N.Z)(xs,ga.gl.UNSIGNED_SHORT,2),xs),Ca=(po=(0,A.b2)(),fs=(0,A.f3)(K.v.IRendererService),po(zo=($o=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"attributesAndIndices",void 0),(0,se.Z)(this,"rendererService",yo,this),(0,N.Z)(this,"attributes",[]),(0,N.Z)(this,"triangulation",void 0),(0,N.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,L.Z)(te,[{key:"registerStyleAttribute",value:function(R){var F=this.getLayerStyleAttribute(R.name||"");return F?F.setProps(R):(F=new Hs(R),this.attributes.push(F)),F}},{key:"updateStyleAttribute",value:function(R,F,re){var pe=this.getLayerStyleAttribute(R);pe||(pe=this.registerStyleAttribute(Ts(Ts({},F),{},{name:R})));var dt=F.scale;dt&&pe&&(pe.scale=dt,pe.needRescale=!0,pe.needRemapping=!0,pe.needRegenerateVertices=!0,re&&re.featureRange&&(pe.featureRange=re.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(R){return this.attributes.find(function(F){return F.name===R})}},{key:"getLayerAttributeScale",value:function(R){var F,re=this.getLayerStyleAttribute(R),pe=re==null||(F=re.scale)===null||F===void 0?void 0:F.scalers;return pe&&pe[0]?pe[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(R,F){var re=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,pe=arguments.length>3?arguments[3]:void 0,dt=this.attributes.find(function(La){return La.name===R});if(dt&&dt.descriptor){var wt=dt.descriptor,At=wt.update,qt=wt.buffer,Pr=wt.size,mn=Pr===void 0?0:Pr,Zn=bs[qt.type||ga.gl.FLOAT];if(At){var Jn=this.featureLayout,_i=Jn.elements,si=Jn.sizePerElement,ji=_i.slice(re,pe);if(!ji.length)return;var $i=ji[0].offset,xa=$i*mn*Zn,ao=ji.map(function(La,co){for(var Ga=La.featureIdx,ta=La.vertices,va=La.normals,za=ta.length/si,fa=[],Ta=0;Ta<za;Ta++){var bo=va?va.slice(Ta*3,Ta*3+3):[];fa.push.apply(fa,(0,Ya.Z)(At(F[Ga],Ga,ta.slice(Ta*si,Ta*si+si),co,bo)))}return fa}).reduce(function(La,co){return La.push.apply(La,(0,Ya.Z)(co)),La},[]);dt.vertexAttribute.updateBuffer({data:ao,offset:xa})}}}},{key:"createAttributesAndIndices",value:function(R,F,re){var pe=this;this.featureLayout={sizePerElement:0,elements:[]},F&&(this.triangulation=F);var dt=this.attributes.map(function(xa){return xa.resetDescriptor(),xa.descriptor}),wt=0,At=[],qt=[],Pr=[],mn=3;R.forEach(function(xa,ao){var La=pe.triangulation(xa,re),co=La.indices,Ga=La.vertices,ta=La.normals,va=La.size;co.forEach(function(bo){qt.push(bo+wt)}),mn=va;var za=Ga.length/va;pe.featureLayout.sizePerElement=mn,pe.featureLayout.elements.push({featureIdx:ao,vertices:Ga,normals:ta,offset:wt}),wt+=za;for(var fa=function(Fo){var ua=(ta==null?void 0:ta.slice(Fo*3,Fo*3+3))||[],Zo=Ga.slice(Fo*va,Fo*va+va);dt.forEach(function(fo,qs){if(fo&&fo.update){var wc;(wc=fo.buffer.data).push.apply(wc,(0,Ya.Z)(fo.update(xa,ao,Zo,Fo,ua)))}})},Ta=0;Ta<za;Ta++)fa(Ta)});var Zn=this.rendererService,Jn=Zn.createAttribute,_i=Zn.createBuffer,si=Zn.createElements,ji={};dt.forEach(function(xa,ao){if(xa){var La=xa.buffer,co=xa.update,Ga=xa.name,ta=(0,no.Z)(xa,["buffer","update","name"]),va=Jn(Ts({buffer:_i(La)},ta));ji[xa.name||""]=va,pe.attributes[ao].vertexAttribute=va}});var $i=si({data:qt,type:ga.gl.UNSIGNED_INT,count:qt.length});return this.attributesAndIndices={attributes:ji,elements:$i},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var R;this.attributes.forEach(function(F){F.vertexAttribute&&F.vertexAttribute.destroy()}),(R=this.attributesAndIndices)===null||R===void 0||R.elements.destroy(),this.attributes=[]}}]),te}(),yo=(0,Ce.Z)($o.prototype,"rendererService",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$o))||zo),To=E(46343),mu=E(67709),wl=E.n(mu),Vu=window.document.documentElement.style,Wl=0;function rl(te){var q=te;if(typeof te=="string"&&(q=document.getElementById(te)),q){var R=document.createElement("div");return R.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,R.id="l7-scene-".concat(Wl++),R.classList.add("l7-scene"),q.appendChild(R),R}return null}var yu,Na,Gu,m,S,j,O,ue,Oe,st,Lt,Mt,wr,jr,qn,Pi,ci,ei,Ea,Fa,Qi,hs,go,Ms,iu,Ds,nl,Ws,Xs,Ys,io,Cu,il;function ps(te){var q=Xl();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Xl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var au=(yu=(0,A.b2)(),Na=(0,A.f3)(K.v.SceneID),Gu=(0,A.f3)(K.v.IIconService),m=(0,A.f3)(K.v.IFontService),S=(0,A.f3)(K.v.IControlService),j=(0,A.f3)(K.v.IGlobalConfigService),O=(0,A.f3)(K.v.IMapService),ue=(0,A.f3)(K.v.ICoordinateSystemService),Oe=(0,A.f3)(K.v.IRendererService),st=(0,A.f3)(K.v.ILayerService),Lt=(0,A.f3)(K.v.ICameraService),Mt=(0,A.f3)(K.v.IInteractionService),wr=(0,A.f3)(K.v.IPickingService),jr=(0,A.f3)(K.v.IShaderModuleService),qn=(0,A.f3)(K.v.IMarkerService),Pi=(0,A.f3)(K.v.IPopupService),yu(ci=(ei=function(te){(0,Ft.Z)(R,te);var q=ps(R);function R(){var F;return(0,W.Z)(this,R),F=q.call(this),(0,N.Z)((0,Le.Z)(F),"destroyed",!1),(0,N.Z)((0,Le.Z)(F),"loaded",!1),(0,N.Z)((0,Le.Z)(F),"loadFont",!1),(0,N.Z)((0,Le.Z)(F),"fontFamily",""),(0,se.Z)((0,Le.Z)(F),"id",Ea,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"iconService",Fa,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"fontService",Qi,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"controlService",hs,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"configService",go,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"map",Ms,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"coordinateSystemService",iu,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"rendererService",Ds,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"layerService",nl,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"cameraService",Ws,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"interactionService",Xs,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"pickingService",Ys,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"shaderModuleService",io,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"markerService",Cu,(0,Le.Z)(F)),(0,se.Z)((0,Le.Z)(F),"popupService",il,(0,Le.Z)(F)),(0,N.Z)((0,Le.Z)(F),"inited",!1),(0,N.Z)((0,Le.Z)(F),"initPromise",void 0),(0,N.Z)((0,Le.Z)(F),"rendering",!1),(0,N.Z)((0,Le.Z)(F),"$container",void 0),(0,N.Z)((0,Le.Z)(F),"canvas",void 0),(0,N.Z)((0,Le.Z)(F),"markerContainer",void 0),(0,N.Z)((0,Le.Z)(F),"hooks",void 0),(0,N.Z)((0,Le.Z)(F),"handleWindowResized",function(){F.emit("resize"),F.$container&&(F.initContainer(),Ne.SO.triggerResize(),F.coordinateSystemService.needRefresh=!0,F.render())}),(0,N.Z)((0,Le.Z)(F),"handleMapCameraChanged",function(re){F.cameraService.update(re),F.render()}),F.hooks={init:new To.zj},F}return(0,L.Z)(R,[{key:"init",value:function(re){var pe=this;this.configService.setSceneConfig(this.id,re),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Xo.Z)(mi().mark(function dt(){return mi().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:return At.next=2,new Promise(function(qt){pe.map.onCameraChanged(function(Pr){pe.cameraService.init(),pe.cameraService.update(Pr),pe.map.version!=="GAODE2.x"&&qt()}),pe.map.version!=="GAODE2.x"?pe.map.init():qt()});case 2:if(!(pe.map.version==="GAODE2.x"&&pe.map.initViewPort)){At.next=6;break}return At.next=5,pe.map.init();case 5:pe.map.initViewPort();case 6:pe.map.onCameraChanged(pe.handleMapCameraChanged),pe.map.addMarkerContainer(),pe.markerService.addMarkers(),pe.markerService.addMarkerLayers(),pe.popupService.initPopup(),pe.interactionService.init(),pe.interactionService.on(oi.s.Drag,pe.addSceneEvent.bind(pe));case 13:case"end":return At.stop()}},dt)}))),this.hooks.init.tapPromise("initRenderer",(0,Xo.Z)(mi().mark(function dt(){var wt;return mi().wrap(function(qt){for(;;)switch(qt.prev=qt.next){case 0:if(wt=rl(pe.configService.getSceneConfig(pe.id).id||""),pe.$container=wt,!wt){qt.next=11;break}return pe.canvas=Ne.SO.create("canvas","",wt),pe.setCanvas(),qt.next=7,pe.rendererService.init(pe.canvas,pe.configService.getSceneConfig(pe.id));case 7:wl()(pe.$container,pe.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(pe.handleWindowResized),qt.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:pe.pickingService.init(pe.id);case 13:case"end":return qt.stop()}},dt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(re){this.layerService.add(re),this.render()}},{key:"render",value:function(){var F=(0,Xo.Z)(mi().mark(function pe(){return mi().wrap(function(wt){for(;;)switch(wt.prev=wt.next){case 0:if(!(this.rendering||this.destroyed)){wt.next=2;break}return wt.abrupt("return");case 2:if(this.rendering=!0,this.inited){wt.next=15;break}return wt.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){wt.next=10;break}return wt.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(),this.rendering=!1;case 17:case"end":return wt.stop()}},pe,this)}));function re(){return F.apply(this,arguments)}return re}()},{key:"addFontFace",value:function(re,pe){this.fontFamily=re;var dt=document.createElement("style");dt.type="text/css",dt.innerText=`
        @font-face{
            font-family: '`.concat(re,`';
            src: url('`).concat(pe,`') format('woff2'),
            url('`).concat(pe,`') format('woff'),
            url('`).concat(pe,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(dt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(re){var pe,dt=(pe=this.$container)===null||pe===void 0?void 0:pe.getElementsByTagName("canvas")[0];this.render();var wt=re==="jpg"?dt==null?void 0:dt.toDataURL("image/jpeg"):dt==null?void 0:dt.toDataURL("image/png");return wt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var re=this.$container.parentElement;re!==null&&(this.markerContainer=Ne.SO.create("div","l7-marker-container",re))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,mu.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var re,pe,dt=Ne.SO.DPR,wt=((re=this.$container)===null||re===void 0?void 0:re.clientWidth)||400,At=((pe=this.$container)===null||pe===void 0?void 0:pe.clientHeight)||300,qt=this.canvas;qt&&(qt.width=wt*dt,qt.height=At*dt,qt.style.width="".concat(wt,"px"),qt.style.height="".concat(At,"px")),this.rendererService.viewport({x:0,y:0,width:dt*wt,height:dt*At})}},{key:"setCanvas",value:function(){var re,pe,dt=Ne.SO.DPR,wt=((re=this.$container)===null||re===void 0?void 0:re.clientWidth)||400,At=((pe=this.$container)===null||pe===void 0?void 0:pe.clientHeight)||300,qt=this.canvas;qt.width=wt*dt,qt.height=At*dt,qt.style.width="".concat(wt,"px"),qt.style.height="".concat(At,"px")}},{key:"addSceneEvent",value:function(re){this.emit(re.type,re)}}]),R}(C.EventEmitter),Ea=(0,Ce.Z)(ei.prototype,"id",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=(0,Ce.Z)(ei.prototype,"iconService",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi=(0,Ce.Z)(ei.prototype,"fontService",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hs=(0,Ce.Z)(ei.prototype,"controlService",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),go=(0,Ce.Z)(ei.prototype,"configService",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ms=(0,Ce.Z)(ei.prototype,"map",[O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iu=(0,Ce.Z)(ei.prototype,"coordinateSystemService",[ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ds=(0,Ce.Z)(ei.prototype,"rendererService",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nl=(0,Ce.Z)(ei.prototype,"layerService",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ws=(0,Ce.Z)(ei.prototype,"cameraService",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=(0,Ce.Z)(ei.prototype,"interactionService",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ys=(0,Ce.Z)(ei.prototype,"pickingService",[wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io=(0,Ce.Z)(ei.prototype,"shaderModuleService",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cu=(0,Ce.Z)(ei.prototype,"markerService",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),il=(0,Ce.Z)(ei.prototype,"popupService",[Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ei))||ci),Fs=E(44908),hc=E.n(Fs);function Au(te){var q=0;switch(te){case"vec2":case"ivec2":q=2;break;case"vec3":case"ivec3":q=3;break;case"vec4":case"ivec4":case"mat2":q=4;break;case"mat3":q=9;break;case"mat4":q=16;break;default:}return q}var Aa=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Tu(te){var q={};return te=te.replace(Aa,function(R,F,re){var pe=re.split(":"),dt=pe[0].trim(),wt="";switch(pe.length>1&&(wt=pe[1].trim()),F){case"bool":wt=wt==="true";break;case"float":case"int":wt=Number(wt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":wt?wt=wt.replace("[","").replace("]","").split(",").reduce(function(At,qt){return At.push(Number(qt.trim())),At},[]):wt=new Array(Au(F)).fill(0);break;default:}return q[dt]=wt,"uniform ".concat(F," ").concat(dt,`;
`)}),{content:te,uniforms:q}}var Yl,Pu;function pc(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function dc(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?pc(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):pc(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}var Dc="#define PI 3.14159265359",Fc=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Cl=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,gu=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,al=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,ol=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Hu=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,sl=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Wu=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Bs=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,vc=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,mc=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Bc=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Xu=/precision\s+(high|low|medium)p\s+float/,Al=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Kl=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,yc=(Yl=(0,A.b2)(),Yl(Pu=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"moduleCache",{}),(0,N.Z)(this,"rawContentCache",{})}return(0,L.Z)(te,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Dc,fs:Dc}),this.registerModule("decode",{vs:Fc,fs:""}),this.registerModule("projection",{vs:sl,fs:""}),this.registerModule("project",{vs:Hu,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Wu}),this.registerModule("lighting",{vs:gu,fs:""}),this.registerModule("light",{vs:Cl,fs:""}),this.registerModule("picking",{vs:ol,fs:al}),this.registerModule("styleMapping",{vs:Bs,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:vc,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:mc,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Bc,fs:""})}},{key:"registerModule",value:function(R,F){if(!this.rawContentCache[R]){var re=F.vs,pe=F.fs,dt=F.uniforms,wt=Tu(re),At=wt.content,qt=wt.uniforms,Pr=Tu(pe),mn=Pr.content,Zn=Pr.uniforms;this.rawContentCache[R]={fs:mn,uniforms:dc(dc(dc({},qt),Zn),dt),vs:At}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(R){var F=this;if(this.moduleCache[R])return this.moduleCache[R];var re=this.rawContentCache[R].vs,pe=this.rawContentCache[R].fs,dt=this.processModule(re,[],"vs"),wt=dt.content,At=dt.includeList,qt=this.processModule(pe,[],"fs"),Pr=qt.content,mn=qt.includeList,Zn=Pr,Jn=hc()(At.concat(mn).concat(R)).reduce(function(_i,si){return dc(dc({},_i),F.rawContentCache[si].uniforms)},{});return Xu.test(Pr)||(Zn=Al+Pr),this.moduleCache[R]={fs:Zn.trim(),uniforms:Jn,vs:wt.trim()},this.moduleCache[R]}},{key:"processModule",value:function(R,F,re){var pe=this,dt=R.replace(Kl,function(wt,At){var qt=At.split(" "),Pr=qt[0].replace(/"/g,"");if(F.indexOf(Pr)>-1)return"";var mn=pe.rawContentCache[Pr][re];F.push(Pr);var Zn=pe.processModule(mn,F,re),Jn=Zn.content;return Jn});return{content:dt,includeList:F}}}]),te}())||Pu),Yu=E(66213),Tl=E(92364),Pl,Mu,$l,Ua,Iu,ul=(Pl=(0,A.b2)(),Mu=(0,A.f3)(K.v.IShaderModuleService),Pl($l=(Ua=function(){function te(){(0,W.Z)(this,te),(0,se.Z)(this,"shaderModuleService",Iu,this),(0,N.Z)(this,"rendererService",void 0),(0,N.Z)(this,"cameraService",void 0),(0,N.Z)(this,"mapService",void 0),(0,N.Z)(this,"interactionService",void 0),(0,N.Z)(this,"layerService",void 0),(0,N.Z)(this,"config",void 0)}return(0,L.Z)(te,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Tl.G.Normal}},{key:"init",value:function(R,F){this.config=F,this.rendererService=R.getContainer().get(K.v.IRendererService),this.cameraService=R.getContainer().get(K.v.ICameraService),this.mapService=R.getContainer().get(K.v.IMapService),this.interactionService=R.getContainer().get(K.v.IInteractionService),this.layerService=R.getContainer().get(K.v.ILayerService)}},{key:"render",value:function(R){}}]),te}(),Iu=(0,Ce.Z)(Ua.prototype,"shaderModuleService",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua))||$l),Jl,Ql;function Ku(te){var q=Jc();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Jc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ll=(Jl=(0,A.b2)(),Jl(Ql=function(te){(0,Ft.Z)(R,te);var q=Ku(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(re,pe){(0,Yu.Z)((0,w.Z)(R.prototype),"init",this).call(this,re,pe)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),R}(ul))||Ql),Ka,cl,$u,Ks,ra;function Za(te,q){var R=typeof Symbol!="undefined"&&te[Symbol.iterator]||te["@@iterator"];if(!R){if(Array.isArray(te)||(R=Ss(te))||q&&te&&typeof te.length=="number"){R&&(te=R);var F=0,re=function(){};return{s:re,n:function(){return F>=te.length?{done:!0}:{done:!1,value:te[F++]}},e:function(qt){throw qt},f:re}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var pe=!0,dt=!1,wt;return{s:function(){R=R.call(te)},n:function(){var qt=R.next();return pe=qt.done,qt},e:function(qt){dt=!0,wt=qt},f:function(){try{!pe&&R.return!=null&&R.return()}finally{if(dt)throw wt}}}}function Ss(te,q){if(!!te){if(typeof te=="string")return Ml(te,q);var R=Object.prototype.toString.call(te).slice(8,-1);if(R==="Object"&&te.constructor&&(R=te.constructor.name),R==="Map"||R==="Set")return Array.from(te);if(R==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(R))return Ml(te,q)}}function Ml(te,q){(q==null||q>te.length)&&(q=te.length);for(var R=0,F=new Array(q);R<q;R++)F[R]=te[R];return F}var Ou=(Ka=(0,A.b2)(),cl=(0,A.f3)(K.v.IPostProcessor),Ka($u=(Ks=function(){function te(){(0,W.Z)(this,te),(0,N.Z)(this,"passes",[]),(0,se.Z)(this,"postProcessor",ra,this),(0,N.Z)(this,"layer",void 0),(0,N.Z)(this,"renderFlag",void 0),(0,N.Z)(this,"width",0),(0,N.Z)(this,"height",0)}return(0,L.Z)(te,[{key:"setLayer",value:function(R){this.layer=R}},{key:"setRenderFlag",value:function(R){this.renderFlag=R}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var q=(0,Xo.Z)(mi().mark(function F(){var re,pe,dt;return mi().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:re=Za(this.passes),At.prev=1,re.s();case 3:if((pe=re.n()).done){At.next=9;break}return dt=pe.value,At.next=7,dt.render(this.layer);case 7:At.next=3;break;case 9:At.next=14;break;case 11:At.prev=11,At.t0=At.catch(1),re.e(At.t0);case 14:return At.prev=14,re.f(),At.finish(14);case 17:this.layer.renderModels();case 18:case"end":return At.stop()}},F,this,[[1,11,14,17]])}));function R(){return q.apply(this,arguments)}return R}()},{key:"resize",value:function(R,F){(this.width!==R||this.height!==F)&&(this.width=R,this.height=F)}},{key:"add",value:function(R,F){R.getType()===Tl.G.PostProcessing?this.postProcessor.add(R,this.layer,F):(R.init(this.layer,F),this.passes.push(R))}},{key:"insert",value:function(R,F,re){R.init(this.layer,F),this.passes.splice(re,0,R)}},{key:"destroy",value:function(){this.passes.length=0}}]),te}(),ra=(0,Ce.Z)(Ks.prototype,"postProcessor",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks))||$u),Il,Qc;function qc(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function Ol(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?qc(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):qc(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function ql(te){var q=Lu();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ko=(Il=(0,A.b2)(),Il(Qc=function(te){(0,Ft.Z)(R,te);var q=ql(R);function R(){var F;(0,W.Z)(this,R);for(var re=arguments.length,pe=new Array(re),dt=0;dt<re;dt++)pe[dt]=arguments[dt];return F=q.call.apply(q,[this].concat(pe)),(0,N.Z)((0,Le.Z)(F),"pickingFBO",void 0),(0,N.Z)((0,Le.Z)(F),"layer",void 0),(0,N.Z)((0,Le.Z)(F),"width",0),(0,N.Z)((0,Le.Z)(F),"height",0),(0,N.Z)((0,Le.Z)(F),"alreadyInRendering",!1),(0,N.Z)((0,Le.Z)(F),"pickFromPickingFBO",function(wt){var At=wt.x,qt=wt.y,Pr=wt.lngLat,mn=wt.type;if(!(!F.layer.isVisible()||!F.layer.needPick(mn))){var Zn=F.rendererService,Jn=Zn.getViewportSize,_i=Zn.readPixels,si=Zn.useFramebuffer,ji=Jn(),$i=ji.width,xa=ji.height,ao=F.layer.getLayerConfig(),La=ao.enableHighlight,co=ao.enableSelect,Ga=At*Ne.SO.DPR,ta=qt*Ne.SO.DPR;if(!(Ga>$i||Ga<0||ta>xa||ta<0)){var va;si(F.pickingFBO,function(){var za;if(va=_i({x:Math.round(Ga),y:Math.round(xa-(qt+1)*Ne.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:F.pickingFBO}),va[0]!==0||va[1]!==0||va[2]!==0){var fa=(0,Ne.W0)(va),Ta=F.layer.getSource().getFeatureById(fa),bo={x:At,y:qt,type:mn,lngLat:Pr,featureId:fa,feature:Ta};Ta&&(F.layer.setCurrentPickId(fa),F.triggerHoverOnLayer(bo))}else{var Fo={x:At,y:qt,lngLat:Pr,type:F.layer.getCurrentPickId()===null?"un"+mn:"mouseout",featureId:null,feature:null};F.triggerHoverOnLayer(Ol(Ol({},Fo),{},{type:"unpick"})),F.triggerHoverOnLayer(Fo),F.layer.setCurrentPickId(null)}La&&F.highlightPickedFeature(va),co&&mn==="click"&&((za=va)===null||za===void 0?void 0:za.toString())!==[0,0,0,0].toString()&&F.selectFeature(va)})}}}),F}return(0,L.Z)(R,[{key:"getType",value:function(){return Tl.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(re,pe){(0,Yu.Z)((0,w.Z)(R.prototype),"init",this).call(this,re,pe),this.layer=re;var dt=this.rendererService,wt=dt.createTexture2D,At=dt.createFramebuffer,qt=dt.getViewportSize,Pr=qt(),mn=Pr.width,Zn=Pr.height;this.pickingFBO=At({color:wt({width:mn,height:Zn,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.interactionService.on(oi.s.Hover,this.pickFromPickingFBO),this.interactionService.on(oi.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(oi.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(re){var pe=this;if(!this.alreadyInRendering){var dt=this.rendererService,wt=dt.getViewportSize,At=dt.useFramebuffer,qt=dt.clear,Pr=wt(),mn=Pr.width,Zn=Pr.height;this.alreadyInRendering=!0,(this.width!==mn||this.height!==Zn)&&(this.pickingFBO.resize({width:mn,height:Zn}),this.width=mn,this.height=Zn),At(this.pickingFBO,function(){qt({framebuffer:pe.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var Jn=pe.layer.multiPassRenderer.getRenderFlag();pe.layer.multiPassRenderer.setRenderFlag(!1),re.hooks.beforePickingEncode.call(),re.render(),re.hooks.afterPickingEncode.call(),pe.layer.multiPassRenderer.setRenderFlag(Jn),pe.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(re){this.layer.emit(re.type,re)}},{key:"highlightPickedFeature",value:function(re){var pe=(0,Qt.Z)(re,3),dt=pe[0],wt=pe[1],At=pe[2];this.layer.hooks.beforeHighlight.call([dt,wt,At]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(re){var pe=(0,Qt.Z)(re,3),dt=pe[0],wt=pe[1],At=pe[2];this.layer.hooks.beforeSelect.call([dt,wt,At]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(re){var pe=re.featureId,dt=(0,Ne.Z6)(pe);this.selectFeature(new Uint8Array(dt))}},{key:"highlightFeatureHandle",value:function(re){var pe=re.featureId,dt=(0,Ne.Z6)(pe);this.highlightPickedFeature(new Uint8Array(dt))}}]),R}(ul))||Qc),Ns=E(69530),fl,_o;function Fn(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function lo(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Fn(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Fn(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Ru(te){var q=hl();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function hl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var $s=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Is=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,gc=(fl=(0,A.b2)(),fl(_o=function(te){(0,Ft.Z)(R,te);var q=Ru(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Is,fs:$s});var re=this.shaderModuleService.getModule("blur-pass"),pe=re.vs,dt=re.fs,wt=re.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:dt,uniforms:lo(lo({},wt),{},{u_ViewportSize:[qt,Pr]})}}},{key:"convertOptionsToUniforms",value:function(re){var pe={};return Ko()(re.blurRadius)||(pe.u_BlurDir=[re.blurRadius,0]),pe}}]),R}(Ns.Z))||_o),vn,ec;function tc(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function ku(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?tc(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):tc(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Va(te){var q=Os();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Os(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var rc=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,_u=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ls=(vn=(0,A.b2)(),vn(ec=function(te){(0,Ft.Z)(R,te);var q=Va(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:_u,fs:rc});var re=this.shaderModuleService.getModule("blur-pass"),pe=re.vs,dt=re.fs,wt=re.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:dt,uniforms:ku(ku({},wt),{},{u_ViewportSize:[qt,Pr]})}}},{key:"convertOptionsToUniforms",value:function(re){var pe={};return Ko()(re.blurRadius)||(pe.u_BlurDir=[0,re.blurRadius]),pe}}]),R}(Ns.Z))||ec),ou,Nc;function Ll(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function _c(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Ll(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Ll(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function zc(te){var q=Js();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Js(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Rs=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,qi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xu=(ou=(0,A.b2)(),ou(Nc=function(te){(0,Ft.Z)(R,te);var q=zc(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:qi,fs:Rs});var re=this.shaderModuleService.getModule("colorhalftone-pass"),pe=re.vs,dt=re.fs,wt=re.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:dt,uniforms:_c(_c({},wt),{},{u_ViewportSize:[qt,Pr]})}}}]),R}(Ns.Z))||Nc),zs,Uo;function pl(te){var q=su();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function su(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var uu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,xo=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Du=(zs=(0,A.b2)(),zs(Uo=function(te){(0,Ft.Z)(R,te);var q=pl(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:xo,fs:uu}),this.shaderModuleService.getModule("copy-pass")}}]),R}(Ns.Z))||Uo),ii,Wn;function Rl(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function is(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Rl(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Rl(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function Qs(te){var q=Jo();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Jo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var lu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,xc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nc=(ii=(0,A.b2)(),ii(Wn=function(te){(0,Ft.Z)(R,te);var q=Qs(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:xc,fs:lu});var re=this.shaderModuleService.getModule("hexagonalpixelate-pass"),pe=re.vs,dt=re.fs,wt=re.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:dt,uniforms:is(is({},wt),{},{u_ViewportSize:[qt,Pr]})}}}]),R}(Ns.Z))||Wn),Wi,Do;function Uc(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function Es(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?Uc(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):Uc(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function ic(te){var q=ws();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function ws(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ds=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,dl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,cu=(Wi=(0,A.b2)(),Wi(Do=function(te){(0,Ft.Z)(R,te);var q=ic(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:dl,fs:ds});var re=this.shaderModuleService.getModule("ink-pass"),pe=re.vs,dt=re.fs,wt=re.uniforms,At=this.rendererService.getViewportSize(),qt=At.width,Pr=At.height;return{vs:pe,fs:dt,uniforms:Es(Es({},wt),{},{u_ViewportSize:[qt,Pr]})}}}]),R}(Ns.Z))||Do),kl,Ju;function Dl(te){var q=Zc();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Fl=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,vl=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,bc=(kl=(0,A.b2)(),kl(Ju=function(te){(0,Ft.Z)(R,te);var q=Dl(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:vl,fs:Fl}),this.shaderModuleService.getModule("noise-pass")}}]),R}(Ns.Z))||Ju),Fu,Bu;function Sc(te){var q=Nu();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function Nu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Us=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ec=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,zu=(Fu=(0,A.b2)(),Fu(Bu=function(te){(0,Ft.Z)(R,te);var q=Sc(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Us,fs:Ec}),this.shaderModuleService.getModule("sepia-pass")}}]),R}(Ns.Z))||Bu),Bl,Qu,i,u,o,h,g=(Bl=(0,A.b2)(),Qu=(0,A.f3)(K.v.IRendererService),i=(0,A.zY)(),Bl(u=(o=function(){function te(){(0,W.Z)(this,te),(0,se.Z)(this,"rendererService",h,this),(0,N.Z)(this,"passes",[]),(0,N.Z)(this,"readFBO",void 0),(0,N.Z)(this,"writeFBO",void 0)}return(0,L.Z)(te,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var q=(0,Xo.Z)(mi().mark(function F(re){var pe,dt;return mi().wrap(function(At){for(;;)switch(At.prev=At.next){case 0:pe=0;case 1:if(!(pe<this.passes.length)){At.next=10;break}return dt=this.passes[pe],dt.setRenderToScreen(this.isLastEnabledPass(pe)),At.next=6,dt.render(re);case 6:pe!==this.passes.length-1&&this.swap();case 7:pe++,At.next=1;break;case 10:case"end":return At.stop()}},F,this)}));function R(F){return q.apply(this,arguments)}return R}()},{key:"resize",value:function(R,F){this.readFBO.resize({width:R,height:F}),this.writeFBO.resize({width:R,height:F})}},{key:"add",value:function(R,F,re){R.init(F,re),this.passes.push(R)}},{key:"insert",value:function(R,F,re,pe){R.init(re,pe),this.passes.splice(F,0,R)}},{key:"getPostProcessingPassByName",value:function(R){return this.passes.find(function(F){return F.getName()===R})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(R){for(var F=R+1;F<this.passes.length;F++)if(this.passes[F].isEnabled())return!1;return!0}},{key:"swap",value:function(){var R=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=R}}]),te}(),h=(0,Ce.Z)(o.prototype,"rendererService",[Qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Ce.Z)(o.prototype,"init",[i],Object.getOwnPropertyDescriptor(o.prototype,"init"),o.prototype),o))||u),b,P;function D(te){var q=H();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function H(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var ae=(b=(0,A.b2)(),b(P=function(te){(0,Ft.Z)(R,te);var q=D(R);function R(){return(0,W.Z)(this,R),q.apply(this,arguments)}return(0,L.Z)(R,[{key:"getType",value:function(){return Tl.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(re,pe){(0,Yu.Z)((0,w.Z)(R.prototype),"init",this).call(this,re,pe)}},{key:"render",value:function(re){var pe=this.rendererService,dt=pe.useFramebuffer,wt=pe.clear;dt(null,function(){wt({color:[0,0,0,0],depth:1,stencil:0}),re.multiPassRenderer.setRenderFlag(!1),re.render(),re.multiPassRenderer.setRenderFlag(!0)})}}]),R}(ul))||P),Se,we,Pe,He,je;function it(te,q){var R=Object.keys(te);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(te);q&&(F=F.filter(function(re){return Object.getOwnPropertyDescriptor(te,re).enumerable})),R.push.apply(R,F)}return R}function ze(te){for(var q=1;q<arguments.length;q++){var R=arguments[q]!=null?arguments[q]:{};q%2?it(Object(R),!0).forEach(function(F){(0,N.Z)(te,F,R[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(R)):it(Object(R)).forEach(function(F){Object.defineProperty(te,F,Object.getOwnPropertyDescriptor(R,F))})}return te}function ot(te){var q=bt();return function(){var F=(0,w.Z)(te),re;if(q){var pe=(0,w.Z)(this).constructor;re=Reflect.construct(F,arguments,pe)}else re=F.apply(this,arguments);return(0,er.Z)(this,re)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(te){return!1}}var Zt=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,fr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,ur=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function gr(te,q){for(var R=0,F=1/q,re=te;re>0;)R=R+F*(re%q),re=Math.floor(re/q),F=F/q;return R}var Nr=1,an=(Se=(0,A.b2)(),we=(0,A.f3)(K.v.IShaderModuleService),Se(Pe=(He=function(te){(0,Ft.Z)(R,te);var q=ot(R);function R(){var F;(0,W.Z)(this,R);for(var re=arguments.length,pe=new Array(re),dt=0;dt<re;dt++)pe[dt]=arguments[dt];return F=q.call.apply(q,[this].concat(pe)),(0,se.Z)((0,Le.Z)(F),"shaderModuleService",je,(0,Le.Z)(F)),(0,N.Z)((0,Le.Z)(F),"haltonSequence",[]),(0,N.Z)((0,Le.Z)(F),"accumulatingId",0),(0,N.Z)((0,Le.Z)(F),"frame",0),(0,N.Z)((0,Le.Z)(F),"timer",void 0),(0,N.Z)((0,Le.Z)(F),"sampleRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"prevRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"outputRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"copyRenderTarget",void 0),(0,N.Z)((0,Le.Z)(F),"blendModel",void 0),(0,N.Z)((0,Le.Z)(F),"outputModel",void 0),(0,N.Z)((0,Le.Z)(F),"copyModel",void 0),F}return(0,L.Z)(R,[{key:"getType",value:function(){return Tl.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(re,pe){(0,Yu.Z)((0,w.Z)(R.prototype),"init",this).call(this,re,pe);var dt=this.rendererService,wt=dt.createFramebuffer,At=dt.createTexture2D;this.sampleRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=wt({color:At({width:1,height:1,wrapS:ga.gl.CLAMP_TO_EDGE,wrapT:ga.gl.CLAMP_TO_EDGE})});for(var qt=0;qt<30;qt++)this.haltonSequence.push([gr(qt,2),gr(qt,3)]);this.blendModel=this.createTriangleModel("blend-pass",Zt),this.outputModel=this.createTriangleModel("copy-pass",fr,{blend:{enable:!0,func:{srcRGB:ga.gl.ONE,dstRGB:ga.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:ga.gl.ONE,dstAlpha:ga.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:ga.gl.FUNC_ADD,alpha:ga.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",fr)}},{key:"render",value:function(re){var pe=this,dt=this.rendererService,wt=dt.clear,At=dt.getViewportSize,qt=dt.useFramebuffer,Pr=At(),mn=Pr.width,Zn=Pr.height;this.sampleRenderTarget.resize({width:mn,height:Zn}),this.prevRenderTarget.resize({width:mn,height:Zn}),this.outputRenderTarget.resize({width:mn,height:Zn}),this.copyRenderTarget.resize({width:mn,height:Zn}),this.resetFrame(),this.stopAccumulating();var Jn=re.multiPassRenderer.getPostProcessor().getReadFBO();qt(Jn,function(){wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:Jn}),re.multiPassRenderer.setRenderFlag(!1),re.render(),re.multiPassRenderer.setRenderFlag(!0)});var _i=function si(ji){!pe.accumulatingId||ji!==pe.accumulatingId||pe.isFinished()||(pe.doRender(re),requestAnimationFrame(function(){si(ji)}))};this.accumulatingId=Nr++,this.timer=window.setTimeout(function(){_i(pe.accumulatingId)},50)}},{key:"doRender",value:function(re){var pe=this,dt=this.rendererService,wt=dt.clear,At=dt.getViewportSize,qt=dt.useFramebuffer,Pr=At(),mn=Pr.width,Zn=Pr.height,Jn=re.getLayerConfig(),_i=Jn.jitterScale,si=_i===void 0?1:_i,ji=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ji[0]*2-1)/mn*si,(ji[1]*2-1)/Zn*si),re.multiPassRenderer.setRenderFlag(!1),re.hooks.beforeRender.call(),qt(this.sampleRenderTarget,function(){wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:pe.sampleRenderTarget}),re.render()}),re.hooks.afterRender.call(),re.multiPassRenderer.setRenderFlag(!0);var $i=re.getLayerConfig();qt(this.outputRenderTarget,function(){pe.blendModel.draw({uniforms:{u_opacity:$i.opacity||1,u_MixRatio:pe.frame===0?1:.9,u_Diffuse1:pe.sampleRenderTarget,u_Diffuse2:pe.frame===0?re.multiPassRenderer.getPostProcessor().getReadFBO():pe.prevRenderTarget}})}),this.frame===0&&wt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(qt(this.copyRenderTarget,function(){pe.outputModel.draw({uniforms:{u_Texture:pe.outputRenderTarget}})}),qt(re.multiPassRenderer.getPostProcessor().getReadFBO(),function(){pe.copyModel.draw({uniforms:{u_Texture:pe.copyRenderTarget}})}),re.multiPassRenderer.getPostProcessor().render(re));var xa=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=xa,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(re,pe,dt){this.shaderModuleService.registerModule(re,{vs:ur,fs:pe});var wt=this.shaderModuleService.getModule(re),At=wt.vs,qt=wt.fs,Pr=wt.uniforms,mn=this.rendererService,Zn=mn.createAttribute,Jn=mn.createBuffer,_i=mn.createModel;return _i(ze({vs:At,fs:qt,attributes:{a_Position:Zn({buffer:Jn({data:[-4,-4,4,-4,0,4],type:ga.gl.FLOAT}),size:2})},uniforms:ze({},Pr),depth:{enable:!1},count:3},dt))}}]),R}(ul),je=(0,Ce.Z)(He.prototype,"shaderModuleService",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),He))||Pe),Hr=new A.W2;Hr.bind(K.v.IGlobalConfigService).to(Ae).inSingletonScope(),Hr.bind(K.v.IShaderModuleService).to(yc).inSingletonScope(),(0,A.GW)((0,A.b2)(),C.EventEmitter),Hr.bind(K.v.IEventEmitter).to(C.EventEmitter);var Rn=(0,Q.Z)(Hr,!1),ri=function(q){var R=Rn.lazyInject(q);return function(F,re,pe){R.call(this,F,re),pe&&(pe.initializer=function(){return F[re]})}},hi=function(q){var R=Rn.lazyMultiInject(q);return function(F,re,pe){R.call(this,F,re),pe&&(pe.initializer=function(){return F[re]})}},ni=Hr,ea=0;function Un(){var te=new A.W2;return te.parent=Hr,te.bind(K.v.SceneID).toConstantValue("".concat(ea++)),te.bind(K.v.ILayerService).to(yi).inSingletonScope(),te.bind(K.v.ISceneService).to(au).inSingletonScope(),te.bind(K.v.ICameraService).to(Lr).inSingletonScope(),te.bind(K.v.ICoordinateSystemService).to(xn).inSingletonScope(),te.bind(K.v.IInteractionService).to(da).inSingletonScope(),te.bind(K.v.IPickingService).to(Ba).inSingletonScope(),te.bind(K.v.IControlService).to(Ur).inSingletonScope(),te.bind(K.v.IMarkerService).to(Cr).inSingletonScope(),te.bind(K.v.IIconService).to(Et).inSingletonScope(),te.bind(K.v.IFontService).to(Ue).inSingletonScope(),te.bind(K.v.IPopupService).to(bi).inSingletonScope(),te.bind(K.v.INormalPass).to(ll).whenTargetNamed("clear"),te.bind(K.v.INormalPass).to(ko).whenTargetNamed("pixelPicking"),te.bind(K.v.INormalPass).to(ae).whenTargetNamed("render"),te.bind(K.v.INormalPass).to(an).whenTargetNamed("taa"),te.bind(K.v.IFactoryNormalPass).toFactory(function(q){return function(R){return q.container.getNamed(K.v.INormalPass,R)}}),te.bind(K.v.IPostProcessingPass).to(Du).whenTargetNamed("copy"),te.bind(K.v.IPostProcessingPass).to(gc).whenTargetNamed("blurH"),te.bind(K.v.IPostProcessingPass).to(Ls).whenTargetNamed("blurV"),te.bind(K.v.IPostProcessingPass).to(bc).whenTargetNamed("noise"),te.bind(K.v.IPostProcessingPass).to(zu).whenTargetNamed("sepia"),te.bind(K.v.IPostProcessingPass).to(xu).whenTargetNamed("colorHalftone"),te.bind(K.v.IPostProcessingPass).to(nc).whenTargetNamed("hexagonalPixelate"),te.bind(K.v.IPostProcessingPass).to(cu).whenTargetNamed("ink"),te.bind(K.v.IFactoryPostProcessingPass).toFactory(function(q){return function(R){var F=q.container.getNamed(K.v.IPostProcessingPass,R);return F.setName(R),F}}),te}function gi(te){var q=new A.W2;return q.parent=te,q.bind(K.v.IStyleAttributeService).to(Ca).inSingletonScope(),q.bind(K.v.IMultiPassRenderer).to(Ou).inSingletonScope(),q.bind(K.v.IPostProcessor).to(g).inSingletonScope(),q}},2811:function(){},64532:function(){},4594:function(Or,U,E){"use strict";E.d(U,{l:function(){return le}});var le={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(Or,U,E){"use strict";E.d(U,{d:function(){return le}});var le;(function(C){C.TOPRIGHT="topright",C.TOPLEFT="topleft",C.BOTTOMRIGHT="bottomright",C.BOTTOMLEFT="bottomleft"})(le||(le={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(Or,U,E){"use strict";E.d(U,{l:function(){return le},k:function(){return C}});var le;(function(d){d[d.LNGLAT=1]="LNGLAT",d[d.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",d[d.VECTOR_TILE=3]="VECTOR_TILE",d[d.IDENTITY=4]="IDENTITY",d[d.P20=5]="P20",d[d.P20_OFFSET=6]="P20_OFFSET",d[d.METER_OFFSET=7]="METER_OFFSET",d[d.P20_2=8]="P20_2"})(le||(le={}));var C={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(Or,U,E){"use strict";E.d(U,{s:function(){return le}});var le;(function(C){C.Hover="hover",C.Click="click",C.Select="select",C.Active="active",C.Drag="drag"})(le||(le={}))},90919:function(){},77252:function(Or,U,E){"use strict";E.d(U,{h:function(){return le}});var le;(function(C){C.normal="normal",C.additive="additive",C.subtractive="subtractive",C.min="min",C.max="max",C.none="none"})(le||(le={}))},31251:function(Or,U,E){"use strict";E.d(U,{vY:function(){return le},ee:function(){return C},GC:function(){return d}});var le;(function(A){A.LINEAR="linear",A.POWER="power",A.LOG="log",A.IDENTITY="identity",A.TIME="time",A.QUANTILE="quantile",A.QUANTIZE="quantize",A.THRESHOLD="threshold",A.CAT="cat"})(le||(le={}));var C;(function(A){A.CONSTANT="constant",A.VARIABLE="variable"})(C||(C={}));var d;(function(A){A[A.Attribute=0]="Attribute",A[A.InstancedAttribute=1]="InstancedAttribute",A[A.Uniform=2]="Uniform"})(d||(d={}))},16606:function(Or,U,E){"use strict";E.d(U,{I:function(){return le}});var le=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(Or,U,E){"use strict";E.d(U,{G:function(){return le}});var le;(function(C){C.Normal="normal",C.PostProcessing="post-processing"})(le||(le={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(Or,U,E){"use strict";E.d(U,{gl:function(){return le}});var le;(function(C){C[C.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",C[C.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",C[C.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",C[C.POINTS=0]="POINTS",C[C.LINES=1]="LINES",C[C.LINE_LOOP=2]="LINE_LOOP",C[C.LINE_STRIP=3]="LINE_STRIP",C[C.TRIANGLES=4]="TRIANGLES",C[C.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",C[C.TRIANGLE_FAN=6]="TRIANGLE_FAN",C[C.ZERO=0]="ZERO",C[C.ONE=1]="ONE",C[C.SRC_COLOR=768]="SRC_COLOR",C[C.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",C[C.SRC_ALPHA=770]="SRC_ALPHA",C[C.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",C[C.DST_ALPHA=772]="DST_ALPHA",C[C.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",C[C.DST_COLOR=774]="DST_COLOR",C[C.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",C[C.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",C[C.FUNC_ADD=32774]="FUNC_ADD",C[C.BLEND_EQUATION=32777]="BLEND_EQUATION",C[C.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",C[C.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",C[C.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",C[C.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",C[C.MAX_EXT=32776]="MAX_EXT",C[C.MIN_EXT=32775]="MIN_EXT",C[C.BLEND_DST_RGB=32968]="BLEND_DST_RGB",C[C.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",C[C.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",C[C.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",C[C.CONSTANT_COLOR=32769]="CONSTANT_COLOR",C[C.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",C[C.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",C[C.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",C[C.BLEND_COLOR=32773]="BLEND_COLOR",C[C.ARRAY_BUFFER=34962]="ARRAY_BUFFER",C[C.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",C[C.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",C[C.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",C[C.STREAM_DRAW=35040]="STREAM_DRAW",C[C.STATIC_DRAW=35044]="STATIC_DRAW",C[C.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",C[C.BUFFER_SIZE=34660]="BUFFER_SIZE",C[C.BUFFER_USAGE=34661]="BUFFER_USAGE",C[C.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",C[C.FRONT=1028]="FRONT",C[C.BACK=1029]="BACK",C[C.FRONT_AND_BACK=1032]="FRONT_AND_BACK",C[C.CULL_FACE=2884]="CULL_FACE",C[C.BLEND=3042]="BLEND",C[C.DITHER=3024]="DITHER",C[C.STENCIL_TEST=2960]="STENCIL_TEST",C[C.DEPTH_TEST=2929]="DEPTH_TEST",C[C.SCISSOR_TEST=3089]="SCISSOR_TEST",C[C.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",C[C.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",C[C.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",C[C.NO_ERROR=0]="NO_ERROR",C[C.INVALID_ENUM=1280]="INVALID_ENUM",C[C.INVALID_VALUE=1281]="INVALID_VALUE",C[C.INVALID_OPERATION=1282]="INVALID_OPERATION",C[C.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",C[C.CW=2304]="CW",C[C.CCW=2305]="CCW",C[C.LINE_WIDTH=2849]="LINE_WIDTH",C[C.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",C[C.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",C[C.CULL_FACE_MODE=2885]="CULL_FACE_MODE",C[C.FRONT_FACE=2886]="FRONT_FACE",C[C.DEPTH_RANGE=2928]="DEPTH_RANGE",C[C.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",C[C.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",C[C.DEPTH_FUNC=2932]="DEPTH_FUNC",C[C.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",C[C.STENCIL_FUNC=2962]="STENCIL_FUNC",C[C.STENCIL_FAIL=2964]="STENCIL_FAIL",C[C.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",C[C.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",C[C.STENCIL_REF=2967]="STENCIL_REF",C[C.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",C[C.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",C[C.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",C[C.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",C[C.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",C[C.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",C[C.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",C[C.VIEWPORT=2978]="VIEWPORT",C[C.SCISSOR_BOX=3088]="SCISSOR_BOX",C[C.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",C[C.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",C[C.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",C[C.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",C[C.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",C[C.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",C[C.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",C[C.RED_BITS=3410]="RED_BITS",C[C.GREEN_BITS=3411]="GREEN_BITS",C[C.BLUE_BITS=3412]="BLUE_BITS",C[C.ALPHA_BITS=3413]="ALPHA_BITS",C[C.DEPTH_BITS=3414]="DEPTH_BITS",C[C.STENCIL_BITS=3415]="STENCIL_BITS",C[C.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",C[C.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",C[C.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",C[C.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",C[C.SAMPLES=32937]="SAMPLES",C[C.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",C[C.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",C[C.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",C[C.DONT_CARE=4352]="DONT_CARE",C[C.FASTEST=4353]="FASTEST",C[C.NICEST=4354]="NICEST",C[C.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",C[C.BYTE=5120]="BYTE",C[C.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",C[C.SHORT=5122]="SHORT",C[C.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",C[C.INT=5124]="INT",C[C.UNSIGNED_INT=5125]="UNSIGNED_INT",C[C.FLOAT=5126]="FLOAT",C[C.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",C[C.ALPHA=6406]="ALPHA",C[C.RGB=6407]="RGB",C[C.RGBA=6408]="RGBA",C[C.LUMINANCE=6409]="LUMINANCE",C[C.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",C[C.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",C[C.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",C[C.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",C[C.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",C[C.VERTEX_SHADER=35633]="VERTEX_SHADER",C[C.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",C[C.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",C[C.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",C[C.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",C[C.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",C[C.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",C[C.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",C[C.SHADER_TYPE=35663]="SHADER_TYPE",C[C.DELETE_STATUS=35712]="DELETE_STATUS",C[C.LINK_STATUS=35714]="LINK_STATUS",C[C.VALIDATE_STATUS=35715]="VALIDATE_STATUS",C[C.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",C[C.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",C[C.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",C[C.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",C[C.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",C[C.NEVER=512]="NEVER",C[C.LESS=513]="LESS",C[C.EQUAL=514]="EQUAL",C[C.LEQUAL=515]="LEQUAL",C[C.GREATER=516]="GREATER",C[C.NOTEQUAL=517]="NOTEQUAL",C[C.GEQUAL=518]="GEQUAL",C[C.ALWAYS=519]="ALWAYS",C[C.KEEP=7680]="KEEP",C[C.REPLACE=7681]="REPLACE",C[C.INCR=7682]="INCR",C[C.DECR=7683]="DECR",C[C.INVERT=5386]="INVERT",C[C.INCR_WRAP=34055]="INCR_WRAP",C[C.DECR_WRAP=34056]="DECR_WRAP",C[C.VENDOR=7936]="VENDOR",C[C.RENDERER=7937]="RENDERER",C[C.VERSION=7938]="VERSION",C[C.NEAREST=9728]="NEAREST",C[C.LINEAR=9729]="LINEAR",C[C.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",C[C.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",C[C.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",C[C.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",C[C.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",C[C.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",C[C.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",C[C.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",C[C.TEXTURE_2D=3553]="TEXTURE_2D",C[C.TEXTURE=5890]="TEXTURE",C[C.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",C[C.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",C[C.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",C[C.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",C[C.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",C[C.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",C[C.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",C[C.TEXTURE0=33984]="TEXTURE0",C[C.TEXTURE1=33985]="TEXTURE1",C[C.TEXTURE2=33986]="TEXTURE2",C[C.TEXTURE3=33987]="TEXTURE3",C[C.TEXTURE4=33988]="TEXTURE4",C[C.TEXTURE5=33989]="TEXTURE5",C[C.TEXTURE6=33990]="TEXTURE6",C[C.TEXTURE7=33991]="TEXTURE7",C[C.TEXTURE8=33992]="TEXTURE8",C[C.TEXTURE9=33993]="TEXTURE9",C[C.TEXTURE10=33994]="TEXTURE10",C[C.TEXTURE11=33995]="TEXTURE11",C[C.TEXTURE12=33996]="TEXTURE12",C[C.TEXTURE13=33997]="TEXTURE13",C[C.TEXTURE14=33998]="TEXTURE14",C[C.TEXTURE15=33999]="TEXTURE15",C[C.TEXTURE16=34e3]="TEXTURE16",C[C.TEXTURE17=34001]="TEXTURE17",C[C.TEXTURE18=34002]="TEXTURE18",C[C.TEXTURE19=34003]="TEXTURE19",C[C.TEXTURE20=34004]="TEXTURE20",C[C.TEXTURE21=34005]="TEXTURE21",C[C.TEXTURE22=34006]="TEXTURE22",C[C.TEXTURE23=34007]="TEXTURE23",C[C.TEXTURE24=34008]="TEXTURE24",C[C.TEXTURE25=34009]="TEXTURE25",C[C.TEXTURE26=34010]="TEXTURE26",C[C.TEXTURE27=34011]="TEXTURE27",C[C.TEXTURE28=34012]="TEXTURE28",C[C.TEXTURE29=34013]="TEXTURE29",C[C.TEXTURE30=34014]="TEXTURE30",C[C.TEXTURE31=34015]="TEXTURE31",C[C.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",C[C.REPEAT=10497]="REPEAT",C[C.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",C[C.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",C[C.FLOAT_VEC2=35664]="FLOAT_VEC2",C[C.FLOAT_VEC3=35665]="FLOAT_VEC3",C[C.FLOAT_VEC4=35666]="FLOAT_VEC4",C[C.INT_VEC2=35667]="INT_VEC2",C[C.INT_VEC3=35668]="INT_VEC3",C[C.INT_VEC4=35669]="INT_VEC4",C[C.BOOL=35670]="BOOL",C[C.BOOL_VEC2=35671]="BOOL_VEC2",C[C.BOOL_VEC3=35672]="BOOL_VEC3",C[C.BOOL_VEC4=35673]="BOOL_VEC4",C[C.FLOAT_MAT2=35674]="FLOAT_MAT2",C[C.FLOAT_MAT3=35675]="FLOAT_MAT3",C[C.FLOAT_MAT4=35676]="FLOAT_MAT4",C[C.SAMPLER_2D=35678]="SAMPLER_2D",C[C.SAMPLER_CUBE=35680]="SAMPLER_CUBE",C[C.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",C[C.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",C[C.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",C[C.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",C[C.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",C[C.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",C[C.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",C[C.COMPILE_STATUS=35713]="COMPILE_STATUS",C[C.LOW_FLOAT=36336]="LOW_FLOAT",C[C.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",C[C.HIGH_FLOAT=36338]="HIGH_FLOAT",C[C.LOW_INT=36339]="LOW_INT",C[C.MEDIUM_INT=36340]="MEDIUM_INT",C[C.HIGH_INT=36341]="HIGH_INT",C[C.FRAMEBUFFER=36160]="FRAMEBUFFER",C[C.RENDERBUFFER=36161]="RENDERBUFFER",C[C.RGBA4=32854]="RGBA4",C[C.RGB5_A1=32855]="RGB5_A1",C[C.RGB565=36194]="RGB565",C[C.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",C[C.STENCIL_INDEX=6401]="STENCIL_INDEX",C[C.STENCIL_INDEX8=36168]="STENCIL_INDEX8",C[C.DEPTH_STENCIL=34041]="DEPTH_STENCIL",C[C.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",C[C.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",C[C.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",C[C.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",C[C.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",C[C.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",C[C.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",C[C.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",C[C.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",C[C.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",C[C.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",C[C.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",C[C.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",C[C.NONE=0]="NONE",C[C.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",C[C.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",C[C.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",C[C.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",C[C.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",C[C.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",C[C.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",C[C.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",C[C.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",C[C.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",C[C.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",C[C.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(le||(le={}))},69530:function(Or,U,E){"use strict";E.d(U,{Z:function(){return Xe}});var le=E(55770),C=E(6610),d=E(5991),A=E(96156),Q=E(3473),K=E(11700),W=E.n(K),L=E(14293),N=E.n(L),Ne=E(68929),Ye=E.n(Ne),Je=E(86700),rt=E(28660),Yt=E.n(rt),Vt=E(7648),tr=E(72302),zt=E(92364),Tt,xt,yr,ee,dr;function Ct(Ut,_r){var ar=Object.keys(Ut);if(Object.getOwnPropertySymbols){var zr=Object.getOwnPropertySymbols(Ut);_r&&(zr=zr.filter(function(fe){return Object.getOwnPropertyDescriptor(Ut,fe).enumerable})),ar.push.apply(ar,zr)}return ar}function Ke(Ut){for(var _r=1;_r<arguments.length;_r++){var ar=arguments[_r]!=null?arguments[_r]:{};_r%2?Ct(Object(ar),!0).forEach(function(zr){(0,A.Z)(Ut,zr,ar[zr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Ut,Object.getOwnPropertyDescriptors(ar)):Ct(Object(ar)).forEach(function(zr){Object.defineProperty(Ut,zr,Object.getOwnPropertyDescriptor(ar,zr))})}return Ut}var Dt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xe=(Tt=(0,Je.b2)(),xt=(0,Je.f3)(tr.v.IShaderModuleService),Tt(yr=(ee=function(){function Ut(){(0,C.Z)(this,Ut),(0,le.Z)(this,"shaderModuleService",dr,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",Dt),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,d.Z)(Ut,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(ar){this.name=ar}},{key:"getType",value:function(){return zt.G.PostProcessing}},{key:"init",value:function(ar,zr){this.config=zr,this.rendererService=ar.getContainer().get(tr.v.IRendererService);var fe=this.rendererService,Re=fe.createAttribute,ge=fe.createBuffer,_t=fe.createModel,pt=this.setupShaders(),Nt=pt.vs,Bt=pt.fs,kr=pt.uniforms;this.model=_t({vs:Nt,fs:Bt,attributes:{a_Position:Re({buffer:ge({data:[-4,-4,4,-4,0,4],type:Vt.gl.FLOAT}),size:2})},uniforms:Ke(Ke({u_Texture:null},kr),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(ar){var zr=this,fe=ar.multiPassRenderer.getPostProcessor(),Re=this.rendererService,ge=Re.useFramebuffer,_t=Re.getViewportSize,pt=Re.clear,Nt=_t(),Bt=Nt.width,kr=Nt.height;ge(this.renderToScreen?null:fe.getWriteFBO(),function(){pt({framebuffer:fe.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),zr.model.draw({uniforms:Ke({u_Texture:fe.getReadFBO(),u_ViewportSize:[Bt,kr]},zr.convertOptionsToUniforms(zr.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(ar){this.enabled=ar}},{key:"setRenderToScreen",value:function(ar){this.renderToScreen=ar}},{key:"updateOptions",value:function(ar){this.optionsToUpdate=Ke(Ke({},this.optionsToUpdate),ar)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(ar){var zr={};return Object.keys(ar).forEach(function(fe){N()(ar[fe])||(zr["u_".concat(W()(Ye()(fe)))]=ar[fe])}),zr}}]),Ut}(),dr=(0,Q.Z)(ee.prototype,"shaderModuleService",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ee))||yr)},19793:function(Or,U,E){"use strict";E.d(U,{P:function(){return le}});var le=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(Or,U,E){"use strict";E.d(U,{v:function(){return le}});var le={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(Or,U,E){"use strict";var le=E(74691),C=null;function d(Xe){return C.indexOf(Xe)}var A=2,Q=4,K=64,W=128,L=256,N=512,Ne=8192,Ye=16384,Je=32768,rt=null,Yt=131072,Vt=262144,tr=524288,zt=1048576,Tt=2097152,xt=4194304,yr=8388608,ee=16777216,dr=null;function Ct(Xe,Ut){return Xe=_clamp(Math.floor(Xe),0,255),Ut=_clamp(Math.floor(Ut),0,255),256*Xe+Ut}function Ke(Xe){var Ut=Xe.color,_r=Xe.radius,ar=Xe.tileX,zr=Xe.tileY,fe=Xe.shape,Re=Xe.opacity,ge=Xe.stroke,_t=Xe.strokeWidth,pt=Xe.strokeOpacity,Nt=[],Bt=[],kr=[],ln=[Ct(Ut[0],Ut[1]),Ct(Ut[2],Ut[3])],yn=[Ct(ge[0],ge[1]),Ct(ge[2],ge[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Vi){var nr=_slicedToArray(Vi,2),de=nr[0],Te=nr[1];Nt.push([].concat(ln,[(de+1)*yr+(Te+1)*Tt+getShapeIndex(fe)*Yt+_r,(ar+512)*tr+(zr+512)*K])),Bt.push([].concat(yn,[_t,pt])),kr.push([Re,0,0,0])}),{packedBuffer:Nt,packedBuffer2:Bt,packedBuffer3:kr}}function Dt(Xe,Ut){if(Xe===0&&!Ut)return 0;if(Xe===1&&Ut)return 4294967295;var _r=Ut?1:0,ar=Math.floor(Xe*127);return ar*dr+_r*ee+ar*Yt+_r*rt+ar*N+_r*L+ar*A+_r}},37624:function(Or,U,E){"use strict";E.d(U,{zP:function(){return Ng},JE:function(){return Ny},ns:function(){return Bg}});var le=E(67294),C=(0,le.createContext)({});function d(){return(0,le.useContext)(C)}var A=E(58881),Q=E(28481),K=E(6610),W=E(5991),L=E(96156),N=E(63349),Ne=E(10379),Ye=E(46070),Je=E(77608),rt=E(6901),Yt=E(26729);function Vt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function tr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Vt(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Vt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function zt(n){var c=Tt();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Tt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var xt;(function(n){n.TOPRIGHT="topright",n.TOPLEFT="topleft",n.BOTTOMRIGHT="bottomright",n.BOTTOMLEFT="bottomleft"})(xt||(xt={}));var yr=0,ee=function(n){(0,Ne.Z)(a,n);var c=zt(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this),(0,L.Z)((0,N.Z)(l),"controlOption",void 0),(0,L.Z)((0,N.Z)(l),"container",void 0),(0,L.Z)((0,N.Z)(l),"sceneContainer",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"renderService",void 0),(0,L.Z)((0,N.Z)(l),"layerService",void 0),(0,L.Z)((0,N.Z)(l),"controlService",void 0),(0,L.Z)((0,N.Z)(l),"isShow",void 0),l.controlOption=tr(tr({},l.getDefault()),s||{}),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:xt.TOPRIGHT,name:"".concat(yr++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",p=this.controlService;return p&&p.removeControl(this),this.controlOption.position=l,p&&p.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(A.vK.IMapService),this.renderService=l.get(A.vK.IRendererService),this.layerService=l.get(A.vK.ILayerService),this.controlService=l.get(A.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var p=this.container,_=this.controlOption.position,T=this.controlService.controlCorners[_];return rt.SO.addClass(p,"l7-control"),_.indexOf("bottom")!==-1?T.insertBefore(p,T.firstChild):T.appendChild(p),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;rt.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;rt.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;rt.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var p=this.mapsService.getContainer();p!==null&&p.focus()}}}]),a}(Yt.EventEmitter);function dr(n){var c=Ct();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ct(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ke=function(n){(0,Ne.Z)(a,n);var c=dr(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"layerControlInputs",void 0),(0,L.Z)((0,N.Z)(l),"layers",void 0),(0,L.Z)((0,N.Z)(l),"lastZIndex",void 0),(0,L.Z)((0,N.Z)(l),"handlingClick",void 0),(0,L.Z)((0,N.Z)(l),"layersLink",void 0),(0,L.Z)((0,N.Z)(l),"baseLayersList",void 0),(0,L.Z)((0,N.Z)(l),"separator",void 0),(0,L.Z)((0,N.Z)(l),"overlaysList",void 0),(0,L.Z)((0,N.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,rt.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:A.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(p){p.layer.on("remove",l.onLayerChange),p.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,p){return this.addLayer(l,p,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),p=l.height;rt.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=p-(this.container.offsetTop+50);return _<this.form.clientHeight?(rt.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):rt.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return rt.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(p){p.layer.off("remove",l.onLayerChange),p.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",p=this.container=rt.SO.create("div",l),_=this.controlOption.collapsed;p.setAttribute("aria-haspopup","true");var T=this.form=rt.SO.create("form",l+"-list");_&&(this.mapsService.on("click",this.collapse),p.addEventListener("mouseenter",this.expand),p.addEventListener("mouseleave",this.collapse)),this.layersLink=rt.SO.create("a",l+"-toggle",p);var I=this.layersLink;I.title="Layers",_||this.expand(),this.baseLayersList=rt.SO.create("div",l+"-base",T),this.separator=rt.SO.create("div",l+"-separator",T),this.overlaysList=rt.SO.create("div",l+"-overlays",T),p.appendChild(T)}},{key:"initLayers",value:function(){var l=this,p=this.controlOption,_=p.baseLayers,T=_===void 0?{}:_,I=p.overlayers,k=I===void 0?{}:I;Object.keys(T).forEach(function(J,X){l.addLayer(T[J],J,!1)}),Object.keys(k).forEach(function(J,X){l.addLayer(k[J],J,!0)})}},{key:"update",value:function(){if(!this.container)return this;rt.SO.empty(this.baseLayersList),rt.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,p,_,T,I=0;for(_=0;_<this.layers.length;_++)T=this.layers[_],this.addItem(T),p=p||T.overlay,l=l||!T.overlay,I+=T.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&I>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=p&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,p,_,T=this.mapsService.getZoom(),I=l.length-1;I>=0;I--)if(p=l[I],_=this.layerService.getLayer(p.layerId),_&&_.inited){var k=_.getMinZoom(),J=_.getMaxZoom();p.disabled=T<k||T>J}}},{key:"addLayer",value:function(l,p,_){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:p,overlay:_});var T=this.controlOption,I=T.sortLayers,k=T.sortFunction,J=T.autoZIndex;I&&this.layers.sort(function(X,ve){return k(X.layer,ve.layer,X.name,ve.name)}),J&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var p=this.layerService.getLayer(l.target.layerId),_=p!=null&&p.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;_&&this.emit(_,p)}},{key:"createRadioElement",value:function(l,p){var _='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(p?' checked="checked"':"")+"/>",T=document.createElement("div");return T.innerHTML=_,T.firstChild}},{key:"addItem",value:function(l){var p=document.createElement("label"),_=this.layerService.getLayer(l.layer.id),T=_&&_.inited&&l.layer.isVisible(),I;l.overlay?(I=document.createElement("input"),I.type="checkbox",I.className="l7-control-layers-selector",I.defaultChecked=T):I=this.createRadioElement("l7-base-layers",T),this.layerControlInputs.push(I),I.layerId=l.layer.id,I.addEventListener("click",this.onInputClick);var k=document.createElement("span");k.innerHTML=" "+l.name;var J=document.createElement("div");p.appendChild(J),J.appendChild(I),J.appendChild(k);var X=l.overlay?this.overlaysList:this.baseLayersList;return X.appendChild(p),this.checkDisabledLayers(),p}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,p,_,T=[],I=[];this.handlingClick=!0;for(var k=l.length-1;k>=0;k--)p=l[k],_=this.layerService.getLayer(p.layerId),p.checked?T.push(_):p.checked||I.push(_);I.forEach(function(J){J.hide()}),T.forEach(function(J){J.show()}),this.handlingClick=!1}}]),a}(ee);function Dt(n){var c=Xe();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Xe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ut=function(n){(0,Ne.Z)(a,n);var c=Dt(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:xt.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",p=rt.SO.create("div",l),_=rt.SO.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),p.appendChild(_),p}},{key:"onRemove",value:function(){return null}}]),a}(ee);function _r(n){var c=ar();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ar(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var zr=function(n){(0,Ne.Z)(a,n);var c=_r(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"mScale",void 0),(0,L.Z)((0,N.Z)(l),"iScale",void 0),(0,rt.Ev)(["update"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:xt.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",p=rt.SO.create("div",l);this.addScales(l+"-line",p);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),p}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,p=this.controlOption.maxWidth,_=l.getSize()[1]/2,T=l.containerToLngLat([0,_]),I=l.containerToLngLat([p,_]),k=(0,rt.yM)([T.lng,T.lat],[I.lng,I.lat]);this.updateScales(k)}},{key:"updateScales",value:function(l){var p=this.controlOption,_=p.metric,T=p.imperial;_&&l&&this.updateMetric(l),T&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var p=this.getRoundNum(l),_=p<1e3?p+" m":p/1e3+" km";this.updateScale(this.mScale,_,p/l)}},{key:"updateImperial",value:function(l){var p=l*3.2808399,_,T,I;p>5280?(_=p/5280,T=this.getRoundNum(_),this.updateScale(this.iScale,T+" mi",T/_)):(I=this.getRoundNum(p),this.updateScale(this.iScale,I+" ft",I/p))}},{key:"updateScale",value:function(l,p,_){var T=this.controlOption.maxWidth;l.style.width=Math.round(T*_)+"px",l.innerHTML=p}},{key:"getRoundNum",value:function(l){var p=Math.pow(10,(Math.floor(l)+"").length-1),_=l/p;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,p*_}},{key:"addScales",value:function(l,p){var _=this.controlOption,T=_.metric,I=_.imperial;T&&(this.mScale=rt.SO.create("div",l,p)),I&&(this.iScale=rt.SO.create("div",l,p))}}]),a}(ee);function fe(n){var c=Re();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Re(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ge=function(n){(0,Ne.Z)(a,n);var c=fe(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this,s),(0,L.Z)((0,N.Z)(l),"disabled",void 0),(0,L.Z)((0,N.Z)(l),"zoomInButton",void 0),(0,L.Z)((0,N.Z)(l),"zoomOutButton",void 0),(0,rt.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{position:xt.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",p=rt.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",p,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",p,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),p}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,p,_,T,I){var k=rt.SO.create("a",_,T);return k.innerHTML=l,k.title=p,k.href="javascript:void(0)",k.addEventListener("click",I),k}},{key:"updateDisabled",value:function(){var l=this.mapsService,p="l7-disabled";rt.SO.removeClass(this.zoomInButton,p),rt.SO.removeClass(this.zoomOutButton,p),(this.disabled||l.getZoom()<=l.getMinZoom())&&rt.SO.addClass(this.zoomOutButton,p),(this.disabled||l.getZoom()>=l.getMaxZoom())&&rt.SO.addClass(this.zoomInButton,p)}}]),a}(ee);function _t(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function pt(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?_t(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_t(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Nt(n){var c=Bt();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var kr=function(n){(0,Ne.Z)(a,n);var c=Nt(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this),(0,L.Z)((0,N.Z)(l),"markerOption",void 0),(0,L.Z)((0,N.Z)(l),"defaultMarker",void 0),(0,L.Z)((0,N.Z)(l),"popup",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"sceneSerive",void 0),(0,L.Z)((0,N.Z)(l),"lngLat",void 0),(0,L.Z)((0,N.Z)(l),"scene",void 0),(0,L.Z)((0,N.Z)(l),"added",!1),(0,L.Z)((0,N.Z)(l),"eventHandle",function(p){l.emit(p.type,{target:p,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=pt(pt({},l.getDefault()),s),(0,rt.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,N.Z)(l)),l.init(),l}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:rt.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(A.vK.IMapService),this.sceneSerive=l.get(A.vK.ISceneService);var p=this.markerOption,_=p.element,T=p.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&rt.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var p=this;if(!this.added)return this.once("added",function(){p.setElement(l)}),this;var _=this.markerOption.element;return _&&rt.SO.remove(_),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var p=this.popup;return p?(p.isOpen()||p.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var p=this.popup;return p&&p.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,_=l.anchor;this.updatePosition(),rt.SO.setTransform(p,"".concat(rt.rQ[_]))}}},{key:"onMapClick",value:function(l){var p=this.markerOption.element;this.popup&&p&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,_=l.offsets,T=this.lngLat,I=T.lng,k=T.lat,J=this.mapsService.getBounds(),X=this.mapsService.lngLatToContainer([I,k]);if(p){p.style.display="block";var ve=this.mapsService.getContainer(),Fe=0,ft=0;if(ve&&(Fe=ve.scrollWidth,ft=ve.scrollHeight),Math.abs(J[0][0])>180||Math.abs(J[1][0])>180){if(X.x>Fe){var Ot=this.mapsService.lngLatToContainer([I-360,k]);X.x=Ot.x}if(X.x<0){var mr=this.mapsService.lngLatToContainer([I+360,k]);X.x=mr.x}}(X.x>Fe||X.x<0||X.y>ft||X.y<0)&&(p.style.display="none"),p.style.left=X.x+_[0]+"px",p.style.top=X.y-_[1]+"px"}}}},{key:"init",value:function(){var l=this,p=this.markerOption.element,_=this.markerOption,T=_.color,I=_.anchor;if(!p){this.defaultMarker=!0,p=rt.SO.create("div"),this.markerOption.element=p;var k=document.createElementNS("http://www.w3.org/2000/svg","svg");k.setAttributeNS(null,"display","block"),k.setAttributeNS(null,"height","48px"),k.setAttributeNS(null,"width","48px"),k.setAttributeNS(null,"viewBox","0 0 1024 1024");var J=document.createElementNS("http://www.w3.org/2000/svg","path");J.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),J.setAttributeNS(null,"fill",T),k.appendChild(J),p.appendChild(k)}rt.SO.addClass(p,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(X){var ve,Fe,ft=((ve=l.markerOption)===null||ve===void 0?void 0:ve.style)&&((Fe=l.markerOption)===null||Fe===void 0?void 0:Fe.style[X]);p&&(p.style[X]=ft)}),p.addEventListener("click",function(X){l.onMapClick(X)}),p.addEventListener("click",this.eventHandle),(0,rt.zi)(p,I,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(Yt.EventEmitter),ln=E(82492),yn=E.n(ln),Vi=E(69848),nr=E.n(Vi);function de(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Te(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?de(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):de(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ue(n){var c=Le();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Le(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ft=function(n){(0,Ne.Z)(a,n);var c=Ue(a);function a(s){var l,p;return(0,K.Z)(this,a),p=c.call(this),(0,L.Z)((0,N.Z)(p),"markers",[]),(0,L.Z)((0,N.Z)(p),"markerLayerOption",void 0),(0,L.Z)((0,N.Z)(p),"clusterIndex",void 0),(0,L.Z)((0,N.Z)(p),"points",[]),(0,L.Z)((0,N.Z)(p),"clusterMarkers",[]),(0,L.Z)((0,N.Z)(p),"mapsService",void 0),(0,L.Z)((0,N.Z)(p),"scene",void 0),(0,L.Z)((0,N.Z)(p),"zoom",void 0),(0,L.Z)((0,N.Z)(p),"bbox",void 0),p.markerLayerOption=yn()(p.getDefault(),s),(0,rt.Ev)(["update"],(0,N.Z)(p)),p.zoom=((l=p.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,p}return(0,W.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(A.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var p=this.markerLayerOption.cluster;p&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var p=this.markers.indexOf(l);p>-1&&this.markers.splice(p,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(p){p.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,p){var _=l.getLnglat(),T=_.lng,I=_.lat,k={geometry:{type:"Point",coordinates:[T,I]},properties:Te(Te({},l.getExtData()),{},{marker_id:p})};this.points.push(k)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,p=l.radius,_=l.minZoom,T=_===void 0?0:_,I=l.maxZoom;this.clusterIndex=new(nr())({radius:p,minZoom:T,maxZoom:I}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,p){var _=this,T=l[0].concat(l[1]),I=this.clusterIndex.getClusters(T,p);this.clusterMarkers.forEach(function(k){k.remove()}),this.clusterMarkers=[],I.forEach(function(k){var J,X=_.markerLayerOption.clusterOption,ve=X.field,Fe=X.method;if(k.properties&&(J=k.properties)!==null&&J!==void 0&&J.cluster_id){var ft,Ot=_.getLeaves((ft=k.properties)===null||ft===void 0?void 0:ft.cluster_id);if(k.properties.clusterData=Ot,ve&&Fe){var mr=Ot==null?void 0:Ot.map(function(Yn){var Ei=(0,L.Z)({},ve,Yn.properties[ve]);return Ei}),Sr=rt.a5.getColumn(mr,ve),Zr=rt.a5.getSatByColumn(Fe,Sr),_n="point_"+Fe;k.properties[_n]=Zr.toFixed(2)}}var kn=_.clusterMarker(k);_.clusterMarkers.push(kn),kn.addTo(_.scene)})}},{key:"getLeaves",value:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,p,_):null}},{key:"clusterMarker",value:function(l){var p=this.markerLayerOption.clusterOption,_=p,T=_.element,I=T===void 0?this.generateElement.bind(this):T,k=new kr({element:I(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return k}},{key:"normalMarker",value:function(l){var p=l.properties.marker_id;return this.markers[p]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),p=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,rt.oO)(this.bbox,p))&&(this.bbox=(0,rt.yA)(p,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var p=rt.SO.create("div","l7-marker-cluster"),_=rt.SO.create("div","",p),T=rt.SO.create("span","",_),I=this.markerLayerOption.clusterOption,k=I.field,J=I.method;l.properties.point_count=l.properties.point_count||1;var X=k&&J?l.properties["point_"+J]||l.properties[k]:l.properties.point_count;return T.textContent=X,p}}]),a}(Yt.EventEmitter);function er(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function w(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?er(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):er(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Z(n){var c=Ee();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ee(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ze=function(n){(0,Ne.Z)(a,n);var c=Z(a);function a(s){var l;return(0,K.Z)(this,a),l=c.call(this),(0,L.Z)((0,N.Z)(l),"popupOption",void 0),(0,L.Z)((0,N.Z)(l),"mapsService",void 0),(0,L.Z)((0,N.Z)(l),"sceneSerive",void 0),(0,L.Z)((0,N.Z)(l),"lngLat",void 0),(0,L.Z)((0,N.Z)(l),"content",void 0),(0,L.Z)((0,N.Z)(l),"closeButton",void 0),(0,L.Z)((0,N.Z)(l),"timeoutInstance",void 0),(0,L.Z)((0,N.Z)(l),"container",void 0),(0,L.Z)((0,N.Z)(l),"tip",void 0),(0,L.Z)((0,N.Z)(l),"scene",void 0),l.popupOption=w(w({},l.getdefault()),s),(0,rt.Ev)(["update","onClickClose","remove"],(0,N.Z)(l)),l}return(0,W.Z)(a,[{key:"addTo",value:function(l){var p=this;return this.mapsService=l.get(A.vK.IMapService),this.sceneSerive=l.get(A.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){p.mapsService.on("click",p.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var p=window.document.createDocumentFragment(),_=window.document.createElement("body"),T;for(_.innerHTML=l;T=_.firstChild,!!T;)p.appendChild(T);return this.setDOMContent(p)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&rt.SO.remove(this.content),this.content=rt.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=rt.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,p,_){var T=window.document.createElement(l);return p!==void 0&&(T.className=p),_&&_.appendChild(T),T}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:rt.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,p=this.lngLat,_=this.popupOption,T=_.className,I=_.maxWidth,k=_.anchor;if(!(!this.mapsService||!p||!this.content)){var J=this.mapsService.getMarkerContainer();if(!this.container&&J){this.container=this.creatDom("div","l7-popup",J),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),T&&T.split(" ").forEach(function(ve){return l.container.classList.add(ve)});var X=this.popupOption.stopPropagation;X&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(ve){l.container.addEventListener(ve,function(Fe){Fe.stopPropagation()})})}I&&this.container.style.maxWidth!==I&&(this.container.style.maxWidth=I),this.updatePosition(),rt.SO.setTransform(this.container,"".concat(rt.rQ[k])),(0,rt.zi)(this.container,k,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,p=l.lng,_=l.lat,T=this.popupOption.offsets,I=this.mapsService.lngLatToContainer([p,_]);this.container.style.left=I.x+T[0]+"px",this.container.style.top=I.y-T[1]+"px"}}}]),a}(Yt.EventEmitter);function Qe(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}Qe(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var yt=E(92137),St=E(87757),jt=E.n(St),Et=E(86700),Qt=E(88307),ie=E.n(Qt),sr=E(28660),Br=function(){function n(c,a){(0,K.Z)(this,n),(0,L.Z)(this,"attribute",void 0),(0,L.Z)(this,"buffer",void 0);var s=a.buffer,l=a.offset,p=a.stride,_=a.normalized,T=a.size,I=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:p||0,normalized:_||!1,divisor:I||0},T&&(this.attribute.size=T)}return(0,W.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),Lr,nt,gt,vt,hr,Vr,Ur,nn,Jr,Cr,Dn,Hn,bi,Ui,Ji=(Lr={},(0,L.Z)(Lr,A.gl.POINTS,"points"),(0,L.Z)(Lr,A.gl.LINES,"lines"),(0,L.Z)(Lr,A.gl.LINE_LOOP,"line loop"),(0,L.Z)(Lr,A.gl.LINE_STRIP,"line strip"),(0,L.Z)(Lr,A.gl.TRIANGLES,"triangles"),(0,L.Z)(Lr,A.gl.TRIANGLE_FAN,"triangle fan"),(0,L.Z)(Lr,A.gl.TRIANGLE_STRIP,"triangle strip"),Lr),Ri=(nt={},(0,L.Z)(nt,A.gl.STATIC_DRAW,"static"),(0,L.Z)(nt,A.gl.DYNAMIC_DRAW,"dynamic"),(0,L.Z)(nt,A.gl.STREAM_DRAW,"stream"),nt),Ii=(gt={},(0,L.Z)(gt,A.gl.BYTE,"int8"),(0,L.Z)(gt,A.gl.UNSIGNED_INT,"int16"),(0,L.Z)(gt,A.gl.INT,"int32"),(0,L.Z)(gt,A.gl.UNSIGNED_BYTE,"uint8"),(0,L.Z)(gt,A.gl.UNSIGNED_SHORT,"uint16"),(0,L.Z)(gt,A.gl.UNSIGNED_INT,"uint32"),(0,L.Z)(gt,A.gl.FLOAT,"float"),gt),Y=(vt={},(0,L.Z)(vt,A.gl.ALPHA,"alpha"),(0,L.Z)(vt,A.gl.LUMINANCE,"luminance"),(0,L.Z)(vt,A.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,L.Z)(vt,A.gl.RGB,"rgb"),(0,L.Z)(vt,A.gl.RGBA,"rgba"),(0,L.Z)(vt,A.gl.RGBA4,"rgba4"),(0,L.Z)(vt,A.gl.RGB5_A1,"rgb5 a1"),(0,L.Z)(vt,A.gl.RGB565,"rgb565"),(0,L.Z)(vt,A.gl.DEPTH_COMPONENT,"depth"),(0,L.Z)(vt,A.gl.DEPTH_STENCIL,"depth stencil"),vt),ce=(hr={},(0,L.Z)(hr,A.gl.DONT_CARE,"dont care"),(0,L.Z)(hr,A.gl.NICEST,"nice"),(0,L.Z)(hr,A.gl.FASTEST,"fast"),hr),ye=(Vr={},(0,L.Z)(Vr,A.gl.NEAREST,"nearest"),(0,L.Z)(Vr,A.gl.LINEAR,"linear"),(0,L.Z)(Vr,A.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,L.Z)(Vr,A.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,L.Z)(Vr,A.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,L.Z)(Vr,A.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Vr),z=(Ur={},(0,L.Z)(Ur,A.gl.REPEAT,"repeat"),(0,L.Z)(Ur,A.gl.CLAMP_TO_EDGE,"clamp"),(0,L.Z)(Ur,A.gl.MIRRORED_REPEAT,"mirror"),Ur),oe=(nn={},(0,L.Z)(nn,A.gl.NONE,"none"),(0,L.Z)(nn,A.gl.BROWSER_DEFAULT_WEBGL,"browser"),nn),me=(Jr={},(0,L.Z)(Jr,A.gl.NEVER,"never"),(0,L.Z)(Jr,A.gl.ALWAYS,"always"),(0,L.Z)(Jr,A.gl.LESS,"less"),(0,L.Z)(Jr,A.gl.LEQUAL,"lequal"),(0,L.Z)(Jr,A.gl.GREATER,"greater"),(0,L.Z)(Jr,A.gl.GEQUAL,"gequal"),(0,L.Z)(Jr,A.gl.EQUAL,"equal"),(0,L.Z)(Jr,A.gl.NOTEQUAL,"notequal"),Jr),Ae=(Cr={},(0,L.Z)(Cr,A.gl.FUNC_ADD,"add"),(0,L.Z)(Cr,A.gl.MIN_EXT,"min"),(0,L.Z)(Cr,A.gl.MAX_EXT,"max"),(0,L.Z)(Cr,A.gl.FUNC_SUBTRACT,"subtract"),(0,L.Z)(Cr,A.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Cr),se=(Dn={},(0,L.Z)(Dn,A.gl.ZERO,"zero"),(0,L.Z)(Dn,A.gl.ONE,"one"),(0,L.Z)(Dn,A.gl.SRC_COLOR,"src color"),(0,L.Z)(Dn,A.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,L.Z)(Dn,A.gl.SRC_ALPHA,"src alpha"),(0,L.Z)(Dn,A.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,L.Z)(Dn,A.gl.DST_COLOR,"dst color"),(0,L.Z)(Dn,A.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,L.Z)(Dn,A.gl.DST_ALPHA,"dst alpha"),(0,L.Z)(Dn,A.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,L.Z)(Dn,A.gl.CONSTANT_COLOR,"constant color"),(0,L.Z)(Dn,A.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,L.Z)(Dn,A.gl.CONSTANT_ALPHA,"constant alpha"),(0,L.Z)(Dn,A.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,L.Z)(Dn,A.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),Dn),Ce=(Hn={},(0,L.Z)(Hn,A.gl.NEVER,"never"),(0,L.Z)(Hn,A.gl.ALWAYS,"always"),(0,L.Z)(Hn,A.gl.LESS,"less"),(0,L.Z)(Hn,A.gl.LEQUAL,"lequal"),(0,L.Z)(Hn,A.gl.GREATER,"greater"),(0,L.Z)(Hn,A.gl.GEQUAL,"gequal"),(0,L.Z)(Hn,A.gl.EQUAL,"equal"),(0,L.Z)(Hn,A.gl.NOTEQUAL,"notequal"),Hn),ct=(bi={},(0,L.Z)(bi,A.gl.ZERO,"zero"),(0,L.Z)(bi,A.gl.KEEP,"keep"),(0,L.Z)(bi,A.gl.REPLACE,"replace"),(0,L.Z)(bi,A.gl.INVERT,"invert"),(0,L.Z)(bi,A.gl.INCR,"increment"),(0,L.Z)(bi,A.gl.DECR,"decrement"),(0,L.Z)(bi,A.gl.INCR_WRAP,"increment wrap"),(0,L.Z)(bi,A.gl.DECR_WRAP,"decrement wrap"),bi),xr=(Ui={},(0,L.Z)(Ui,A.gl.FRONT,"front"),(0,L.Z)(Ui,A.gl.BACK,"back"),Ui),Gt=function(){function n(c,a){(0,K.Z)(this,n),(0,L.Z)(this,"buffer",void 0);var s=a.data,l=a.usage,p=a.type;this.buffer=c.buffer({data:s,usage:Ri[l||A.gl.STATIC_DRAW],type:Ii[p||A.gl.UNSIGNED_BYTE]})}return(0,W.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),n}(),Jt=function(){function n(c,a){(0,K.Z)(this,n),(0,L.Z)(this,"elements",void 0);var s=a.data,l=a.usage,p=a.type,_=a.count;this.elements=c.elements({data:s,usage:Ri[l||A.gl.STATIC_DRAW],type:Ii[p||A.gl.UNSIGNED_BYTE],count:_})}return(0,W.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),Rr=function(){function n(c,a){(0,K.Z)(this,n),(0,L.Z)(this,"framebuffer",void 0);var s=a.width,l=a.height,p=a.color,_=a.colors,T=a.depth,I=a.stencil,k={width:s,height:l};Array.isArray(_)&&(k.colors=_.map(function(J){return J.get()})),p&&typeof p!="boolean"&&(k.color=p.get()),this.framebuffer=c.framebuffer(k)}return(0,W.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),n}(),Ln=E(90484),Mn=E(36719),$t=E.n(Mn),bn=E(68630),on=E.n(bn);function un(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function wi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?un(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):un(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var xn=function(){function n(c,a){(0,K.Z)(this,n),(0,L.Z)(this,"reGl",void 0),(0,L.Z)(this,"destroyed",!1),(0,L.Z)(this,"drawCommand",void 0),(0,L.Z)(this,"drawParams",void 0),(0,L.Z)(this,"options",void 0),(0,L.Z)(this,"uniforms",{}),this.reGl=c;var s=a.vs,l=a.fs,p=a.attributes,_=a.uniforms,T=a.primitive,I=a.count,k=a.elements,J=a.depth,X=a.blend,ve=a.stencil,Fe=a.cull,ft=a.instances,Ot={};this.options=a,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(Zr){Ot[Zr]=c.prop(Zr)}));var mr={};Object.keys(p).forEach(function(Zr){mr[Zr]=p[Zr].get()});var Sr={attributes:mr,frag:l,uniforms:Ot,vert:s,primitive:Ji[T===void 0?A.gl.TRIANGLES:T]};ft&&(Sr.instances=ft),I&&(Sr.count=I),k&&(Sr.elements=k.get()),this.initDepthDrawParams({depth:J},Sr),this.initBlendDrawParams({blend:X},Sr),this.initStencilDrawParams({stencil:ve},Sr),this.initCullDrawParams({cull:Fe},Sr),this.drawCommand=c(Sr),this.drawParams=Sr}return(0,W.Z)(n,[{key:"addUniforms",value:function(a){this.uniforms=wi(wi({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=wi(wi({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(p){var _=(0,Ln.Z)(s[p]);_==="boolean"||_==="number"||Array.isArray(s[p])||s[p].BYTES_PER_ELEMENT?l[p]=s[p]:l[p]=s[p].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:me[l.func||A.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var p=l.enable,_=l.func,T=l.equation,I=l.color,k=I===void 0?[0,0,0,0]:I;s.blend={enable:!!p,func:{srcRGB:se[_&&_.srcRGB||A.gl.SRC_ALPHA],srcAlpha:se[_&&_.srcAlpha||A.gl.SRC_ALPHA],dstRGB:se[_&&_.dstRGB||A.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:se[_&&_.dstAlpha||A.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Ae[T&&T.rgb||A.gl.FUNC_ADD],alpha:Ae[T&&T.alpha||A.gl.FUNC_ADD]},color:k}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var p=l.enable,_=l.mask,T=_===void 0?-1:_,I=l.func,k=I===void 0?{cmp:A.gl.ALWAYS,ref:0,mask:-1}:I,J=l.opFront,X=J===void 0?{fail:A.gl.KEEP,zfail:A.gl.KEEP,zpass:A.gl.KEEP}:J,ve=l.opBack,Fe=ve===void 0?{fail:A.gl.KEEP,zfail:A.gl.KEEP,zpass:A.gl.KEEP}:ve;s.stencil={enable:!!p,mask:T,func:wi(wi({},k),{},{cmp:Ce[k.cmp]}),opFront:{fail:ct[X.fail],zfail:ct[X.zfail],zpass:ct[X.zpass]},opBack:{fail:ct[Fe.fail],zfail:ct[Fe.zfail],zpass:ct[Fe.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var p=l.enable,_=l.face,T=_===void 0?A.gl.BACK:_;s.cull={enable:!!p,face:xr[T]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(p){s.extractUniformsRecursively(p,a[p],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,p){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||$t()(s)||s===""||"resize"in s){l["".concat(p&&p+".").concat(a)]=s;return}on()(s)&&Object.keys(s).forEach(function(T){_.extractUniformsRecursively(T,s[T],l,"".concat(p&&p+".").concat(a))}),Array.isArray(s)&&s.forEach(function(T,I){Object.keys(T).forEach(function(k){_.extractUniformsRecursively(k,T[k],l,"".concat(p&&p+".").concat(a,"[").concat(I,"]"))})})}}]),n}(),Oi=function(){function n(c,a){(0,K.Z)(this,n),(0,L.Z)(this,"texture",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0);var s=a.data,l=a.type,p=l===void 0?A.gl.UNSIGNED_BYTE:l,_=a.width,T=a.height,I=a.flipY,k=I===void 0?!1:I,J=a.format,X=J===void 0?A.gl.RGBA:J,ve=a.mipmap,Fe=ve===void 0?!1:ve,ft=a.wrapS,Ot=ft===void 0?A.gl.CLAMP_TO_EDGE:ft,mr=a.wrapT,Sr=mr===void 0?A.gl.CLAMP_TO_EDGE:mr,Zr=a.aniso,_n=Zr===void 0?0:Zr,kn=a.alignment,Yn=kn===void 0?1:kn,Ei=a.premultiplyAlpha,Qn=Ei===void 0?!1:Ei,Ti=a.mag,sa=Ti===void 0?A.gl.NEAREST:Ti,ma=a.min,vi=ma===void 0?A.gl.NEAREST:ma,Oa=a.colorSpace,qa=Oa===void 0?A.gl.BROWSER_DEFAULT_WEBGL:Oa;this.width=_,this.height=T;var wu={width:_,height:T,type:Ii[p],format:Y[X],wrapS:z[Ot],wrapT:z[Sr],mag:ye[sa],min:ye[vi],alignment:Yn,flipY:k,colorSpace:oe[qa],premultiplyAlpha:Qn,aniso:_n};s&&(wu.data=s),typeof Fe=="number"?wu.mipmap=ce[Fe]:typeof Fe=="boolean"&&(wu.mipmap=Fe),this.texture=c.texture(wu)}return(0,W.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),Yi,oi,Ki=(Yi=(0,Et.b2)(),Yi(oi=function(){function n(){var c=this;(0,K.Z)(this,n),(0,L.Z)(this,"extensionObject",void 0),(0,L.Z)(this,"gl",void 0),(0,L.Z)(this,"$container",void 0),(0,L.Z)(this,"canvas",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"isDirty",void 0),(0,L.Z)(this,"createModel",function(a){return new xn(c.gl,a)}),(0,L.Z)(this,"createAttribute",function(a){return new Br(c.gl,a)}),(0,L.Z)(this,"createBuffer",function(a){return new Gt(c.gl,a)}),(0,L.Z)(this,"createElements",function(a){return new Jt(c.gl,a)}),(0,L.Z)(this,"createTexture2D",function(a){return new Oi(c.gl,a)}),(0,L.Z)(this,"createFramebuffer",function(a){return new Rr(c.gl,a)}),(0,L.Z)(this,"useFramebuffer",function(a,s){c.gl({framebuffer:a?a.get():null})(s)}),(0,L.Z)(this,"clear",function(a){var s=a.color,l=a.depth,p=a.stencil,_=a.framebuffer,T=_===void 0?null:_,I={color:s,depth:l,stencil:p};I.framebuffer=T===null?T:T.get(),c.gl.clear(I)}),(0,L.Z)(this,"viewport",function(a){var s=a.x,l=a.y,p=a.width,_=a.height;c.gl._gl.viewport(s,l,p,_),c.width=p,c.height=_,c.gl._refresh()}),(0,L.Z)(this,"readPixels",function(a){var s=a.framebuffer,l=a.x,p=a.y,_=a.width,T=a.height,I={x:l,y:p,width:_,height:T};return s&&(I.framebuffer=s.get()),c.gl.read(I)}),(0,L.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,L.Z)(this,"getContainer",function(){var a;return(a=c.canvas)===null||a===void 0?void 0:a.parentElement}),(0,L.Z)(this,"getCanvas",function(){return c.canvas}),(0,L.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,L.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,W.Z)(n,[{key:"init",value:function(){var c=(0,yt.Z)(jt().mark(function s(l,p){var _=this;return jt().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return this.canvas=l,I.next=3,new Promise(function(k,J){ie()({canvas:_.canvas,attributes:{alpha:!0,antialias:p.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:p.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(ve,Fe){(ve||!Fe)&&J(ve),k(Fe)}})});case 3:this.gl=I.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return I.stop()}},s,this)}));function a(s,l){return c.apply(this,arguments)}return a}()},{key:"testExtension",value:function(a){return!!this.getGLContext().getExtension(a)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||oi);function zi(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ai(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?zi(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):zi(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var ca=function(){function n(c){(0,K.Z)(this,n),(0,L.Z)(this,"sceneService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"controlService",void 0),(0,L.Z)(this,"layerService",void 0),(0,L.Z)(this,"iconService",void 0),(0,L.Z)(this,"markerService",void 0),(0,L.Z)(this,"popupService",void 0),(0,L.Z)(this,"fontService",void 0),(0,L.Z)(this,"interactionService",void 0),(0,L.Z)(this,"container",void 0);var a=c.id,s=c.map,l=(0,A.Hp)();this.container=l,s.setContainer(l,a),l.bind(A.vK.IRendererService).to(Ki).inSingletonScope(),this.sceneService=l.get(A.vK.ISceneService),this.mapService=l.get(A.vK.IMapService),this.iconService=l.get(A.vK.IIconService),this.fontService=l.get(A.vK.IFontService),this.controlService=l.get(A.vK.IControlService),this.layerService=l.get(A.vK.ILayerService),this.markerService=l.get(A.vK.IMarkerService),this.interactionService=l.get(A.vK.IInteractionService),this.popupService=l.get(A.vK.IPopupService),this.initComponent(a),this.sceneService.init(c),this.initControl()}return(0,W.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var p=new a(s);p.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(a){var s=(0,A.e7)(this.container);a.setContainer(s),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a){this.layerService.remove(a)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var p=(0,Q.Z)(l,2),_=p[0],T=p[1];s.fontService.addIconFont(_,T)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){A.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"once",value:function(a,s){A.SceneEventList.indexOf(a)===-1?this.mapService.once(a,s):this.sceneService.once(a,s)}},{key:"off",value:function(a,s){A.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a){this.mapService.panBy(a)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),p=l.fitBoundsOptions,_=l.animate;this.mapService.fitBounds(a,s||Ai(Ai({},p),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(A.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:rt.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new Ut({position:l}))}}]),n}(),ba=E(81253),ai=E(55770),ti=E(3473),Gi=E(13218),da=E.n(Gi),Xo=E(23560),ya=E.n(Xo),mi=E(46343),ga,Gs,Sa,Co,Wa;function Xa(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var Yo=(ga=(0,Et.b2)(),Gs=(0,Et.f3)(A.vK.IGlobalConfigService),ga(Sa=(Co=function(){function n(){(0,K.Z)(this,n),(0,ai.Z)(this,"configService",Wa,this),(0,L.Z)(this,"enabled",void 0)}return(0,W.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.rendererService,_=s.postProcessingPassFactory,T=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var I=a.getLayerConfig(),k=I.enableMultiPassRenderer,J=I.passes,X=J===void 0?[]:J;l.enabled=!!k&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,X,_,T),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,p){var _=a.multiPassRenderer,T=a.getLayerConfig(),I=T.enablePicking,k=T.enableTAA;return I&&_.add(p("pixelPicking")),_}}]),n}(),Wa=(0,ti.Z)(Co.prototype,"configService",[Gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Co))||Sa),Zi,Ao=(Zi={},(0,L.Z)(Zi,A.BlendType.additive,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(Zi,A.BlendType.none,{enable:!1}),(0,L.Z)(Zi,A.BlendType.normal,{enable:!0,func:{srcRGB:A.gl.SRC_ALPHA,dstRGB:A.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,L.Z)(Zi,A.BlendType.subtractive,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE,srcAlpha:A.gl.ZERO,dstAlpha:A.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:A.gl.FUNC_SUBTRACT,alpha:A.gl.FUNC_SUBTRACT}}),(0,L.Z)(Zi,A.BlendType.max,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE},equation:{rgb:A.gl.MAX_EXT}}),(0,L.Z)(Zi,A.BlendType.min,{enable:!0,func:{srcRGB:A.gl.ONE,dstRGB:A.gl.ONE},equation:{rgb:A.gl.MIN_EXT}}),Zi),Lo=E(47037),so=E.n(Lo),Ro=E(81763),Hi=E.n(Ro),Da=E(1469),Ba=E.n(Da),_s=1024;function _a(n,c,a,s,l){c.updateStyleAttribute(n,a,s,l)}function xe(n,c){n.opacity&&ke("opacity",c,n.opacity),n.strokeWidth&&ke("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&ke("strokeOpacity",c,n.strokeOpacity),n.stroke&&Xt("stroke",c,n.stroke),n.offsets&&lt("offsets",c,n.offsets),n.textOffset&&lt("textOffset",c,n.textOffset)}function ke(n,c,a){so()(a)?_a(n,c,a,function(s){return s}):Hi()(a)?_a(n,c,[a],void 0):Ba()(a)&&a.length===2?so()(a[0])&&ya()(a[1])||so()(a[0])&&Ba()(a[1])&&Hi()(a[1][0])&&Hi()(a[1][1])?_a(n,c,a[0],a[1]):_a(n,c,[1],void 0):_a(n,c,[1],void 0)}function lt(n,c,a){so()(a)?_a(n,c,a,function(s){return s}):Ba()(a)&&a.length===2&&so()(a[0])&&ya()(a[1])?_a(n,c,a[0],a[1]):Ba()(a)&&a.length===2&&Hi()(a[0])&&Hi()(a[1])?_a(n,c,a,void 0):_a(n,c,[0,0],void 0)}function Xt(n,c,a){so()(a)?_a(n,c,a,void 0):Ba()(a)&&a.length===2&&(so()(a[0])&&ya()(a[1])||so()(a[0])&&Ba()(a[1])&&a[1].length>0)?_a(n,c,a[0],a[1]):_a(n,c,"#fff",void 0)}var Xr,$n,yi,no,Ya;function uo(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Ko(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,T;return{s:function(){a=a.call(n)},n:function(){var k=a.next();return p=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function Ko(n,c){if(!!n){if(typeof n=="string")return Hs(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hs(n,c)}}function Hs(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function xs(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function po(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?xs(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):xs(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function fs(n){var c=zo();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function zo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var $o=0,yo=(Xr=(0,A.yT)(A.vK.IGlobalConfigService),$n=(0,A.yT)(A.vK.IShaderModuleService),yi=function(n){(0,Ne.Z)(a,n);var c=fs(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,K.Z)(this,a),s=c.call(this),(0,L.Z)((0,N.Z)(s),"id","".concat($o++)),(0,L.Z)((0,N.Z)(s),"name","".concat($o)),(0,L.Z)((0,N.Z)(s),"type",void 0),(0,L.Z)((0,N.Z)(s),"visible",!0),(0,L.Z)((0,N.Z)(s),"zIndex",0),(0,L.Z)((0,N.Z)(s),"minZoom",void 0),(0,L.Z)((0,N.Z)(s),"maxZoom",void 0),(0,L.Z)((0,N.Z)(s),"inited",!1),(0,L.Z)((0,N.Z)(s),"layerModelNeedUpdate",!1),(0,L.Z)((0,N.Z)(s),"pickedFeatureID",null),(0,L.Z)((0,N.Z)(s),"selectedFeatureID",null),(0,L.Z)((0,N.Z)(s),"styleNeedUpdate",!1),(0,L.Z)((0,N.Z)(s),"rendering",void 0),(0,L.Z)((0,N.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,L.Z)((0,N.Z)(s),"hooks",{init:new mi.oI,afterInit:new mi.oI,beforeRender:new mi.oI,beforeRenderData:new mi.gg,afterRender:new mi.ni,beforePickingEncode:new mi.ni,afterPickingEncode:new mi.ni,beforeHighlight:new mi.ni(["pickedColor"]),afterHighlight:new mi.ni,beforeSelect:new mi.ni(["pickedColor"]),afterSelect:new mi.ni,beforeDestroy:new mi.ni,afterDestroy:new mi.ni}),(0,L.Z)((0,N.Z)(s),"models",[]),(0,L.Z)((0,N.Z)(s),"multiPassRenderer",void 0),(0,L.Z)((0,N.Z)(s),"plugins",void 0),(0,L.Z)((0,N.Z)(s),"sourceOption",void 0),(0,L.Z)((0,N.Z)(s),"layerModel",void 0),(0,ai.Z)((0,N.Z)(s),"configService",no,(0,N.Z)(s)),(0,ai.Z)((0,N.Z)(s),"shaderModuleService",Ya,(0,N.Z)(s)),(0,L.Z)((0,N.Z)(s),"cameraService",void 0),(0,L.Z)((0,N.Z)(s),"coordinateService",void 0),(0,L.Z)((0,N.Z)(s),"iconService",void 0),(0,L.Z)((0,N.Z)(s),"fontService",void 0),(0,L.Z)((0,N.Z)(s),"pickingService",void 0),(0,L.Z)((0,N.Z)(s),"rendererService",void 0),(0,L.Z)((0,N.Z)(s),"layerService",void 0),(0,L.Z)((0,N.Z)(s),"interactionService",void 0),(0,L.Z)((0,N.Z)(s),"mapService",void 0),(0,L.Z)((0,N.Z)(s),"styleAttributeService",void 0),(0,L.Z)((0,N.Z)(s),"layerSource",void 0),(0,L.Z)((0,N.Z)(s),"postProcessingPassFactory",void 0),(0,L.Z)((0,N.Z)(s),"normalPassFactory",void 0),(0,L.Z)((0,N.Z)(s),"animateOptions",{enable:!1}),(0,L.Z)((0,N.Z)(s),"container",void 0),(0,L.Z)((0,N.Z)(s),"encodedData",void 0),(0,L.Z)((0,N.Z)(s),"configSchema",void 0),(0,L.Z)((0,N.Z)(s),"currentPickId",null),(0,L.Z)((0,N.Z)(s),"rawConfig",void 0),(0,L.Z)((0,N.Z)(s),"needUpdateConfig",void 0),(0,L.Z)((0,N.Z)(s),"pendingStyleAttributes",[]),(0,L.Z)((0,N.Z)(s),"scaleOptions",{}),(0,L.Z)((0,N.Z)(s),"animateStartTime",void 0),(0,L.Z)((0,N.Z)(s),"aniamateStatus",!1),(0,L.Z)((0,N.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var p=s.getLayerConfig(),_=p.autoFit,T=p.fitBoundsOptions;_&&s.fitBounds(T),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,W.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=po(po({},this.needUpdateConfig),l);else{var p=this.container.get(A.vK.SceneID);xe(l,this),this.configService.setLayerConfig(p,this.id,po(po(po({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,p=this.container.get(A.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,T=_===void 0?!1:_;this.configService.setLayerConfig(p,this.id,{enableMultiPassRenderer:T}),this.iconService=this.container.get(A.vK.IIconService),this.fontService=this.container.get(A.vK.IFontService),this.rendererService=this.container.get(A.vK.IRendererService),this.layerService=this.container.get(A.vK.ILayerService),this.interactionService=this.container.get(A.vK.IInteractionService),this.pickingService=this.container.get(A.vK.IPickingService),this.mapService=this.container.get(A.vK.IMapService),this.cameraService=this.container.get(A.vK.ICameraService),this.coordinateService=this.container.get(A.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(A.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(A.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(A.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(A.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(X){var ve=X.attributeName,Fe=X.attributeField,ft=X.attributeValues,Ot=X.updateOptions;l.styleAttributeService.updateStyleAttribute(ve,{scale:po({field:Fe},l.splitValuesAndCallbackInAttribute(ft,l.getLayerConfig()[ve]))},Ot)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(A.vK.ILayerPlugin);var I=uo(this.plugins),k;try{for(I.s();!(k=I.n()).done;){var J=k.value;J.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(X){I.e(X)}finally{I.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(po(po({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),p=l.animateOption;p!=null&&p.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,p,_){return this.updateStyleAttribute("color",l,p,_),this}},{key:"texture",value:function(l,p,_){return this.updateStyleAttribute("texture",l,p,_),this}},{key:"rotate",value:function(l,p,_){return this.updateStyleAttribute("rotate",l,p,_),this}},{key:"size",value:function(l,p,_){return this.updateStyleAttribute("size",l,p,_),this}},{key:"filter",value:function(l,p,_){return this.updateStyleAttribute("filter",l,p,_),this}},{key:"shape",value:function(l,p,_){return this.updateStyleAttribute("shape",l,p,_),this}},{key:"label",value:function(l,p,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:p,updateOptions:_}),this}},{key:"animate",value:function(l){var p={};return da()(l)?(p.enable=!0,p=po(po({},p),l)):p.enable=l,this.updateLayerConfig({animateOption:p}),this}},{key:"source",value:function(l,p){return this.sourceOption={data:l,options:p},this}},{key:"setData",value:function(l,p){var _=this;return this.inited?this.layerSource.setData(l,p):this.on("inited",function(){_.layerSource.setData(l,p)}),this}},{key:"style",value:function(l){var p=this,_=l.passes,T=(0,ba.Z)(l,["passes"]);return _&&Xa(_).forEach(function(I){var k=p.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(I[0]);k&&k.updateOptions(I[1])}),this.rawConfig=po(po({},this.rawConfig),T),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,p){return da()(l)?this.scaleOptions=po(po({},this.scaleOptions),l):this.scaleOptions[l]=p,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var p={};return p.enableHighlight=da()(l)?!0:l,da()(l)?(p.enableHighlight=!0,l.color&&(p.highlightColor=l.color)):p.enableHighlight=!!l,this.updateLayerConfig(p),this}},{key:"setActive",value:function(l,p){var _=this;if(da()(l)){var T=l.x,I=T===void 0?0:T,k=l.y,J=k===void 0?0:k;this.updateLayerConfig({highlightColor:da()(p)?p.color:this.getLayerConfig().highlightColor}),this.pick({x:I,y:J})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:da()(p)?p.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,rt.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(l){var p={};return p.enableSelect=da()(l)?!0:l,da()(l)?(p.enableSelect=!0,l.color&&(p.selectColor=l.color)):p.enableSelect=!!l,this.updateLayerConfig(p),this}},{key:"setSelect",value:function(l,p){var _=this;if(da()(l)){var T=l.x,I=T===void 0?0:T,k=l.y,J=k===void 0?0:k;this.updateLayerConfig({selectColor:da()(p)?p.color:this.getLayerConfig().selectColor}),this.pick({x:I,y:J})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:da()(p)?p.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,rt.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),p=this.getLayerConfig(),_=p.visible,T=p.minZoom,I=T===void 0?-Infinity:T,k=p.maxZoom,J=k===void 0?Infinity:k;return!!_&&l>=I&&l<=J}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),p=l.minZoom;return p}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),p=l.maxZoom;return p}},{key:"get",value:function(l){var p=this.getLayerConfig();return p[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var p=this.getSource(),_=p.extent,T=_.some(function(I){return Math.abs(I)===Infinity});return T?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var p=this.mapService.getZoom();this.layerSource.updateClusterData(p)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var p=this.styleAttributeService.getLayerAttributeScale(l);if(p){if(p.ticks){var _=p.ticks().map(function(I){return(0,L.Z)({value:I},l,p(I))});return _}else if(p.invertExtent){var T=p.range().map(function(I){return(0,L.Z)({value:p.invertExtent(I)},l,I)});return T}}else return[]}},{key:"pick",value:function(l){var p=l.x,_=l.y;this.interactionService.triggerHover({x:p,y:_})}},{key:"boxSelect",value:function(l,p){this.pickingService.boxPickLayer(this,l,p)}},{key:"buildLayerModel",value:function(l){var p=l.moduleName,_=l.vertexShader,T=l.fragmentShader,I=l.triangulation,k=l.segmentNumber,J=(0,ba.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(p,{vs:_,fs:T});var X=this.shaderModuleService.getModule(p),ve=X.vs,Fe=X.fs,ft=X.uniforms,Ot=this.rendererService.createModel,mr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,I,k),Sr=mr.attributes,Zr=mr.elements;return Ot(po({attributes:Sr,uniforms:ft,fs:Fe,vs:ve,elements:Zr,blend:Ao[A.BlendType.normal]},J))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var p=this.getLayerConfig(),_=p.enableHighlight,T=_===void 0?!0:_,I=p.enableSelect,k=I===void 0?!0:I,J=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&k&&(J=!0),l==="mousemove"&&(T||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(J=!0),this.isVisible()&&J}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){p.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,p,_,T){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:po({field:p},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[p]))},T):this.pendingStyleAttributes.push({attributeName:l,attributeField:p,attributeValues:_,updateOptions:T})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,p){return{values:ya()(l)?void 0:l||p,callback:ya()(l)?l:void 0}}}]),a}(Yt.EventEmitter),no=(0,ti.Z)(yi.prototype,"configService",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ya=(0,ti.Z)(yi.prototype,"shaderModuleService",[$n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yi),Si=E(85061),Ts=E(18446),Ps=E.n(Ts),bs=E(2650),Ca,To,mu,wl,Vu;function Wl(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=rl(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,T;return{s:function(){a=a.call(n)},n:function(){var k=a.next();return p=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function rl(n,c){if(!!n){if(typeof n=="string")return yu(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return yu(n,c)}}function yu(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var Na=(Ca=(0,A.yT)(A.vK.IGlobalConfigService),To=(0,A.yT)(A.vK.IShaderModuleService),mu=function(){function n(c){(0,K.Z)(this,n),(0,L.Z)(this,"triangulation",void 0),(0,L.Z)(this,"createTexture2D",void 0),(0,L.Z)(this,"layer",void 0),(0,L.Z)(this,"dataTexture",void 0),(0,L.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,L.Z)(this,"rowCount",void 0),(0,L.Z)(this,"cacheStyleProperties",void 0),(0,L.Z)(this,"cellLength",void 0),(0,L.Z)(this,"cellProperties",void 0),(0,L.Z)(this,"cellTypeLayout",void 0),(0,L.Z)(this,"stylePropertyesExist",void 0),(0,L.Z)(this,"dataTextureTest",void 0),(0,ai.Z)(this,"configService",wl,this),(0,ai.Z)(this,"shaderModuleService",Vu,this),(0,L.Z)(this,"rendererService",void 0),(0,L.Z)(this,"iconService",void 0),(0,L.Z)(this,"fontService",void 0),(0,L.Z)(this,"styleAttributeService",void 0),(0,L.Z)(this,"mapService",void 0),(0,L.Z)(this,"cameraService",void 0),(0,L.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(A.vK.IRendererService),this.styleAttributeService=c.getContainer().get(A.vK.IStyleAttributeService),this.mapService=c.getContainer().get(A.vK.IMapService),this.iconService=c.getContainer().get(A.vK.IIconService),this.fontService=c.getContainer().get(A.vK.IFontService),this.cameraService=c.getContainer().get(A.vK.ICameraService),this.layerService=c.getContainer().get(A.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var a=this.rendererService.createTexture2D;this.createTexture2D=a,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:A.gl.NEAREST,min:A.gl.NEAREST,width:1,height:1}))}return(0,W.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(a){var s=!1;return Ps()(a.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=a.opacity),Ps()(a.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=a.strokeOpacity),Ps()(a.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=a.strokeWidth),Ps()(a.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=a.stroke),Ps()(a.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=a.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(a){this.clearLastCalRes(),a.opacity!==void 0&&!Hi()(a.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),a.strokeOpacity!==void 0&&!Hi()(a.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),a.strokeWidth!==void 0&&!Hi()(a.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),a.stroke!==void 0&&!this.isStaticColor(a.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),a.offsets!==void 0&&!this.isOffsetStatic(a.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(a){return so()(a)?!!(0,bs.ZP)(a):!1}},{key:"getStrokeColor",value:function(a){if(this.isStaticColor(a)){var s=(0,rt.CI)(a);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(a){return!!(Ba()(a)&&a.length===2&&Hi()(a[0])&&Hi()(a[1]))}},{key:"patchMod",value:function(a,s){for(var l=0;l<s;l++)a.push(-1)}},{key:"patchData",value:function(a,s,l){var p=Wl(l),_;try{for(p.s();!(_=p.n()).done;){var T=_.value,I=T.attr,k=T.count,J=s[I];J?I==="stroke"?a.push.apply(a,(0,Si.Z)((0,rt.CI)(J))):I==="offsets"?this.isOffsetStatic(J)?a.push(-J[0],J[1]):a.push(0,0):a.push(Hi()(J)?J:1):this.patchMod(a,k)}}catch(X){p.e(X)}finally{p.f()}}},{key:"calDataFrame",value:function(a,s,l){for(var p=s.length,_=Math.ceil(p*a/this.DATA_TEXTURE_WIDTH),T=_*this.DATA_TEXTURE_WIDTH,I=[],k=0;k<p;k++){var J=s[k];this.patchData(I,J,l)}for(var X=I.length;X<T;X++)I.push(-1);return{data:I,width:this.DATA_TEXTURE_WIDTH,height:_}}},{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return Ao[A.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),wl=(0,ti.Z)(mu.prototype,"configService",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vu=(0,ti.Z)(mu.prototype,"shaderModuleService",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu),Gu=E(9187),m=E.n(Gu),S=E(31437),j=S.create(),O=S.create(),ue=S.create(),Oe=S.create(),st=S.create();function Lt(n,c,a,s,l){S.add(n,a,s),S.normalize(n,n),c=S.fromValues(-n[1],n[0]);var p=S.fromValues(-a[1],a[0]);return[l/S.dot(c,p),c]}function Mt(n,c){return S.set(n,-c[1],c[0])}function wr(n,c,a){return S.sub(n,c,a),S.normalize(n,n),n}function jr(n,c){return n[0]===c[0]&&n[1]===c[1]}function qn(n){for(var c=new Map,a=0;a<n.length;a++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(a,1),a++):c.set(s,s)}return n}var Pi=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,K.Z)(this,n),(0,L.Z)(this,"complex",void 0),(0,L.Z)(this,"join",void 0),(0,L.Z)(this,"cap",void 0),(0,L.Z)(this,"miterLimit",void 0),(0,L.Z)(this,"thickness",void 0),(0,L.Z)(this,"normal",void 0),(0,L.Z)(this,"lastFlip",-1),(0,L.Z)(this,"miter",S.fromValues(0,0)),(0,L.Z)(this,"started",!1),(0,L.Z)(this,"dash",!1),(0,L.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,W.Z)(n,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var p=a.length,_=l.startIndex,T=1;T<p;T++){var I=a[T-1],k=s[T-1],J=a[T],X=s[T],ve=T<a.length-1?a[T+1]:null,Fe=T<s.length-1?s[T+1]:null,ft=this.segment_gaode2(l,_,I,J,ve,k,X,Fe);_+=ft}if(this.dash)for(var Ot=0;Ot<l.positions.length/6;Ot++)l.positions[Ot*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,p=s.startIndex,_=1;_<l;_++){var T=a[_-1],I=a[_],k=_<a.length-1?a[_+1]:null,J=this.segment(s,p,T,I,k);p+=J}if(this.dash)for(var X=0;X<s.positions.length/6;X++)s.positions[X*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,p,_,T,I,k){var J=0,X=a.indices,ve=a.positions,Fe=a.normals,ft=this.cap==="square",Ot=this.join==="bevel",mr=(0,rt.Z)([I[0],I[1]]),Sr=(0,rt.Z)([T[0],T[1]]);wr(ue,p,l);var Zr=0;if(this.dash&&(Zr=this.lineSegmentDistance(mr,Sr),this.totalDistance+=Zr),this.normal||(this.normal=S.create(),Mt(this.normal,ue)),!this.started)if(this.started=!0,ft){var _n=S.create(),kn=S.create();S.add(_n,this.normal,ue),S.add(kn,this.normal,ue),Fe.push(kn[0],kn[1],0),Fe.push(_n[0],_n[1],0),ve.push(l[0],l[1],0,this.totalDistance-Zr,-this.thickness,0),ve.push(l[0],l[1],0,this.totalDistance-Zr,this.thickness,0)}else this.extrusions(ve,Fe,l,this.normal,this.thickness,this.totalDistance-Zr);if(X.push(s+0,s+1,s+2),_){jr(p,_)&&S.add(_,p,S.normalize(_,S.subtract(_,p,l))),wr(Oe,_,p);var Qn=Lt(st,S.create(),ue,Oe,this.thickness),Ti=(0,Q.Z)(Qn,2),sa=Ti[0],ma=Ti[1],vi=S.dot(st,this.normal)<0?-1:1,Oa=Ot;if(!Oa&&this.join==="miter"){var qa=sa;qa>this.miterLimit&&(Oa=!0)}Oa?(Fe.push(this.normal[0],this.normal[1],0),Fe.push(ma[0],ma[1],0),ve.push(p[0],p[1],0,this.totalDistance,-this.thickness*vi,0),ve.push(p[0],p[1],0,this.totalDistance,this.thickness*vi,0),X.push.apply(X,(0,Si.Z)(this.lastFlip!==-vi?[s,s+2,s+3]:[s+2,s+1,s+3])),X.push(s+2,s+3,s+4),Mt(j,Oe),S.copy(this.normal,j),Fe.push(this.normal[0],this.normal[1],0),ve.push(p[0],p[1],0,this.totalDistance,-this.thickness*vi,0),J+=3):(this.extrusions(ve,Fe,p,ma,sa,this.totalDistance),X.push.apply(X,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),vi=-1,S.copy(this.normal,ma),J+=2),this.lastFlip=vi}else{if(Mt(this.normal,ue),ft){var Yn=S.create(),Ei=S.create();S.sub(Ei,ue,this.normal),S.add(Yn,ue,this.normal),Fe.push(Ei[0],Ei[1],0),Fe.push(Yn[0],Yn[1],0),ve.push(p[0],p[1],0,this.totalDistance,this.thickness,0),ve.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(ve,Fe,p,this.normal,this.thickness,this.totalDistance);X.push.apply(X,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),J+=2}return J}},{key:"segment",value:function(a,s,l,p,_){var T=0,I=a.indices,k=a.positions,J=a.normals,X=this.cap==="square",ve=this.join==="bevel",Fe=(0,rt.Z)([p[0],p[1]]),ft=(0,rt.Z)([l[0],l[1]]);wr(ue,Fe,ft);var Ot=0;if(this.dash&&(Ot=this.lineSegmentDistance(Fe,ft),this.totalDistance+=Ot),this.normal||(this.normal=S.create(),Mt(this.normal,ue)),!this.started)if(this.started=!0,X){var mr=S.create(),Sr=S.create();S.add(mr,this.normal,ue),S.add(Sr,this.normal,ue),J.push(Sr[0],Sr[1],0),J.push(mr[0],mr[1],0),k.push(l[0],l[1],0,this.totalDistance-Ot,-this.thickness,0),k.push(l[0],l[1],0,this.totalDistance-Ot,this.thickness,0)}else this.extrusions(k,J,l,this.normal,this.thickness,this.totalDistance-Ot);if(I.push(s+0,s+1,s+2),_){var kn=(0,rt.Z)([_[0],_[1]]);jr(Fe,kn)&&S.add(kn,Fe,S.normalize(kn,S.subtract(kn,Fe,ft))),wr(Oe,kn,Fe);var Yn=Lt(st,S.create(),ue,Oe,this.thickness),Ei=(0,Q.Z)(Yn,2),Qn=Ei[0],Ti=Ei[1],sa=S.dot(st,this.normal)<0?-1:1,ma=ve;if(!ma&&this.join==="miter"){var vi=Qn;vi>this.miterLimit&&(ma=!0)}ma?(J.push(this.normal[0],this.normal[1],0),J.push(Ti[0],Ti[1],0),k.push(p[0],p[1],0,this.totalDistance,-this.thickness*sa,0),k.push(p[0],p[1],0,this.totalDistance,this.thickness*sa,0),I.push.apply(I,(0,Si.Z)(this.lastFlip!==-sa?[s,s+2,s+3]:[s+2,s+1,s+3])),I.push(s+2,s+3,s+4),Mt(j,Oe),S.copy(this.normal,j),J.push(this.normal[0],this.normal[1],0),k.push(p[0],p[1],0,this.totalDistance,-this.thickness*sa,0),T+=3):(this.extrusions(k,J,p,Ti,Qn,this.totalDistance),I.push.apply(I,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),sa=-1,S.copy(this.normal,Ti),T+=2),this.lastFlip=sa}else{if(Mt(this.normal,ue),X){var Zr=S.create(),_n=S.create();S.sub(_n,ue,this.normal),S.add(Zr,ue,this.normal),J.push(_n[0],_n[1],0),J.push(Zr[0],Zr[1],0),k.push(p[0],p[1],0,this.totalDistance,this.thickness,0),k.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(k,J,p,this.normal,this.thickness,this.totalDistance);I.push.apply(I,(0,Si.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),T+=2}return T}},{key:"extrusions",value:function(a,s,l,p,_,T){s.push(p[0],p[1],0),s.push(p[0],p[1],0),a.push(l[0],l[1],0,T,-_,0),a.push(l[0],l[1],0,T,_,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],p=s[1]-a[1];return Math.sqrt(l*l+p*p)}}]),n}();function ci(n){if(Hi()(n[0]))return n;if(Hi()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Hi()(n[0][0][0])){var c=n,a=0,s=0,l=0;return c.forEach(function(p){p.forEach(function(_){a+=_[0],s+=_[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var ei=E(77160);function Ea(n){var c=n[0][0],a=n[0][n[0].length-1];c[0]===a[0]&&c[1]===a[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=m().flatten(n),p=l.vertices,_=l.dimensions,T=[],I=[],k=0;k<p.length/_;k++)_===2?T.push(p[k*2],p[k*2+1],1):T.push(p[k*3],p[k*3+1],1);var J=m()(l.vertices,l.holes,l.dimensions);I.push.apply(I,(0,Si.Z)(J));for(var X=function(ft){var Ot=l.vertices.slice(ft*_,(ft+1)*_),mr=l.vertices.slice((ft+1)*_,(ft+2)*_);mr.length===0&&(mr=l.vertices.slice(0,_));var Sr=T.length/3;T.push(Ot[0],Ot[1],1,mr[0],mr[1],1,Ot[0],Ot[1],0,mr[0],mr[1],0),I.push.apply(I,(0,Si.Z)([0,2,1,2,3,1].map(function(Zr){return Zr+Sr})))},ve=0;ve<s;ve++)X(ve);return{positions:T,index:I}}function Fa(n){var c=m().flatten(n),a=m()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:a}}function Qi(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=n[0][0],s=n[0][n[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,p=m().flatten(n),_=p.vertices,T=p.dimensions,I=[],k=[],J=[],X=0;X<_.length/T;X++)T===2?I.push(_[X*2],_[X*2+1],1,-1,-1):I.push(_[X*3],_[X*3+1],1,-1,-1),J.push(0,0,1);var ve=m()(p.vertices,p.holes,p.dimensions);k.push.apply(k,(0,Si.Z)(ve));for(var Fe=function(mr){var Sr=p.vertices.slice(mr*T,(mr+1)*T),Zr=p.vertices.slice((mr+1)*T,(mr+2)*T);Zr.length===0&&(Zr=p.vertices.slice(0,T));var _n=I.length/5;I.push(Sr[0],Sr[1],1,0,0,Zr[0],Zr[1],1,.1,0,Sr[0],Sr[1],0,0,.8,Zr[0],Zr[1],0,.1,.8);var kn=hs([Zr[0],Zr[1],1],[Sr[0],Sr[1],0],[Sr[0],Sr[1],1],c);J.push.apply(J,(0,Si.Z)(kn).concat((0,Si.Z)(kn),(0,Si.Z)(kn),(0,Si.Z)(kn))),k.push.apply(k,(0,Si.Z)([1,2,0,3,2,1].map(function(Yn){return Yn+_n})))},ft=0;ft<l;ft++)Fe(ft);return{positions:I,index:k,normals:J}}function hs(n,c,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=ei.create(),p=ei.create(),_=ei.create();s&&(n=(0,rt.vP)(n),c=(0,rt.vP)(c),a=(0,rt.vP)(a));var T=ei.fromValues.apply(ei,(0,Si.Z)(n)),I=ei.fromValues.apply(ei,(0,Si.Z)(c)),k=ei.fromValues.apply(ei,(0,Si.Z)(a));ei.sub(l,k,I),ei.sub(p,T,I),ei.cross(_,l,p);var J=ei.create();return ei.normalize(J,_),J}var go,Ms;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(Ms||(Ms={}));var iu;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(iu||(iu={}));function Ds(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(a*l+c*Math.PI/12);var p=s.map(function(_){var T=Math.sin(_+Math.PI/4),I=Math.cos(_+Math.PI/4);return[T,I,0]});return p}function nl(){return Ds(30)}function Ws(){return Ds(4)}function Xs(){return Ds(3)}function Ys(){return Ds(6,1)}function io(){return Ds(5)}var Cu=(go={},(0,L.Z)(go,iu.CIRCLE,nl),(0,L.Z)(go,iu.HEXAGON,Ys),(0,L.Z)(go,iu.TRIANGLE,Xs),(0,L.Z)(go,iu.SQUARE,Ws),(0,L.Z)(go,iu.PENTAGON,io),(0,L.Z)(go,Ms.CYLINDER,nl),(0,L.Z)(go,Ms.HEXAGONCOLUMN,Ys),(0,L.Z)(go,Ms.TRIANGLECOLUMN,Xs),(0,L.Z)(go,Ms.SQUARECOLUMN,Ws),(0,L.Z)(go,Ms.PENTAGONCOLUMN,io),go),il={};function ps(n){var c=ci(n.coordinates);return{vertices:[].concat((0,Si.Z)(c),(0,Si.Z)(c),(0,Si.Z)(c),(0,Si.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function Xl(n){var c=n.shape,a=pc(c,!1),s=a.positions,l=a.index,p=a.normals;return{vertices:s,indices:l,normals:p,size:5}}function au(n){var c=ci(n.coordinates);return{vertices:(0,Si.Z)(c),indices:[0],size:c.length}}function Fs(n){var c=n.coordinates,a=n.originCoordinates,s=n.version,l=new Pi({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var p=c;Array.isArray(p[0][0])||(p=[c]);var _=a;Array.isArray(_[0][0])||(_=[a]);for(var T=0;T<p.length;T++){var I=p[T],k=_[T];l.extrude_gaode2(I,k)}}else{var J=c;Array.isArray(J[0][0])||(J=[c]),J.forEach(function(ve){l.extrude(ve)})}var X=l.complex;return{vertices:X.positions,indices:X.indices,normals:X.normals,size:6}}function hc(n){var c=n.coordinates,a=m().flatten(c),s=a.vertices,l=a.dimensions,p=a.holes;return{indices:m()(s,p,l),vertices:s,size:l}}function Au(n){var c=n.coordinates,a=Qi(c,!0),s=a.positions,l=a.index,p=a.normals;return{vertices:s,indices:l,normals:p,size:5}}function Aa(n){var c=n.shape,a=Cl(c),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function Tu(n){var c=n.coordinates,a=[].concat((0,Si.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,Si.Z)(c[1]),[0,1,0],(0,Si.Z)(c[0]),[0,0,1],(0,Si.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function Yl(n,c){for(var a=c||30,s=n.coordinates,l=[],p=[],_=function(k){l.push(k,1,k,s[0][0],s[0][1],s[1][0],s[1][1],k,-1,k,s[0][0],s[0][1],s[1][0],s[1][1]),k!==a-1&&p.push.apply(p,(0,Si.Z)([0,1,2,1,3,2].map(function(J){return k*2+J})))},T=0;T<a;T++)_(T);return{vertices:l,indices:p,size:7}}function Pu(n){var c=n.coordinates;c.length===2&&c.push(0);var a=n.size,s=gu(-1,1),l=gu(1,1),p=gu(-1,-1),_=gu(1,-1),T=[].concat((0,Si.Z)(c),(0,Si.Z)(s),(0,Si.Z)(c),(0,Si.Z)(p),(0,Si.Z)(c),(0,Si.Z)(_),(0,Si.Z)(c),(0,Si.Z)(l)),I=[0,1,2,3,0,2];return{vertices:T,indices:I,size:5}}function pc(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(il&&il[n])return il[n];var a=Cu[n]?Cu[n]():Cu.cylinder(),s=Qi([a],c);return il[n]=s,s}function dc(n,c){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/a*3),p,_,T,I=vec3.create(),k=vec3.create(),J=vec3.create(),X=0,ve=c.length;X<ve;X+=3){p=c[X+0]*3,_=c[X+1]*3,T=c[X+2]*3;var Fe=[n[p],n[p+1]],ft=[n[_],n[_+1]],Ot=[n[T],n[T+1]];s&&(Fe=lngLatToMeters(Fe),ft=lngLatToMeters(ft),Ot=lngLatToMeters(Ot));var mr=Fe,Sr=_slicedToArray(mr,2),Zr=Sr[0],_n=Sr[1],kn=vec3.fromValues(Zr,_n,n[p+2]),Yn=ft,Ei=_slicedToArray(Yn,2),Qn=Ei[0],Ti=Ei[1],sa=vec3.fromValues(Qn,Ti,n[_+2]),ma=Ot,vi=_slicedToArray(ma,2),Oa=vi[0],qa=vi[1],wu=vec3.fromValues(Oa,qa,n[T+2]);vec3.sub(I,wu,sa),vec3.sub(k,kn,sa),vec3.cross(J,I,k),l[p]+=I[0],l[p+1]+=I[1],l[p+2]+=I[2],l[_]+=I[0],l[_+1]+=I[1],l[_+2]+=I[2],l[T]+=I[0],l[T+1]+=I[1],l[T+2]+=I[2]}return Dc(l),l}function Dc(n){for(var c=0,a=n.length;c<a;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function Fc(n){var c=n[0][0],a=n[0][n[0].length-1];return c[0]===a[0]&&c[1]===a[1]}function Cl(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=Cu[n]?Cu[n]():Cu.circle(),s=c.indexOf(n)===-1?Fa([a]):Ea([a]);return s}function gu(n,c){var a=(n+1)/2,s=(c+1)/2;return[a,s]}function al(n){var c=ol();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ol(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Hu=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,sl=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Wu=function(n){(0,Ne.Z)(a,n);var c=al(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,T=l.baseColor,I=T===void 0?"rgb(16,16,16)":T,k=l.brightColor,J=k===void 0?"rgb(255,176,38)":k,X=l.windowColor,ve=X===void 0?"rgb(30,60,89)":X,Fe=l.time,ft=Fe===void 0?0:Fe;return{u_opacity:_,u_baseColor:(0,rt.CI)(I),u_brightColor:(0,rt.CI)(J),u_windowColor:(0,rt.CI)(ve),u_time:this.layer.getLayerAnimateTime()||ft}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:sl,fragmentShader:Hu,triangulation:Au})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(p,_,T,I){var k=p.size,J=k===void 0?10:k;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(p,_,T,I){var k=p.size;return[T[3],T[4]]}}})}}]),a}(Na);function Bs(n){var c=vc();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function vc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var mc=function(n){(0,Ne.Z)(a,n);var c=Bs(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"type","PolygonLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new Wu(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(yo);function Bc(n){var c=Xu();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Xu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Al=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,Kl=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,yc=function(n){(0,Ne.Z)(a,n);var c=Bc(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:p||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Al,fragmentShader:Kl,triangulation:Aa,depth:{enable:!1},primitive:A.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_){var T=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[T[0],T[1],0]}}})}}]),a}(Na);function Yu(n){var c=Tl();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Tl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Pl=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,Mu=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,$l=function(n){(0,Ne.Z)(a,n);var c=Yu(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:p||1,u_coverage:_||1,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Pl,fragmentShader:Mu,triangulation:Xl,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(p,_,T,I){var k=p.size;return Array.isArray(k)?[k[0]]:[k]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_){var T=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[T[0],T[1],0]}}})}}]),a}(Na),Ua=E(85975);function Iu(n,c){for(var a=[],s=[],l=[],p=n+1,_=c+1,T=n/2,I=c/2,k=0;k<_;k++)for(var J=k-I,X=0;X<p;X++){var ve=X-T;s.push(ve/T,-J/I,0),l.push(X/n),l.push(1-k/c)}for(var Fe=0;Fe<c;Fe++)for(var ft=0;ft<n;ft++){var Ot=ft+p*Fe,mr=ft+p*(Fe+1),Sr=ft+1+p*(Fe+1),Zr=ft+1+p*Fe;a.push(Ot,mr,Zr),a.push(mr,Sr,Zr)}return{vertices:s,indices:a,uvs:l}}var ul,Jl;function Ql(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ku(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ql(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ql(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Jc(n){var c=ll();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ka=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,cl=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,$u=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,Ks=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,ra=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,Za=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Ss=(ul=(0,Et.b2)(),ul(Jl=function(n){(0,Ne.Z)(a,n);var c=Jc(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"colorTexture",void 0),(0,L.Z)((0,N.Z)(s),"heatmapFramerBuffer",void 0),(0,L.Z)((0,N.Z)(s),"intensityModel",void 0),(0,L.Z)((0,N.Z)(s),"colorModel",void 0),(0,L.Z)((0,N.Z)(s),"shapeType",void 0),s}return(0,W.Z)(a,[{key:"render",value:function(){var l=this,p=this.rendererService,_=p.clear,T=p.useFramebuffer;T(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,p=this.rendererService,_=p.createFramebuffer,T=p.clear,I=p.getViewportSize,k=p.createTexture2D,J=p.useFramebuffer,X=this.styleAttributeService.getLayerStyleAttribute("shape"),ve=(X==null||(l=X.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=ve,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=ve==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Fe=this.layer.getLayerConfig(),ft=Fe.rampColors,Ot=(0,rt.Cl)(ft),mr=I(),Sr=mr.width,Zr=mr.height;return this.heatmapFramerBuffer=_({color:k({width:Math.floor(Sr/4),height:Math.floor(Zr/4),wrapS:A.gl.CLAMP_TO_EDGE,wrapT:A.gl.CLAMP_TO_EDGE,min:A.gl.LINEAR,mag:A.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:A.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(p,_,T,I){return[T[3],T[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(p,_,T,I){var k=p.size,J=k===void 0?1:k;return[J]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:ra,fragmentShader:Ks,triangulation:Pu,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:A.gl.ONE,srcAlpha:1,dstRGB:A.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:Za,fs:$u});var l=this.shaderModuleService.getModule("heatmapColor"),p=l.vs,_=l.fs,T=l.uniforms,I=this.rendererService,k=I.createAttribute,J=I.createElements,X=I.createBuffer,ve=I.createModel;return ve({vs:p,fs:_,attributes:{a_Position:k({buffer:X({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:A.gl.FLOAT}),size:3}),a_Uv:k({buffer:X({data:[0,1,1,1,0,0,1,0],type:A.gl.FLOAT}),size:2})},uniforms:Ku({},T),depth:{enable:!1},blend:this.getBlend(),count:6,elements:J({data:[0,2,1,2,3,1],type:A.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.intensity,T=_===void 0?10:_,I=l.radius,k=I===void 0?5:I;this.intensityModel.draw({uniforms:{u_opacity:p||1,u_radius:k,u_intensity:T}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=Ua.create();Ua.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Si.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,p=l(),_=p.width,T=p.height,I=Iu(_/4,T/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:cl,fs:Ka});var k=this.shaderModuleService.getModule("heatmap3dColor"),J=k.vs,X=k.fs,ve=k.uniforms,Fe=this.rendererService,ft=Fe.createAttribute,Ot=Fe.createElements,mr=Fe.createBuffer,Sr=Fe.createModel;return Sr({vs:J,fs:X,attributes:{a_Position:ft({buffer:mr({data:I.vertices,type:A.gl.FLOAT}),size:3}),a_Uv:ft({buffer:mr({data:I.uvs,type:A.gl.FLOAT}),size:2})},primitive:A.gl.TRIANGLES,uniforms:Ku({},ve),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:A.gl.SRC_ALPHA,srcAlpha:1,dstRGB:A.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Ot({data:I.indices,type:A.gl.UNSIGNED_INT,count:I.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var p=this.layer.getLayerConfig(),_=p.rampColors,T=(0,rt.Cl)(_);this.colorTexture=l({data:new Uint8Array(T.data),width:T.width,height:T.height,wrapS:A.gl.CLAMP_TO_EDGE,wrapT:A.gl.CLAMP_TO_EDGE,min:A.gl.NEAREST,mag:A.gl.NEAREST,flipY:!1})}}]),a}(Na))||Jl);function Ml(n){var c=Ou();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ou(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Il=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Qc=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,qc=function(n){(0,Ne.Z)(a,n);var c=Ml(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,T=l.angle;return{u_opacity:p||1,u_coverage:_||.9,u_angle:T||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Qc,fragmentShader:Il,triangulation:Aa,depth:{enable:!1},primitive:A.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_){var T=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[T[0],T[1],0]}}})}}]),a}(Na),Ol={heatmap:Ss,heatmap3d:Ss,grid:yc,grid3d:$l,hexagon:qc},ql=Ol;function Lu(n){var c=ko();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ns=function(n){(0,Ne.Z)(a,n);var c=Lu(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"type","HeatMapLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new ql[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,p=this.getModelType();return p==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),T=_.shape3d,I=this.getSource(),k=I.data.type,J=(p==null||(l=p.scale)===null||l===void 0?void 0:l.field)||"heatmap";return J==="heatmap"||J==="heatmap3d"?"heatmap":k==="hexagon"?(T==null?void 0:T.indexOf(J))===-1?"hexagon":"grid3d":k==="grid"?(T==null?void 0:T.indexOf(J))===-1?"grid":"grid3d":"heatmap"}}]),a}(yo);function fl(n){var c=_o();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function _o(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Fn=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,lo=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Ru=function(n){(0,Ne.Z)(a,n);var c=fl(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,p=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),p.data.images.then(function(T){l.texture=_({data:T[0],width:T[0].width,height:T[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:lo,fragmentShader:Fn,triangulation:Tu,primitive:A.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(p,_,T,I){return[T[3],T[4]]}}})}}]),a}(Na),hl={image:Ru},$s=hl;function Is(n){var c=gc();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function gc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var vn=function(n){(0,Ne.Z)(a,n);var c=Is(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"type","ImageLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new $s[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={image:{}};return p[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(yo);function ec(n){var c=tc();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function tc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ku=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,Va=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Os={solid:0,dash:1},rc=function(n){(0,Ne.Z)(a,n);var c=ec(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,X=J===void 0?"solid":J,ve=l.dashArray,Fe=ve===void 0?[10,5]:ve,ft=l.forward,Ot=ft===void 0?!0:ft,mr=l.lineTexture,Sr=mr===void 0?!1:mr,Zr=l.iconStep,_n=Zr===void 0?100:Zr,kn=l.segmentNumber,Yn=kn===void 0?30:kn;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Ei=this.layer.getEncodedData(),Qn=this.calDataFrame(this.cellLength,Ei,this.cellProperties),Ti=Qn.data,sa=Qn.width,ma=Qn.height;this.rowCount=ma,this.dataTexture=this.cellLength>0&&Ti.length>0?this.createTexture2D({flipY:!0,data:Ti,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:sa,height:ma}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}Fe.length===2&&Fe.push(0,0);var vi=0,Oa=[0,0,0,0],qa=[0,0,0,0];return _&&T&&(Oa=(0,rt.CI)(_),qa=(0,rt.CI)(T),vi=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(p)?p:1,u_textureBlend:k==="normal"?0:1,segmentNumber:Yn,u_line_type:Os[X||"solid"],u_dash_array:Fe,u_blur:.9,u_lineDir:Ot?1:-1,u_texture:this.texture,u_line_texture:Sr?1:0,u_icon_step:_n,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:vi,u_sourceColor:Oa,u_targetColor:qa}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),p=l.segmentNumber,_=p===void 0?30:p;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Va,fragmentShader:ku,triangulation:Yl,depth:{enable:!1},blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,X=J===void 0?1:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:A.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(_,T,I,k){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),X=_.texture,ve=J[X]||{x:0,y:0},Fe=ve.x,ft=ve.y;return[Fe,ft]}}})}}]),a}(Na);function _u(n){var c=Ls();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ou=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Nc=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Ll={solid:0,dash:1},_c=function(n){(0,Ne.Z)(a,n);var c=_u(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,X=J===void 0?"solid":J,ve=l.dashArray,Fe=ve===void 0?[10,5]:ve,ft=l.lineTexture,Ot=ft===void 0?!1:ft,mr=l.iconStep,Sr=mr===void 0?100:mr,Zr=l.segmentNumber,_n=Zr===void 0?30:Zr;Fe.length===2&&Fe.push(0,0);var kn=0,Yn=[0,0,0,0],Ei=[0,0,0,0];if(_&&T&&(Yn=(0,rt.CI)(_),Ei=(0,rt.CI)(T),kn=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Qn=this.layer.getEncodedData(),Ti=this.calDataFrame(this.cellLength,Qn,this.cellProperties),sa=Ti.data,ma=Ti.width,vi=Ti.height;this.rowCount=vi,this.dataTexture=this.cellLength>0&&sa.length>0?this.createTexture2D({flipY:!0,data:sa,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:ma,height:vi}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(p)?p:1,u_textureBlend:k==="normal"?0:1,segmentNumber:_n,u_line_type:Ll[X]||0,u_dash_array:Fe,u_texture:this.texture,u_line_texture:Ot?1:0,u_icon_step:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:kn,u_sourceColor:Yn,u_targetColor:Ei}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Nc,fragmentShader:ou,triangulation:Yl,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,X=J===void 0?1:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:A.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(_,T,I,k){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),X=_.texture,ve=J[X]||{x:0,y:0},Fe=ve.x,ft=ve.y;return[Fe,ft]}}})}}]),a}(Na);function zc(n){var c=Js();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Js(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Rs=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,qi=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,xu={solid:0,dash:1},zs=function(n){(0,Ne.Z)(a,n);var c=zc(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,X=J===void 0?"solid":J,ve=l.dashArray,Fe=ve===void 0?[10,5]:ve,ft=l.lineTexture,Ot=ft===void 0?!1:ft,mr=l.iconStep,Sr=mr===void 0?100:mr,Zr=l.segmentNumber,_n=Zr===void 0?30:Zr;Fe.length===2&&Fe.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var kn=0,Yn=[0,0,0,0],Ei=[0,0,0,0];if(_&&T&&(Yn=(0,rt.CI)(_),Ei=(0,rt.CI)(T),kn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Qn=this.layer.getEncodedData(),Ti=this.calDataFrame(this.cellLength,Qn,this.cellProperties),sa=Ti.data,ma=Ti.width,vi=Ti.height;this.rowCount=vi,this.dataTexture=this.cellLength>0&&sa.length>0?this.createTexture2D({flipY:!0,data:sa,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:ma,height:vi}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(p)?p:1,u_textureBlend:k==="normal"?0:1,segmentNumber:_n,u_line_type:xu[X]||0,u_dash_array:Fe,u_texture:this.texture,u_line_texture:Ot?1:0,u_icon_step:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:kn,u_sourceColor:Yn,u_targetColor:Ei}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:qi,fragmentShader:Rs,triangulation:Yl,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,X=J===void 0?1:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:A.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(_,T,I,k){return[I[3],I[4],I[5],I[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),X=_.texture,ve=J[X]||{x:0,y:0},Fe=ve.x,ft=ve.y;return[Fe,ft]}}})}}]),a}(Na);function Uo(n){var c=pl();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function pl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var su=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,uu=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,xo={solid:0,dash:1},Du=function(n){(0,Ne.Z)(a,n);var c=Uo(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.NEAREST,min:A.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,T=l.targetColor,I=l.textureBlend,k=I===void 0?"normal":I,J=l.lineType,X=J===void 0?"solid":J,ve=l.dashArray,Fe=ve===void 0?[10,5,0,0]:ve,ft=l.lineTexture,Ot=ft===void 0?!1:ft,mr=l.iconStep,Sr=mr===void 0?100:mr;Fe.length===2&&Fe.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Zr=0,_n=[0,0,0,0],kn=[0,0,0,0];if(_&&T&&(_n=(0,rt.CI)(_),kn=(0,rt.CI)(T),Zr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Yn=this.layer.getEncodedData(),Ei=this.calDataFrame(this.cellLength,Yn,this.cellProperties),Qn=Ei.data,Ti=Ei.width,sa=Ei.height;this.rowCount=sa,this.dataTexture=this.cellLength>0&&Qn.length>0?this.createTexture2D({flipY:!0,data:Qn,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:Ti,height:sa}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(p)?p:1,u_textureBlend:k==="normal"?0:1,u_line_type:xo[X],u_dash_array:Fe,u_texture:this.texture,u_line_texture:Ot?1:0,u_icon_step:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Zr,u_sourceColor:_n,u_targetColor:kn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:uu,fragmentShader:su,triangulation:Fs,primitive:A.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.lineType,T=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:A.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(k,J,X,ve){return[X[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:A.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(k,J,X,ve){return[X[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(k,J,X,ve){var Fe=k.size,ft=Fe===void 0?1:Fe;return Array.isArray(ft)?[ft[0],ft[1]]:[ft,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(k,J,X,ve,Fe){return Fe}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:A.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(k,J,X,ve){return[X[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(k,J,X,ve){var Fe=l.iconService.getIconMap(),ft=k.texture,Ot=Fe[ft]||{x:0,y:0},mr=Ot.x,Sr=Ot.y;return[mr,Sr]}}})}},{key:"loadImage",value:function(l){return new Promise(function(p,_){if(l instanceof HTMLImageElement){p(l);return}var T=new Image;T.crossOrigin="anonymous",T.onload=function(){p(T)},T.onerror=function(){_(new Error("Could not load image at "+l))},T.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(Na),ii={arc:rc,arc3d:_c,greatcircle:zs,line:Du},Wn=ii;function Rl(n){var c=is();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function is(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Qs=function(n){(0,Ne.Z)(a,n);var c=Rl(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"type","LineLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Wn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return p[l]}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return _||"line"}}]),a}(yo);function Jo(n){var c=lu();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var xc=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,nc=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Wi=function(n){(0,Ne.Z)(a,n);var c=Jo(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),k=I.data,J=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:J,height:X}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:nc,fragmentShader:xc,triangulation:Xl,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_,T,I){var k=p.size;if(k){var J=[];return Array.isArray(k)&&(J=k.length===2?[k[0],k[0],k[1]]:k),Array.isArray(k)||(J=[k]),J}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:A.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_){var T=ci(p.coordinates);return[T[0],T[1],0]}}})}}]),a}(Na);function Do(n){var c=Uc();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Uc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Es=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,ic=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,ws=function(n){(0,Ne.Z)(a,n);var c=Do(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,T=l.strokeOpacity,I=T===void 0?1:T,k=l.strokeWidth,J=k===void 0?0:k,X=l.stroke,ve=X===void 0?"rgba(0,0,0,0)":X,Fe=l.offsets,ft=Fe===void 0?[0,0]:Fe;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeOpacity:I,strokeWidth:J,stroke:ve,offsets:ft})){this.judgeStyleAttributes({opacity:_,strokeOpacity:I,strokeWidth:J,stroke:ve,offsets:ft});var Ot=this.layer.getEncodedData(),mr=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Sr=mr.data,Zr=mr.width,_n=mr.height;this.rowCount=_n,this.dataTexture=this.cellLength>0&&Sr.length>0?this.createTexture2D({flipY:!0,data:Sr,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:Zr,height:_n}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1,u_stroke_opacity:Hi()(I)?I:1,u_stroke_width:Hi()(J)?J:0,u_stroke_color:this.getStrokeColor(ve),u_offsets:this.isOffsetStatic(ft)?ft:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),ps)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:ic,fragmentShader:Es,triangulation:ps,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:A.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=[1,1,-1,1,-1,-1,1,-1],X=k%4*2;return[J[X],J[X+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,X=J===void 0?5:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:A.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.shape,X=J===void 0?2:J,ve=l.layer.getLayerConfig().shape2d,Fe=ve.indexOf(X);return[Fe]}}})}}]),a}(Na);function ds(n){var c=dl();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function dl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var cu=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,kl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Ju=function(n){(0,Ne.Z)(a,n);var c=ds(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:kl,fragmentShader:cu,triangulation:au,primitive:A.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.fontService.mapping,X=_.shape,ve=l.fontService.getGlyph(X),Fe=J[ve],ft=Fe.x,Ot=Fe.y;return[ft,Ot]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.texture=l({data:p,mag:A.gl.LINEAR,min:A.gl.LINEAR,width:p.width,height:p.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.fontWeight,T=_===void 0?"normal":_,I=p.fontFamily,k=I===void 0?"sans-serif":I,J=this.layer.getEncodedData(),X=[];J.forEach(function(ve){var Fe=ve.shape,ft=Fe===void 0?"":Fe;ft=ft.toString();var Ot=l.fontService.getGlyph(ft);X.indexOf(Ot)===-1&&X.push(Ot)}),this.fontService.setFontOptions({characterSet:X,fontWeight:T,fontFamily:k,fontSize:48})}}]),a}(Na);function Dl(n){var c=Zc();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Fl=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,vl=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,bc=function(n){(0,Ne.Z)(a,n);var c=Dl(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"updateTexture",function(){var T=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=T({data:s.iconService.getCanvas(),mag:A.gl.LINEAR,min:A.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.offsets,T=_===void 0?[0,0]:_;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:T})){this.judgeStyleAttributes({opacity:p,offsets:T});var I=this.layer.getEncodedData(),k=this.calDataFrame(this.cellLength,I,this.cellProperties),J=k.data,X=k.width,ve=k.height;this.rowCount=ve,this.dataTexture=this.cellLength>0&&J.length>0?this.createTexture2D({flipY:!0,data:J,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:X,height:ve}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Hi()(p)?p:1,u_offsets:this.isOffsetStatic(T)?T:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:vl,fragmentShader:Fl,triangulation:au,primitive:A.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(_,T,I,k){var J=_.size,X=J===void 0?5:J;return Array.isArray(X)?[X[0]]:[X]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(_,T,I,k){var J=l.iconService.getIconMap(),X=_.shape,ve=J[X]||{x:0,y:0},Fe=ve.x,ft=ve.y;return[Fe,ft]}}})}}]),a}(Na);function Fu(n){var c=Bu();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Bu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Sc=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Nu=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Us(n){var c=n.coordinates;return{vertices:(0,Si.Z)(c),indices:[0],size:c.length}}var Ec=function(n){(0,Ne.Z)(a,n);var c=Fu(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,T=l.offsets,I=T===void 0?[0,0]:T;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,offsets:I})){this.judgeStyleAttributes({opacity:_,offsets:I});var k=this.layer.getEncodedData(),J=this.calDataFrame(this.cellLength,k,this.cellProperties),X=J.data,ve=J.width,Fe=J.height;this.rowCount=Fe,this.dataTexture=this.cellLength>0&&X.length>0?this.createTexture2D({flipY:!0,data:X,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:ve,height:Fe}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1,u_offsets:this.isOffsetStatic(I)?I:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Nu,fragmentShader:Sc,triangulation:Us,depth:{enable:!1},primitive:A.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(p,_,T,I){var k=p.size,J=k===void 0?1:k;return Array.isArray(J)?[J[0]]:[J]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:A.BlendType.additive}}}]),a}(Na),zu=E(98333);function Bl(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Qu(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,T;return{s:function(){a=a.call(n)},n:function(){var k=a.next();return p=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function Qu(n,c){if(!!n){if(typeof n=="string")return i(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(n,c)}}function i(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var u=function(){function n(c,a,s){(0,K.Z)(this,n),(0,L.Z)(this,"boxCells",[]),(0,L.Z)(this,"xCellCount",void 0),(0,L.Z)(this,"yCellCount",void 0),(0,L.Z)(this,"boxKeys",void 0),(0,L.Z)(this,"bboxes",void 0),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"xScale",void 0),(0,L.Z)(this,"yScale",void 0),(0,L.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(a/s);for(var p=0;p<this.xCellCount*this.yCellCount;p++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=a,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,W.Z)(n,[{key:"insert",value:function(a,s,l,p,_){this.forEachCell(s,l,p,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_)}},{key:"query",value:function(a,s,l,p,_){return this.queryHitTest(a,s,l,p,!1,_)}},{key:"hitTest",value:function(a,s,l,p,_){return this.queryHitTest(a,s,l,p,!0,_)}},{key:"insertBoxCell",value:function(a,s,l,p,_,T){this.boxCells[_].push(T)}},{key:"queryHitTest",value:function(a,s,l,p,_,T){if(l<0||a>this.width||p<0||s>this.height)return _?!1:[];var I=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=p){if(_)return!0;for(var k=0;k<this.boxKeys.length;k++)I.push({key:this.boxKeys[k],x1:this.bboxes[k*4],y1:this.bboxes[k*4+1],x2:this.bboxes[k*4+2],y2:this.bboxes[k*4+3]});return T?I.filter(T):I}var J={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,p,this.queryCell,I,J,T),_?I.length>0:I}},{key:"queryCell",value:function(a,s,l,p,_,T,I,k){var J=I.seenUids,X=this.boxCells[_];if(X!==null){var ve=this.bboxes,Fe=Bl(X),ft;try{for(Fe.s();!(ft=Fe.n()).done;){var Ot=ft.value;if(!J.box[Ot]){J.box[Ot]=!0;var mr=Ot*4;if(a<=ve[mr+2]&&s<=ve[mr+3]&&l>=ve[mr+0]&&p>=ve[mr+1]&&(!k||k(this.boxKeys[Ot]))){if(I.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Ot],x1:ve[mr],y1:ve[mr+1],x2:ve[mr+2],y2:ve[mr+3]})}}}}catch(Sr){Fe.e(Sr)}finally{Fe.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,p,_,T,I,k){for(var J=this.convertToXCellCoord(a),X=this.convertToYCellCoord(s),ve=this.convertToXCellCoord(l),Fe=this.convertToYCellCoord(p),ft=J;ft<=ve;ft++)for(var Ot=X;Ot<=Fe;Ot++){var mr=this.xCellCount*Ot+ft;if(_.call(this,a,s,l,p,mr,T,I,k))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),n}(),o=u,h=function(){function n(c,a){(0,K.Z)(this,n),(0,L.Z)(this,"width",void 0),(0,L.Z)(this,"height",void 0),(0,L.Z)(this,"grid",void 0),(0,L.Z)(this,"viewportPadding",100),(0,L.Z)(this,"screenRightBoundary",void 0),(0,L.Z)(this,"screenBottomBoundary",void 0),(0,L.Z)(this,"gridRightBoundary",void 0),(0,L.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=a,this.viewportPadding=Math.max(c,a),this.grid=new o(c+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,W.Z)(n,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,p=a.x2+a.anchorPointX+this.viewportPadding,_=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,p,_)||this.grid.hitTest(s,l,p,_)?{box:[]}:{box:[s,l,p,_]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var p=zu.al(s,l,0,1),_=zu.Ue(),T=Ua.fromValues.apply(Ua,(0,Si.Z)(a));return zu.fF(_,p,T),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,p){return l>=0&&a<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}}]),n}();function g(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=b(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,T;return{s:function(){a=a.call(n)},n:function(){var k=a.next();return p=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function b(n,c){if(!!n){if(typeof n=="string")return P(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return P(n,c)}}function P(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function D(n){var c=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:c,verticalAlign:a}}function H(n,c,a,s,l){if(!!l){var p=n[s],_=p.glyph;if(_)for(var T=c[_].advance*p.scale,I=(n[s].x+T)*l,k=a;k<=s;k++)n[k].x-=I}}function ae(n,c,a,s,l,p,_){var T=(c-a)*l,I=(-s*_+.5)*p,k=g(n),J;try{for(k.s();!(J=k.n()).done;){var X=J.value;X.x+=T,X.y+=I}}catch(ve){k.e(ve)}finally{k.f()}}function Se(n,c,a,s,l,p,_){var T=-8,I=0,k=T,J=0,X=n.positionedGlyphs,ve=p==="right"?1:p==="left"?0:.5,Fe=X.length;a.forEach(function(Zr){if(Zr.split("").forEach(function(kn){var Yn=c[kn],Ei=0;Yn&&(X.push({glyph:kn,x:I,y:k+Ei,vertical:!1,scale:1,metrics:Yn}),I+=Yn.advance+_)}),X.length!==Fe){var _n=I-_;J=Math.max(_n,J),H(X,c,Fe,X.length-1,ve)}I=0,k+=s});var ft=D(l),Ot=ft.horizontalAlign,mr=ft.verticalAlign;ae(X,ve,Ot,mr,J,s,a.length);var Sr=k-T;n.top+=-mr*Sr,n.bottom=n.top+Sr,n.left+=-Ot*J,n.right=n.left+J}function we(n,c,a,s,l,p,_){var T=-8,I=0,k=T,J=0,X=n.positionedGlyphs,ve=p==="right"?1:p==="left"?0:.5,Fe=X.length;a.forEach(function(Zr){var _n=c[Zr],kn=0;if(_n&&(X.push({glyph:Zr,x:I,y:k+kn,vertical:!1,scale:1,metrics:_n}),I+=_n.advance+_),X.length!==Fe){var Yn=I-_;J=Math.max(Yn,J),H(X,c,Fe,X.length-1,ve)}I=0,k+=s});var ft=D(l),Ot=ft.horizontalAlign,mr=ft.verticalAlign;ae(X,ve,Ot,mr,J,s,a.length);var Sr=k-T;n.top+=-mr*Sr,n.bottom=n.top+Sr,n.left+=-Ot*J,n.right=n.left+J}function Pe(n,c,a,s,l,p){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],T=arguments.length>7?arguments[7]:void 0,I=n.split(`
`),k=[],J={positionedGlyphs:k,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:I.length,text:n};return T?we(J,c,I,a,s,l,p):Se(J,c,I,a,s,l,p),k.length?J:!1}function He(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,p=[],_=g(l),T;try{for(_.s();!(T=_.n()).done;){var I=T.value,k=I.metrics,J=4,X=k.advance*I.scale/2,ve=a?[I.x+X,I.y]:[0,0],Fe=a?[0,0]:[I.x+X+c[0],I.y+c[1]],ft=(0-J)*I.scale-X+Fe[0],Ot=(0-J)*I.scale+Fe[1],mr=ft+k.width*I.scale,Sr=Ot+k.height*I.scale,Zr={x:ft,y:Ot},_n={x:mr,y:Ot},kn={x:ft,y:Sr},Yn={x:mr,y:Sr};p.push({tl:Zr,tr:_n,bl:kn,br:Yn,tex:k,glyphOffset:ve})}}catch(Ei){_.e(Ei)}finally{_.f()}return p}function je(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=it(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,T;return{s:function(){a=a.call(n)},n:function(){var k=a.next();return p=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function it(n,c){if(!!n){if(typeof n=="string")return ze(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ze(n,c)}}function ze(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function ot(n){var c=bt();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function bt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Zt=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,fr=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ur(n){var c=this,a=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var p=c.glyphInfoMap[a].centroid,_=p.length===2?[p[0],p[1],0]:p;return c.glyphInfoMap[a].glyphQuads.forEach(function(T,I){s.push.apply(s,(0,Si.Z)(_).concat([T.tex.x,T.tex.y+T.tex.height,T.tl.x,T.tl.y],(0,Si.Z)(_),[T.tex.x+T.tex.width,T.tex.y+T.tex.height,T.tr.x,T.tr.y],(0,Si.Z)(_),[T.tex.x+T.tex.width,T.tex.y,T.br.x,T.br.y],(0,Si.Z)(_),[T.tex.x,T.tex.y,T.bl.x,T.bl.y])),l.push(0+I*4,1+I*4,2+I*4,2+I*4,3+I*4,0+I*4)}),{vertices:s,indices:l,size:7}}var gr=function(n){(0,Ne.Z)(a,n);var c=ot(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"glyphInfo",void 0),(0,L.Z)((0,N.Z)(s),"glyphInfoMap",{}),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"currentZoom",-1),(0,L.Z)((0,N.Z)(s),"extent",void 0),(0,L.Z)((0,N.Z)(s),"textureHeight",0),(0,L.Z)((0,N.Z)(s),"textCount",0),(0,L.Z)((0,N.Z)(s),"preTextStyle",{}),(0,L.Z)((0,N.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:fr,fragmentShader:Zt,triangulation:ur.bind((0,N.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,T=l.stroke,I=T===void 0?"#fff":T,k=l.strokeWidth,J=k===void 0?0:k,X=l.textAnchor,ve=X===void 0?"center":X,Fe=l.textAllowOverlap,ft=Fe===void 0?!1:Fe,Ot=l.halo,mr=Ot===void 0?.5:Ot,Sr=l.gamma,Zr=Sr===void 0?2:Sr,_n=this.fontService,kn=_n.canvas,Yn=_n.mapping;if(Object.keys(Yn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Yn).length),this.preTextStyle={textAnchor:ve,textAllowOverlap:ft},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeWidth:J,stroke:I})){this.judgeStyleAttributes({opacity:_,strokeWidth:J,stroke:I});var Ei=this.layer.getEncodedData(),Qn=this.calDataFrame(this.cellLength,Ei,this.cellProperties),Ti=Qn.data,sa=Qn.width,ma=Qn.height;this.rowCount=ma,this.dataTexture=this.cellLength>0&&Ti.length>0?this.createTexture2D({flipY:!0,data:Ti,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:sa,height:ma}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1,u_stroke_width:Hi()(J)?J:0,u_stroke_color:this.getStrokeColor(I),u_sdf_map:this.texture,u_halo_blur:mr,u_gamma_scale:Zr,u_sdf_map_size:[kn.width,kn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),p=l.textAnchor,_=p===void 0?"center":p,T=l.textAllowOverlap,I=T===void 0?!0:T;return this.preTextStyle={textAnchor:_,textAllowOverlap:I},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),p=l.textAllowOverlap,_=p===void 0?!1:p,T=this.mapService.getZoom(),I=this.mapService.getBounds(),k=(0,rt.oO)(this.extent,I);return!_&&(Math.abs(this.currentZoom-T)>1||!k)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:A.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(p,_,T,I){var k=p.rotate,J=k===void 0?0:k;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:A.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(p,_,T,I){return[T[5],T[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(p,_,T,I){var k=p.size,J=k===void 0?12:k;return Array.isArray(J)?[J[0]]:[J]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:A.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(p,_,T,I){return[T[3],T[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,rt.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,_=p===void 0?"400":p,T=l.fontFamily,I=T===void 0?"sans-serif":T,k=this.layer.getEncodedData(),J=[];k.forEach(function(X){var ve=X.shape,Fe=ve===void 0?"":ve;Fe=Fe.toString();var ft=je(Fe),Ot;try{for(ft.s();!(Ot=ft.n()).done;){var mr=Ot.value;J.indexOf(mr)===-1&&J.push(mr)}}catch(Sr){ft.e(Sr)}finally{ft.f()}}),this.fontService.setFontOptions({characterSet:J,fontWeight:_,fontFamily:I,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,_=p===void 0?"400":p,T=l.fontFamily,I=T===void 0?"sans-serif":T,k=this.layer.getEncodedData(),J=[];k.forEach(function(X){var ve=X.shape,Fe=ve===void 0?"":ve;Fe=Fe.toString(),J.indexOf(Fe)===-1&&J.push(Fe)}),this.fontService.setFontOptions({characterSet:J,fontWeight:_,fontFamily:I,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var p=this,_=this.fontService.mapping,T=this.layer.getLayerConfig(),I=T.spacing,k=I===void 0?2:I,J=T.textAnchor,X=J===void 0?"center":J,ve=this.layer.getEncodedData();this.glyphInfo=ve.map(function(Fe){var ft=Fe.shape,Ot=ft===void 0?"":ft,mr=Fe.id,Sr=Fe.size,Zr=Sr===void 0?1:Sr,_n=Fe.textOffset,kn=_n===void 0?[0,0]:_n,Yn=Pe(Ot.toString(),_,Zr,X,"center",k,kn,l),Ei=He(Yn,kn,!1);return Fe.shaping=Yn,Fe.glyphQuads=Ei,Fe.centroid=ci(Fe.coordinates),Fe.originCentroid=Fe.version==="GAODE2.x"?ci(Fe.originCoordinates):Fe.originCentroid=Fe.centroid,p.glyphInfoMap[mr]={shaping:Yn,glyphQuads:Ei,centroid:ci(Fe.coordinates)},Fe})}},{key:"filterGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.padding,T=_===void 0?[4,4]:_,I=p.textAllowOverlap,k=I===void 0?!1:I;if(!k){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var J=this.rendererService.getViewportSize(),X=J.width,ve=J.height,Fe=new h(X,ve),ft=this.glyphInfo.filter(function(Ot){var mr=Ot.shaping,Sr=Ot.id,Zr=Sr===void 0?0:Sr,_n=Ot.version==="GAODE2.x"?Ot.originCentroid:Ot.centroid,kn=Ot.size,Yn=kn/24,Ei=l.mapService.lngLatToContainer(_n),Qn=Fe.placeCollisionBox({x1:mr.left*Yn-T[0],x2:mr.right*Yn+T[0],y1:mr.top*Yn-T[1],y2:mr.bottom*Yn+T[1],anchorPointX:Ei.x,anchorPointY:Ei.y}),Ti=Qn.box;return Ti&&Ti.length?(Fe.insertCollisionBox(Ti,Zr),!0):!1});ft.forEach(function(Ot){l.glyphInfoMap[Ot.id]=Ot})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),p=l.iconfont,_=p===void 0?!1:p;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.textureHeight=p.height,this.texture&&this.texture.destroy(),this.texture=l({data:p,mag:A.gl.LINEAR,min:A.gl.LINEAR,width:p.width,height:p.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:fr,fragmentShader:Zt,triangulation:ur.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(Na),Nr={fill:ws,image:bc,normal:Ec,extrude:Wi,text:gr,icon:Ju},an=Nr;function Hr(n){var c=Rn();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Rn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ri=function(n){(0,Ne.Z)(a,n);var c=Hr(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"type","PointLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new an[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return p[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),_=p.shape2d,T=p.shape3d,I=this.iconService.getIconMap(),k=l.find(function(X){return X.hasOwnProperty("shape")});if(k){var J=k.shape;return J==="dot"?"normal":(_==null?void 0:_.indexOf(J))!==-1?"fill":(T==null?void 0:T.indexOf(J))!==-1?"extrude":I.hasOwnProperty(J)?"image":this.fontService.getGlyph(J)!==""?"icon":"text"}else return"normal"}}]),a}(yo);function hi(n){var c=ni();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function ni(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ea=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Un=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,gi=function(n){(0,Ne.Z)(a,n);var c=hi(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),k=I.data,J=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:J,height:X}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:Un,fragmentShader:ea,triangulation:Au})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:A.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:A.gl.STATIC_DRAW,data:[],type:A.gl.FLOAT},size:3,update:function(p,_,T,I,k){return k}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:A.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(p,_,T,I){var k=p.size,J=k===void 0?10:k;return Array.isArray(J)?[J[0]]:[J]}}})}}]),a}(Na);function te(n){var c=q();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function q(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var R=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,F=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,re=function(n){(0,Ne.Z)(a,n);var c=te(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var T=this.layer.getEncodedData(),I=this.calDataFrame(this.cellLength,T,this.cellProperties),k=I.data,J=I.width,X=I.height;this.rowCount=X,this.dataTexture=this.cellLength>0&&k.length>0?this.createTexture2D({flipY:!0,data:k,format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:J,height:X}):this.createTexture2D({flipY:!0,data:[1],format:A.gl.LUMINANCE,type:A.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Hi()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:F,fragmentShader:R,triangulation:hc,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(Na),pe={fill:re,line:Du,extrude:gi,text:gr,point_fill:ws,point_image:bc,point_normal:Ec,point_extrude:Wi},dt=pe;function wt(n){var c=At();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function At(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var qt=function(n){(0,Ne.Z)(a,n);var c=wt(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"type","PolygonLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new dt[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),_=p.shape2d,T=p.shape3d,I=this.iconService.getIconMap(),k=l.find(function(X){return X.hasOwnProperty("shape")});if(k){var J=k.shape;return J==="dot"?"point_normal":(_==null?void 0:_.indexOf(J))!==-1?"point_fill":(T==null?void 0:T.indexOf(J))!==-1?"point_extrude":I.hasOwnProperty(J)?"point_image":"text"}else return"fill"}}]),a}(yo);function Pr(n){var c=mn();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function mn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Zn=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,Jn=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,_i=function(n){(0,Ne.Z)(a,n);var c=Pr(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"texture",void 0),(0,L.Z)((0,N.Z)(s),"colorTexture",void 0),s}return(0,W.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,T=l.clampLow,I=T===void 0?!0:T,k=l.clampHigh,J=k===void 0?!0:k,X=l.noDataValue,ve=X===void 0?-9999999:X,Fe=l.domain,ft=Fe===void 0?[0,1]:Fe;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:ft,u_clampLow:I,u_clampHigh:typeof J!="undefined"?J:I,u_noDataValue:ve,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),p=this.rendererService.createTexture2D,_=l.data.dataArray[0];this.texture=p({data:_.data,width:_.width,height:_.height,format:A.gl.LUMINANCE,type:A.gl.FLOAT});var T=this.layer.getLayerConfig(),I=T.rampColors,k=(0,rt.Cl)(I);return this.colorTexture=p({data:k.data,width:k.width,height:k.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:Jn,fragmentShader:Zn,triangulation:Tu,primitive:A.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(p,_,T,I){return[T[3],T[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,p=this.layer.getLayerConfig(),_=p.rampColors,T=(0,rt.Cl)(_);this.colorTexture=l({data:T.data,width:T.width,height:T.height,flipY:!1})}}]),a}(Na),si={raster:_i,raster3d:_i},ji=si;function $i(n){var c=xa();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function xa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ao=function(n){(0,Ne.Z)(a,n);var c=$i(a);function a(){var s;(0,K.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,L.Z)((0,N.Z)(s),"type","RasterLayer"),s}return(0,W.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new ji[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={raster:{},raster3d:{}};return p[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(yo),La=E(50361),co=E.n(La),Ga,ta,va,za,fa,Ta,bo,Fo,ua;function Zo(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function fo(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Zo(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Zo(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var qs=(Ga=(0,Et.b2)(),ta=(0,Et.f3)(A.vK.IGlobalConfigService),va=(0,Et.f3)(A.vK.IMapService),za=(0,Et.f3)(A.vK.IFontService),Ga(fa=(Ta=function(){function n(){(0,K.Z)(this,n),(0,ai.Z)(this,"configService",bo,this),(0,ai.Z)(this,"mapService",Fo,this),(0,ai.Z)(this,"fontService",ua,this)}return(0,W.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:p})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:p}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var _=p.getLayerStyleAttributes()||[],T=p.getLayerStyleAttribute("filter"),I=a.getSource().data.dataArray,k=_.filter(function(X){return X.needRemapping}),J=I;T!=null&&T.needRemapping&&T!==null&&T!==void 0&&T.scale&&(J=I.filter(function(X){return l.applyAttributeMapping(T,X)[0]})),k.length&&(T!=null&&T.needRemapping?(a.setEncodedData(l.mapping(_,J)),T.needRemapping=!1):a.setEncodedData(l.mapping(k,J,a.getEncodedData())),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,p=s.styleAttributeService,_=p.getLayerStyleAttributes()||[],T=p.getLayerStyleAttribute("filter"),I=a.getSource().data.dataArray,k=I;T!=null&&T.scale&&(k=I.filter(function(J){return l.applyAttributeMapping(T,J)[0]})),a.setEncodedData(this.mapping(_,k))}},{key:"mapping",value:function(a,s,l){var p=this,_=s.map(function(T,I){var k=l?l[I]:{},J=fo({id:T._id,coordinates:T.coordinates},k);return a.filter(function(X){return X.scale!==void 0}).forEach(function(X){var ve=p.applyAttributeMapping(X,T);X.needRemapping=!1,X.name==="color"&&(ve=ve.map(function(Fe){return(0,rt.CI)(Fe)})),J[X.name]=Array.isArray(ve)&&ve.length===1?ve[0]:ve,X.name==="shape"&&(J.shape=p.fontService.getIconFontKey(J[X.name]))}),J});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.map(function(T){T.version="GAODE2.x",T.originCoordinates=co()(T.coordinates),T.coordinates=p.mapService.lngLatToCoord(T.coordinates)}):_.map(function(T){T.version="GAODE2.x",T.originCoordinates=co()(T.coordinates),T.coordinates=p.mapService.lngLatToCoords(T.coordinates)})),_}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var p=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],_=[];return p.forEach(function(T){var I,k=T.field;(s.hasOwnProperty(k)||((I=a.scale)===null||I===void 0?void 0:I.type)==="variable")&&_.push(s[k])}),a.mapping?a.mapping(_):[]}}]),n}(),bo=(0,ti.Z)(Ta.prototype,"configService",[ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fo=(0,ti.Z)(Ta.prototype,"mapService",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ua=(0,ti.Z)(Ta.prototype,"fontService",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta))||fa),wc={},Nl={},qu=function(c){return Nl[c]},fu=function(c,a){Nl[c]=a},zl=function(c){return wc[c]},Zs=function(c,a){wc[c]=a},ml={},yl={},hu=34,Po=10,ef=13;function tf(n){return new Function("d","return {"+n.map(function(c,a){return JSON.stringify(c)+": d["+a+'] || ""'}).join(",")+"}")}function hf(n,c){var a=tf(n);return function(s,l){return c(a(s),l,n)}}function Ff(n){var c=Object.create(null),a=[];return n.forEach(function(s){for(var l in s)l in c||a.push(c[l]=l)}),a}function eu(n,c){var a=n+"",s=a.length;return s<c?new Array(c-s+1).join(0)+a:a}function rf(n){return n<0?"-"+eu(-n,6):n>9999?"+"+eu(n,6):eu(n,4)}function Cc(n){var c=n.getUTCHours(),a=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":rf(n.getUTCFullYear(),4)+"-"+eu(n.getUTCMonth()+1,2)+"-"+eu(n.getUTCDate(),2)+(l?"T"+eu(c,2)+":"+eu(a,2)+":"+eu(s,2)+"."+eu(l,3)+"Z":s?"T"+eu(c,2)+":"+eu(a,2)+":"+eu(s,2)+"Z":a||c?"T"+eu(c,2)+":"+eu(a,2)+"Z":"")}function dp(n){var c=new RegExp('["'+n+`
\r]`),a=n.charCodeAt(0);function s(X,ve){var Fe,ft,Ot=l(X,function(mr,Sr){if(Fe)return Fe(mr,Sr-1);ft=mr,Fe=ve?hf(mr,ve):tf(mr)});return Ot.columns=ft||[],Ot}function l(X,ve){var Fe=[],ft=X.length,Ot=0,mr=0,Sr,Zr=ft<=0,_n=!1;X.charCodeAt(ft-1)===Po&&--ft,X.charCodeAt(ft-1)===ef&&--ft;function kn(){if(Zr)return yl;if(_n)return _n=!1,ml;var Ei,Qn=Ot,Ti;if(X.charCodeAt(Qn)===hu){for(;Ot++<ft&&X.charCodeAt(Ot)!==hu||X.charCodeAt(++Ot)===hu;);return(Ei=Ot)>=ft?Zr=!0:(Ti=X.charCodeAt(Ot++))===Po?_n=!0:Ti===ef&&(_n=!0,X.charCodeAt(Ot)===Po&&++Ot),X.slice(Qn+1,Ei-1).replace(/""/g,'"')}for(;Ot<ft;){if((Ti=X.charCodeAt(Ei=Ot++))===Po)_n=!0;else if(Ti===ef)_n=!0,X.charCodeAt(Ot)===Po&&++Ot;else if(Ti!==a)continue;return X.slice(Qn,Ei)}return Zr=!0,X.slice(Qn,ft)}for(;(Sr=kn())!==yl;){for(var Yn=[];Sr!==ml&&Sr!==yl;)Yn.push(Sr),Sr=kn();ve&&(Yn=ve(Yn,mr++))==null||Fe.push(Yn)}return Fe}function p(X,ve){return X.map(function(Fe){return ve.map(function(ft){return J(Fe[ft])}).join(n)})}function _(X,ve){return ve==null&&(ve=Ff(X)),[ve.map(J).join(n)].concat(p(X,ve)).join(`
`)}function T(X,ve){return ve==null&&(ve=Ff(X)),p(X,ve).join(`
`)}function I(X){return X.map(k).join(`
`)}function k(X){return X.map(J).join(n)}function J(X){return X==null?"":X instanceof Date?Cc(X):c.test(X+="")?'"'+X.replace(/"/g,'""')+'"':X}return{parse:s,parseRows:l,format:_,formatBody:T,formatRows:I,formatRow:k,formatValue:J}}var Ul=dp(","),nh=Ul.parse,Ac=Ul.parseRows,pf=Ul.format,Hp=Ul.formatBody,df=Ul.formatRows,Ph=Ul.formatRow,Wp=Ul.formatValue,vp=E(38163),ih=E.n(vp);function Mh(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Bf(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Mh(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Mh(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ih(n,c){var a=c.x,s=c.y,l=c.x1,p=c.y1,_=c.coordinates,T=[];return n.forEach(function(I,k){var J=[];if(a&&s&&(J=[parseFloat(I[a]),parseFloat(I[s])]),a&&s&&l&&p){var X=[parseFloat(I[a]),parseFloat(I[s])],ve=[parseFloat(I[l]),parseFloat(I[p])];J=[X,ve]}if(_){var Fe="Polygon";Array.isArray(_[0])||(Fe="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(Fe="LineString");var ft={type:Fe,coordinates:(0,Si.Z)(I[_])};ih()(ft,!0),J=ft.coordinates}var Ot=Bf(Bf({},I),{},{_id:k,coordinates:J});T.push(Ot)}),{dataArray:T}}function nf(n,c){var a=nh(n);return Ih(a,c)}var Oh=E(40271);function as(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Nf(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Lh(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return Lh(n[0]);throw new Error("coordinates must only contain numbers")}function ah(n,c,a){if(!c||!a)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.type)}function oh(n,c,a){if(!n)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.geometry.type)}function af(n,c,a){if(!n)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var p=l[s];if(!p||p.type!=="Feature"||!p.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!p.geometry||p.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+p.geometry.type)}}function zf(n){return n.type==="Feature"?n.geometry:n}function Uf(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function gl(n,c,a){if(n!==null)for(var s,l,p,_,T,I,k,J=0,X=0,ve,Fe=n.type,ft=Fe==="FeatureCollection",Ot=Fe==="Feature",mr=ft?n.features.length:1,Sr=0;Sr<mr;Sr++){k=ft?n.features[Sr].geometry:Ot?n.geometry:n,ve=k?k.type==="GeometryCollection":!1,T=ve?k.geometries.length:1;for(var Zr=0;Zr<T;Zr++){var _n=0,kn=0;if(_=ve?k.geometries[Zr]:k,_!==null){I=_.coordinates;var Yn=_.type;switch(J=a&&(Yn==="Polygon"||Yn==="MultiPolygon")?1:0,Yn){case null:break;case"Point":if(c(I,X,Sr,_n,kn)===!1)return!1;X++,_n++;break;case"LineString":case"MultiPoint":for(s=0;s<I.length;s++){if(c(I[s],X,Sr,_n,kn)===!1)return!1;X++,Yn==="MultiPoint"&&_n++}Yn==="LineString"&&_n++;break;case"Polygon":case"MultiLineString":for(s=0;s<I.length;s++){for(l=0;l<I[s].length-J;l++){if(c(I[s][l],X,Sr,_n,kn)===!1)return!1;X++}Yn==="MultiLineString"&&_n++,Yn==="Polygon"&&kn++}Yn==="Polygon"&&_n++;break;case"MultiPolygon":for(s=0;s<I.length;s++){for(kn=0,l=0;l<I[s].length;l++){for(p=0;p<I[s][l].length-J;p++){if(c(I[s][l][p],X,Sr,_n,kn)===!1)return!1;X++}kn++}_n++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(gl(_.geometries[s],c,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Zf(n,c,a,s){var l=a;return gl(n,function(p,_,T,I,k){_===0&&a===void 0?l=p:l=c(l,p,_,T,I,k)},s),l}function of(n,c){var a;switch(n.type){case"FeatureCollection":for(a=0;a<n.features.length&&c(n.features[a].properties,a)!==!1;a++);break;case"Feature":c(n.properties,0);break}}function sh(n,c,a){var s=a;return of(n,function(l,p){p===0&&a===void 0?s=l:s=c(s,l,p)}),s}function Tc(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var a=0;a<n.features.length&&c(n.features[a],a)!==!1;a++);}function Rh(n,c,a){var s=a;return Tc(n,function(l,p){p===0&&a===void 0?s=l:s=c(s,l,p)}),s}function vf(n){var c=[];return gl(n,function(a){c.push(a)}),c}function mf(n,c){var a,s,l,p,_,T,I,k,J,X,ve=0,Fe=n.type==="FeatureCollection",ft=n.type==="Feature",Ot=Fe?n.features.length:1;for(a=0;a<Ot;a++){for(T=Fe?n.features[a].geometry:ft?n.geometry:n,k=Fe?n.features[a].properties:ft?n.properties:{},J=Fe?n.features[a].bbox:ft?n.bbox:void 0,X=Fe?n.features[a].id:ft?n.id:void 0,I=T?T.type==="GeometryCollection":!1,_=I?T.geometries.length:1,l=0;l<_;l++){if(p=I?T.geometries[l]:T,p===null){if(c(null,ve,k,J,X)===!1)return!1;continue}switch(p.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(p,ve,k,J,X)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<p.geometries.length;s++)if(c(p.geometries[s],ve,k,J,X)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ve++}}function yf(n,c,a){var s=a;return mf(n,function(l,p,_,T,I){p===0&&a===void 0?s=l:s=c(s,l,p,_,T,I)}),s}function Zl(n,c){mf(n,function(a,s,l,p,_){var T=a===null?null:a.type;switch(T){case null:case"Point":case"LineString":case"Polygon":return c((0,Oh.zL)(a,l,{bbox:p,id:_}),s,0)===!1?!1:void 0}var I;switch(T){case"MultiPoint":I="Point";break;case"MultiLineString":I="LineString";break;case"MultiPolygon":I="Polygon";break}for(var k=0;k<a.coordinates.length;k++){var J=a.coordinates[k],X={type:I,coordinates:J};if(c((0,Oh.zL)(X,l),s,k)===!1)return!1}})}function bu(n,c,a){var s=a;return Zl(n,function(l,p,_){p===0&&_===0&&a===void 0?s=l:s=c(s,l,p,_)}),s}function gf(n,c){Zl(n,function(a,s,l){var p=0;if(!!a.geometry){var _=a.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var T,I=0,k=0,J=0;if(gl(a,function(X,ve,Fe,ft,Ot){if(T===void 0||s>I||ft>k||Ot>J){T=X,I=s,k=ft,J=Ot,p=0;return}var mr=lineString([T,X],a.properties);if(c(mr,s,l,Ot,p)===!1)return!1;p++,T=X})===!1)return!1}}})}function jf(n,c,a){var s=a,l=!1;return gf(n,function(p,_,T,I,k){l===!1&&a===void 0?s=p:s=c(s,p,_,T,I,k),l=!0}),s}function _f(n,c){if(!n)throw new Error("geojson is required");Zl(n,function(a,s,l){if(a.geometry!==null){var p=a.geometry.type,_=a.geometry.coordinates;switch(p){case"LineString":if(c(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var T=0;T<_.length;T++)if(c(lineString(_[T],a.properties),s,l,T)===!1)return!1;break}}})}function kh(n,c,a){var s=a;return _f(n,function(l,p,_,T){p===0&&a===void 0?s=l:s=c(s,l,p,_,T)}),s}function xf(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.segmentIndex||0,_=c.properties,T;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,T=n.features[a].geometry;break;case"Feature":_=_||n.properties,T=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=n;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var I=T.coordinates;switch(T.type){case"Point":case"MultiPoint":return null;case"LineString":return p<0&&(p=I.length+p-1),lineString([I[p],I[p+1]],_,c);case"Polygon":return l<0&&(l=I.length+l),p<0&&(p=I[l].length+p-1),lineString([I[l][p],I[l][p+1]],_,c);case"MultiLineString":return s<0&&(s=I.length+s),p<0&&(p=I[s].length+p-1),lineString([I[s][p],I[s][p+1]],_,c);case"MultiPolygon":return s<0&&(s=I.length+s),l<0&&(l=I[s].length+l),p<0&&(p=I[s][l].length-p-1),lineString([I[s][l][p],I[s][l][p+1]],_,c)}throw new Error("geojson is invalid")}function _l(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.coordIndex||0,_=c.properties,T;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,T=n.features[a].geometry;break;case"Feature":_=_||n.properties,T=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":T=n;break;default:throw new Error("geojson is invalid")}if(T===null)return null;var I=T.coordinates;switch(T.type){case"Point":return point(I,_,c);case"MultiPoint":return s<0&&(s=I.length+s),point(I[s],_,c);case"LineString":return p<0&&(p=I.length+p),point(I[p],_,c);case"Polygon":return l<0&&(l=I.length+l),p<0&&(p=I[l].length+p),point(I[l][p],_,c);case"MultiLineString":return s<0&&(s=I.length+s),p<0&&(p=I[s].length+p),point(I[s][p],_,c);case"MultiPolygon":return s<0&&(s=I.length+s),l<0&&(l=I[s].length+l),p<0&&(p=I[s][l].length-p),point(I[s][l][p],_,c)}throw new Error("geojson is invalid")}function uh(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Vf(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?uh(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):uh(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Dh(n,c){var a=[],s={};if(n.features=n.features.filter(function(p){var _=p.geometry;return p!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),ih()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return Zl(n,function(p,_){var T=Nf(p),I=_,k=Vf(Vf({},p.properties),{},{coordinates:T,_id:I});a.push(k)}),{dataArray:a,featureKeys:s}}function lh(n,c){var a=c.extent,s=new Promise(function(p){mp(n,function(_){p(_)})}),l={images:s,_id:1,dataArray:[{_id:0,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return l}function mp(n,c){var a=n,s=[];if(typeof a=="string")(0,rt.gJ)({url:a},function(_,T){s.push(T),c(s)});else{var l=a.length,p=0;a.forEach(function(_){(0,rt.gJ)({url:_},function(T,I){p++,s.push(I),p===l&&c(s)})})}return lh}function Pc(n,c){var a=c.extent,s=c.width,l=c.height,p=c.min,_=c.max,T={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:p,max:_,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return T}var jc=E(30236),Fh=E.n(jc);function bf(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function sf(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?bf(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):bf(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Uu(n,c){var a=c.radius,s=a===void 0?40:a,l=c.maxZoom,p=l===void 0?18:l,_=c.minZoom,T=_===void 0?0:_,I=c.zoom,k=I===void 0?2:I;if(n.pointIndex){var J=n.pointIndex.getClusters(n.extent,Math.floor(k));return n.dataArray=yp(J),n}var X=new(nr())({radius:s,minZoom:T,maxZoom:p}),ve={type:"FeatureCollection",features:[]};return ve.features=n.dataArray.map(function(Fe){return{type:"Feature",geometry:{type:"Point",coordinates:Fe.coordinates},properties:sf({},Fe)}}),X.load(ve.features),X}function yp(n){return n.map(function(c,a){return sf({coordinates:c.geometry.coordinates,_id:a+1},c.properties)})}function jl(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]>c&&(c=n[a]);return c}function Bh(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]<c&&(c=n[a]);return c}function xl(n){if(n.length===0)return 0;for(var c=n[0],a=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?a+=c-s+n[l]:a+=n[l]-s+c,c=s;return c+a*1}function ac(n){if(n.length===0)throw new Error("mean requires at least one data point");return xl(n)/n.length}var Nh={min:Bh,max:jl,mean:ac,sum:xl};function ch(n,c){return n.map(function(a){return a[c]*1})}function Sf(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function fh(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Sf(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Sf(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function vs(n){var c=jo();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function jo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function os(n,c){if(Array.isArray(c))return c}var pu=function(n){(0,Ne.Z)(a,n);var c=vs(a);function a(s,l){var p;return(0,K.Z)(this,a),p=c.call(this),(0,L.Z)((0,N.Z)(p),"data",void 0),(0,L.Z)((0,N.Z)(p),"extent",void 0),(0,L.Z)((0,N.Z)(p),"hooks",{init:new mi.ni}),(0,L.Z)((0,N.Z)(p),"parser",{type:"geojson"}),(0,L.Z)((0,N.Z)(p),"transforms",[]),(0,L.Z)((0,N.Z)(p),"cluster",!1),(0,L.Z)((0,N.Z)(p),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,L.Z)((0,N.Z)(p),"mapService",void 0),(0,L.Z)((0,N.Z)(p),"invalidExtent",!1),(0,L.Z)((0,N.Z)(p),"originData",void 0),(0,L.Z)((0,N.Z)(p),"rawData",void 0),(0,L.Z)((0,N.Z)(p),"cfg",{}),(0,L.Z)((0,N.Z)(p),"clusterIndex",void 0),p.originData=s,p.initCfg(l),p.hooks.init.tap("parser",function(){p.excuteParser()}),p.hooks.init.tap("cluster",function(){p.initCluster()}),p.hooks.init.tap("transform",function(){p.executeTrans()}),p.init(),p}return(0,W.Z)(a,[{key:"setData",value:function(l,p){this.rawData=l,this.originData=l,this.initCfg(p),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var p=this,_=this.clusterOptions,T=_.method,I=T===void 0?"sum":T,k=_.field,J=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,J.forEach(function(X){X.id||(X.properties.point_count=1)}),(k||ya()(I))&&(J=J.map(function(X){var ve=X.id;if(ve){var Fe=p.clusterIndex.getLeaves(ve,Infinity),ft=Fe.map(function(Sr){return Sr.properties}),Ot;if(so()(I)&&k){var mr=ch(ft,k);Ot=Nh[I](mr)}ya()(I)&&(Ot=I(ft)),X.properties.stat=Ot}else X.properties.point_count=1;return X})),this.data=qu("geojson")({type:"FeatureCollection",features:J}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var p=this.parser.type,_=p===void 0?"geojson":p;if(_==="geojson"&&!this.cluster){var T=l<this.originData.features.length?this.originData.features[l]:"null",I=co()(T);if(this.transforms.length!==0){var k=this.data.dataArray.find(function(J){return J._id===l});I.properties=k}return I}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,p){var _=this.data.dataArray.find(function(T){return T[l]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var p=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(p=(0,rt.yA)((0,rt.ds)(this.extent),l)),p[0].concat(p[1])}},{key:"initCfg",value:function(l){this.cfg=Fh()(this.cfg,l,os);var p=this.cfg;p&&(p.parser&&(this.parser=p.parser),p.transforms&&(this.transforms=p.transforms),this.cluster=p.cluster||!1,p.clusterOptions&&(this.cluster=!0,this.clusterOptions=fh(fh({},this.clusterOptions),p.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,p=l.type||"geojson",_=qu(p);this.data=_(this.originData,l),this.extent=(0,rt.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,p=this.transforms;p.forEach(function(_){var T=_.type,I=zl(T)(l.data,_);Object.assign(l.data,I)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=Uu(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(Yt.EventEmitter);function hh(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.filter(a)),n}function zh(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Uh(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(k){throw k},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,T;return{s:function(){a=a.call(n)},n:function(){var k=a.next();return p=k.done,k},e:function(k){_=!0,T=k},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw T}}}}function Uh(n,c){if(!!n){if(typeof n=="string")return Zh(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Zh(n,c)}}function Zh(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var ph=6378e3;function jh(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,p=l/(2*Math.PI*ph)*(256<<20)/2,_=Vh(a,l),T=_.gridHash,I=_.gridOffset,k=Gh(T,I,c);return{yOffset:p,xOffset:p,radius:p,type:"grid",dataArray:k}}function Vh(n,c){var a=Infinity,s=-Infinity,l,p=zh(n),_;try{for(p.s();!(_=p.n()).done;){var T=_.value;l=T.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(_n){p.e(_n)}finally{p.f()}var I=(a+s)/2,k=gp(c,I);if(k.xOffset<=0||k.yOffset<=0)return{gridHash:{},gridOffset:k};var J={},X=zh(n),ve;try{for(X.s();!(ve=X.n()).done;){var Fe=ve.value,ft=Fe.coordinates[1],Ot=Fe.coordinates[0];if(Number.isFinite(ft)&&Number.isFinite(Ot)){var mr=Math.floor((ft+90)/k.yOffset),Sr=Math.floor((Ot+180)/k.xOffset),Zr="".concat(mr,"-").concat(Sr);J[Zr]=J[Zr]||{count:0,points:[]},J[Zr].count+=1,J[Zr].points.push(Fe)}}}catch(_n){X.e(_n)}finally{X.f()}return{gridHash:J,gridOffset:k}}function gp(n,c){var a=_p(n),s=Ef(c,n);return{yOffset:a,xOffset:s}}function _p(n){return n/ph*(180/Math.PI)}function Ef(n,c){return c/ph*(180/Math.PI)/Math.cos(n*Math.PI/180)}function Gh(n,c,a){return Object.keys(n).reduce(function(s,l,p){var _=l.split("-"),T=parseInt(_[0],10),I=parseInt(_[1],10),k={};if(a.field&&a.method){var J=rt.a5.getColumn(n[l].points,a.field);k[a.method]=rt.a5.statMap[a.method](J)}return Object.assign(k,{_id:p,coordinates:(0,rt.Z)([-180+c.xOffset*(I+.5),-90+c.yOffset*(T+.5)]),rawData:n[l].points,count:n[l].count}),s.push(k),s},[])}var Mc=Math.PI/3,wf=[0,Mc,2*Mc,3*Mc,4*Mc,5*Mc];function $a(n){return n[0]}function Hh(n){return n[1]}function oc(){var n=0,c=0,a=1,s=1,l=$a,p=Hh,_,T,I;function k(X){var ve={},Fe=[],ft,Ot=X.length;for(ft=0;ft<Ot;++ft)if(!(isNaN(Sr=+l.call(null,mr=X[ft],ft,X))||isNaN(Zr=+p.call(null,mr,ft,X)))){var mr,Sr,Zr,_n=Math.round(Zr=Zr/I),kn=Math.round(Sr=Sr/T-(_n&1)/2),Yn=Zr-_n;if(Math.abs(Yn)*3>1){var Ei=Sr-kn,Qn=kn+(Sr<kn?-1:1)/2,Ti=_n+(Zr<_n?-1:1),sa=Sr-Qn,ma=Zr-Ti;Ei*Ei+Yn*Yn>sa*sa+ma*ma&&(kn=Qn+(_n&1?1:-1)/2,_n=Ti)}var vi=kn+"-"+_n,Oa=ve[vi];Oa?Oa.push(mr):(Fe.push(Oa=ve[vi]=[mr]),Oa.x=(kn+(_n&1)/2)*T,Oa.y=_n*I)}return Fe}function J(X){var ve=0,Fe=0;return wf.map(function(ft){var Ot=Math.sin(ft)*X,mr=-Math.cos(ft)*X,Sr=Ot-ve,Zr=mr-Fe;return ve=Ot,Fe=mr,[Sr,Zr]})}return k.hexagon=function(X){return"m"+J(X==null?_:+X).join("l")+"z"},k.centers=function(){for(var X=[],ve=Math.round(c/I),Fe=Math.round(n/T),ft=ve*I;ft<s+_;ft+=I,++ve)for(var Ot=Fe*T+(ve&1)*T/2;Ot<a+T/2;Ot+=T)X.push([Ot,ft]);return X},k.mesh=function(){var X=J(_).slice(0,4).join("l");return k.centers().map(function(ve){return"M"+ve+"m"+X}).join("")},k.x=function(X){return arguments.length?(l=X,k):l},k.y=function(X){return arguments.length?(p=X,k):p},k.radius=function(X){return arguments.length?(_=+X,T=_*2*Math.sin(Mc),I=_*1.5,k):_},k.size=function(X){return arguments.length?(n=c=0,a=+X[0],s=+X[1],k):[a-n,s-c]},k.extent=function(X){return arguments.length?(n=+X[0][0],c=+X[0][1],a=+X[1][0],s=+X[1][1],k):[[n,c],[a,s]]},k.radius(1)}function Ic(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function dh(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ic(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ic(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var V=6378e3;function Me(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,p=c.method,_=p===void 0?"sum":p,T=l/(2*Math.PI*V)*(256<<20)/2,I=a.map(function(ve){var Fe=(0,rt.Z)(ve.coordinates),ft=(0,Q.Z)(Fe,2),Ot=ft[0],mr=ft[1];return dh(dh({},ve),{},{coordinates:[Ot,mr]})}),k=oc().radius(T).x(function(ve){return ve.coordinates[0]}).y(function(ve){return ve.coordinates[1]}),J=k(I),X={dataArray:J.map(function(ve,Fe){var ft;if(c.field&&_){var Ot=rt.a5.getColumn(ve,c.field);ve[_]=rt.a5.statMap[_](Ot)}return ft={},(0,L.Z)(ft,c.method,ve[_]),(0,L.Z)(ft,"count",ve.length),(0,L.Z)(ft,"rawData",ve),(0,L.Z)(ft,"coordinates",[ve.x,ve.y]),(0,L.Z)(ft,"_id",Fe),ft}),radius:T,xOffset:T,yOffset:T,type:"hexagon"};return X}function $e(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ir(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?$e(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):$e(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Mr(n,c){var a=c.sourceField,s=c.targetField,l=c.data,p={};return l.forEach(function(_){p[_[a]]=_}),n.dataArray=n.dataArray.map(function(_){var T=_[s];return ir(ir({},_),p[T])}),n}function rr(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.map(a)),n}var Er=E(4771),Fr=pu;fu("geojson",Dh),fu("image",lh),fu("csv",nf),fu("json",Ih),fu("raster",Pc),Zs("cluster",Uu),Zs("filter",hh),Zs("join",Mr),Zs("map",rr),Zs("grid",jh),Zs("hexagon",Me);var Gr,Kr,Qr=(Gr=(0,Et.b2)(),Gr(Kr=function(){function n(){(0,K.Z)(this,n),(0,L.Z)(this,"mapService",void 0)}return(0,W.Z)(n,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(A.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var p=a.sourceOption,_=p.data,T=p.options;a.setSource(new Fr(_,T))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),p=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||p})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,p=s.clusterOptions,_=p.zoom,T=_===void 0?0:_,I=p.maxZoom,k=I===void 0?16:I,J=this.mapService.getZoom()-1,X=a.dataState.dataSourceNeedUpdate;return l&&(X||Math.abs(T-J)>1)&&k>T?(s.updateClusterData(Math.floor(J)),!0):!1}}]),n}())||Kr),en=E(44908),pn=E.n(en),Wr=E(14293),qr=E.n(Wr);function Rt(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function pr(n){return n.length===1&&(n=Yr(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)<0?s=p+1:l=p}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)>0?l=p:s=p+1}return s}}}function Yr(n){return function(c,a){return Rt(n(c),a)}}var wn=pr(Rt),Tr=wn.right,Sn=wn.left,rn=null;function ui(n,c){var a=n.length,s=-1,l,p,_;if(c==null){for(;++s<a;)if((l=n[s])!=null&&l>=l)for(p=_=l;++s<a;)(l=n[s])!=null&&(p>l&&(p=l),_<l&&(_=l))}else for(;++s<a;)if((l=c(n[s],s,n))!=null&&l>=l)for(p=_=l;++s<a;)(l=c(n[s],s,n))!=null&&(p>l&&(p=l),_<l&&(_=l));return[p,_]}var Ar=Array.prototype,br=Ar.slice,Xn=Ar.map,fn=Math.sqrt(50),$r=Math.sqrt(10),gn=Math.sqrt(2);function En(n,c,a){var s,l=-1,p,_,T;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(p=n,n=c,c=p),(T=Ni(n,c,a))===0||!isFinite(T))return[];if(T>0)for(n=Math.ceil(n/T),c=Math.floor(c/T),_=new Array(p=Math.ceil(c-n+1));++l<p;)_[l]=(n+l)*T;else for(n=Math.floor(n*T),c=Math.ceil(c*T),_=new Array(p=Math.ceil(n-c+1));++l<p;)_[l]=(n-l)/T;return s&&_.reverse(),_}function Ni(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),p=s/Math.pow(10,l);return l>=0?(p>=fn?10:p>=$r?5:p>=gn?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(p>=fn?10:p>=$r?5:p>=gn?2:1)}function ki(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),p=s/l;return p>=fn?l*=10:p>=$r?l*=5:p>=gn&&(l*=2),c<n?-l:l}function Tn(){var n=identity,c=extent,a=sturges;function s(l){var p,_=l.length,T,I=new Array(_);for(p=0;p<_;++p)I[p]=n(l[p],p,l);var k=c(I),J=k[0],X=k[1],ve=a(I,J,X);Array.isArray(ve)||(ve=tickStep(J,X,ve),ve=range(Math.ceil(J/ve)*ve,X,ve));for(var Fe=ve.length;ve[0]<=J;)ve.shift(),--Fe;for(;ve[Fe-1]>X;)ve.pop(),--Fe;var ft=new Array(Fe+1),Ot;for(p=0;p<=Fe;++p)Ot=ft[p]=[],Ot.x0=p>0?ve[p-1]:J,Ot.x1=p<Fe?ve[p]:X;for(p=0;p<_;++p)T=I[p],J<=T&&T<=X&&ft[bisect(ve,T,0,Fe)].push(l[p]);return ft}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function Cn(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function xi(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Di(n){return n.length===1&&(n=ia(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)<0?s=p+1:l=p}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)>0?l=p:s=p+1}return s}}}function ia(n){return function(c,a){return xi(n(c),a)}}var So=Di(xi),Mo=So.right,la=So.left,Qo=Mo,to=Array.prototype,Cs=to.slice,ss=to.map,qo=Math.sqrt(50),us=Math.sqrt(10),es=Math.sqrt(2);function Bo(n,c,a){var s,l=-1,p,_,T;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(p=n,n=c,c=p),(T=Fi(n,c,a))===0||!isFinite(T))return[];if(T>0)for(n=Math.ceil(n/T),c=Math.floor(c/T),_=new Array(p=Math.ceil(c-n+1));++l<p;)_[l]=(n+l)*T;else for(n=Math.floor(n*T),c=Math.ceil(c*T),_=new Array(p=Math.ceil(n-c+1));++l<p;)_[l]=(n-l)/T;return s&&_.reverse(),_}function Fi(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),p=s/Math.pow(10,l);return l>=0?(p>=qo?10:p>=us?5:p>=es?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(p>=qo?10:p>=us?5:p>=es?2:1)}function Vo(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),p=s/l;return p>=qo?l*=10:p>=us?l*=5:p>=es&&(l*=2),c<n?-l:l}function Ra(){var n=identity,c=extent,a=sturges;function s(l){var p,_=l.length,T,I=new Array(_);for(p=0;p<_;++p)I[p]=n(l[p],p,l);var k=c(I),J=k[0],X=k[1],ve=a(I,J,X);Array.isArray(ve)||(ve=tickStep(J,X,ve),ve=range(Math.ceil(J/ve)*ve,X,ve));for(var Fe=ve.length;ve[0]<=J;)ve.shift(),--Fe;for(;ve[Fe-1]>X;)ve.pop(),--Fe;var ft=new Array(Fe+1),Ot;for(p=0;p<=Fe;++p)Ot=ft[p]=[],Ot.x0=p>0?ve[p-1]:J,Ot.x1=p<Fe?ve[p]:X;for(p=0;p<_;++p)T=I[p],J<=T&&T<=X&&ft[bisect(ve,T,0,Fe)].push(l[p]);return ft}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function Go(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function Mi(n){return n===null?NaN:+n}function aa(n,c,a){if(a==null&&(a=Mi),!!(s=n.length)){if((c=+c)<=0||s<2)return+a(n[0],0,n);if(c>=1)return+a(n[s-1],s-1,n);var s,l=(s-1)*c,p=Math.floor(l),_=+a(n[p],p,n),T=+a(n[p+1],p+1,n);return _+(T-_)*(l-p)}}var ha="$";function oo(){}oo.prototype=el.prototype={constructor:oo,has:function(n){return ha+n in this},get:function(n){return this[ha+n]},set:function(n,c){return this[ha+n]=c,this},remove:function(n){var c=ha+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===ha&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===ha&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===ha&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===ha&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===ha&&++n;return n},empty:function(){for(var n in this)if(n[0]===ha)return!1;return!0},each:function(n){for(var c in this)c[0]===ha&&n(this[c],c.slice(1),this)}};function el(n,c){var a=new oo;if(n instanceof oo)n.each(function(T,I){a.set(I,T)});else if(Array.isArray(n)){var s=-1,l=n.length,p;if(c==null)for(;++s<l;)a.set(s,n[s]);else for(;++s<l;)a.set(c(p=n[s],s,n),p)}else if(n)for(var _ in n)a.set(_,n[_]);return a}var Ve=el;function lr(){var n=[],c=[],a,s,l;function p(T,I,k,J){if(I>=n.length)return a!=null&&T.sort(a),s!=null?s(T):T;for(var X=-1,ve=T.length,Fe=n[I++],ft,Ot,mr=map(),Sr,Zr=k();++X<ve;)(Sr=mr.get(ft=Fe(Ot=T[X])+""))?Sr.push(Ot):mr.set(ft,[Ot]);return mr.each(function(_n,kn){J(Zr,kn,p(_n,I,k,J))}),Zr}function _(T,I){if(++I>n.length)return T;var k,J=c[I-1];return s!=null&&I>=n.length?k=T.entries():(k=[],T.each(function(X,ve){k.push({key:ve,values:_(X,I)})})),J!=null?k.sort(function(X,ve){return J(X.key,ve.key)}):k}return l={object:function(T){return p(T,0,Kt,Nn)},map:function(T){return p(T,0,oa,De)},entries:function(T){return _(p(T,0,oa,De),0)},key:function(T){return n.push(T),l},sortKeys:function(T){return c[n.length-1]=T,l},sortValues:function(T){return a=T,l},rollup:function(T){return s=T,l}}}function Kt(){return{}}function Nn(n,c,a){n[c]=a}function oa(){return map()}function De(n,c,a){n.set(c,a)}function be(){}var tt=Ve.prototype;be.prototype=kt.prototype={constructor:be,has:tt.has,add:function(n){return n+="",this[ha+n]=n,this},remove:tt.remove,clear:tt.clear,values:tt.keys,size:tt.size,empty:tt.empty,each:tt.each};function kt(n,c){var a=new be;if(n instanceof be)n.each(function(p){a.add(p)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)a.add(n[s]);else for(;++s<l;)a.add(c(n[s],s,n))}return a}var or=null,mt=Array.prototype,ut=mt.map,et=mt.slice;function Ie(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function at(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var Be={name:"implicit"};function It(){var n=Ve(),c=[],a=[],s=Be;function l(p){var _=p+"",T=n.get(_);if(!T){if(s!==Be)return s;n.set(_,T=c.push(p))}return a[(T-1)%a.length]}return l.domain=function(p){if(!arguments.length)return c.slice();c=[],n=Ve();for(var _=-1,T=p.length,I,k;++_<T;)n.has(k=(I=p[_])+"")||n.set(k,c.push(I));return l},l.range=function(p){return arguments.length?(a=et.call(p),l):a.slice()},l.unknown=function(p){return arguments.length?(s=p,l):s},l.copy=function(){return It(c,a).unknown(s)},Ie.apply(l,arguments),l}function Ht(){var n=ordinal().unknown(void 0),c=n.domain,a=n.range,s=[0,1],l,p,_=!1,T=0,I=0,k=.5;delete n.unknown;function J(){var X=c().length,ve=s[1]<s[0],Fe=s[ve-0],ft=s[1-ve];l=(ft-Fe)/Math.max(1,X-T+I*2),_&&(l=Math.floor(l)),Fe+=(ft-Fe-l*(X-T))*k,p=l*(1-T),_&&(Fe=Math.round(Fe),p=Math.round(p));var Ot=sequence(X).map(function(mr){return Fe+l*mr});return a(ve?Ot.reverse():Ot)}return n.domain=function(X){return arguments.length?(c(X),J()):c()},n.range=function(X){return arguments.length?(s=[+X[0],+X[1]],J()):s.slice()},n.rangeRound=function(X){return s=[+X[0],+X[1]],_=!0,J()},n.bandwidth=function(){return p},n.step=function(){return l},n.round=function(X){return arguments.length?(_=!!X,J()):_},n.padding=function(X){return arguments.length?(T=Math.min(1,I=+X),J()):T},n.paddingInner=function(X){return arguments.length?(T=Math.min(1,X),J()):T},n.paddingOuter=function(X){return arguments.length?(I=+X,J()):I},n.align=function(X){return arguments.length?(k=Math.max(0,Math.min(1,X)),J()):k},n.copy=function(){return Ht(c(),s).round(_).paddingInner(T).paddingOuter(I).align(k)},initRange.apply(J(),arguments)}function Dr(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return Dr(c())},n}function hn(){return Dr(Ht.apply(null,arguments).paddingInner(1))}var cn=E(26257),Pn=E(73626);function sn(n,c){return n=+n,c=+c,function(a){return Math.round(n*(1-a)+c*a)}}function Kn(n){return function(){return n}}function In(n){return+n}var Gn=[0,1];function An(n){return n}function jn(n,c){return(c-=n=+n)?function(a){return(a-n)/c}:Kn(isNaN(c)?NaN:.5)}function pi(n){var c=n[0],a=n[n.length-1],s;return c>a&&(s=c,c=a,a=s),function(l){return Math.max(c,Math.min(a,l))}}function Ja(n,c,a){var s=n[0],l=n[1],p=c[0],_=c[1];return l<s?(s=jn(l,s),p=a(_,p)):(s=jn(s,l),p=a(p,_)),function(T){return p(s(T))}}function Ho(n,c,a){var s=Math.min(n.length,c.length)-1,l=new Array(s),p=new Array(s),_=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++_<s;)l[_]=jn(n[_],n[_+1]),p[_]=a(c[_],c[_+1]);return function(T){var I=Qo(n,T,1,s)-1;return p[I](l[I](T))}}function Zu(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function Ha(){var n=Gn,c=Gn,a=cn.Z,s,l,p,_=An,T,I,k;function J(){return T=Math.min(n.length,c.length)>2?Ho:Ja,I=k=null,X}function X(ve){return isNaN(ve=+ve)?p:(I||(I=T(n.map(s),c,a)))(s(_(ve)))}return X.invert=function(ve){return _(l((k||(k=T(c,n.map(s),Pn.Z)))(ve)))},X.domain=function(ve){return arguments.length?(n=ut.call(ve,In),_===An||(_=pi(n)),J()):n.slice()},X.range=function(ve){return arguments.length?(c=et.call(ve),J()):c.slice()},X.rangeRound=function(ve){return c=et.call(ve),a=sn,J()},X.clamp=function(ve){return arguments.length?(_=ve?pi(n):An,X):_!==An},X.interpolate=function(ve){return arguments.length?(a=ve,J()):a},X.unknown=function(ve){return arguments.length?(p=ve,X):p},function(ve,Fe){return s=ve,l=Fe,J()}}function Pa(n,c){return Ha()(n,c)}var js=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Su(n){if(!(c=js.exec(n)))throw new Error("invalid format: "+n);var c;return new du({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}Su.prototype=du.prototype;function du(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}du.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function vh(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function vu(n,c){if((a=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var a,s=n.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+n.slice(a+1)]}function sc(n){return n=vu(Math.abs(n)),n?n[1]:NaN}function Cf(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(sc(c)/3)))*3-sc(Math.abs(n)))}function Af(n,c){return function(a,s){for(var l=a.length,p=[],_=0,T=n[0],I=0;l>0&&T>0&&(I+T+1>s&&(T=Math.max(1,s-I)),p.push(a.substring(l-=T,l+T)),!((I+=T+1)>s));)T=n[_=(_+1)%n.length];return p.reverse().join(c)}}function Xp(n){return function(c){return c.replace(/[0-9]/g,function(a){return n[+a]})}}function ms(n){e:for(var c=n.length,a=1,s=-1,l;a<c;++a)switch(n[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+n[a])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var Gf;function Vc(n,c){var a=vu(n,c);if(!a)return n+"";var s=a[0],l=a[1],p=l-(Gf=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,_=s.length;return p===_?s:p>_?s+new Array(p-_+1).join("0"):p>0?s.slice(0,p)+"."+s.slice(p):"0."+new Array(1-p).join("0")+vu(n,Math.max(0,c+p-1))[0]}function mh(n,c){var a=vu(n,c);if(!a)return n+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var yh={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:vh,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return mh(n*100,c)},r:mh,s:Vc,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function Wh(n){return n}var Tf=Array.prototype.map,Oc=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Yp(n){var c=n.grouping===void 0||n.thousands===void 0?Wh:Af(Tf.call(n.grouping,Number),n.thousands+""),a=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",p=n.numerals===void 0?Wh:Xp(Tf.call(n.numerals,String)),_=n.percent===void 0?"%":n.percent+"",T=n.minus===void 0?"-":n.minus+"",I=n.nan===void 0?"NaN":n.nan+"";function k(X){X=Su(X);var ve=X.fill,Fe=X.align,ft=X.sign,Ot=X.symbol,mr=X.zero,Sr=X.width,Zr=X.comma,_n=X.precision,kn=X.trim,Yn=X.type;Yn==="n"?(Zr=!0,Yn="g"):yh[Yn]||(_n===void 0&&(_n=12),kn=!0,Yn="g"),(mr||ve==="0"&&Fe==="=")&&(mr=!0,ve="0",Fe="=");var Ei=Ot==="$"?a:Ot==="#"&&/[boxX]/.test(Yn)?"0"+Yn.toLowerCase():"",Qn=Ot==="$"?s:/[%p]/.test(Yn)?_:"",Ti=yh[Yn],sa=/[defgprs%]/.test(Yn);_n=_n===void 0?6:/[gprs]/.test(Yn)?Math.max(1,Math.min(21,_n)):Math.max(0,Math.min(20,_n));function ma(vi){var Oa=Ei,qa=Qn,wu,cp,fp;if(Yn==="c")qa=Ti(vi)+qa,vi="";else{vi=+vi;var hp=vi<0||1/vi<0;if(vi=isNaN(vi)?I:Ti(Math.abs(vi),_n),kn&&(vi=ms(vi)),hp&&+vi==0&&ft!=="+"&&(hp=!1),Oa=(hp?ft==="("?ft:T:ft==="-"||ft==="("?"":ft)+Oa,qa=(Yn==="s"?Oc[8+Gf/3]:"")+qa+(hp&&ft==="("?")":""),sa){for(wu=-1,cp=vi.length;++wu<cp;)if(fp=vi.charCodeAt(wu),48>fp||fp>57){qa=(fp===46?l+vi.slice(wu+1):vi.slice(wu))+qa,vi=vi.slice(0,wu);break}}}Zr&&!mr&&(vi=c(vi,Infinity));var pp=Oa.length+vi.length+qa.length,$c=pp<Sr?new Array(Sr-pp+1).join(ve):"";switch(Zr&&mr&&(vi=c($c+vi,$c.length?Sr-qa.length:Infinity),$c=""),Fe){case"<":vi=Oa+vi+qa+$c;break;case"=":vi=Oa+$c+vi+qa;break;case"^":vi=$c.slice(0,pp=$c.length>>1)+Oa+vi+qa+$c.slice(pp);break;default:vi=$c+Oa+vi+qa;break}return p(vi)}return ma.toString=function(){return X+""},ma}function J(X,ve){var Fe=k((X=Su(X),X.type="f",X)),ft=Math.max(-8,Math.min(8,Math.floor(sc(ve)/3)))*3,Ot=Math.pow(10,-ft),mr=Oc[8+ft/3];return function(Sr){return Fe(Ot*Sr)+mr}}return{format:k,formatPrefix:J}}var gh,xp,As;uf({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function uf(n){return gh=Yp(n),xp=gh.format,As=gh.formatPrefix,gh}function Kp(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,sc(c)-sc(n))+1}function e(n){return Math.max(0,-sc(Math.abs(n)))}function t(n,c,a,s){var l=Vo(n,c,a),p;switch(s=Su(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(p=Cf(l,_))&&(s.precision=p),As(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(p=Kp(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=p-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(p=e(l))&&(s.precision=p-(s.type==="%")*2);break}}return xp(s)}function r(n){var c=n.domain;return n.ticks=function(a){var s=c();return Bo(s[0],s[s.length-1],a==null?10:a)},n.tickFormat=function(a,s){var l=c();return t(l[0],l[l.length-1],a==null?10:a,s)},n.nice=function(a){a==null&&(a=10);var s=c(),l=0,p=s.length-1,_=s[l],T=s[p],I;return T<_&&(I=_,_=T,T=I,I=l,l=p,p=I),I=Fi(_,T,a),I>0?(_=Math.floor(_/I)*I,T=Math.ceil(T/I)*I,I=Fi(_,T,a)):I<0&&(_=Math.ceil(_*I)/I,T=Math.floor(T*I)/I,I=Fi(_,T,a)),I>0?(s[l]=Math.floor(_/I)*I,s[p]=Math.ceil(T/I)*I,c(s)):I<0&&(s[l]=Math.ceil(_*I)/I,s[p]=Math.floor(T*I)/I,c(s)),n},n}function f(){var n=Pa(An,An);return n.copy=function(){return Zu(n,f())},Ie.apply(n,arguments),r(n)}function v(n){var c;function a(s){return isNaN(s=+s)?c:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(n=ut.call(s,In),a):n.slice()},a.unknown=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return v(n).unknown(c)},n=arguments.length?ut.call(n,In):[0,1],r(a)}function y(n,c){n=n.slice();var a=0,s=n.length-1,l=n[a],p=n[s],_;return p<l&&(_=a,a=s,s=_,_=l,l=p,p=_),n[a]=c.floor(l),n[s]=c.ceil(p),n}function x(n){return Math.log(n)}function M(n){return Math.exp(n)}function B(n){return-Math.log(-n)}function G(n){return-Math.exp(-n)}function $(n){return isFinite(n)?+("1e"+n):n<0?0:n}function ne(n){return n===10?$:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function he(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function _e(n){return function(c){return-n(-c)}}function Ge(n){var c=n(x,M),a=c.domain,s=10,l,p;function _(){return l=he(s),p=ne(s),a()[0]<0?(l=_e(l),p=_e(p),n(B,G)):n(x,M),c}return c.base=function(T){return arguments.length?(s=+T,_()):s},c.domain=function(T){return arguments.length?(a(T),_()):a()},c.ticks=function(T){var I=a(),k=I[0],J=I[I.length-1],X;(X=J<k)&&(ve=k,k=J,J=ve);var ve=l(k),Fe=l(J),ft,Ot,mr,Sr=T==null?10:+T,Zr=[];if(!(s%1)&&Fe-ve<Sr){if(ve=Math.round(ve)-1,Fe=Math.round(Fe)+1,k>0){for(;ve<Fe;++ve)for(Ot=1,ft=p(ve);Ot<s;++Ot)if(mr=ft*Ot,!(mr<k)){if(mr>J)break;Zr.push(mr)}}else for(;ve<Fe;++ve)for(Ot=s-1,ft=p(ve);Ot>=1;--Ot)if(mr=ft*Ot,!(mr<k)){if(mr>J)break;Zr.push(mr)}}else Zr=Bo(ve,Fe,Math.min(Fe-ve,Sr)).map(p);return X?Zr.reverse():Zr},c.tickFormat=function(T,I){if(I==null&&(I=s===10?".0e":","),typeof I!="function"&&(I=xp(I)),T===Infinity)return I;T==null&&(T=10);var k=Math.max(1,s*T/c.ticks().length);return function(J){var X=J/p(Math.round(l(J)));return X*s<s-.5&&(X*=s),X<=k?I(J):""}},c.nice=function(){return a(y(a(),{floor:function(T){return p(Math.floor(l(T)))},ceil:function(T){return p(Math.ceil(l(T)))}}))},c}function We(){var n=Ge(Ha()).domain([1,10]);return n.copy=function(){return Zu(n,We()).base(n.base())},Ie.apply(n,arguments),n}function ht(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function qe(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function Pt(n){var c=1,a=n(ht(c),qe(c));return a.constant=function(s){return arguments.length?n(ht(c=+s),qe(c)):c},linearish(a)}function Wt(){var n=Pt(transformer());return n.copy=function(){return copy(n,Wt()).constant(n.constant())},initRange.apply(n,arguments)}function cr(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function vr(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function Ir(n){return n<0?-n*n:n*n}function tn(n){var c=n(An,An),a=1;function s(){return a===1?n(An,An):a===.5?n(vr,Ir):n(cr(a),cr(1/a))}return c.exponent=function(l){return arguments.length?(a=+l,s()):a},r(c)}function dn(){var n=tn(Ha());return n.copy=function(){return Zu(n,dn()).exponent(n.exponent())},Ie.apply(n,arguments),n}function li(){return dn.apply(null,arguments).exponent(.5)}function Bn(){var n=[],c=[],a=[],s;function l(){var _=0,T=Math.max(1,c.length);for(a=new Array(T-1);++_<T;)a[_-1]=aa(n,_/T);return p}function p(_){return isNaN(_=+_)?s:c[Qo(a,_)]}return p.invertExtent=function(_){var T=c.indexOf(_);return T<0?[NaN,NaN]:[T>0?a[T-1]:n[0],T<a.length?a[T]:n[n.length-1]]},p.domain=function(_){if(!arguments.length)return n.slice();n=[];for(var T=0,I=_.length,k;T<I;++T)k=_[T],k!=null&&!isNaN(k=+k)&&n.push(k);return n.sort(xi),l()},p.range=function(_){return arguments.length?(c=et.call(_),l()):c.slice()},p.unknown=function(_){return arguments.length?(s=_,p):s},p.quantiles=function(){return a.slice()},p.copy=function(){return Bn().domain(n).range(c).unknown(s)},Ie.apply(p,arguments)}function fi(){var n=0,c=1,a=1,s=[.5],l=[0,1],p;function _(I){return I<=I?l[Qo(s,I,0,a)]:p}function T(){var I=-1;for(s=new Array(a);++I<a;)s[I]=((I+1)*c-(I-a)*n)/(a+1);return _}return _.domain=function(I){return arguments.length?(n=+I[0],c=+I[1],T()):[n,c]},_.range=function(I){return arguments.length?(a=(l=et.call(I)).length-1,T()):l.slice()},_.invertExtent=function(I){var k=l.indexOf(I);return k<0?[NaN,NaN]:k<1?[n,s[0]]:k>=a?[s[a-1],c]:[s[k-1],s[k]]},_.unknown=function(I){return arguments.length&&(p=I),_},_.thresholds=function(){return s.slice()},_.copy=function(){return fi().domain([n,c]).range(l).unknown(p)},Ie.apply(r(_),arguments)}function zn(){var n=[.5],c=[0,1],a,s=1;function l(p){return p<=p?c[Qo(n,p,0,s)]:a}return l.domain=function(p){return arguments.length?(n=et.call(p),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(p){return arguments.length?(c=et.call(p),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(p){var _=c.indexOf(p);return[n[_-1],n[_]]},l.unknown=function(p){return arguments.length?(a=p,l):a},l.copy=function(){return zn().domain(n).range(c).unknown(a)},Ie.apply(l,arguments)}var Xi=new Date,Ci=new Date;function On(n,c,a,s){function l(p){return n(p=arguments.length===0?new Date:new Date(+p)),p}return l.floor=function(p){return n(p=new Date(+p)),p},l.ceil=function(p){return n(p=new Date(p-1)),c(p,1),n(p),p},l.round=function(p){var _=l(p),T=l.ceil(p);return p-_<T-p?_:T},l.offset=function(p,_){return c(p=new Date(+p),_==null?1:Math.floor(_)),p},l.range=function(p,_,T){var I=[],k;if(p=l.ceil(p),T=T==null?1:Math.floor(T),!(p<_)||!(T>0))return I;do I.push(k=new Date(+p)),c(p,T),n(p);while(k<p&&p<_);return I},l.filter=function(p){return On(function(_){if(_>=_)for(;n(_),!p(_);)_.setTime(_-1)},function(_,T){if(_>=_)if(T<0)for(;++T<=0;)for(;c(_,-1),!p(_););else for(;--T>=0;)for(;c(_,1),!p(_););})},a&&(l.count=function(p,_){return Xi.setTime(+p),Ci.setTime(+_),n(Xi),n(Ci),Math.floor(a(Xi,Ci))},l.every=function(p){return p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?l.filter(s?function(_){return s(_)%p==0}:function(_){return l.count(0,_)%p==0}):l}),l}var na=On(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});na.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:On(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,a){c.setFullYear(c.getFullYear()+a*n)})};var Bi=na,wa=na.range,di=On(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),ka=di,Io=di.range,Eo=1e3,ho=6e4,vo=36e5,No=864e5,ys=6048e5;function Oo(n){return On(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,a){c.setDate(c.getDate()+a*7)},function(c,a){return(a-c-(a.getTimezoneOffset()-c.getTimezoneOffset())*ho)/ys})}var ks=Oo(0),ls=Oo(1),tu=Oo(2),ts=Oo(3),Wo=Oo(4),pa=Oo(5),ro=Oo(6),Qa=ks.range,Ma=ls.range,Eu=tu.range,ru=ts.range,wo=Wo.range,gs=pa.range,nu=ro.range,Ia=On(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*ho)/No},function(n){return n.getDate()-1}),Vl=Ia,bl=Ia.range,uc=On(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*Eo-n.getMinutes()*ho)},function(n,c){n.setTime(+n+c*vo)},function(n,c){return(c-n)/vo},function(n){return n.getHours()}),rs=uc,Gc=uc.range,Sl=On(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*Eo)},function(n,c){n.setTime(+n+c*ho)},function(n,c){return(c-n)/ho},function(n){return n.getMinutes()}),Hf=Sl,Wf=Sl.range,Pf=On(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*Eo)},function(n,c){return(c-n)/Eo},function(n){return n.getUTCSeconds()}),Hc=Pf,_h=Pf.range,Mf=On(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});Mf.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?On(function(c){c.setTime(Math.floor(c/n)*n)},function(c,a){c.setTime(+c+a*n)},function(c,a){return(a-c)/n}):Mf};var Xf=Mf,Xh=Mf.range;function Lc(n){return On(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCDate(c.getUTCDate()+a*7)},function(c,a){return(a-c)/ys})}var xh=Lc(0),Gl=Lc(1),bh=Lc(2),Yf=Lc(3),El=Lc(4),Kf=Lc(5),Yh=Lc(6),bp=xh.range,Kh=Gl.range,$h=bh.range,Sp=Yf.range,Jh=El.range,Qh=Kf.range,qh=Yh.range,Sh=On(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/No},function(n){return n.getUTCDate()-1}),If=Sh,Ep=Sh.range,lf=On(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});lf.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:On(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCFullYear(c.getUTCFullYear()+a*n)})};var Wc=lf,$f=lf.range;function Of(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function cf(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function Lf(n,c,a){return{y:n,m:c,d:a,H:0,M:0,S:0,L:0}}function $p(n){var c=n.dateTime,a=n.date,s=n.time,l=n.periods,p=n.days,_=n.shortDays,T=n.months,I=n.shortMonths,k=ju(l),J=Eh(l),X=ju(p),ve=Eh(p),Fe=ju(_),ft=Eh(_),Ot=ju(T),mr=Eh(T),Sr=ju(I),Zr=Eh(I),_n={a:hp,A:pp,b:$c,B:e0,c:null,d:lc,e:lc,f:Qf,g:Lp,G:ud,H:Pd,I:nd,j:Rf,L:kf,m:qf,M:eh,p:t0,q:r0,Q:Bp,s:Wd,S:id,u:ad,U:od,V:Ip,w:Op,W:Xc,x:null,X:null,y:sd,Y:Rp,Z:kp,"%":rh},kn={a:n0,A:i0,b:a0,B:o0,c:null,d:Dp,e:Dp,f:fd,g:Fd,G:op,H:ld,I:Fp,j:cd,L:th,m:ap,M:Md,p:s0,q:u0,Q:Bp,s:Wd,S:hd,u:Id,U:Od,V:Ld,w:Rd,W:kd,x:null,X:null,y:Dd,Y:kc,Z:dd,"%":rh},Yn={a:ma,A:vi,b:Oa,B:qa,c:wu,d:Tp,e:Tp,f:td,g:Jf,G:wh,H:Pp,I:Pp,j:Ch,L:ed,m:Ap,M:Qp,p:sa,q:np,Q:ip,s:rd,S:qp,u:Cp,U:Jp,V:tp,w:ff,W:Rc,x:cp,X:fp,y:Jf,Y:wh,Z:rp,"%":tl};_n.x=Ei(a,_n),_n.X=Ei(s,_n),_n.c=Ei(c,_n),kn.x=Ei(a,kn),kn.X=Ei(s,kn),kn.c=Ei(c,kn);function Ei(Li,eo){return function(mo){var Vn=[],Hl=-1,cs=0,cc=Li.length,fc,Th,Cm;for(mo instanceof Date||(mo=new Date(+mo));++Hl<cc;)Li.charCodeAt(Hl)===37&&(Vn.push(Li.slice(cs,Hl)),(Th=ep[fc=Li.charAt(++Hl)])!=null?fc=Li.charAt(++Hl):Th=fc==="e"?" ":"0",(Cm=eo[fc])&&(fc=Cm(mo,Th)),Vn.push(fc),cs=Hl+1);return Vn.push(Li.slice(cs,Hl)),Vn.join("")}}function Qn(Li,eo){return function(mo){var Vn=Lf(1900,void 0,1),Hl=Ti(Vn,Li,mo+="",0),cs,cc;if(Hl!=mo.length)return null;if("Q"in Vn)return new Date(Vn.Q);if("s"in Vn)return new Date(Vn.s*1e3+("L"in Vn?Vn.L:0));if(eo&&!("Z"in Vn)&&(Vn.Z=0),"p"in Vn&&(Vn.H=Vn.H%12+Vn.p*12),Vn.m===void 0&&(Vn.m="q"in Vn?Vn.q:0),"V"in Vn){if(Vn.V<1||Vn.V>53)return null;"w"in Vn||(Vn.w=1),"Z"in Vn?(cs=cf(Lf(Vn.y,0,1)),cc=cs.getUTCDay(),cs=cc>4||cc===0?Gl.ceil(cs):Gl(cs),cs=If.offset(cs,(Vn.V-1)*7),Vn.y=cs.getUTCFullYear(),Vn.m=cs.getUTCMonth(),Vn.d=cs.getUTCDate()+(Vn.w+6)%7):(cs=Of(Lf(Vn.y,0,1)),cc=cs.getDay(),cs=cc>4||cc===0?ls.ceil(cs):ls(cs),cs=Vl.offset(cs,(Vn.V-1)*7),Vn.y=cs.getFullYear(),Vn.m=cs.getMonth(),Vn.d=cs.getDate()+(Vn.w+6)%7)}else("W"in Vn||"U"in Vn)&&("w"in Vn||(Vn.w="u"in Vn?Vn.u%7:"W"in Vn?1:0),cc="Z"in Vn?cf(Lf(Vn.y,0,1)).getUTCDay():Of(Lf(Vn.y,0,1)).getDay(),Vn.m=0,Vn.d="W"in Vn?(Vn.w+6)%7+Vn.W*7-(cc+5)%7:Vn.w+Vn.U*7-(cc+6)%7);return"Z"in Vn?(Vn.H+=Vn.Z/100|0,Vn.M+=Vn.Z%100,cf(Vn)):Of(Vn)}}function Ti(Li,eo,mo,Vn){for(var Hl=0,cs=eo.length,cc=mo.length,fc,Th;Hl<cs;){if(Vn>=cc)return-1;if(fc=eo.charCodeAt(Hl++),fc===37){if(fc=eo.charAt(Hl++),Th=Yn[fc in ep?eo.charAt(Hl++):fc],!Th||(Vn=Th(Li,mo,Vn))<0)return-1}else if(fc!=mo.charCodeAt(Vn++))return-1}return Vn}function sa(Li,eo,mo){var Vn=k.exec(eo.slice(mo));return Vn?(Li.p=J[Vn[0].toLowerCase()],mo+Vn[0].length):-1}function ma(Li,eo,mo){var Vn=Fe.exec(eo.slice(mo));return Vn?(Li.w=ft[Vn[0].toLowerCase()],mo+Vn[0].length):-1}function vi(Li,eo,mo){var Vn=X.exec(eo.slice(mo));return Vn?(Li.w=ve[Vn[0].toLowerCase()],mo+Vn[0].length):-1}function Oa(Li,eo,mo){var Vn=Sr.exec(eo.slice(mo));return Vn?(Li.m=Zr[Vn[0].toLowerCase()],mo+Vn[0].length):-1}function qa(Li,eo,mo){var Vn=Ot.exec(eo.slice(mo));return Vn?(Li.m=mr[Vn[0].toLowerCase()],mo+Vn[0].length):-1}function wu(Li,eo,mo){return Ti(Li,c,eo,mo)}function cp(Li,eo,mo){return Ti(Li,a,eo,mo)}function fp(Li,eo,mo){return Ti(Li,s,eo,mo)}function hp(Li){return _[Li.getDay()]}function pp(Li){return p[Li.getDay()]}function $c(Li){return I[Li.getMonth()]}function e0(Li){return T[Li.getMonth()]}function t0(Li){return l[+(Li.getHours()>=12)]}function r0(Li){return 1+~~(Li.getMonth()/3)}function n0(Li){return _[Li.getUTCDay()]}function i0(Li){return p[Li.getUTCDay()]}function a0(Li){return I[Li.getUTCMonth()]}function o0(Li){return T[Li.getUTCMonth()]}function s0(Li){return l[+(Li.getUTCHours()>=12)]}function u0(Li){return 1+~~(Li.getUTCMonth()/3)}return{format:function(Li){var eo=Ei(Li+="",_n);return eo.toString=function(){return Li},eo},parse:function(Li){var eo=Qn(Li+="",!1);return eo.toString=function(){return Li},eo},utcFormat:function(Li){var eo=Ei(Li+="",kn);return eo.toString=function(){return Li},eo},utcParse:function(Li){var eo=Qn(Li+="",!0);return eo.toString=function(){return Li},eo}}}var ep={"-":"",_:" ","0":"0"},Vs=/^\s*\d+/,wp=/^%/,Td=/[\\^$*+?|[\]().{}]/g;function ja(n,c,a){var s=n<0?"-":"",l=(s?-n:n)+"",p=l.length;return s+(p<a?new Array(a-p+1).join(c)+l:l)}function ns(n){return n.replace(Td,"\\$&")}function ju(n){return new RegExp("^(?:"+n.map(ns).join("|")+")","i")}function Eh(n){for(var c={},a=-1,s=n.length;++a<s;)c[n[a].toLowerCase()]=a;return c}function ff(n,c,a){var s=Vs.exec(c.slice(a,a+1));return s?(n.w=+s[0],a+s[0].length):-1}function Cp(n,c,a){var s=Vs.exec(c.slice(a,a+1));return s?(n.u=+s[0],a+s[0].length):-1}function Jp(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.U=+s[0],a+s[0].length):-1}function tp(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.V=+s[0],a+s[0].length):-1}function Rc(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.W=+s[0],a+s[0].length):-1}function wh(n,c,a){var s=Vs.exec(c.slice(a,a+4));return s?(n.y=+s[0],a+s[0].length):-1}function Jf(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function rp(n,c,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(a,a+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function np(n,c,a){var s=Vs.exec(c.slice(a,a+1));return s?(n.q=s[0]*3-3,a+s[0].length):-1}function Ap(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.m=s[0]-1,a+s[0].length):-1}function Tp(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.d=+s[0],a+s[0].length):-1}function Ch(n,c,a){var s=Vs.exec(c.slice(a,a+3));return s?(n.m=0,n.d=+s[0],a+s[0].length):-1}function Pp(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.H=+s[0],a+s[0].length):-1}function Qp(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.M=+s[0],a+s[0].length):-1}function qp(n,c,a){var s=Vs.exec(c.slice(a,a+2));return s?(n.S=+s[0],a+s[0].length):-1}function ed(n,c,a){var s=Vs.exec(c.slice(a,a+3));return s?(n.L=+s[0],a+s[0].length):-1}function td(n,c,a){var s=Vs.exec(c.slice(a,a+6));return s?(n.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function tl(n,c,a){var s=wp.exec(c.slice(a,a+1));return s?a+s[0].length:-1}function ip(n,c,a){var s=Vs.exec(c.slice(a));return s?(n.Q=+s[0],a+s[0].length):-1}function rd(n,c,a){var s=Vs.exec(c.slice(a));return s?(n.s=+s[0],a+s[0].length):-1}function lc(n,c){return ja(n.getDate(),c,2)}function Pd(n,c){return ja(n.getHours(),c,2)}function nd(n,c){return ja(n.getHours()%12||12,c,2)}function Rf(n,c){return ja(1+Vl.count(Bi(n),n),c,3)}function kf(n,c){return ja(n.getMilliseconds(),c,3)}function Qf(n,c){return kf(n,c)+"000"}function qf(n,c){return ja(n.getMonth()+1,c,2)}function eh(n,c){return ja(n.getMinutes(),c,2)}function id(n,c){return ja(n.getSeconds(),c,2)}function ad(n){var c=n.getDay();return c===0?7:c}function od(n,c){return ja(ks.count(Bi(n)-1,n),c,2)}function Mp(n){var c=n.getDay();return c>=4||c===0?Wo(n):Wo.ceil(n)}function Ip(n,c){return n=Mp(n),ja(Wo.count(Bi(n),n)+(Bi(n).getDay()===4),c,2)}function Op(n){return n.getDay()}function Xc(n,c){return ja(ls.count(Bi(n)-1,n),c,2)}function sd(n,c){return ja(n.getFullYear()%100,c,2)}function Lp(n,c){return n=Mp(n),ja(n.getFullYear()%100,c,2)}function Rp(n,c){return ja(n.getFullYear()%1e4,c,4)}function ud(n,c){var a=n.getDay();return n=a>=4||a===0?Wo(n):Wo.ceil(n),ja(n.getFullYear()%1e4,c,4)}function kp(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+ja(c/60|0,"0",2)+ja(c%60,"0",2)}function Dp(n,c){return ja(n.getUTCDate(),c,2)}function ld(n,c){return ja(n.getUTCHours(),c,2)}function Fp(n,c){return ja(n.getUTCHours()%12||12,c,2)}function cd(n,c){return ja(1+If.count(Wc(n),n),c,3)}function th(n,c){return ja(n.getUTCMilliseconds(),c,3)}function fd(n,c){return th(n,c)+"000"}function ap(n,c){return ja(n.getUTCMonth()+1,c,2)}function Md(n,c){return ja(n.getUTCMinutes(),c,2)}function hd(n,c){return ja(n.getUTCSeconds(),c,2)}function Id(n){var c=n.getUTCDay();return c===0?7:c}function Od(n,c){return ja(xh.count(Wc(n)-1,n),c,2)}function pd(n){var c=n.getUTCDay();return c>=4||c===0?El(n):El.ceil(n)}function Ld(n,c){return n=pd(n),ja(El.count(Wc(n),n)+(Wc(n).getUTCDay()===4),c,2)}function Rd(n){return n.getUTCDay()}function kd(n,c){return ja(Gl.count(Wc(n)-1,n),c,2)}function Dd(n,c){return ja(n.getUTCFullYear()%100,c,2)}function Fd(n,c){return n=pd(n),ja(n.getUTCFullYear()%100,c,2)}function kc(n,c){return ja(n.getUTCFullYear()%1e4,c,4)}function op(n,c){var a=n.getUTCDay();return n=a>=4||a===0?El(n):El.ceil(n),ja(n.getUTCFullYear()%1e4,c,4)}function dd(){return"+0000"}function rh(){return"%"}function Bp(n){return+n}function Wd(n){return Math.floor(+n/1e3)}var sp,Xd,Am,Tm,Pm;Mm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Mm(n){return sp=$p(n),Xd=sp.format,Am=sp.parse,Tm=sp.utcFormat,Pm=sp.utcParse,sp}var Np=1e3,zp=Np*60,Up=zp*60,Zp=Up*24,Im=Zp*7,Yd=Zp*30,Bd=Zp*365;function Om(n){return new Date(n)}function Lm(n){return n instanceof Date?+n:+new Date(+n)}function Kd(n,c,a,s,l,p,_,T,I){var k=Pa(An,An),J=k.invert,X=k.domain,ve=I(".%L"),Fe=I(":%S"),ft=I("%I:%M"),Ot=I("%I %p"),mr=I("%a %d"),Sr=I("%b %d"),Zr=I("%B"),_n=I("%Y"),kn=[[_,1,Np],[_,5,5*Np],[_,15,15*Np],[_,30,30*Np],[p,1,zp],[p,5,5*zp],[p,15,15*zp],[p,30,30*zp],[l,1,Up],[l,3,3*Up],[l,6,6*Up],[l,12,12*Up],[s,1,Zp],[s,2,2*Zp],[a,1,Im],[c,1,Yd],[c,3,3*Yd],[n,1,Bd]];function Yn(Qn){return(_(Qn)<Qn?ve:p(Qn)<Qn?Fe:l(Qn)<Qn?ft:s(Qn)<Qn?Ot:c(Qn)<Qn?a(Qn)<Qn?mr:Sr:n(Qn)<Qn?Zr:_n)(Qn)}function Ei(Qn,Ti,sa,ma){if(Qn==null&&(Qn=10),typeof Qn=="number"){var vi=Math.abs(sa-Ti)/Qn,Oa=Di(function(qa){return qa[2]}).right(kn,vi);Oa===kn.length?(ma=Vo(Ti/Bd,sa/Bd,Qn),Qn=n):Oa?(Oa=kn[vi/kn[Oa-1][2]<kn[Oa][2]/vi?Oa-1:Oa],ma=Oa[1],Qn=Oa[0]):(ma=Math.max(Vo(Ti,sa,Qn),1),Qn=T)}return ma==null?Qn:Qn.every(ma)}return k.invert=function(Qn){return new Date(J(Qn))},k.domain=function(Qn){return arguments.length?X(ut.call(Qn,Lm)):X().map(Om)},k.ticks=function(Qn,Ti){var sa=X(),ma=sa[0],vi=sa[sa.length-1],Oa=vi<ma,qa;return Oa&&(qa=ma,ma=vi,vi=qa),qa=Ei(Qn,ma,vi,Ti),qa=qa?qa.range(ma,vi+1):[],Oa?qa.reverse():qa},k.tickFormat=function(Qn,Ti){return Ti==null?Yn:I(Ti)},k.nice=function(Qn,Ti){var sa=X();return(Qn=Ei(Qn,sa[0],sa[sa.length-1],Ti))?X(y(sa,Qn)):k},k.copy=function(){return Zu(k,Kd(n,c,a,s,l,p,_,T,I))},k}function Rm(){return Ie.apply(Kd(Bi,ka,ks,Vl,rs,Hf,Hc,Xf,Xd).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function l0(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function vd(){var n=0,c=1,a,s,l,p,_=identity,T=!1,I;function k(J){return isNaN(J=+J)?I:_(l===0?.5:(J=(p(J)-a)*l,T?Math.max(0,Math.min(1,J)):J))}return k.domain=function(J){return arguments.length?(a=p(n=+J[0]),s=p(c=+J[1]),l=a===s?0:1/(s-a),k):[n,c]},k.clamp=function(J){return arguments.length?(T=!!J,k):T},k.interpolator=function(J){return arguments.length?(_=J,k):_},k.unknown=function(J){return arguments.length?(I=J,k):I},function(J){return p=J,a=J(n),s=J(c),l=a===s?0:1/(s-a),k}}function md(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function km(){var n=linearish(vd()(identity));return n.copy=function(){return md(n,km())},initInterpolator.apply(n,arguments)}function Dm(){var n=loggish(vd()).domain([1,10]);return n.copy=function(){return md(n,Dm()).base(n.base())},initInterpolator.apply(n,arguments)}function Fm(){var n=symlogish(vd());return n.copy=function(){return md(n,Fm()).constant(n.constant())},initInterpolator.apply(n,arguments)}function $d(){var n=powish(vd());return n.copy=function(){return md(n,$d()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function c0(){return $d.apply(null,arguments).exponent(.5)}function Bm(){var n=[],c=identity;function a(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return a.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,p=s.length,_;l<p;++l)_=s[l],_!=null&&!isNaN(_=+_)&&n.push(_);return n.sort(ascending),a},a.interpolator=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return Bm(c).domain(n)},initInterpolator.apply(a,arguments)}function yd(){var n=0,c=.5,a=1,s,l,p,_,T,I=identity,k,J=!1,X;function ve(Fe){return isNaN(Fe=+Fe)?X:(Fe=.5+((Fe=+k(Fe))-l)*(Fe<l?_:T),I(J?Math.max(0,Math.min(1,Fe)):Fe))}return ve.domain=function(Fe){return arguments.length?(s=k(n=+Fe[0]),l=k(c=+Fe[1]),p=k(a=+Fe[2]),_=s===l?0:.5/(l-s),T=l===p?0:.5/(p-l),ve):[n,c,a]},ve.clamp=function(Fe){return arguments.length?(J=!!Fe,ve):J},ve.interpolator=function(Fe){return arguments.length?(I=Fe,ve):I},ve.unknown=function(Fe){return arguments.length?(X=Fe,ve):X},function(Fe){return k=Fe,s=Fe(n),l=Fe(c),p=Fe(a),_=s===l?0:.5/(l-s),T=l===p?0:.5/(p-l),ve}}function Nm(){var n=linearish(yd()(identity));return n.copy=function(){return copy(n,Nm())},initInterpolator.apply(n,arguments)}function zm(){var n=loggish(yd()).domain([.1,1,10]);return n.copy=function(){return copy(n,zm()).base(n.base())},initInterpolator.apply(n,arguments)}function Um(){var n=symlogish(yd());return n.copy=function(){return copy(n,Um()).constant(n.constant())},initInterpolator.apply(n,arguments)}function Jd(){var n=powish(yd());return n.copy=function(){return copy(n,Jd()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function f0(){return Jd.apply(null,arguments).exponent(.5)}var Yc,Qd,qd,ev,Nd,tv,Zm=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,jm=(Yc={},(0,L.Z)(Yc,A.ScaleTypes.LINEAR,f),(0,L.Z)(Yc,A.ScaleTypes.POWER,dn),(0,L.Z)(Yc,A.ScaleTypes.LOG,We),(0,L.Z)(Yc,A.ScaleTypes.IDENTITY,v),(0,L.Z)(Yc,A.ScaleTypes.TIME,Rm),(0,L.Z)(Yc,A.ScaleTypes.QUANTILE,Bn),(0,L.Z)(Yc,A.ScaleTypes.QUANTIZE,fi),(0,L.Z)(Yc,A.ScaleTypes.THRESHOLD,zn),(0,L.Z)(Yc,A.ScaleTypes.CAT,It),Yc),Vm=(Qd=(0,Et.b2)(),qd=(0,Et.f3)(A.vK.IGlobalConfigService),Qd(ev=(Nd=function(){function n(){(0,K.Z)(this,n),(0,ai.Z)(this,"configService",tv,this),(0,L.Z)(this,"scaleCache",{}),(0,L.Z)(this,"scaleOptions",{})}return(0,W.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes(),T=a.getSource().data.dataArray;T.length!==0&&l.caculateScalesForAttributes(_||[],T)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes(),T=a.getSource().data.dataArray;return l.caculateScalesForAttributes(_||[],T),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes();if(_){var T=a.getSource().data.dataArray;if(T.length===0)return;var I=_.filter(function(k){return k.needRescale});I.length&&l.caculateScalesForAttributes(I,T)}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(p){if(p.scale){var _=p.scale,T=p.name;_.names=l.parseFields(p.scale.field||[]);var I=[];_.names.forEach(function(k){I.push(l.getOrCreateScale(k,p,s))}),I.some(function(k){return k.type===A.StyleScaleType.VARIABLE})?(_.type=A.StyleScaleType.VARIABLE,I.forEach(function(k){if(!_.callback){var J;if(_.values&&_.values!=="text"){var X;if(((X=k.option)===null||X===void 0?void 0:X.type)==="linear"&&_.values.length>2){var ve=k.scale.ticks(_.values.length);T==="color"&&k.scale.domain(ve)}k.scale.range(_.values)}else((J=k.option)===null||J===void 0?void 0:J.type)==="cat"&&k.scale.range(k.option.domain)}})):(_.type=A.StyleScaleType.CONSTANT,_.defaultValues=I.map(function(k,J){return k.scale(_.names[J])})),_.scalers=I.map(function(k){return{field:k.field,func:k.scale,option:k.option}}),p.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var p,_=[a,s.name].join("_"),T=(p=s.scale)===null||p===void 0?void 0:p.values,I=this.createScale(a,s.name,T,l);return I}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:so()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,p){var _,T,I=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===a?this.scaleOptions[s]:this.scaleOptions[a],k={field:a,scale:void 0,type:A.StyleScaleType.VARIABLE,option:I};if(!p||!p.length)return I&&I.type?k.scale=this.createDefaultScale(I):(k.scale=It([a]),k.type=A.StyleScaleType.CONSTANT),k;var J=(T=p.find(function(Fe){return!qr()(Fe[a])}))===null||T===void 0?void 0:T[a];if(this.isNumber(a)||qr()(J)&&!I)k.scale=It([a]),k.type=A.StyleScaleType.CONSTANT;else{var X=I&&I.type||this.getDefaultType(J);l==="text"&&(X=A.ScaleTypes.CAT);var ve=this.createDefaultScaleConfig(X,a,p);Object.assign(ve,I),k.scale=this.createDefaultScale(ve),k.option=ve}return k}},{key:"getDefaultType",value:function(a){var s=A.ScaleTypes.LINEAR;return typeof a=="string"&&(s=Zm.test(a)?A.ScaleTypes.TIME:A.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var p={type:a},_=(l==null?void 0:l.map(function(T){return T[s]}))||[];return a!==A.ScaleTypes.CAT&&a!==A.ScaleTypes.QUANTILE?p.domain=ui(_):a===A.ScaleTypes.CAT?p.domain=pn()(_):a===A.ScaleTypes.QUANTILE&&(p.domain=_),p}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,p=jm[s]();return l&&p.domain(l),p}}]),n}(),tv=(0,ti.Z)(Nd.prototype,"configService",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nd))||ev),rv,nv,iv,av,gd,ov,sv;function uv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Gm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?uv(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):uv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Hm=(rv=(0,Et.b2)(),nv=(0,Et.f3)(A.vK.ICameraService),iv=(0,Et.f3)(A.vK.IRendererService),rv(av=(gd=function(){function n(){(0,K.Z)(this,n),(0,ai.Z)(this,"cameraService",ov,this),(0,ai.Z)(this,"rendererService",sv,this)}return(0,W.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(Gm({},a.layerModel.getAnimateUniforms()))})})}}]),n}(),ov=(0,ti.Z)(gd.prototype,"cameraService",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sv=(0,ti.Z)(gd.prototype,"rendererService",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd))||av),lv,cv,Wm=(lv=(0,Et.b2)(),lv(cv=function(){function n(){(0,K.Z)(this,n)}return(0,W.Z)(n,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),n}())||cv),fv,hv,Xm=(fv=(0,Et.b2)(),fv(hv=function(){function n(){(0,K.Z)(this,n)}return(0,W.Z)(n,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,p=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(p)},100)})}}]),n}())||hv),pv,dv;function vv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function jp(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?vv(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):vv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var mv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},Ym={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Km={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},$m={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},h0=null;function Jm(n){var c={u_DirectionalLights:new Array(3).fill(jp({},Km)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(jp({},$m)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[Ym]),n.forEach(function(a,s){var l=a.type,p=l===void 0?"directional":l,_=(0,ba.Z)(a,["type"]),T=mv[p].lights,I=mv[p].num,k=c[I];c[T][k]=jp(jp({},c[T][k]),_),c[I]++}),c}var Qm=(pv=(0,Et.b2)(),pv(dv=function(){function n(){(0,K.Z)(this,n)}return(0,W.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(p){return p.addUniforms(jp({},Jm()))})})}}]),n}())||dv),yv,gv,_d={NONE:0,ENCODE:1,HIGHLIGHT:2},qm=(yv=(0,Et.b2)(),yv(gv=function(){function n(){(0,K.Z)(this,n)}return(0,W.Z)(n,[{key:"apply",value:function(a,s){var l=s.rendererService,p=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;p.registerStyleAttribute({name:"pickingColor",type:A.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:A.gl.FLOAT},size:3,update:function(k,J){var X=k.id;return T?(0,rt.Z6)(X):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;T&&a.isVisible()&&a.models.forEach(function(I){return I.addUniforms({u_PickingStage:_d.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),T=_.enablePicking;T&&a.isVisible()&&a.models.forEach(function(I){return I.addUniforms({u_PickingStage:_d.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var T=a.getLayerConfig(),I=T.highlightColor,k=typeof I=="string"?(0,rt.CI)(I):I||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,rt.W0)(new Uint8Array(_))}),a.models.forEach(function(J){return J.addUniforms({u_PickingStage:_d.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:k.map(function(X){return X*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var T=a.getLayerConfig(),I=T.selectColor,k=typeof I=="string"?(0,rt.CI)(I):I||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,rt.W0)(new Uint8Array(_))}),a.models.forEach(function(J){return J.addUniforms({u_PickingStage:_d.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:k.map(function(X){return X*255})})})})}}]),n}())||gv),_v,xv,ey=(_v=(0,Et.b2)(),_v(xv=function(){function n(){(0,K.Z)(this,n)}return(0,W.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(p)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:A.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:A.gl.FLOAT},size:3,update:function(l,p,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),a.registerStyleAttribute({name:"filter",type:A.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(l,p){var _=l.filter;return _?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:A.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:4,update:function(l,p){var _=l.color;return!_||!_.length?[1,1,1,1]:_}}}),a.registerStyleAttribute({name:"vertexId",type:A.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:1,update:function(l,p,_,T){return[p]}}})}}]),n}())||xv),bv,Sv,Ev,wv,Cv,Av,up,Tv,Pv,Mv,Iv,ty=(bv=(0,Et.b2)(),Sv=(0,Et.f3)(A.vK.ICameraService),Ev=(0,Et.f3)(A.vK.ICoordinateSystemService),wv=(0,Et.f3)(A.vK.IRendererService),Cv=(0,Et.f3)(A.vK.IMapService),bv(Av=(up=function(){function n(){(0,K.Z)(this,n),(0,ai.Z)(this,"cameraService",Tv,this),(0,ai.Z)(this,"coordinateSystemService",Pv,this),(0,ai.Z)(this,"rendererService",Mv,this),(0,ai.Z)(this,"mapService",Iv,this)}return(0,W.Z)(n,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(p=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var T=s.rendererService.getViewportSize(),I=T.width,k=T.height;a.models.forEach(function(J){var X;J.addUniforms((X={},(0,L.Z)(X,A.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,L.Z)(X,A.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,L.Z)(X,A.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,L.Z)(X,A.CameraUniform.Zoom,s.cameraService.getZoom()),(0,L.Z)(X,A.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,L.Z)(X,A.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,L.Z)(X,A.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,L.Z)(X,A.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,L.Z)(X,A.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,L.Z)(X,A.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,L.Z)(X,A.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,L.Z)(X,A.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,L.Z)(X,A.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,L.Z)(X,A.CoordinateUniform.Mvp,p),(0,L.Z)(X,"u_SceneCenterMKT",_),(0,L.Z)(X,"u_ViewportSize",[I,k]),(0,L.Z)(X,"u_DevicePixelRatio",window.devicePixelRatio),(0,L.Z)(X,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,L.Z)(X,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),X))})})}}]),n}(),Tv=(0,ti.Z)(up.prototype,"cameraService",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=(0,ti.Z)(up.prototype,"coordinateSystemService",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mv=(0,ti.Z)(up.prototype,"rendererService",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=(0,ti.Z)(up.prototype,"mapService",[Cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up))||Av),Ov,Lv,ry=(Ov=(0,Et.b2)(),Ov(Lv=function(){function n(){(0,K.Z)(this,n)}return(0,W.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),n}())||Lv),Rv,kv,ny=(Rv=(0,Et.b2)(),Rv(kv=function(){function n(){(0,K.Z)(this,n)}return(0,W.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:p})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:p})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=s.styleAttributeService,p=l.getLayerStyleAttributes()||[],_=l.getLayerStyleAttribute("filter"),T=l.getLayerStyleAttribute("shape");if(_&&_.needRegenerateVertices||T&&T.needRegenerateVertices){a.layerModelNeedUpdate=!0,p.forEach(function(I){return I.needRegenerateVertices=!1});return}p.filter(function(I){return I.needRegenerateVertices}).forEach(function(I){l.updateAttributeByFeatureRange(I.name,a.getEncodedData(),I.featureRange.startIndex,I.featureRange.endIndex),I.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(a,s){var l=s.styleAttributeService,p=l.getLayerStyleAttributes()||[];p.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){l.updateAttributeByFeatureRange(_.name,a.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}}]),n}())||kv);A.nC.bind(A.vK.ILayerPlugin).to(Qr).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(ey).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Vm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(qs).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Xm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(ny).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(ry).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Yo).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(ty).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Hm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Qm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(qm).inRequestScope(),A.nC.bind(A.vK.ILayerPlugin).to(Wm).inRequestScope();var p0="2.5.12";function Dv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function d0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Dv(Object(a),!0).forEach(function(s){iy(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Dv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function iy(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function v0(n,c){return uy(n)||sy(n,c)||oy(n,c)||ay()}function ay(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oy(n,c){if(!!n){if(typeof n=="string")return Fv(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Fv(n,c)}}function Fv(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function sy(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){p=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw T}}return s}}function uy(n){if(Array.isArray(n))return n}var m0=null,y0=null,Bv,zd,Nv;function zv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Uv(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?zv(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):zv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var ly=(Bv=(0,A.yT)(A.vK.IGlobalConfigService),zd=function(){function n(c){(0,K.Z)(this,n),(0,ai.Z)(this,"configService",Nv,this),(0,L.Z)(this,"config",void 0),this.config=c}return(0,W.Z)(n,[{key:"setContainer",value:function(a,s){a.bind(A.vK.MapConfig).toConstantValue(Uv(Uv({},this.config),{},{id:s})),a.bind(A.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),Nv=(0,ti.Z)(zd.prototype,"configService",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd),cy=E(6158),fy=E.n(cy),Ud;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP"})(Ud||(Ud={}));function Vp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function xd(n,c){var a=zu.fF([],c,n);return zu.bA(a,a,1/a[3]),a}function g0(n,c){var a=n%c;return a<0?c+a:a}function _0(n,c,a){return a*c+(1-a)*n}function Ah(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var Kc=Math.PI,Zv=Kc/4,Df=Kc/180,jv=180/Kc,Zd=512,jd=4003e4,hy=1.5;function Vv(n){return Math.pow(2,n)}function py(n){return Math.log2(n)}function bd(n,c){var a=(0,Q.Z)(n,2),s=a[0],l=a[1];Ah(Number.isFinite(s)&&Number.isFinite(c)),Ah(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=Zd;var p=s*Df,_=l*Df,T=c*(p+Kc)/(2*Kc),I=c*(Kc-Math.log(Math.tan(Zv+_*.5)))/(2*Kc);return[T,I]}function Vd(n,c){var a=(0,Q.Z)(n,2),s=a[0],l=a[1];c*=Zd;var p=s/c*(2*Kc)-Kc,_=2*(Math.atan(Math.exp(Kc-l/c*(2*Kc)))-Zv);return[p*jv,_*jv]}function x0(n){var c=n.latitude;assert(Number.isFinite(c));var a=Math.cos(c*Df);return py(jd*a)-9}function Gv(n){var c=n.latitude,a=n.longitude,s=n.zoom,l=n.scale,p=n.highPrecision,_=p===void 0?!1:p;l=l!==void 0?l:Vv(s),Ah(Number.isFinite(c)&&Number.isFinite(a)&&Number.isFinite(l));var T={},I=Zd*l,k=Math.cos(c*Df),J=I/360,X=J/k,ve=I/jd/k;if(T.pixelsPerMeter=[ve,-ve,ve],T.metersPerPixel=[1/ve,-1/ve,1/ve],T.pixelsPerDegree=[J,-X,ve],T.degreesPerPixel=[1/J,-1/X,1/ve],_){var Fe=Df*Math.tan(c*Df)/k,ft=J*Fe/2,Ot=I/jd*Fe,mr=Ot/X*ve;T.pixelsPerDegree2=[0,-ft,Ot],T.pixelsPerMeter2=[mr,0,mr]}return T}function b0(n,c){var a=_slicedToArray(n,3),s=a[0],l=a[1],p=a[2],_=_slicedToArray(c,3),T=_[0],I=_[1],k=_[2],J=1,X=Gv({longitude:s,latitude:l,scale:J,highPrecision:!0}),ve=X.pixelsPerMeter,Fe=X.pixelsPerMeter2,ft=bd(n,J);ft[0]+=T*(ve[0]+Fe[0]*I),ft[1]+=I*(ve[1]+Fe[1]*I);var Ot=Vd(ft,J),mr=(p||0)+(k||0);return Number.isFinite(p)||Number.isFinite(k)?[Ot[0],Ot[1],mr]:Ot}function dy(n){var c=n.height,a=n.pitch,s=n.bearing,l=n.altitude,p=n.center,_=p===void 0?null:p,T=n.flipY,I=T===void 0?!1:T,k=Vp();return Ua.translate(k,k,[0,0,-l]),Ua.scale(k,k,[1,1,1/c]),Ua.rotateX(k,k,-a*Df),Ua.rotateZ(k,k,s*Df),I&&Ua.scale(k,k,[1,-1,1]),_&&Ua.translate(k,k,ei.negate([],_)),k}function vy(n){var c=n.width,a=n.height,s=n.altitude,l=s===void 0?hy:s,p=n.pitch,_=p===void 0?0:p,T=n.nearZMultiplier,I=T===void 0?1:T,k=n.farZMultiplier,J=k===void 0?1:k,X=_*Df,ve=Math.atan(.5/l),Fe=Math.sin(ve)*l/Math.sin(Math.PI/2-X-ve),ft=Math.cos(Math.PI/2-X)*Fe+l;return{fov:2*Math.atan(a/2/l),aspect:c/a,focalDistance:l,near:I,far:ft*J}}function yy(n){var c=n.width,a=n.height,s=n.pitch,l=n.altitude,p=n.nearZMultiplier,_=n.farZMultiplier,T=vy({width:c,height:a,altitude:l,pitch:s,nearZMultiplier:p,farZMultiplier:_}),I=T.fov,k=T.aspect,J=T.near,X=T.far,ve=Ua.perspective([],I,k,J,X);return ve}function gy(n,c){var a=(0,Q.Z)(n,3),s=a[0],l=a[1],p=a[2],_=p===void 0?0:p;return Ah(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(_)),xd(c,[s,l,_,1])}function Hv(n,c){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,Q.Z)(n,3),l=s[0],p=s[1],_=s[2];if(Ah(Number.isFinite(l)&&Number.isFinite(p),"invalid pixel coordinate"),Number.isFinite(_)){var T=xd(c,[l,p,_,1]);return T}var I=xd(c,[l,p,0,1]),k=xd(c,[l,p,1,1]),J=I[2],X=k[2],ve=J===X?0:((a||0)-J)/(X-J);return S.lerp([],I,k,ve)}var Wv=Vp(),_y=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=c.width,s=c.height,l=c.viewMatrix,p=l===void 0?Wv:l,_=c.projectionMatrix,T=_===void 0?Wv:_;(0,K.Z)(this,n),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=p,this.projectionMatrix=T;var I=Vp();Ua.multiply(I,I,this.projectionMatrix),Ua.multiply(I,I,this.viewMatrix),this.viewProjectionMatrix=I;var k=Vp();Ua.scale(k,k,[this.width/2,-this.height/2,1]),Ua.translate(k,k,[1,-1,0]),Ua.multiply(k,k,this.viewProjectionMatrix);var J=Ua.invert(Vp(),k);if(!J)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=k,this.pixelUnprojectionMatrix=J,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,W.Z)(n,[{key:"equals",value:function(a){return a instanceof n?a.width===this.width&&a.height===this.height&&Ua.equals(a.projectionMatrix,this.projectionMatrix)&&Ua.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,_=this.projectPosition(a),T=gy(_,this.pixelProjectionMatrix),I=(0,Q.Z)(T,2),k=I[0],J=I[1],X=p?J:this.height-J;return a.length===2?[k,X]:[k,X,T[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,_=s.targetZ,T=(0,Q.Z)(a,3),I=T[0],k=T[1],J=T[2],X=p?k:this.height-k,ve=_&&_*this.pixelsPerMeter,Fe=Hv([I,X,J],this.pixelUnprojectionMatrix,ve),ft=this.unprojectPosition(Fe),Ot=(0,Q.Z)(ft,3),mr=Ot[0],Sr=Ot[1],Zr=Ot[2];return Number.isFinite(J)?[mr,Sr,Zr]:Number.isFinite(_)?[mr,Sr,_]:[mr,Sr]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,Q.Z)(s,2),p=l[0],_=l[1],T=(a[2]||0)*this.pixelsPerMeter;return[p,_,T]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,Q.Z)(s,2),p=l[0],_=l[1],T=(a[2]||0)/this.pixelsPerMeter;return[p,_,T]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),n}();function xy(n){var c=n.width,a=n.height,s=n.bounds,l=n.minExtent,p=l===void 0?0:l,_=n.maxZoom,T=_===void 0?24:_,I=n.padding,k=I===void 0?0:I,J=n.offset,X=J===void 0?[0,0]:J,ve=(0,Q.Z)(s,2),Fe=(0,Q.Z)(ve[0],2),ft=Fe[0],Ot=Fe[1],mr=(0,Q.Z)(ve[1],2),Sr=mr[0],Zr=mr[1];if(Number.isFinite(k)){var _n=k;k={top:_n,bottom:_n,left:_n,right:_n}}else Ah(Number.isFinite(k.top)&&Number.isFinite(k.bottom)&&Number.isFinite(k.left)&&Number.isFinite(k.right));var kn=new Xv({width:c,height:a,longitude:0,latitude:0,zoom:0}),Yn=kn.project([ft,Zr]),Ei=kn.project([Sr,Ot]),Qn=[Math.max(Math.abs(Ei[0]-Yn[0]),p),Math.max(Math.abs(Ei[1]-Yn[1]),p)],Ti=[c-k.left-k.right-Math.abs(X[0])*2,a-k.top-k.bottom-Math.abs(X[1])*2];Ah(Ti[0]>0&&Ti[1]>0);var sa=Ti[0]/Qn[0],ma=Ti[1]/Qn[1],vi=(k.right-k.left)/2/sa,Oa=(k.bottom-k.top)/2/ma,qa=[(Ei[0]+Yn[0])/2+vi,(Ei[1]+Yn[1])/2+Oa],wu=kn.unproject(qa),cp=kn.zoom+Math.log2(Math.abs(Math.min(sa,ma)));return{longitude:wu[0],latitude:wu[1],zoom:Math.min(cp,T)}}var Xv=function(n){(0,Ne.Z)(c,n);function c(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,p=s.height,_=s.latitude,T=_===void 0?0:_,I=s.longitude,k=I===void 0?0:I,J=s.zoom,X=J===void 0?0:J,ve=s.pitch,Fe=ve===void 0?0:ve,ft=s.bearing,Ot=ft===void 0?0:ft,mr=s.altitude,Sr=mr===void 0?1.5:mr,Zr=s.nearZMultiplier,_n=s.farZMultiplier;(0,K.Z)(this,c),l=l||1,p=p||1;var kn=Vv(X);Sr=Math.max(.75,Sr);var Yn=bd([k,T],kn);Yn[2]=0;var Ei=yy({width:l,height:p,pitch:Fe,bearing:Ot,altitude:Sr,nearZMultiplier:Zr||1/p,farZMultiplier:_n||1.01}),Qn=dy({height:p,center:Yn,pitch:Fe,bearing:Ot,altitude:Sr,flipY:!0});return a=(0,Ye.Z)(this,(0,Je.Z)(c).call(this,{width:l,height:p,viewMatrix:Qn,projectionMatrix:Ei})),a.latitude=T,a.longitude=k,a.zoom=X,a.pitch=Fe,a.bearing=Ot,a.altitude=Sr,a.scale=kn,a.center=Yn,a.pixelsPerMeter=Gv((0,N.Z)((0,N.Z)(a))).pixelsPerMeter[2],Object.freeze((0,N.Z)((0,N.Z)(a))),a}return(0,W.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return bd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Vd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,p=s.pos,_=Hv(p,this.pixelUnprojectionMatrix),T=bd(l,this.scale),I=S.add([],T,S.negate([],_)),k=S.add([],this.center,I);return Vd(k,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,p=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:p})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=this.width,_=this.height,T=xy(Object.assign({width:p,height:_,bounds:s},l)),I=T.longitude,k=T.latitude,J=T.zoom;return new c({width:p,height:_,longitude:I,latitude:k,zoom:J})}}]),c}(_y),by=function(){function n(){(0,K.Z)(this,n),(0,L.Z)(this,"viewport",void 0)}return(0,W.Z)(n,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,p=a.pitch,_=a.bearing,T=a.viewportHeight,I=a.viewportWidth;this.viewport=new Xv({width:I,height:T,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:p,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),n}(),Yv={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Kv,$v,Jv,Qv,qv,em,lp,tm,rm,nm,im;function am(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Sy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?am(Object(a),!0).forEach(function(s){(0,L.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):am(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ey(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}Ey(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=fy();var om={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},wy=0,Cy=12,sm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",Ay=(Kv=(0,Et.b2)(),$v=(0,Et.f3)(A.vK.MapConfig),Jv=(0,Et.f3)(A.vK.IGlobalConfigService),Qv=(0,Et.f3)(A.vK.ICoordinateSystemService),qv=(0,Et.f3)(A.vK.IEventEmitter),Kv(em=(lp=function(){function n(){var c=this;(0,K.Z)(this,n),(0,L.Z)(this,"version",Ud.MAPBOX),(0,L.Z)(this,"map",void 0),(0,ai.Z)(this,"config",tm,this),(0,ai.Z)(this,"configService",rm,this),(0,ai.Z)(this,"coordinateSystemService",nm,this),(0,ai.Z)(this,"eventEmitter",im,this),(0,L.Z)(this,"viewport",void 0),(0,L.Z)(this,"markerContainer",void 0),(0,L.Z)(this,"cameraChangedCallback",void 0),(0,L.Z)(this,"$mapContainer",void 0),(0,L.Z)(this,"handleCameraChanged",function(){var a=c.map.getCenter().wrap(),s=a.lat,l=a.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var p=c.config.offsetZoom,_=p===void 0?Cy:p;c.viewport.getZoom()>_?c.coordinateSystemService.setCoordinateSystem(A.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(A.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,W.Z)(n,[{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=rt.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){A.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(om[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(om[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a){this.panTo(a)}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),p=l.x,_=p===void 0?0:p,T=l.y,I=T===void 0?0:T,k=l.z,J=k===void 0?0:k;return{x:_,y:I,z:J}}},{key:"getModelMatrix",value:function(a,s,l){var p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},T=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),I=T.meterInMercatorCoordinateUnits(),k=Ua.create();return Ua.translate(k,k,ei.fromValues(T.x-_.x,T.y-_.y,T.z||0-_.z)),Ua.scale(k,k,ei.fromValues(I*p[0],-I*p[1],I*p[2])),Ua.rotateX(k,k,l[0]),Ua.rotateY(k,k,l[1]),Ua.rotateZ(k,k,l[2]),k}},{key:"init",value:function(){var c=(0,yt.Z)(jt().mark(function s(){var l,p,_,T,I,k,J,X,ve,Fe,ft,Ot,mr;return jt().wrap(function(Zr){for(;;)switch(Zr.prev=Zr.next){case 0:l=this.config,p=l.id,_=p===void 0?"map":p,T=l.attributionControl,I=T===void 0?!1:T,k=l.style,J=k===void 0?"light":k,X=l.token,ve=X===void 0?sm:X,Fe=l.rotation,ft=Fe===void 0?0:Fe,Ot=l.mapInstance,mr=(0,ba.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new by,!Ot&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),ve===sm&&J!=="blank"&&!window.mapboxgl.accessToken&&!Ot&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Ot&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=ve),Ot?(this.map=Ot,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(Sy({container:this.$mapContainer,style:this.getMapStyle(J),attributionControl:I,bearing:ft},mr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Zr.stop()}},s,this)}));function a(){return c.apply(this,arguments)}return a}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[a].concat(p))}},{key:"once",value:function(a){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[a].concat(p))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+wy++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:Yv[a]?Yv[a]:a}}]),n}(),tm=(0,ti.Z)(lp.prototype,"config",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rm=(0,ti.Z)(lp.prototype,"configService",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm=(0,ti.Z)(lp.prototype,"coordinateSystemService",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im=(0,ti.Z)(lp.prototype,"eventEmitter",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lp))||em);function Ty(n){var c=Py();return function(){var s=(0,Je.Z)(n),l;if(c){var p=(0,Je.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,Ye.Z)(this,l)}}function Py(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function My(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}My(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Iy=function(n){(0,Ne.Z)(a,n);var c=Ty(a);function a(){return(0,K.Z)(this,a),c.apply(this,arguments)}return(0,W.Z)(a,[{key:"getServiceConstructor",value:function(){return Ay}}]),a}(ly);function um(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function lm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?um(Object(a),!0).forEach(function(s){Oy(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):um(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Oy(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Ly(n,c){return Fy(n)||Dy(n,c)||ky(n,c)||Ry()}function Ry(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ky(n,c){if(!!n){if(typeof n=="string")return cm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return cm(n,c)}}function cm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Dy(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){p=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw T}}return s}}function Fy(n){if(Array.isArray(n))return n}var By=le.memo(function(n){var c=n.style,a=n.className,s=n.map,l=n.option,p=n.onSceneLoaded,_=(0,le.createRef)(),T=(0,le.useState)(),I=Ly(T,2),k=I[0],J=I[1];return(0,le.useEffect)(function(){var X=new ca(lm(lm({id:_.current},l),{},{map:new Iy(s)}));return X.on("loaded",function(){J(X),p&&p(X)}),function(){X.destroy()}},[]),(0,le.useEffect)(function(){k&&s.style&&k.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,le.useEffect)(function(){k&&s.zoom&&k.setZoom(s.zoom)},[s.zoom]),(0,le.useEffect)(function(){k&&s.center&&k.setCenter(s.center)},[JSON.stringify(s.center)]),(0,le.useEffect)(function(){k&&s.pitch!==void 0&&k.setPitch(s.pitch||0)},[s.pitch]),(0,le.useEffect)(function(){k&&s.rotation&&k.setRotation(s.rotation)},[s.rotation]),le.createElement(C.Provider,{value:k},(0,le.createElement)("div",{ref:_,style:c,className:a},k&&n.children))}),Ny=By;function fm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function S0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?fm(Object(a),!0).forEach(function(s){zy(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):fm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function zy(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function E0(n,c){return Vy(n)||jy(n,c)||Zy(n,c)||Uy()}function Uy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Zy(n,c){if(!!n){if(typeof n=="string")return hm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return hm(n,c)}}function hm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function jy(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){p=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw T}}return s}}function Vy(n){if(Array.isArray(n))return n}var w0=null,C0=null;function pm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function A0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?pm(Object(a),!0).forEach(function(s){Gy(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):pm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Gy(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function T0(n,c){return Yy(n)||Xy(n,c)||Wy(n,c)||Hy()}function Hy(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wy(n,c){if(!!n){if(typeof n=="string")return dm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dm(n,c)}}function dm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Xy(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){p=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw T}}return s}}function Yy(n){if(Array.isArray(n))return n}var P0=null,M0=null;function I0(n,c){return Qy(n)||Jy(n,c)||$y(n,c)||Ky()}function Ky(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function $y(n,c){if(!!n){if(typeof n=="string")return vm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return vm(n,c)}}function vm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Jy(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){p=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw T}}return s}}function Qy(n){if(Array.isArray(n))return n}var O0=null,L0=null;function mm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function R0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?mm(Object(a),!0).forEach(function(s){qy(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):mm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function qy(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function k0(n,c){if(n==null)return{};var a=eg(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function eg(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var D0=null,ym=E(73935);function tg(n,c){return ag(n)||ig(n,c)||ng(n,c)||rg()}function rg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ng(n,c){if(!!n){if(typeof n=="string")return gm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return gm(n,c)}}function gm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function ig(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){p=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw T}}return s}}function ag(n){if(Array.isArray(n))return n}var og=le.useEffect,sg=le.useState;function F0(n){var c=n.className,a=n.style,s=n.children,l=n.position,p=useSceneValue(),_=sg(function(){return document.createElement("div")}),T=tg(_,1),I=T[0];return og(function(){var k=new Control({position:l});return k.onAdd=function(){if(c&&(I.className=c),a){var J=Object.keys(a).map(function(X){return"".concat(X,":").concat(a[X])}).join(";");I.style.cssText=J}return I},p.addControl(k),function(){p.removeControl(k)}},[]),createPortal(s,I)}var _m=(0,le.createContext)({});function B0(){return useContext(_m)}var ug=le.useEffect,lg=le.memo(function(c){var a=c.layer,s=c.active;return ug(function(){a.active(s.option)},[JSON.stringify(s)]),null}),cg=le.useEffect,fg=le.memo(function(c){var a=c.layer,s=c.animate;return cg(function(){a.animate(s)},[JSON.stringify(s)]),null}),hg=le.useEffect,pg=le.memo(function(c){var a=c.layer,s=c.color;return hg(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),dg=le.useEffect,vg=le.memo(function(c){var a=c.layer,s=c.filter;return dg(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),mg=le.useEffect,yg=le.memo(function(c){var a=c.layer,s=c.scale;return mg(function(){a.scale(s.values)},[s.values]),null}),gg=le.useEffect,_g=le.memo(function(c){var a=c.layer,s=c.select;return gg(function(){a.select(s.option)},[JSON.stringify(s)]),null}),xg=le.useEffect,bg=le.memo(function(c){var a=c.layer,s=c.shape;return xg(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Sg=le.useEffect,Eg=le.memo(function(c){var a=c.layer,s=c.size;return Sg(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),wg=["data"];function Cg(n,c){if(n==null)return{};var a=Ag(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function Ag(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var Tg=le.useEffect,Pg=le.memo(function(c){var a=c.layer,s=c.source,l=s.data,p=Cg(s,wg);return Tg(function(){a.inited?a.setData(l,p):a.source(l,p),p.autoFit&&a.fitBounds(p&&p.fitBoundsOptions)},[l,JSON.stringify(p)]),null}),Mg=le.useEffect,Ig=le.memo(function(c){var a=c.layer,s=c.style;return Mg(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function Og(n,c){return Dg(n)||kg(n,c)||Rg(n,c)||Lg()}function Lg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Rg(n,c){if(!!n){if(typeof n=="string")return xm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xm(n,c)}}function xm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function kg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,T;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(I){p=!0,T=I}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw T}}return s}}function Dg(n){if(Array.isArray(n))return n}var Gp=le.useEffect,Fg=le.useState;function bm(n,c){var a=c.source,s=c.color,l=c.shape,p=c.style,_=c.size,T=c.scale,I=c.active,k=c.select,J=c.filter,X=c.animate,ve=c.options,Fe=c.onLayerLoaded,ft=d(),Ot=Fg(function(){var Zr;switch(n){case"polygonLayer":Zr=new qt(ve);break;case"lineLayer":Zr=new Qs(ve);break;case"pointLayer":Zr=new ri(ve);break;case"heatmapLayer":Zr=new Ns(ve);break;case"rasterLayer":Zr=new ao(ve);break;case"imageLayer":Zr=new vn(ve);break;case"citybuildingLayer":Zr=new mc(ve);break;default:Zr=new qt(ve)}return Zr.on("inited",function(){Fe&&Fe(Zr,ft)}),Zr}),mr=Og(Ot,1),Sr=mr[0];return Gp(function(){return ft.addLayer(Sr),function(){ft.removeLayer(Sr)}},[]),Gp(function(){Sr.inited&&ve&&Sr.updateLayerConfig(ve)},[ve==null?void 0:ve.minZoom,ve==null?void 0:ve.maxZoom,ve==null?void 0:ve.visible]),Gp(function(){Sr.inited&&(ve==null?void 0:ve.zIndex)&&Sr.setIndex(ve.zIndex)},[ve==null?void 0:ve.zIndex]),Gp(function(){Sr.inited&&(ve==null?void 0:ve.blend)&&Sr.setBlend(ve.blend)},[ve==null?void 0:ve.blend]),Gp(function(){ft.render()}),le.createElement(_m.Provider,{value:Sr},le.createElement(Pg,{layer:Sr,source:a}),T&&le.createElement(yg,{layer:Sr,scale:T}),s&&le.createElement(pg,{layer:Sr,color:s}),_&&le.createElement(Eg,{layer:Sr,size:_}),l&&le.createElement(bg,{layer:Sr,shape:l}),p&&le.createElement(Ig,{layer:Sr,style:p}),I&&le.createElement(lg,{layer:Sr,active:I}),k&&le.createElement(_g,{layer:Sr,select:k}),J&&le.createElement(vg,{layer:Sr,filter:J}),X&&le.createElement(fg,{layer:Sr,animate:X}),c.children)}var N0=null,z0=null,Bg=le.memo(function(c){return bm("pointLayer",c)}),Ng=le.memo(function(c){return bm("heatmapLayer",c)}),U0=null,Z0=null,j0=null,V0=le.useEffect,G0=null,H0=null;function Sd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Sd=function(a){return typeof a}:Sd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Sd(n)}function Sm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ed(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Sm(Object(a),!0).forEach(function(s){zg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Sm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function zg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Ug(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Em(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function Zg(n,c,a){return c&&Em(n.prototype,c),a&&Em(n,a),n}function jg(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Gd(n,c)}function Gd(n,c){return Gd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Gd(n,c)}function Vg(n){var c=Wg();return function(){var s=wd(n),l;if(c){var p=wd(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return Gg(this,l)}}function Gg(n,c){return c&&(Sd(c)==="object"||typeof c=="function")?c:Hg(n)}function Hg(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Wg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function wd(n){return wd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},wd(n)}var W0=function(n){jg(a,n);var c=Vg(a);function a(s){var l;return Ug(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return Zg(a,[{key:"componentDidMount",value:function(){var l,p=this.props,_=p.lnglat,T=p.children,I=p.option,k=p.lngLat,J=new Ze(Ed(Ed({},I),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));_&&J.setLnglat(_),k&&J.setLnglat(k),T&&J.setDOMContent(this.el),this.popup=J,this.scene.addPopup(J)}},{key:"componentDidUpdate",value:function(l){var p,_,T,I,k,J,X=Array.isArray(l.lnglat)?l.lnglat:[l==null||(p=l.lnglat)===null||p===void 0?void 0:p.lng,l==null||(_=l.lnglat)===null||_===void 0?void 0:_.lat],ve=Array.isArray(this.props.lnglat)?this.props.lnglat:[(T=this.props)===null||T===void 0||(I=T.lnglat)===null||I===void 0?void 0:I.lng,(k=this.props)===null||k===void 0||(J=k.lnglat)===null||J===void 0?void 0:J.lat],Fe=X.toString()!==ve.toString();if(Fe){var ft;this.popup.remove(),this.popup=new Ze(Ed(Ed({},this.props.option),{},{stopPropagation:(ft=this.props.option)===null||ft===void 0?void 0:ft.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return le.createElement(C.Consumer,{},function(p){return p&&(l.scene=p),(0,ym.createPortal)(l.props.children,l.el)})}}]),a}(le.PureComponent);function Cd(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Cd=function(a){return typeof a}:Cd=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Cd(n)}function Xg(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function wm(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function Yg(n,c,a){return c&&wm(n.prototype,c),a&&wm(n,a),n}function Kg(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Hd(n,c)}function Hd(n,c){return Hd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Hd(n,c)}function $g(n){var c=qg();return function(){var s=Ad(n),l;if(c){var p=Ad(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return Jg(this,l)}}function Jg(n,c){return c&&(Cd(c)==="object"||typeof c=="function")?c:Qg(n)}function Qg(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function qg(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Ad(n){return Ad=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Ad(n)}var X0=function(n){Kg(a,n);var c=$g(a);function a(s){var l;return Xg(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return Yg(a,[{key:"componentDidMount",value:function(){var l=this.props,p=l.lnglat,_=l.children,T=l.option,I=l.onMarkerLoaded,k=new kr(T);p&&k.setLnglat(p),_&&k.setElement(this.el),this.marker=k,I&&I(k),this.scene.addMarker(k)}},{key:"componentDidUpdate",value:function(l){var p,_=(l==null?void 0:l.lnglat.toString())!==((p=this.props)===null||p===void 0?void 0:p.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return le.createElement(C.Consumer,{},function(p){return p&&(l.scene=p),(0,ym.createPortal)(l.props.children,l.el)})}}]),a}(le.PureComponent),Y0=le.useEffect,K0=null,$0=null,J0=le.useEffect,Q0=null},4771:function(){},6901:function(Or,U,E){"use strict";E.d(U,{SO:function(){return le},z6:function(){return gt},a5:function(){return C},Z:function(){return Et},rQ:function(){return Dn},bV:function(){return Cr},zi:function(){return Hn},ds:function(){return nt},Ev:function(){return vt},oO:function(){return Lr},W0:function(){return Ur},Z6:function(){return nn},We:function(){return er},Cl:function(){return Jr},gJ:function(){return Ue},vP:function(){return Ze},yM:function(){return ie},yA:function(){return Br},CI:function(){return Vr}});var le={};E.r(le),E.d(le,{DPR:function(){return Ke},addClass:function(){return rt},create:function(){return Ye},empty:function(){return Tt},getClass:function(){return zt},getContainer:function(){return W},getViewPortScale:function(){return Ct},hasClass:function(){return Vt},printCanvas:function(){return dr},remove:function(){return Je},removeClass:function(){return Yt},setClass:function(){return tr},setTransform:function(){return yr},splitWords:function(){return N},triggerResize:function(){return ee},trim:function(){return L}});var C={};E.r(C),E.d(C,{getColumn:function(){return ce},getSatByColumn:function(){return ye},max:function(){return bi},mean:function(){return Ri},min:function(){return Ui},mode:function(){return Ii},statMap:function(){return Y},sum:function(){return Ji}});function d(z){var oe=131,me=137,Ae=0;z+="x";for(var se=Math.floor(9007199254740991/me),Ce=0;Ce<z.length;Ce++)Ae>se&&(Ae=Math.floor(Ae/me)),Ae=Ae*oe+z.charCodeAt(Ce);return Ae}function A(z){z=z.toString();for(var oe=5381,me=z.length;me;)oe=oe*33^z.charCodeAt(--me);return oe>>>0}var Q=E(28481),K=window.document.documentElement.style;function W(z){var oe=z;return typeof z=="string"&&(oe=document.getElementById(z)),oe}function L(z){return z.trim?z.trim():z.replace(/^\s+|\s+$/g,"")}function N(z){return L(z).split(/\s+/)}function Ne(z){if(!K)return z[0];for(var oe in z)if(z[oe]&&z[oe]in K)return z[oe];return z[0]}function Ye(z,oe,me){var Ae=document.createElement(z);return Ae.className=oe||"",me&&me.appendChild(Ae),Ae}function Je(z){var oe=z.parentNode;oe&&oe.removeChild(z)}function rt(z,oe){if(z.classList!==void 0)for(var me=N(oe),Ae=0,se=me.length;Ae<se;Ae++)z.classList.add(me[Ae]);else if(!Vt(z,oe)){var Ce=zt(z);tr(z,(Ce?Ce+" ":"")+oe)}}function Yt(z,oe){z.classList!==void 0?z.classList.remove(oe):tr(z,L((" "+zt(z)+" ").replace(" "+oe+" "," ")))}function Vt(z,oe){if(z.classList!==void 0)return z.classList.contains(oe);var me=zt(z);return me.length>0&&new RegExp("(^|\\s)"+oe+"(\\s|$)").test(me)}function tr(z,oe){z instanceof HTMLElement?z.className=oe:z.className.baseVal=oe}function zt(z){return z instanceof SVGElement&&(z=z.correspondingElement),z.className.baseVal===void 0?z.className:z.className.baseVal}function Tt(z){for(;z&&z.firstChild;)z.removeChild(z.firstChild)}var xt=Ne(["transform","WebkitTransform"]);function yr(z,oe){z.style[xt]=oe}function ee(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var z=window.document.createEvent("UIEvents");z.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(z)}}function dr(z){var oe=["padding: "+(z.height/2-8)+"px "+z.width/2+"px;","line-height: "+z.height+"px;","background-image: url("+z.toDataURL()+");"];console.log(`%c
`,oe.join(""))}function Ct(){var z,oe=document.querySelector('meta[name="viewport"]');if(!oe)return 1;var me=(z=oe.content)===null||z===void 0?void 0:z.split(","),Ae=me.find(function(se){var Ce=se.split("="),ct=(0,Q.Z)(Ce,2),xr=ct[0],Gt=ct[1];return xr==="initial-scale"});return Ae?Ae.split("=")[1]*1:1}var Ke=Ct()<1?1:window.devicePixelRatio,Dt=E(6610),Xe=E(5991),Ut=E(63349),_r=E(10379),ar=E(46070),zr=E(77608),fe=E(14665);function Re(z){return Function.toString.call(z).indexOf("[native code]")!==-1}var ge=E(51814);function _t(z,oe,me){return(0,ge.Z)()?_t=Reflect.construct:_t=function(se,Ce,ct){var xr=[null];xr.push.apply(xr,Ce);var Gt=Function.bind.apply(se,xr),Jt=new Gt;return ct&&(0,fe.Z)(Jt,ct.prototype),Jt},_t.apply(null,arguments)}function pt(z){var oe=typeof Map=="function"?new Map:void 0;return pt=function(Ae){if(Ae===null||!Re(Ae))return Ae;if(typeof Ae!="function")throw new TypeError("Super expression must either be null or a function");if(typeof oe!="undefined"){if(oe.has(Ae))return oe.get(Ae);oe.set(Ae,se)}function se(){return _t(Ae,arguments,(0,zr.Z)(this).constructor)}return se.prototype=Object.create(Ae.prototype,{constructor:{value:se,enumerable:!1,writable:!0,configurable:!0}}),(0,fe.Z)(se,Ae)},pt(z)}var Nt=E(96156);function Bt(z){var oe=kr();return function(){var Ae=(0,zr.Z)(z),se;if(oe){var Ce=(0,zr.Z)(this).constructor;se=Reflect.construct(Ae,arguments,Ce)}else se=Ae.apply(this,arguments);return(0,ar.Z)(this,se)}}function kr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(z){return!1}}var ln=function(z){(0,_r.Z)(me,z);var oe=Bt(me);function me(Ae,se,Ce){var ct;return(0,Dt.Z)(this,me),ct=oe.call(this,Ae),(0,Nt.Z)((0,Ut.Z)(ct),"status",void 0),(0,Nt.Z)((0,Ut.Z)(ct),"url",void 0),ct.status=se,ct.url=Ce,ct.name=ct.constructor.name,ct.message=Ae,ct}return(0,Xe.Z)(me,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),me}(pt(Error));function yn(z){var oe=new XMLHttpRequest;oe.open("GET",z.url,!0);for(var me in z.headers)z.headers.hasOwnProperty(me)&&oe.setRequestHeader(me,z.headers[me]);return oe.withCredentials=z.credentials==="include",oe}var Vi=function(oe,me){var Ae=yn(oe);return Ae.setRequestHeader("Accept","application/json"),Ae.onerror=function(){me(new Error(Ae.statusText))},Ae.onload=function(){if(Ae.status>=200&&Ae.status<300&&Ae.response){var se;try{se=JSON.parse(Ae.response)}catch(Ce){return me(Ce)}me(null,se)}else Ae.status===401?me(new ln("".concat(Ae.statusText),Ae.status,oe.url)):me(new ln(Ae.statusText,Ae.status,oe.url))},Ae.send(),Ae},nr=function(oe,me){var Ae=yn(oe);return Ae.responseType="arraybuffer",Ae.onerror=function(){me(new Error(Ae.statusText))},Ae.onload=function(){var se=Ae.response;if(se.byteLength===0&&Ae.status===200)return me(new Error("http status 200 returned without content."));Ae.status>=200&&Ae.status<300&&Ae.response?me(null,{data:se,cacheControl:Ae.getResponseHeader("Cache-Control"),expires:Ae.getResponseHeader("Expires")}):me(new ln(Ae.statusText,Ae.status,oe.url))},Ae.send(),Ae};function de(z){var oe=window.document.createElement("a");return oe.href=z,oe.protocol===window.document.location.protocol&&oe.host===window.document.location.host}var Te="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ue=function(oe,me){return nr(oe,function(Ae,se){if(Ae)me(Ae);else if(se){var Ce=new window.Image;Ce.crossOrigin="anonymous";var ct=window.URL||window.webkitURL;Ce.onload=function(){me(null,Ce),ct.revokeObjectURL(Ce.src)};var xr=new window.Blob([new Uint8Array(se.data)],{type:"image/png"});Ce.src=se.data.byteLength?ct.createObjectURL(xr):Te}})},Le=E(40271),Ft=2*Math.PI*6378137/2;function er(z){var oe=[Infinity,Infinity,-Infinity,-Infinity];return z.forEach(function(me){var Ae=me.coordinates;w(oe,Ae)}),oe}function w(z,oe){return Array.isArray(oe[0])?oe.forEach(function(me){w(z,me)}):(z[0]>oe[0]&&(z[0]=oe[0]),z[1]>oe[1]&&(z[1]=oe[1]),z[2]<oe[0]&&(z[2]=oe[0]),z[3]<oe[1]&&(z[3]=oe[1])),z}function Z(z,oe){return Ee(z,oe)}function Ee(z,oe){return Array.isArray(z[0])?z.map(function(me){return Ee(me,oe)}):oe(z)}function Ze(z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,me=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};z=jt(z,oe);var Ae=z[0],se=z[1],Ce=Ae*Ft/180,ct=Math.log(Math.tan((90+se)*Math.PI/360))/(Math.PI/180);return ct=ct*Ft/180,me.enable&&(Ce=Number(Ce.toFixed(me.decimal)),ct=Number(ct.toFixed(me.decimal))),z.length===3?[Ce,ct,z[2]]:[Ce,ct]}function Qe(z){var oe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,me=z[0],Ae=z[1],se=me/Ft*180,Ce=Ae/Ft*180;return Ce=180/Math.PI*(2*Math.atan(Math.exp(Ce*Math.PI/180))-Math.PI/2),oe!=null&&(se=Number(se.toFixed(oe)),Ce=Number(Ce.toFixed(oe))),z.length===3?[se,Ce,z[2]]:[se,Ce]}function yt(z){if(z==null)throw new Error("lng is required");return(z>180||z<-180)&&(z=z%360,z>180&&(z=-360+z),z<-180&&(z=360+z),z===0&&(z=0)),z}function St(z){if(z==null)throw new Error("lat is required");return(z>90||z<-90)&&(z=z%180,z>90&&(z=-180+z),z<-90&&(z=180+z),z===0&&(z=0)),z}function jt(z,oe){if(oe===!1)return z;var me=yt(z[0]),Ae=St(z[1]);return Ae>85&&(Ae=85),Ae<-85&&(Ae=-85),z.length===3?[me,Ae,z[2]]:[me,Ae]}function Et(z){var oe=85.0511287798,me=Math.max(Math.min(oe,z[1]),-oe),Ae=256<<20,se=Math.PI/180,Ce=z[0]*se,ct=me*se;ct=Math.log(Math.tan(Math.PI/4+ct/2));var xr=.5/Math.PI,Gt=.5,Jt=-.5/Math.PI;return se=.5,Ce=Ae*(xr*Ce+Gt),ct=Ae*(Jt*ct+se),[Math.floor(Ce),Math.floor(ct)]}function Qt(z){var oe=.5/Math.PI,me=.5,Ae=-.5/Math.PI,se=.5,Ce=256<<20,ct=_slicedToArray(z,2),xr=ct[0],Gt=ct[1];xr=(xr/Ce-me)/oe,Gt=(Gt/Ce-se)/Ae,Gt=(Math.atan(Math.pow(Math.E,Gt))-Math.PI/4)*2,se=Math.PI/180;var Jt=Gt/se,Rr=xr/se;return[Rr,Jt]}function ie(z,oe,me){var Ae=(0,Le.Ht)(oe[1]-z[1]),se=(0,Le.Ht)(oe[0]-z[0]),Ce=(0,Le.Ht)(z[1]),ct=(0,Le.Ht)(oe[1]),xr=Math.pow(Math.sin(Ae/2),2)+Math.pow(Math.sin(se/2),2)*Math.cos(Ce)*Math.cos(ct);return(0,Le.DL)(2*Math.atan2(Math.sqrt(xr),Math.sqrt(1-xr)),me="meters")}function sr(z){var oe=Math.PI/180,me=85.0511287798,Ae=6378137,se=Math.max(Math.min(me,z[1]),-me),Ce=Math.sin(se*oe),ct=Ae*z[0]*oe,xr=Ae*Math.log((1+Ce)/(1-Ce))/2;return[ct,xr]}function Br(z,oe){var me=Math.abs(z[1][1]-z[0][1])*oe,Ae=Math.abs(z[1][0]-z[0][0])*oe;return[[z[0][0]-Ae,z[0][1]-me],[z[1][0]+Ae,z[1][1]+me]]}function Lr(z,oe){return z[0][0]<=oe[0][0]&&z[0][1]<=oe[0][1]&&z[1][0]>=oe[1][0]&&z[1][1]>=oe[1][1]}function nt(z){return[[z[0],z[1]],[z[2],z[3]]]}var gt=function(){function z(){var oe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,me=arguments.length>1?arguments[1]:void 0;(0,Dt.Z)(this,z),(0,Nt.Z)(this,"limit",void 0),(0,Nt.Z)(this,"cache",void 0),(0,Nt.Z)(this,"destroy",void 0),(0,Nt.Z)(this,"order",void 0),this.limit=oe,this.destroy=me||this.defaultDestroy,this.order=[],this.clear()}return(0,Xe.Z)(z,[{key:"clear",value:function(){var me=this;this.order.forEach(function(Ae){me.delete(Ae)}),this.cache={},this.order=[]}},{key:"get",value:function(me){var Ae=this.cache[me];return Ae&&(this.deleteOrder(me),this.appendOrder(me)),Ae}},{key:"set",value:function(me,Ae){this.cache[me]?(this.delete(me),this.cache[me]=Ae,this.appendOrder(me)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[me]=Ae,this.appendOrder(me))}},{key:"delete",value:function(me){var Ae=this.cache[me];Ae&&(this.deleteCache(me),this.deleteOrder(me),this.destroy(Ae,me))}},{key:"deleteCache",value:function(me){delete this.cache[me]}},{key:"deleteOrder",value:function(me){var Ae=this.order.findIndex(function(se){return se===me});Ae>=0&&this.order.splice(Ae,1)}},{key:"appendOrder",value:function(me){this.order.push(me)}},{key:"defaultDestroy",value:function(me,Ae){return null}}]),z}();function vt(z,oe){z.forEach(function(me){!oe[me]||(oe[me]=oe[me].bind(oe))})}var hr=E(2650);function Vr(z){var oe=hr.ZP(z),me=[0,0,0,0];return oe!=null&&(me[0]=oe.r/255,me[1]=oe.g/255,me[2]=oe.b/255,me[3]=oe.opacity),me}function Ur(z){var oe=z&&z[0],me=z&&z[1],Ae=z&&z[2],se=oe+me*256+Ae*65536-1;return se}function nn(z){return[z+1&255,z+1>>8&255,z+1>>8>>8&255]}function Jr(z){var oe=document.createElement("canvas"),me=oe.getContext("2d");oe.width=256,oe.height=1;for(var Ae=me.createLinearGradient(0,0,256,1),se=null,Ce=z.positions[0],ct=z.positions[z.positions.length-1],xr=0;xr<z.colors.length;++xr){var Gt=(z.positions[xr]-Ce)/(ct-Ce);Ae.addColorStop(Gt,z.colors[xr])}return me.fillStyle=Ae,me.fillRect(0,0,256,1),se=new Uint8ClampedArray(me.getImageData(0,0,256,1).data),new ImageData(se,256,1)}var Cr;(function(z){z.CENTER="center",z.TOP="top",z["TOP-LEFT"]="top-left",z["TOP-RIGHT"]="top-right",z.BOTTOM="bottom",z["BOTTOM-LEFT"]="bottom-left",z.LEFT="left",z.RIGHT="right"})(Cr||(Cr={}));var Dn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Hn(z,oe,me){var Ae=z.classList;for(var se in Dn)Dn.hasOwnProperty(se)&&Ae.remove("l7-".concat(me,"-anchor-").concat(se));Ae.add("l7-".concat(me,"-anchor-").concat(oe))}function bi(z){if(z.length===0)throw new Error("max requires at least one data point");for(var oe=z[0],me=1;me<z.length;me++)z[me]>oe&&(oe=z[me]);return oe*1}function Ui(z){if(z.length===0)throw new Error("min requires at least one data point");for(var oe=z[0],me=1;me<z.length;me++)z[me]<oe&&(oe=z[me]);return oe*1}function Ji(z){if(z.length===0)return 0;for(var oe=z[0]*1,me=1;me<z.length;me++)oe+=z[me]*1;return oe}function Ri(z){if(z.length===0)throw new Error("mean requires at least one data point");return Ji(z)/z.length}function Ii(z){if(z.length===0)throw new Error("mean requires at least one data point");if(z.length<3)return z[0];z.sort();for(var oe=z[0],me=NaN,Ae=0,se=1,Ce=1;Ce<z.length+1;Ce++)z[Ce]!==oe?(se>Ae&&(Ae=se,me=oe),se=1,oe=z[Ce]):se++;return me*1}var Y={min:Ui,max:bi,mean:Ri,sum:Ji,mode:Ii};function ce(z,oe){return z.map(function(me){return me[oe]})}function ye(z,oe){return Y[z](oe)}},3473:function(Or,U,E){"use strict";E.d(U,{Z:function(){return le}});function le(C,d,A,Q,K){var W={};return Object.keys(Q).forEach(function(L){W[L]=Q[L]}),W.enumerable=!!W.enumerable,W.configurable=!!W.configurable,("value"in W||W.initializer)&&(W.writable=!0),W=A.slice().reverse().reduce(function(L,N){return N(C,d,L)||L},W),K&&W.initializer!==void 0&&(W.value=W.initializer?W.initializer.call(K):void 0,W.initializer=void 0),W.initializer===void 0&&(Object.defineProperty(C,d,W),W=null),W}},66213:function(Or,U,E){"use strict";E.d(U,{Z:function(){return d}});var le=E(77608);function C(A,Q){for(;!Object.prototype.hasOwnProperty.call(A,Q)&&(A=(0,le.Z)(A),A!==null););return A}function d(A,Q,K){return typeof Reflect!="undefined"&&Reflect.get?d=Reflect.get:d=function(L,N,Ne){var Ye=C(L,N);if(!!Ye){var Je=Object.getOwnPropertyDescriptor(Ye,N);return Je.get?Je.get.call(Ne):Je.value}},d(A,Q,K||A)}},55770:function(Or,U,E){"use strict";E.d(U,{Z:function(){return le}});function le(C,d,A,Q){!A||Object.defineProperty(C,d,{enumerable:A.enumerable,configurable:A.configurable,writable:A.writable,value:A.initializer?A.initializer.call(Q):void 0})}},31795:function(Or,U,E){var le=E(75752);Or.exports.geometry=C,Or.exports.ring=A;function C(K){var W=0,L;switch(K.type){case"Polygon":return d(K.coordinates);case"MultiPolygon":for(L=0;L<K.coordinates.length;L++)W+=d(K.coordinates[L]);return W;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(L=0;L<K.geometries.length;L++)W+=C(K.geometries[L]);return W}}function d(K){var W=0;if(K&&K.length>0){W+=Math.abs(A(K[0]));for(var L=1;L<K.length;L++)W-=Math.abs(A(K[L]))}return W}function A(K){var W,L,N,Ne,Ye,Je,rt,Yt=0,Vt=K.length;if(Vt>2){for(rt=0;rt<Vt;rt++)rt===Vt-2?(Ne=Vt-2,Ye=Vt-1,Je=0):rt===Vt-1?(Ne=Vt-1,Ye=0,Je=1):(Ne=rt,Ye=rt+1,Je=rt+2),W=K[Ne],L=K[Ye],N=K[Je],Yt+=(Q(N[0])-Q(W[0]))*Math.sin(Q(L[1]));Yt=Yt*le.RADIUS*le.RADIUS/2}return Yt}function Q(K){return K*Math.PI/180}},38163:function(Or,U,E){var le=E(31795);Or.exports=C;function C(L,N){switch(L&&L.type||null){case"FeatureCollection":return L.features=L.features.map(d(C,N)),L;case"GeometryCollection":return L.geometries=L.geometries.map(d(C,N)),L;case"Feature":return L.geometry=C(L.geometry,N),L;case"Polygon":case"MultiPolygon":return A(L,N);default:return L}}function d(L,N){return function(Ne){return L(Ne,N)}}function A(L,N){return L.type==="Polygon"?L.coordinates=Q(L.coordinates,N):L.type==="MultiPolygon"&&(L.coordinates=L.coordinates.map(d(Q,N))),L}function Q(L,N){N=!!N,L[0]=K(L[0],N);for(var Ne=1;Ne<L.length;Ne++)L[Ne]=K(L[Ne],!N);return L}function K(L,N){return W(L)===N?L:L.reverse()}function W(L){return le.ring(L)>=0}},49296:function(Or){"use strict";Or.exports=E,Or.exports.default=E;var U=1e20;function E(Q,K,W,L,N,Ne){this.fontSize=Q||24,this.buffer=K===void 0?3:K,this.cutoff=L||.25,this.fontFamily=N||"sans-serif",this.fontWeight=Ne||"normal",this.radius=W||8;var Ye=this.size=this.fontSize+this.buffer*2,Je=Ye+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ye,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Je*Je),this.gridInner=new Float64Array(Je*Je),this.f=new Float64Array(Je),this.z=new Float64Array(Je+1),this.v=new Uint16Array(Je),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(Ye/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function le(Q,K,W,L,N,Ne,Ye){Ne.fill(U,0,K*W),Ye.fill(0,0,K*W);for(var Je=(K-L)/2,rt=0;rt<N;rt++)for(var Yt=0;Yt<L;Yt++){var Vt=(rt+Je)*K+Yt+Je,tr=Q.data[4*(rt*L+Yt)+3]/255;if(tr===1)Ne[Vt]=0,Ye[Vt]=U;else if(tr===0)Ne[Vt]=U,Ye[Vt]=0;else{var zt=Math.max(0,.5-tr),Tt=Math.max(0,tr-.5);Ne[Vt]=zt*zt,Ye[Vt]=Tt*Tt}}}function C(Q,K,W,L,N,Ne,Ye){for(var Je=0;Je<K*W;Je++){var rt=Math.sqrt(L[Je])-Math.sqrt(N[Je]);Q[Je]=Math.round(255-255*(rt/Ne+Ye))}}E.prototype._draw=function(Q,K){var W=this.ctx.measureText(Q),L=W.width,N=2*this.buffer,Ne,Ye,Je,rt,Yt,Vt,tr,zt;K&&this.useMetrics?(Yt=Math.floor(W.actualBoundingBoxAscent),zt=this.buffer+Math.ceil(W.actualBoundingBoxAscent),Vt=this.buffer,tr=this.buffer,Ye=Math.min(this.size,Math.ceil(W.actualBoundingBoxRight-W.actualBoundingBoxLeft)),rt=Math.min(this.size-Vt,Math.ceil(W.actualBoundingBoxAscent+W.actualBoundingBoxDescent)),Ne=Ye+N,Je=rt+N,this.ctx.textBaseline="alphabetic"):(Ne=Ye=this.size,Je=rt=this.size,Yt=19*this.fontSize/24,Vt=tr=0,zt=this.middle,this.ctx.textBaseline="middle");var Tt;Ye&&rt&&(this.ctx.clearRect(tr,Vt,Ye,rt),this.ctx.fillText(Q,this.buffer,zt),Tt=this.ctx.getImageData(tr,Vt,Ye,rt));var xt=new Uint8ClampedArray(Ne*Je);return le(Tt,Ne,Je,Ye,rt,this.gridOuter,this.gridInner),d(this.gridOuter,Ne,Je,this.f,this.v,this.z),d(this.gridInner,Ne,Je,this.f,this.v,this.z),C(xt,Ne,Je,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:xt,metrics:{width:Ye,height:rt,sdfWidth:Ne,sdfHeight:Je,top:Yt,left:0,advance:L}}},E.prototype.draw=function(Q){return this._draw(Q,!1).data},E.prototype.drawWithMetrics=function(Q){return this._draw(Q,!0)};function d(Q,K,W,L,N,Ne){for(var Ye=0;Ye<K;Ye++)A(Q,Ye,K,W,L,N,Ne);for(var Je=0;Je<W;Je++)A(Q,Je*K,1,K,L,N,Ne)}function A(Q,K,W,L,N,Ne,Ye){var Je,rt,Yt,Vt;for(Ne[0]=0,Ye[0]=-U,Ye[1]=U,Je=0;Je<L;Je++)N[Je]=Q[K+Je*W];for(Je=1,rt=0,Yt=0;Je<L;Je++){do Vt=Ne[rt],Yt=(N[Je]-N[Vt]+Je*Je-Vt*Vt)/(Je-Vt)/2;while(Yt<=Ye[rt]&&--rt>-1);rt++,Ne[rt]=Je,Ye[rt]=Yt,Ye[rt+1]=U}for(Je=0,rt=0;Je<L;Je++){for(;Ye[rt+1]<Je;)rt++;Vt=Ne[rt],Q[K+Je*W]=N[Vt]+(Je-Vt)*(Je-Vt)}}},40271:function(Or,U,E){"use strict";E.d(U,{zL:function(){return Q},DL:function(){return xt},Ht:function(){return Ke}});var le=63710088e-1,C={centimeters:le*100,centimetres:le*100,degrees:le/111325,feet:le*3.28084,inches:le*39.37,kilometers:le/1e3,kilometres:le/1e3,meters:le,metres:le,miles:le/1609.344,millimeters:le*1e3,millimetres:le*1e3,nauticalmiles:le/1852,radians:1,yards:le*1.0936},d={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/le,yards:1.0936133},A={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Q(fe,Re,ge){ge===void 0&&(ge={});var _t={type:"Feature"};return(ge.id===0||ge.id)&&(_t.id=ge.id),ge.bbox&&(_t.bbox=ge.bbox),_t.properties=Re||{},_t.geometry=fe,_t}function K(fe,Re,ge){switch(ge===void 0&&(ge={}),fe){case"Point":return W(Re).geometry;case"LineString":return Ye(Re).geometry;case"Polygon":return N(Re).geometry;case"MultiPoint":return Vt(Re).geometry;case"MultiLineString":return Yt(Re).geometry;case"MultiPolygon":return tr(Re).geometry;default:throw new Error(fe+" is invalid")}}function W(fe,Re,ge){if(ge===void 0&&(ge={}),!fe)throw new Error("coordinates is required");if(!Array.isArray(fe))throw new Error("coordinates must be an Array");if(fe.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ut(fe[0])||!Ut(fe[1]))throw new Error("coordinates must contain numbers");var _t={type:"Point",coordinates:fe};return Q(_t,Re,ge)}function L(fe,Re,ge){return ge===void 0&&(ge={}),rt(fe.map(function(_t){return W(_t,Re)}),ge)}function N(fe,Re,ge){ge===void 0&&(ge={});for(var _t=0,pt=fe;_t<pt.length;_t++){var Nt=pt[_t];if(Nt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Bt=0;Bt<Nt[Nt.length-1].length;Bt++)if(Nt[Nt.length-1][Bt]!==Nt[0][Bt])throw new Error("First and last Position are not equivalent.")}var kr={type:"Polygon",coordinates:fe};return Q(kr,Re,ge)}function Ne(fe,Re,ge){return ge===void 0&&(ge={}),rt(fe.map(function(_t){return N(_t,Re)}),ge)}function Ye(fe,Re,ge){if(ge===void 0&&(ge={}),fe.length<2)throw new Error("coordinates must be an array of two or more positions");var _t={type:"LineString",coordinates:fe};return Q(_t,Re,ge)}function Je(fe,Re,ge){return ge===void 0&&(ge={}),rt(fe.map(function(_t){return Ye(_t,Re)}),ge)}function rt(fe,Re){Re===void 0&&(Re={});var ge={type:"FeatureCollection"};return Re.id&&(ge.id=Re.id),Re.bbox&&(ge.bbox=Re.bbox),ge.features=fe,ge}function Yt(fe,Re,ge){ge===void 0&&(ge={});var _t={type:"MultiLineString",coordinates:fe};return Q(_t,Re,ge)}function Vt(fe,Re,ge){ge===void 0&&(ge={});var _t={type:"MultiPoint",coordinates:fe};return Q(_t,Re,ge)}function tr(fe,Re,ge){ge===void 0&&(ge={});var _t={type:"MultiPolygon",coordinates:fe};return Q(_t,Re,ge)}function zt(fe,Re,ge){ge===void 0&&(ge={});var _t={type:"GeometryCollection",geometries:fe};return Q(_t,Re,ge)}function Tt(fe,Re){if(Re===void 0&&(Re=0),Re&&!(Re>=0))throw new Error("precision must be a positive number");var ge=Math.pow(10,Re||0);return Math.round(fe*ge)/ge}function xt(fe,Re){Re===void 0&&(Re="kilometers");var ge=C[Re];if(!ge)throw new Error(Re+" units is invalid");return fe*ge}function yr(fe,Re){Re===void 0&&(Re="kilometers");var ge=C[Re];if(!ge)throw new Error(Re+" units is invalid");return fe/ge}function ee(fe,Re){return Ct(yr(fe,Re))}function dr(fe){var Re=fe%360;return Re<0&&(Re+=360),Re}function Ct(fe){var Re=fe%(2*Math.PI);return Re*180/Math.PI}function Ke(fe){var Re=fe%360;return Re*Math.PI/180}function Dt(fe,Re,ge){if(Re===void 0&&(Re="kilometers"),ge===void 0&&(ge="kilometers"),!(fe>=0))throw new Error("length must be a positive number");return xt(yr(fe,Re),ge)}function Xe(fe,Re,ge){if(Re===void 0&&(Re="meters"),ge===void 0&&(ge="kilometers"),!(fe>=0))throw new Error("area must be a positive number");var _t=A[Re];if(!_t)throw new Error("invalid original units");var pt=A[ge];if(!pt)throw new Error("invalid final units");return fe/_t*pt}function Ut(fe){return!isNaN(fe)&&fe!==null&&!Array.isArray(fe)}function _r(fe){return!!fe&&fe.constructor===Object}function ar(fe){if(!fe)throw new Error("bbox is required");if(!Array.isArray(fe))throw new Error("bbox must be an Array");if(fe.length!==4&&fe.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");fe.forEach(function(Re){if(!Ut(Re))throw new Error("bbox must only contain numbers")})}function zr(fe){if(!fe)throw new Error("id is required");if(["string","number"].indexOf(typeof fe)===-1)throw new Error("id must be a number or a string")}},17781:function(){},9187:function(Or){"use strict";Or.exports=U,Or.exports.default=U;function U(fe,Re,ge){ge=ge||2;var _t=Re&&Re.length,pt=_t?Re[0]*ge:fe.length,Nt=E(fe,0,pt,ge,!0),Bt=[];if(!Nt||Nt.next===Nt.prev)return Bt;var kr,ln,yn,Vi,nr,de,Te;if(_t&&(Nt=W(fe,Re,Nt,ge)),fe.length>80*ge){kr=yn=fe[0],ln=Vi=fe[1];for(var Ue=ge;Ue<pt;Ue+=ge)nr=fe[Ue],de=fe[Ue+1],nr<kr&&(kr=nr),de<ln&&(ln=de),nr>yn&&(yn=nr),de>Vi&&(Vi=de);Te=Math.max(yn-kr,Vi-ln),Te=Te!==0?1/Te:0}return C(Nt,Bt,ge,kr,ln,Te),Bt}function E(fe,Re,ge,_t,pt){var Nt,Bt;if(pt===zr(fe,Re,ge,_t)>0)for(Nt=Re;Nt<ge;Nt+=_t)Bt=Ut(Nt,fe[Nt],fe[Nt+1],Bt);else for(Nt=ge-_t;Nt>=Re;Nt-=_t)Bt=Ut(Nt,fe[Nt],fe[Nt+1],Bt);return Bt&&xt(Bt,Bt.next)&&(_r(Bt),Bt=Bt.next),Bt}function le(fe,Re){if(!fe)return fe;Re||(Re=fe);var ge=fe,_t;do if(_t=!1,!ge.steiner&&(xt(ge,ge.next)||Tt(ge.prev,ge,ge.next)===0)){if(_r(ge),ge=Re=ge.prev,ge===ge.next)break;_t=!0}else ge=ge.next;while(_t||ge!==Re);return Re}function C(fe,Re,ge,_t,pt,Nt,Bt){if(!!fe){!Bt&&Nt&&Je(fe,_t,pt,Nt);for(var kr=fe,ln,yn;fe.prev!==fe.next;){if(ln=fe.prev,yn=fe.next,Nt?A(fe,_t,pt,Nt):d(fe)){Re.push(ln.i/ge),Re.push(fe.i/ge),Re.push(yn.i/ge),_r(fe),fe=yn.next,kr=yn.next;continue}if(fe=yn,fe===kr){Bt?Bt===1?(fe=Q(le(fe),Re,ge),C(fe,Re,ge,_t,pt,Nt,2)):Bt===2&&K(fe,Re,ge,_t,pt,Nt):C(le(fe),Re,ge,_t,pt,Nt,1);break}}}}function d(fe){var Re=fe.prev,ge=fe,_t=fe.next;if(Tt(Re,ge,_t)>=0)return!1;for(var pt=fe.next.next;pt!==fe.prev;){if(tr(Re.x,Re.y,ge.x,ge.y,_t.x,_t.y,pt.x,pt.y)&&Tt(pt.prev,pt,pt.next)>=0)return!1;pt=pt.next}return!0}function A(fe,Re,ge,_t){var pt=fe.prev,Nt=fe,Bt=fe.next;if(Tt(pt,Nt,Bt)>=0)return!1;for(var kr=pt.x<Nt.x?pt.x<Bt.x?pt.x:Bt.x:Nt.x<Bt.x?Nt.x:Bt.x,ln=pt.y<Nt.y?pt.y<Bt.y?pt.y:Bt.y:Nt.y<Bt.y?Nt.y:Bt.y,yn=pt.x>Nt.x?pt.x>Bt.x?pt.x:Bt.x:Nt.x>Bt.x?Nt.x:Bt.x,Vi=pt.y>Nt.y?pt.y>Bt.y?pt.y:Bt.y:Nt.y>Bt.y?Nt.y:Bt.y,nr=Yt(kr,ln,Re,ge,_t),de=Yt(yn,Vi,Re,ge,_t),Te=fe.prevZ,Ue=fe.nextZ;Te&&Te.z>=nr&&Ue&&Ue.z<=de;){if(Te!==fe.prev&&Te!==fe.next&&tr(pt.x,pt.y,Nt.x,Nt.y,Bt.x,Bt.y,Te.x,Te.y)&&Tt(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,Ue!==fe.prev&&Ue!==fe.next&&tr(pt.x,pt.y,Nt.x,Nt.y,Bt.x,Bt.y,Ue.x,Ue.y)&&Tt(Ue.prev,Ue,Ue.next)>=0))return!1;Ue=Ue.nextZ}for(;Te&&Te.z>=nr;){if(Te!==fe.prev&&Te!==fe.next&&tr(pt.x,pt.y,Nt.x,Nt.y,Bt.x,Bt.y,Te.x,Te.y)&&Tt(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;Ue&&Ue.z<=de;){if(Ue!==fe.prev&&Ue!==fe.next&&tr(pt.x,pt.y,Nt.x,Nt.y,Bt.x,Bt.y,Ue.x,Ue.y)&&Tt(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.nextZ}return!0}function Q(fe,Re,ge){var _t=fe;do{var pt=_t.prev,Nt=_t.next.next;!xt(pt,Nt)&&yr(pt,_t,_t.next,Nt)&&Ke(pt,Nt)&&Ke(Nt,pt)&&(Re.push(pt.i/ge),Re.push(_t.i/ge),Re.push(Nt.i/ge),_r(_t),_r(_t.next),_t=fe=Nt),_t=_t.next}while(_t!==fe);return le(_t)}function K(fe,Re,ge,_t,pt,Nt){var Bt=fe;do{for(var kr=Bt.next.next;kr!==Bt.prev;){if(Bt.i!==kr.i&&zt(Bt,kr)){var ln=Xe(Bt,kr);Bt=le(Bt,Bt.next),ln=le(ln,ln.next),C(Bt,Re,ge,_t,pt,Nt),C(ln,Re,ge,_t,pt,Nt);return}kr=kr.next}Bt=Bt.next}while(Bt!==fe)}function W(fe,Re,ge,_t){var pt=[],Nt,Bt,kr,ln,yn;for(Nt=0,Bt=Re.length;Nt<Bt;Nt++)kr=Re[Nt]*_t,ln=Nt<Bt-1?Re[Nt+1]*_t:fe.length,yn=E(fe,kr,ln,_t,!1),yn===yn.next&&(yn.steiner=!0),pt.push(Vt(yn));for(pt.sort(L),Nt=0;Nt<pt.length;Nt++)ge=N(pt[Nt],ge),ge=le(ge,ge.next);return ge}function L(fe,Re){return fe.x-Re.x}function N(fe,Re){var ge=Ne(fe,Re);if(!ge)return Re;var _t=Xe(ge,fe),pt=le(ge,ge.next);return le(_t,_t.next),Re===ge?pt:Re}function Ne(fe,Re){var ge=Re,_t=fe.x,pt=fe.y,Nt=-Infinity,Bt;do{if(pt<=ge.y&&pt>=ge.next.y&&ge.next.y!==ge.y){var kr=ge.x+(pt-ge.y)*(ge.next.x-ge.x)/(ge.next.y-ge.y);if(kr<=_t&&kr>Nt){if(Nt=kr,kr===_t){if(pt===ge.y)return ge;if(pt===ge.next.y)return ge.next}Bt=ge.x<ge.next.x?ge:ge.next}}ge=ge.next}while(ge!==Re);if(!Bt)return null;if(_t===Nt)return Bt;var ln=Bt,yn=Bt.x,Vi=Bt.y,nr=Infinity,de;ge=Bt;do _t>=ge.x&&ge.x>=yn&&_t!==ge.x&&tr(pt<Vi?_t:Nt,pt,yn,Vi,pt<Vi?Nt:_t,pt,ge.x,ge.y)&&(de=Math.abs(pt-ge.y)/(_t-ge.x),Ke(ge,fe)&&(de<nr||de===nr&&(ge.x>Bt.x||ge.x===Bt.x&&Ye(Bt,ge)))&&(Bt=ge,nr=de)),ge=ge.next;while(ge!==ln);return Bt}function Ye(fe,Re){return Tt(fe.prev,fe,Re.prev)<0&&Tt(Re.next,fe,fe.next)<0}function Je(fe,Re,ge,_t){var pt=fe;do pt.z===null&&(pt.z=Yt(pt.x,pt.y,Re,ge,_t)),pt.prevZ=pt.prev,pt.nextZ=pt.next,pt=pt.next;while(pt!==fe);pt.prevZ.nextZ=null,pt.prevZ=null,rt(pt)}function rt(fe){var Re,ge,_t,pt,Nt,Bt,kr,ln,yn=1;do{for(ge=fe,fe=null,Nt=null,Bt=0;ge;){for(Bt++,_t=ge,kr=0,Re=0;Re<yn&&(kr++,_t=_t.nextZ,!!_t);Re++);for(ln=yn;kr>0||ln>0&&_t;)kr!==0&&(ln===0||!_t||ge.z<=_t.z)?(pt=ge,ge=ge.nextZ,kr--):(pt=_t,_t=_t.nextZ,ln--),Nt?Nt.nextZ=pt:fe=pt,pt.prevZ=Nt,Nt=pt;ge=_t}Nt.nextZ=null,yn*=2}while(Bt>1);return fe}function Yt(fe,Re,ge,_t,pt){return fe=32767*(fe-ge)*pt,Re=32767*(Re-_t)*pt,fe=(fe|fe<<8)&16711935,fe=(fe|fe<<4)&252645135,fe=(fe|fe<<2)&858993459,fe=(fe|fe<<1)&1431655765,Re=(Re|Re<<8)&16711935,Re=(Re|Re<<4)&252645135,Re=(Re|Re<<2)&858993459,Re=(Re|Re<<1)&1431655765,fe|Re<<1}function Vt(fe){var Re=fe,ge=fe;do(Re.x<ge.x||Re.x===ge.x&&Re.y<ge.y)&&(ge=Re),Re=Re.next;while(Re!==fe);return ge}function tr(fe,Re,ge,_t,pt,Nt,Bt,kr){return(pt-Bt)*(Re-kr)-(fe-Bt)*(Nt-kr)>=0&&(fe-Bt)*(_t-kr)-(ge-Bt)*(Re-kr)>=0&&(ge-Bt)*(Nt-kr)-(pt-Bt)*(_t-kr)>=0}function zt(fe,Re){return fe.next.i!==Re.i&&fe.prev.i!==Re.i&&!Ct(fe,Re)&&(Ke(fe,Re)&&Ke(Re,fe)&&Dt(fe,Re)&&(Tt(fe.prev,fe,Re.prev)||Tt(fe,Re.prev,Re))||xt(fe,Re)&&Tt(fe.prev,fe,fe.next)>0&&Tt(Re.prev,Re,Re.next)>0)}function Tt(fe,Re,ge){return(Re.y-fe.y)*(ge.x-Re.x)-(Re.x-fe.x)*(ge.y-Re.y)}function xt(fe,Re){return fe.x===Re.x&&fe.y===Re.y}function yr(fe,Re,ge,_t){var pt=dr(Tt(fe,Re,ge)),Nt=dr(Tt(fe,Re,_t)),Bt=dr(Tt(ge,_t,fe)),kr=dr(Tt(ge,_t,Re));return!!(pt!==Nt&&Bt!==kr||pt===0&&ee(fe,ge,Re)||Nt===0&&ee(fe,_t,Re)||Bt===0&&ee(ge,fe,_t)||kr===0&&ee(ge,Re,_t))}function ee(fe,Re,ge){return Re.x<=Math.max(fe.x,ge.x)&&Re.x>=Math.min(fe.x,ge.x)&&Re.y<=Math.max(fe.y,ge.y)&&Re.y>=Math.min(fe.y,ge.y)}function dr(fe){return fe>0?1:fe<0?-1:0}function Ct(fe,Re){var ge=fe;do{if(ge.i!==fe.i&&ge.next.i!==fe.i&&ge.i!==Re.i&&ge.next.i!==Re.i&&yr(ge,ge.next,fe,Re))return!0;ge=ge.next}while(ge!==fe);return!1}function Ke(fe,Re){return Tt(fe.prev,fe,fe.next)<0?Tt(fe,Re,fe.next)>=0&&Tt(fe,fe.prev,Re)>=0:Tt(fe,Re,fe.prev)<0||Tt(fe,fe.next,Re)<0}function Dt(fe,Re){var ge=fe,_t=!1,pt=(fe.x+Re.x)/2,Nt=(fe.y+Re.y)/2;do ge.y>Nt!=ge.next.y>Nt&&ge.next.y!==ge.y&&pt<(ge.next.x-ge.x)*(Nt-ge.y)/(ge.next.y-ge.y)+ge.x&&(_t=!_t),ge=ge.next;while(ge!==fe);return _t}function Xe(fe,Re){var ge=new ar(fe.i,fe.x,fe.y),_t=new ar(Re.i,Re.x,Re.y),pt=fe.next,Nt=Re.prev;return fe.next=Re,Re.prev=fe,ge.next=pt,pt.prev=ge,_t.next=ge,ge.prev=_t,Nt.next=_t,_t.prev=Nt,_t}function Ut(fe,Re,ge,_t){var pt=new ar(fe,Re,ge);return _t?(pt.next=_t.next,pt.prev=_t,_t.next.prev=pt,_t.next=pt):(pt.prev=pt,pt.next=pt),pt}function _r(fe){fe.next.prev=fe.prev,fe.prev.next=fe.next,fe.prevZ&&(fe.prevZ.nextZ=fe.nextZ),fe.nextZ&&(fe.nextZ.prevZ=fe.prevZ)}function ar(fe,Re,ge){this.i=fe,this.x=Re,this.y=ge,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}U.deviation=function(fe,Re,ge,_t){var pt=Re&&Re.length,Nt=pt?Re[0]*ge:fe.length,Bt=Math.abs(zr(fe,0,Nt,ge));if(pt)for(var kr=0,ln=Re.length;kr<ln;kr++){var yn=Re[kr]*ge,Vi=kr<ln-1?Re[kr+1]*ge:fe.length;Bt-=Math.abs(zr(fe,yn,Vi,ge))}var nr=0;for(kr=0;kr<_t.length;kr+=3){var de=_t[kr]*ge,Te=_t[kr+1]*ge,Ue=_t[kr+2]*ge;nr+=Math.abs((fe[de]-fe[Ue])*(fe[Te+1]-fe[de+1])-(fe[de]-fe[Te])*(fe[Ue+1]-fe[de+1]))}return Bt===0&&nr===0?0:Math.abs((nr-Bt)/Bt)};function zr(fe,Re,ge,_t){for(var pt=0,Nt=Re,Bt=ge-_t;Nt<ge;Nt+=_t)pt+=(fe[Bt]-fe[Nt])*(fe[Nt+1]+fe[Bt+1]),Bt=Nt;return pt}U.flatten=function(fe){for(var Re=fe[0][0].length,ge={vertices:[],holes:[],dimensions:Re},_t=0,pt=0;pt<fe.length;pt++){for(var Nt=0;Nt<fe[pt].length;Nt++)for(var Bt=0;Bt<Re;Bt++)ge.vertices.push(fe[pt][Nt][Bt]);pt>0&&(_t+=fe[pt-1].length,ge.holes.push(_t))}return ge}},67709:function(Or){function U(le){var C=le.target||le.srcElement;C.__resizeRAF__&&cancelAnimationFrame(C.__resizeRAF__),C.__resizeRAF__=requestAnimationFrame(function(){var d=C.__resizeTrigger__,A=d&&d.__resizeListeners__;A&&A.forEach(function(Q){Q.call(d,le)})})}var E=function(C,d){var A=this,Q=A.document,K,W=Q.attachEvent;typeof navigator!="undefined"&&(K=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function L(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",U)}if(!C.__resizeListeners__)if(C.__resizeListeners__=[],W)C.__resizeTrigger__=C,C.attachEvent("onresize",U);else{getComputedStyle(C).position==="static"&&(C.style.position="relative");var N=C.__resizeTrigger__=Q.createElement("object");N.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),N.setAttribute("class","resize-sensor"),N.setAttribute("tabindex","-1"),N.setAttribute("title",""),N.__resizeElement__=C,N.onload=L,N.type="text/html",K&&C.appendChild(N),N.data="about:blank",K||C.appendChild(N)}C.__resizeListeners__.push(d)};Or.exports=typeof window=="undefined"?E:E.bind(window),Or.exports.unbind=function(le,C){var d=document.attachEvent,A=le.__resizeListeners__||[];if(C){var Q=A.indexOf(C);Q!==-1&&A.splice(Q,1)}else A=le.__resizeListeners__=[];if(!A.length){if(d)le.detachEvent("onresize",U);else if(le.__resizeTrigger__){var K=le.__resizeTrigger__.contentDocument,W=K&&K.defaultView;W&&(W.removeEventListener("resize",U),delete W.__resizeTrigger__),le.__resizeTrigger__=!le.removeChild(le.__resizeTrigger__)}delete le.__resizeListeners__}}},26729:function(Or){"use strict";var U=Object.prototype.hasOwnProperty,E="~";function le(){}Object.create&&(le.prototype=Object.create(null),new le().__proto__||(E=!1));function C(K,W,L){this.fn=K,this.context=W,this.once=L||!1}function d(K,W,L,N,Ne){if(typeof L!="function")throw new TypeError("The listener must be a function");var Ye=new C(L,N||K,Ne),Je=E?E+W:W;return K._events[Je]?K._events[Je].fn?K._events[Je]=[K._events[Je],Ye]:K._events[Je].push(Ye):(K._events[Je]=Ye,K._eventsCount++),K}function A(K,W){--K._eventsCount==0?K._events=new le:delete K._events[W]}function Q(){this._events=new le,this._eventsCount=0}Q.prototype.eventNames=function(){var W=[],L,N;if(this._eventsCount===0)return W;for(N in L=this._events)U.call(L,N)&&W.push(E?N.slice(1):N);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(L)):W},Q.prototype.listeners=function(W){var L=E?E+W:W,N=this._events[L];if(!N)return[];if(N.fn)return[N.fn];for(var Ne=0,Ye=N.length,Je=new Array(Ye);Ne<Ye;Ne++)Je[Ne]=N[Ne].fn;return Je},Q.prototype.listenerCount=function(W){var L=E?E+W:W,N=this._events[L];return N?N.fn?1:N.length:0},Q.prototype.emit=function(W,L,N,Ne,Ye,Je){var rt=E?E+W:W;if(!this._events[rt])return!1;var Yt=this._events[rt],Vt=arguments.length,tr,zt;if(Yt.fn){switch(Yt.once&&this.removeListener(W,Yt.fn,void 0,!0),Vt){case 1:return Yt.fn.call(Yt.context),!0;case 2:return Yt.fn.call(Yt.context,L),!0;case 3:return Yt.fn.call(Yt.context,L,N),!0;case 4:return Yt.fn.call(Yt.context,L,N,Ne),!0;case 5:return Yt.fn.call(Yt.context,L,N,Ne,Ye),!0;case 6:return Yt.fn.call(Yt.context,L,N,Ne,Ye,Je),!0}for(zt=1,tr=new Array(Vt-1);zt<Vt;zt++)tr[zt-1]=arguments[zt];Yt.fn.apply(Yt.context,tr)}else{var Tt=Yt.length,xt;for(zt=0;zt<Tt;zt++)switch(Yt[zt].once&&this.removeListener(W,Yt[zt].fn,void 0,!0),Vt){case 1:Yt[zt].fn.call(Yt[zt].context);break;case 2:Yt[zt].fn.call(Yt[zt].context,L);break;case 3:Yt[zt].fn.call(Yt[zt].context,L,N);break;case 4:Yt[zt].fn.call(Yt[zt].context,L,N,Ne);break;default:if(!tr)for(xt=1,tr=new Array(Vt-1);xt<Vt;xt++)tr[xt-1]=arguments[xt];Yt[zt].fn.apply(Yt[zt].context,tr)}}return!0},Q.prototype.on=function(W,L,N){return d(this,W,L,N,!1)},Q.prototype.once=function(W,L,N){return d(this,W,L,N,!0)},Q.prototype.removeListener=function(W,L,N,Ne){var Ye=E?E+W:W;if(!this._events[Ye])return this;if(!L)return A(this,Ye),this;var Je=this._events[Ye];if(Je.fn)Je.fn===L&&(!Ne||Je.once)&&(!N||Je.context===N)&&A(this,Ye);else{for(var rt=0,Yt=[],Vt=Je.length;rt<Vt;rt++)(Je[rt].fn!==L||Ne&&!Je[rt].once||N&&Je[rt].context!==N)&&Yt.push(Je[rt]);Yt.length?this._events[Ye]=Yt.length===1?Yt[0]:Yt:A(this,Ye)}return this},Q.prototype.removeAllListeners=function(W){var L;return W?(L=E?E+W:W,this._events[L]&&A(this,L)):(this._events=new le,this._eventsCount=0),this},Q.prototype.off=Q.prototype.removeListener,Q.prototype.addListener=Q.prototype.on,Q.prefixed=E,Q.EventEmitter=Q,Or.exports=Q},85975:function(Or,U,E){"use strict";E.r(U),E.d(U,{create:function(){return C},clone:function(){return d},copy:function(){return A},fromValues:function(){return Q},set:function(){return K},identity:function(){return W},transpose:function(){return L},invert:function(){return N},adjoint:function(){return Ne},determinant:function(){return Ye},multiply:function(){return Je},translate:function(){return rt},scale:function(){return Yt},rotate:function(){return Vt},rotateX:function(){return tr},rotateY:function(){return zt},rotateZ:function(){return Tt},fromTranslation:function(){return xt},fromScaling:function(){return yr},fromRotation:function(){return ee},fromXRotation:function(){return dr},fromYRotation:function(){return Ct},fromZRotation:function(){return Ke},fromRotationTranslation:function(){return Dt},fromQuat2:function(){return Xe},getTranslation:function(){return Ut},getScaling:function(){return _r},getRotation:function(){return ar},fromRotationTranslationScale:function(){return zr},fromRotationTranslationScaleOrigin:function(){return fe},fromQuat:function(){return Re},frustum:function(){return ge},perspective:function(){return _t},perspectiveFromFieldOfView:function(){return pt},ortho:function(){return Nt},lookAt:function(){return Bt},targetTo:function(){return kr},str:function(){return ln},frob:function(){return yn},add:function(){return Vi},subtract:function(){return nr},multiplyScalar:function(){return de},multiplyScalarAndAdd:function(){return Te},exactEquals:function(){return Ue},equals:function(){return Le},mul:function(){return Ft},sub:function(){return er}});var le=E(49685);function C(){var w=new le.WT(16);return le.WT!=Float32Array&&(w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=0,w[12]=0,w[13]=0,w[14]=0),w[0]=1,w[5]=1,w[10]=1,w[15]=1,w}function d(w){var Z=new le.WT(16);return Z[0]=w[0],Z[1]=w[1],Z[2]=w[2],Z[3]=w[3],Z[4]=w[4],Z[5]=w[5],Z[6]=w[6],Z[7]=w[7],Z[8]=w[8],Z[9]=w[9],Z[10]=w[10],Z[11]=w[11],Z[12]=w[12],Z[13]=w[13],Z[14]=w[14],Z[15]=w[15],Z}function A(w,Z){return w[0]=Z[0],w[1]=Z[1],w[2]=Z[2],w[3]=Z[3],w[4]=Z[4],w[5]=Z[5],w[6]=Z[6],w[7]=Z[7],w[8]=Z[8],w[9]=Z[9],w[10]=Z[10],w[11]=Z[11],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15],w}function Q(w,Z,Ee,Ze,Qe,yt,St,jt,Et,Qt,ie,sr,Br,Lr,nt,gt){var vt=new le.WT(16);return vt[0]=w,vt[1]=Z,vt[2]=Ee,vt[3]=Ze,vt[4]=Qe,vt[5]=yt,vt[6]=St,vt[7]=jt,vt[8]=Et,vt[9]=Qt,vt[10]=ie,vt[11]=sr,vt[12]=Br,vt[13]=Lr,vt[14]=nt,vt[15]=gt,vt}function K(w,Z,Ee,Ze,Qe,yt,St,jt,Et,Qt,ie,sr,Br,Lr,nt,gt,vt){return w[0]=Z,w[1]=Ee,w[2]=Ze,w[3]=Qe,w[4]=yt,w[5]=St,w[6]=jt,w[7]=Et,w[8]=Qt,w[9]=ie,w[10]=sr,w[11]=Br,w[12]=Lr,w[13]=nt,w[14]=gt,w[15]=vt,w}function W(w){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function L(w,Z){if(w===Z){var Ee=Z[1],Ze=Z[2],Qe=Z[3],yt=Z[6],St=Z[7],jt=Z[11];w[1]=Z[4],w[2]=Z[8],w[3]=Z[12],w[4]=Ee,w[6]=Z[9],w[7]=Z[13],w[8]=Ze,w[9]=yt,w[11]=Z[14],w[12]=Qe,w[13]=St,w[14]=jt}else w[0]=Z[0],w[1]=Z[4],w[2]=Z[8],w[3]=Z[12],w[4]=Z[1],w[5]=Z[5],w[6]=Z[9],w[7]=Z[13],w[8]=Z[2],w[9]=Z[6],w[10]=Z[10],w[11]=Z[14],w[12]=Z[3],w[13]=Z[7],w[14]=Z[11],w[15]=Z[15];return w}function N(w,Z){var Ee=Z[0],Ze=Z[1],Qe=Z[2],yt=Z[3],St=Z[4],jt=Z[5],Et=Z[6],Qt=Z[7],ie=Z[8],sr=Z[9],Br=Z[10],Lr=Z[11],nt=Z[12],gt=Z[13],vt=Z[14],hr=Z[15],Vr=Ee*jt-Ze*St,Ur=Ee*Et-Qe*St,nn=Ee*Qt-yt*St,Jr=Ze*Et-Qe*jt,Cr=Ze*Qt-yt*jt,Dn=Qe*Qt-yt*Et,Hn=ie*gt-sr*nt,bi=ie*vt-Br*nt,Ui=ie*hr-Lr*nt,Ji=sr*vt-Br*gt,Ri=sr*hr-Lr*gt,Ii=Br*hr-Lr*vt,Y=Vr*Ii-Ur*Ri+nn*Ji+Jr*Ui-Cr*bi+Dn*Hn;return Y?(Y=1/Y,w[0]=(jt*Ii-Et*Ri+Qt*Ji)*Y,w[1]=(Qe*Ri-Ze*Ii-yt*Ji)*Y,w[2]=(gt*Dn-vt*Cr+hr*Jr)*Y,w[3]=(Br*Cr-sr*Dn-Lr*Jr)*Y,w[4]=(Et*Ui-St*Ii-Qt*bi)*Y,w[5]=(Ee*Ii-Qe*Ui+yt*bi)*Y,w[6]=(vt*nn-nt*Dn-hr*Ur)*Y,w[7]=(ie*Dn-Br*nn+Lr*Ur)*Y,w[8]=(St*Ri-jt*Ui+Qt*Hn)*Y,w[9]=(Ze*Ui-Ee*Ri-yt*Hn)*Y,w[10]=(nt*Cr-gt*nn+hr*Vr)*Y,w[11]=(sr*nn-ie*Cr-Lr*Vr)*Y,w[12]=(jt*bi-St*Ji-Et*Hn)*Y,w[13]=(Ee*Ji-Ze*bi+Qe*Hn)*Y,w[14]=(gt*Ur-nt*Jr-vt*Vr)*Y,w[15]=(ie*Jr-sr*Ur+Br*Vr)*Y,w):null}function Ne(w,Z){var Ee=Z[0],Ze=Z[1],Qe=Z[2],yt=Z[3],St=Z[4],jt=Z[5],Et=Z[6],Qt=Z[7],ie=Z[8],sr=Z[9],Br=Z[10],Lr=Z[11],nt=Z[12],gt=Z[13],vt=Z[14],hr=Z[15];return w[0]=jt*(Br*hr-Lr*vt)-sr*(Et*hr-Qt*vt)+gt*(Et*Lr-Qt*Br),w[1]=-(Ze*(Br*hr-Lr*vt)-sr*(Qe*hr-yt*vt)+gt*(Qe*Lr-yt*Br)),w[2]=Ze*(Et*hr-Qt*vt)-jt*(Qe*hr-yt*vt)+gt*(Qe*Qt-yt*Et),w[3]=-(Ze*(Et*Lr-Qt*Br)-jt*(Qe*Lr-yt*Br)+sr*(Qe*Qt-yt*Et)),w[4]=-(St*(Br*hr-Lr*vt)-ie*(Et*hr-Qt*vt)+nt*(Et*Lr-Qt*Br)),w[5]=Ee*(Br*hr-Lr*vt)-ie*(Qe*hr-yt*vt)+nt*(Qe*Lr-yt*Br),w[6]=-(Ee*(Et*hr-Qt*vt)-St*(Qe*hr-yt*vt)+nt*(Qe*Qt-yt*Et)),w[7]=Ee*(Et*Lr-Qt*Br)-St*(Qe*Lr-yt*Br)+ie*(Qe*Qt-yt*Et),w[8]=St*(sr*hr-Lr*gt)-ie*(jt*hr-Qt*gt)+nt*(jt*Lr-Qt*sr),w[9]=-(Ee*(sr*hr-Lr*gt)-ie*(Ze*hr-yt*gt)+nt*(Ze*Lr-yt*sr)),w[10]=Ee*(jt*hr-Qt*gt)-St*(Ze*hr-yt*gt)+nt*(Ze*Qt-yt*jt),w[11]=-(Ee*(jt*Lr-Qt*sr)-St*(Ze*Lr-yt*sr)+ie*(Ze*Qt-yt*jt)),w[12]=-(St*(sr*vt-Br*gt)-ie*(jt*vt-Et*gt)+nt*(jt*Br-Et*sr)),w[13]=Ee*(sr*vt-Br*gt)-ie*(Ze*vt-Qe*gt)+nt*(Ze*Br-Qe*sr),w[14]=-(Ee*(jt*vt-Et*gt)-St*(Ze*vt-Qe*gt)+nt*(Ze*Et-Qe*jt)),w[15]=Ee*(jt*Br-Et*sr)-St*(Ze*Br-Qe*sr)+ie*(Ze*Et-Qe*jt),w}function Ye(w){var Z=w[0],Ee=w[1],Ze=w[2],Qe=w[3],yt=w[4],St=w[5],jt=w[6],Et=w[7],Qt=w[8],ie=w[9],sr=w[10],Br=w[11],Lr=w[12],nt=w[13],gt=w[14],vt=w[15],hr=Z*St-Ee*yt,Vr=Z*jt-Ze*yt,Ur=Z*Et-Qe*yt,nn=Ee*jt-Ze*St,Jr=Ee*Et-Qe*St,Cr=Ze*Et-Qe*jt,Dn=Qt*nt-ie*Lr,Hn=Qt*gt-sr*Lr,bi=Qt*vt-Br*Lr,Ui=ie*gt-sr*nt,Ji=ie*vt-Br*nt,Ri=sr*vt-Br*gt;return hr*Ri-Vr*Ji+Ur*Ui+nn*bi-Jr*Hn+Cr*Dn}function Je(w,Z,Ee){var Ze=Z[0],Qe=Z[1],yt=Z[2],St=Z[3],jt=Z[4],Et=Z[5],Qt=Z[6],ie=Z[7],sr=Z[8],Br=Z[9],Lr=Z[10],nt=Z[11],gt=Z[12],vt=Z[13],hr=Z[14],Vr=Z[15],Ur=Ee[0],nn=Ee[1],Jr=Ee[2],Cr=Ee[3];return w[0]=Ur*Ze+nn*jt+Jr*sr+Cr*gt,w[1]=Ur*Qe+nn*Et+Jr*Br+Cr*vt,w[2]=Ur*yt+nn*Qt+Jr*Lr+Cr*hr,w[3]=Ur*St+nn*ie+Jr*nt+Cr*Vr,Ur=Ee[4],nn=Ee[5],Jr=Ee[6],Cr=Ee[7],w[4]=Ur*Ze+nn*jt+Jr*sr+Cr*gt,w[5]=Ur*Qe+nn*Et+Jr*Br+Cr*vt,w[6]=Ur*yt+nn*Qt+Jr*Lr+Cr*hr,w[7]=Ur*St+nn*ie+Jr*nt+Cr*Vr,Ur=Ee[8],nn=Ee[9],Jr=Ee[10],Cr=Ee[11],w[8]=Ur*Ze+nn*jt+Jr*sr+Cr*gt,w[9]=Ur*Qe+nn*Et+Jr*Br+Cr*vt,w[10]=Ur*yt+nn*Qt+Jr*Lr+Cr*hr,w[11]=Ur*St+nn*ie+Jr*nt+Cr*Vr,Ur=Ee[12],nn=Ee[13],Jr=Ee[14],Cr=Ee[15],w[12]=Ur*Ze+nn*jt+Jr*sr+Cr*gt,w[13]=Ur*Qe+nn*Et+Jr*Br+Cr*vt,w[14]=Ur*yt+nn*Qt+Jr*Lr+Cr*hr,w[15]=Ur*St+nn*ie+Jr*nt+Cr*Vr,w}function rt(w,Z,Ee){var Ze=Ee[0],Qe=Ee[1],yt=Ee[2],St,jt,Et,Qt,ie,sr,Br,Lr,nt,gt,vt,hr;return Z===w?(w[12]=Z[0]*Ze+Z[4]*Qe+Z[8]*yt+Z[12],w[13]=Z[1]*Ze+Z[5]*Qe+Z[9]*yt+Z[13],w[14]=Z[2]*Ze+Z[6]*Qe+Z[10]*yt+Z[14],w[15]=Z[3]*Ze+Z[7]*Qe+Z[11]*yt+Z[15]):(St=Z[0],jt=Z[1],Et=Z[2],Qt=Z[3],ie=Z[4],sr=Z[5],Br=Z[6],Lr=Z[7],nt=Z[8],gt=Z[9],vt=Z[10],hr=Z[11],w[0]=St,w[1]=jt,w[2]=Et,w[3]=Qt,w[4]=ie,w[5]=sr,w[6]=Br,w[7]=Lr,w[8]=nt,w[9]=gt,w[10]=vt,w[11]=hr,w[12]=St*Ze+ie*Qe+nt*yt+Z[12],w[13]=jt*Ze+sr*Qe+gt*yt+Z[13],w[14]=Et*Ze+Br*Qe+vt*yt+Z[14],w[15]=Qt*Ze+Lr*Qe+hr*yt+Z[15]),w}function Yt(w,Z,Ee){var Ze=Ee[0],Qe=Ee[1],yt=Ee[2];return w[0]=Z[0]*Ze,w[1]=Z[1]*Ze,w[2]=Z[2]*Ze,w[3]=Z[3]*Ze,w[4]=Z[4]*Qe,w[5]=Z[5]*Qe,w[6]=Z[6]*Qe,w[7]=Z[7]*Qe,w[8]=Z[8]*yt,w[9]=Z[9]*yt,w[10]=Z[10]*yt,w[11]=Z[11]*yt,w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15],w}function Vt(w,Z,Ee,Ze){var Qe=Ze[0],yt=Ze[1],St=Ze[2],jt=Math.hypot(Qe,yt,St),Et,Qt,ie,sr,Br,Lr,nt,gt,vt,hr,Vr,Ur,nn,Jr,Cr,Dn,Hn,bi,Ui,Ji,Ri,Ii,Y,ce;return jt<le.Ib?null:(jt=1/jt,Qe*=jt,yt*=jt,St*=jt,Et=Math.sin(Ee),Qt=Math.cos(Ee),ie=1-Qt,sr=Z[0],Br=Z[1],Lr=Z[2],nt=Z[3],gt=Z[4],vt=Z[5],hr=Z[6],Vr=Z[7],Ur=Z[8],nn=Z[9],Jr=Z[10],Cr=Z[11],Dn=Qe*Qe*ie+Qt,Hn=yt*Qe*ie+St*Et,bi=St*Qe*ie-yt*Et,Ui=Qe*yt*ie-St*Et,Ji=yt*yt*ie+Qt,Ri=St*yt*ie+Qe*Et,Ii=Qe*St*ie+yt*Et,Y=yt*St*ie-Qe*Et,ce=St*St*ie+Qt,w[0]=sr*Dn+gt*Hn+Ur*bi,w[1]=Br*Dn+vt*Hn+nn*bi,w[2]=Lr*Dn+hr*Hn+Jr*bi,w[3]=nt*Dn+Vr*Hn+Cr*bi,w[4]=sr*Ui+gt*Ji+Ur*Ri,w[5]=Br*Ui+vt*Ji+nn*Ri,w[6]=Lr*Ui+hr*Ji+Jr*Ri,w[7]=nt*Ui+Vr*Ji+Cr*Ri,w[8]=sr*Ii+gt*Y+Ur*ce,w[9]=Br*Ii+vt*Y+nn*ce,w[10]=Lr*Ii+hr*Y+Jr*ce,w[11]=nt*Ii+Vr*Y+Cr*ce,Z!==w&&(w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w)}function tr(w,Z,Ee){var Ze=Math.sin(Ee),Qe=Math.cos(Ee),yt=Z[4],St=Z[5],jt=Z[6],Et=Z[7],Qt=Z[8],ie=Z[9],sr=Z[10],Br=Z[11];return Z!==w&&(w[0]=Z[0],w[1]=Z[1],w[2]=Z[2],w[3]=Z[3],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w[4]=yt*Qe+Qt*Ze,w[5]=St*Qe+ie*Ze,w[6]=jt*Qe+sr*Ze,w[7]=Et*Qe+Br*Ze,w[8]=Qt*Qe-yt*Ze,w[9]=ie*Qe-St*Ze,w[10]=sr*Qe-jt*Ze,w[11]=Br*Qe-Et*Ze,w}function zt(w,Z,Ee){var Ze=Math.sin(Ee),Qe=Math.cos(Ee),yt=Z[0],St=Z[1],jt=Z[2],Et=Z[3],Qt=Z[8],ie=Z[9],sr=Z[10],Br=Z[11];return Z!==w&&(w[4]=Z[4],w[5]=Z[5],w[6]=Z[6],w[7]=Z[7],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w[0]=yt*Qe-Qt*Ze,w[1]=St*Qe-ie*Ze,w[2]=jt*Qe-sr*Ze,w[3]=Et*Qe-Br*Ze,w[8]=yt*Ze+Qt*Qe,w[9]=St*Ze+ie*Qe,w[10]=jt*Ze+sr*Qe,w[11]=Et*Ze+Br*Qe,w}function Tt(w,Z,Ee){var Ze=Math.sin(Ee),Qe=Math.cos(Ee),yt=Z[0],St=Z[1],jt=Z[2],Et=Z[3],Qt=Z[4],ie=Z[5],sr=Z[6],Br=Z[7];return Z!==w&&(w[8]=Z[8],w[9]=Z[9],w[10]=Z[10],w[11]=Z[11],w[12]=Z[12],w[13]=Z[13],w[14]=Z[14],w[15]=Z[15]),w[0]=yt*Qe+Qt*Ze,w[1]=St*Qe+ie*Ze,w[2]=jt*Qe+sr*Ze,w[3]=Et*Qe+Br*Ze,w[4]=Qt*Qe-yt*Ze,w[5]=ie*Qe-St*Ze,w[6]=sr*Qe-jt*Ze,w[7]=Br*Qe-Et*Ze,w}function xt(w,Z){return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=Z[0],w[13]=Z[1],w[14]=Z[2],w[15]=1,w}function yr(w,Z){return w[0]=Z[0],w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Z[1],w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=Z[2],w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ee(w,Z,Ee){var Ze=Ee[0],Qe=Ee[1],yt=Ee[2],St=Math.hypot(Ze,Qe,yt),jt,Et,Qt;return St<le.Ib?null:(St=1/St,Ze*=St,Qe*=St,yt*=St,jt=Math.sin(Z),Et=Math.cos(Z),Qt=1-Et,w[0]=Ze*Ze*Qt+Et,w[1]=Qe*Ze*Qt+yt*jt,w[2]=yt*Ze*Qt-Qe*jt,w[3]=0,w[4]=Ze*Qe*Qt-yt*jt,w[5]=Qe*Qe*Qt+Et,w[6]=yt*Qe*Qt+Ze*jt,w[7]=0,w[8]=Ze*yt*Qt+Qe*jt,w[9]=Qe*yt*Qt-Ze*jt,w[10]=yt*yt*Qt+Et,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w)}function dr(w,Z){var Ee=Math.sin(Z),Ze=Math.cos(Z);return w[0]=1,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Ze,w[6]=Ee,w[7]=0,w[8]=0,w[9]=-Ee,w[10]=Ze,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ct(w,Z){var Ee=Math.sin(Z),Ze=Math.cos(Z);return w[0]=Ze,w[1]=0,w[2]=-Ee,w[3]=0,w[4]=0,w[5]=1,w[6]=0,w[7]=0,w[8]=Ee,w[9]=0,w[10]=Ze,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Ke(w,Z){var Ee=Math.sin(Z),Ze=Math.cos(Z);return w[0]=Ze,w[1]=Ee,w[2]=0,w[3]=0,w[4]=-Ee,w[5]=Ze,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=1,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function Dt(w,Z,Ee){var Ze=Z[0],Qe=Z[1],yt=Z[2],St=Z[3],jt=Ze+Ze,Et=Qe+Qe,Qt=yt+yt,ie=Ze*jt,sr=Ze*Et,Br=Ze*Qt,Lr=Qe*Et,nt=Qe*Qt,gt=yt*Qt,vt=St*jt,hr=St*Et,Vr=St*Qt;return w[0]=1-(Lr+gt),w[1]=sr+Vr,w[2]=Br-hr,w[3]=0,w[4]=sr-Vr,w[5]=1-(ie+gt),w[6]=nt+vt,w[7]=0,w[8]=Br+hr,w[9]=nt-vt,w[10]=1-(ie+Lr),w[11]=0,w[12]=Ee[0],w[13]=Ee[1],w[14]=Ee[2],w[15]=1,w}function Xe(w,Z){var Ee=new le.WT(3),Ze=-Z[0],Qe=-Z[1],yt=-Z[2],St=Z[3],jt=Z[4],Et=Z[5],Qt=Z[6],ie=Z[7],sr=Ze*Ze+Qe*Qe+yt*yt+St*St;return sr>0?(Ee[0]=(jt*St+ie*Ze+Et*yt-Qt*Qe)*2/sr,Ee[1]=(Et*St+ie*Qe+Qt*Ze-jt*yt)*2/sr,Ee[2]=(Qt*St+ie*yt+jt*Qe-Et*Ze)*2/sr):(Ee[0]=(jt*St+ie*Ze+Et*yt-Qt*Qe)*2,Ee[1]=(Et*St+ie*Qe+Qt*Ze-jt*yt)*2,Ee[2]=(Qt*St+ie*yt+jt*Qe-Et*Ze)*2),Dt(w,Z,Ee),w}function Ut(w,Z){return w[0]=Z[12],w[1]=Z[13],w[2]=Z[14],w}function _r(w,Z){var Ee=Z[0],Ze=Z[1],Qe=Z[2],yt=Z[4],St=Z[5],jt=Z[6],Et=Z[8],Qt=Z[9],ie=Z[10];return w[0]=Math.hypot(Ee,Ze,Qe),w[1]=Math.hypot(yt,St,jt),w[2]=Math.hypot(Et,Qt,ie),w}function ar(w,Z){var Ee=new le.WT(3);_r(Ee,Z);var Ze=1/Ee[0],Qe=1/Ee[1],yt=1/Ee[2],St=Z[0]*Ze,jt=Z[1]*Qe,Et=Z[2]*yt,Qt=Z[4]*Ze,ie=Z[5]*Qe,sr=Z[6]*yt,Br=Z[8]*Ze,Lr=Z[9]*Qe,nt=Z[10]*yt,gt=St+ie+nt,vt=0;return gt>0?(vt=Math.sqrt(gt+1)*2,w[3]=.25*vt,w[0]=(sr-Lr)/vt,w[1]=(Br-Et)/vt,w[2]=(jt-Qt)/vt):St>ie&&St>nt?(vt=Math.sqrt(1+St-ie-nt)*2,w[3]=(sr-Lr)/vt,w[0]=.25*vt,w[1]=(jt+Qt)/vt,w[2]=(Br+Et)/vt):ie>nt?(vt=Math.sqrt(1+ie-St-nt)*2,w[3]=(Br-Et)/vt,w[0]=(jt+Qt)/vt,w[1]=.25*vt,w[2]=(sr+Lr)/vt):(vt=Math.sqrt(1+nt-St-ie)*2,w[3]=(jt-Qt)/vt,w[0]=(Br+Et)/vt,w[1]=(sr+Lr)/vt,w[2]=.25*vt),w}function zr(w,Z,Ee,Ze){var Qe=Z[0],yt=Z[1],St=Z[2],jt=Z[3],Et=Qe+Qe,Qt=yt+yt,ie=St+St,sr=Qe*Et,Br=Qe*Qt,Lr=Qe*ie,nt=yt*Qt,gt=yt*ie,vt=St*ie,hr=jt*Et,Vr=jt*Qt,Ur=jt*ie,nn=Ze[0],Jr=Ze[1],Cr=Ze[2];return w[0]=(1-(nt+vt))*nn,w[1]=(Br+Ur)*nn,w[2]=(Lr-Vr)*nn,w[3]=0,w[4]=(Br-Ur)*Jr,w[5]=(1-(sr+vt))*Jr,w[6]=(gt+hr)*Jr,w[7]=0,w[8]=(Lr+Vr)*Cr,w[9]=(gt-hr)*Cr,w[10]=(1-(sr+nt))*Cr,w[11]=0,w[12]=Ee[0],w[13]=Ee[1],w[14]=Ee[2],w[15]=1,w}function fe(w,Z,Ee,Ze,Qe){var yt=Z[0],St=Z[1],jt=Z[2],Et=Z[3],Qt=yt+yt,ie=St+St,sr=jt+jt,Br=yt*Qt,Lr=yt*ie,nt=yt*sr,gt=St*ie,vt=St*sr,hr=jt*sr,Vr=Et*Qt,Ur=Et*ie,nn=Et*sr,Jr=Ze[0],Cr=Ze[1],Dn=Ze[2],Hn=Qe[0],bi=Qe[1],Ui=Qe[2],Ji=(1-(gt+hr))*Jr,Ri=(Lr+nn)*Jr,Ii=(nt-Ur)*Jr,Y=(Lr-nn)*Cr,ce=(1-(Br+hr))*Cr,ye=(vt+Vr)*Cr,z=(nt+Ur)*Dn,oe=(vt-Vr)*Dn,me=(1-(Br+gt))*Dn;return w[0]=Ji,w[1]=Ri,w[2]=Ii,w[3]=0,w[4]=Y,w[5]=ce,w[6]=ye,w[7]=0,w[8]=z,w[9]=oe,w[10]=me,w[11]=0,w[12]=Ee[0]+Hn-(Ji*Hn+Y*bi+z*Ui),w[13]=Ee[1]+bi-(Ri*Hn+ce*bi+oe*Ui),w[14]=Ee[2]+Ui-(Ii*Hn+ye*bi+me*Ui),w[15]=1,w}function Re(w,Z){var Ee=Z[0],Ze=Z[1],Qe=Z[2],yt=Z[3],St=Ee+Ee,jt=Ze+Ze,Et=Qe+Qe,Qt=Ee*St,ie=Ze*St,sr=Ze*jt,Br=Qe*St,Lr=Qe*jt,nt=Qe*Et,gt=yt*St,vt=yt*jt,hr=yt*Et;return w[0]=1-sr-nt,w[1]=ie+hr,w[2]=Br-vt,w[3]=0,w[4]=ie-hr,w[5]=1-Qt-nt,w[6]=Lr+gt,w[7]=0,w[8]=Br+vt,w[9]=Lr-gt,w[10]=1-Qt-sr,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,w}function ge(w,Z,Ee,Ze,Qe,yt,St){var jt=1/(Ee-Z),Et=1/(Qe-Ze),Qt=1/(yt-St);return w[0]=yt*2*jt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=yt*2*Et,w[6]=0,w[7]=0,w[8]=(Ee+Z)*jt,w[9]=(Qe+Ze)*Et,w[10]=(St+yt)*Qt,w[11]=-1,w[12]=0,w[13]=0,w[14]=St*yt*2*Qt,w[15]=0,w}function _t(w,Z,Ee,Ze,Qe){var yt=1/Math.tan(Z/2),St;return w[0]=yt/Ee,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=yt,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[11]=-1,w[12]=0,w[13]=0,w[15]=0,Qe!=null&&Qe!==Infinity?(St=1/(Ze-Qe),w[10]=(Qe+Ze)*St,w[14]=2*Qe*Ze*St):(w[10]=-1,w[14]=-2*Ze),w}function pt(w,Z,Ee,Ze){var Qe=Math.tan(Z.upDegrees*Math.PI/180),yt=Math.tan(Z.downDegrees*Math.PI/180),St=Math.tan(Z.leftDegrees*Math.PI/180),jt=Math.tan(Z.rightDegrees*Math.PI/180),Et=2/(St+jt),Qt=2/(Qe+yt);return w[0]=Et,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=Qt,w[6]=0,w[7]=0,w[8]=-((St-jt)*Et*.5),w[9]=(Qe-yt)*Qt*.5,w[10]=Ze/(Ee-Ze),w[11]=-1,w[12]=0,w[13]=0,w[14]=Ze*Ee/(Ee-Ze),w[15]=0,w}function Nt(w,Z,Ee,Ze,Qe,yt,St){var jt=1/(Z-Ee),Et=1/(Ze-Qe),Qt=1/(yt-St);return w[0]=-2*jt,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=-2*Et,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=2*Qt,w[11]=0,w[12]=(Z+Ee)*jt,w[13]=(Qe+Ze)*Et,w[14]=(St+yt)*Qt,w[15]=1,w}function Bt(w,Z,Ee,Ze){var Qe,yt,St,jt,Et,Qt,ie,sr,Br,Lr,nt=Z[0],gt=Z[1],vt=Z[2],hr=Ze[0],Vr=Ze[1],Ur=Ze[2],nn=Ee[0],Jr=Ee[1],Cr=Ee[2];return Math.abs(nt-nn)<le.Ib&&Math.abs(gt-Jr)<le.Ib&&Math.abs(vt-Cr)<le.Ib?W(w):(ie=nt-nn,sr=gt-Jr,Br=vt-Cr,Lr=1/Math.hypot(ie,sr,Br),ie*=Lr,sr*=Lr,Br*=Lr,Qe=Vr*Br-Ur*sr,yt=Ur*ie-hr*Br,St=hr*sr-Vr*ie,Lr=Math.hypot(Qe,yt,St),Lr?(Lr=1/Lr,Qe*=Lr,yt*=Lr,St*=Lr):(Qe=0,yt=0,St=0),jt=sr*St-Br*yt,Et=Br*Qe-ie*St,Qt=ie*yt-sr*Qe,Lr=Math.hypot(jt,Et,Qt),Lr?(Lr=1/Lr,jt*=Lr,Et*=Lr,Qt*=Lr):(jt=0,Et=0,Qt=0),w[0]=Qe,w[1]=jt,w[2]=ie,w[3]=0,w[4]=yt,w[5]=Et,w[6]=sr,w[7]=0,w[8]=St,w[9]=Qt,w[10]=Br,w[11]=0,w[12]=-(Qe*nt+yt*gt+St*vt),w[13]=-(jt*nt+Et*gt+Qt*vt),w[14]=-(ie*nt+sr*gt+Br*vt),w[15]=1,w)}function kr(w,Z,Ee,Ze){var Qe=Z[0],yt=Z[1],St=Z[2],jt=Ze[0],Et=Ze[1],Qt=Ze[2],ie=Qe-Ee[0],sr=yt-Ee[1],Br=St-Ee[2],Lr=ie*ie+sr*sr+Br*Br;Lr>0&&(Lr=1/Math.sqrt(Lr),ie*=Lr,sr*=Lr,Br*=Lr);var nt=Et*Br-Qt*sr,gt=Qt*ie-jt*Br,vt=jt*sr-Et*ie;return Lr=nt*nt+gt*gt+vt*vt,Lr>0&&(Lr=1/Math.sqrt(Lr),nt*=Lr,gt*=Lr,vt*=Lr),w[0]=nt,w[1]=gt,w[2]=vt,w[3]=0,w[4]=sr*vt-Br*gt,w[5]=Br*nt-ie*vt,w[6]=ie*gt-sr*nt,w[7]=0,w[8]=ie,w[9]=sr,w[10]=Br,w[11]=0,w[12]=Qe,w[13]=yt,w[14]=St,w[15]=1,w}function ln(w){return"mat4("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+", "+w[4]+", "+w[5]+", "+w[6]+", "+w[7]+", "+w[8]+", "+w[9]+", "+w[10]+", "+w[11]+", "+w[12]+", "+w[13]+", "+w[14]+", "+w[15]+")"}function yn(w){return Math.hypot(w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7],w[8],w[9],w[10],w[11],w[12],w[13],w[14],w[15])}function Vi(w,Z,Ee){return w[0]=Z[0]+Ee[0],w[1]=Z[1]+Ee[1],w[2]=Z[2]+Ee[2],w[3]=Z[3]+Ee[3],w[4]=Z[4]+Ee[4],w[5]=Z[5]+Ee[5],w[6]=Z[6]+Ee[6],w[7]=Z[7]+Ee[7],w[8]=Z[8]+Ee[8],w[9]=Z[9]+Ee[9],w[10]=Z[10]+Ee[10],w[11]=Z[11]+Ee[11],w[12]=Z[12]+Ee[12],w[13]=Z[13]+Ee[13],w[14]=Z[14]+Ee[14],w[15]=Z[15]+Ee[15],w}function nr(w,Z,Ee){return w[0]=Z[0]-Ee[0],w[1]=Z[1]-Ee[1],w[2]=Z[2]-Ee[2],w[3]=Z[3]-Ee[3],w[4]=Z[4]-Ee[4],w[5]=Z[5]-Ee[5],w[6]=Z[6]-Ee[6],w[7]=Z[7]-Ee[7],w[8]=Z[8]-Ee[8],w[9]=Z[9]-Ee[9],w[10]=Z[10]-Ee[10],w[11]=Z[11]-Ee[11],w[12]=Z[12]-Ee[12],w[13]=Z[13]-Ee[13],w[14]=Z[14]-Ee[14],w[15]=Z[15]-Ee[15],w}function de(w,Z,Ee){return w[0]=Z[0]*Ee,w[1]=Z[1]*Ee,w[2]=Z[2]*Ee,w[3]=Z[3]*Ee,w[4]=Z[4]*Ee,w[5]=Z[5]*Ee,w[6]=Z[6]*Ee,w[7]=Z[7]*Ee,w[8]=Z[8]*Ee,w[9]=Z[9]*Ee,w[10]=Z[10]*Ee,w[11]=Z[11]*Ee,w[12]=Z[12]*Ee,w[13]=Z[13]*Ee,w[14]=Z[14]*Ee,w[15]=Z[15]*Ee,w}function Te(w,Z,Ee,Ze){return w[0]=Z[0]+Ee[0]*Ze,w[1]=Z[1]+Ee[1]*Ze,w[2]=Z[2]+Ee[2]*Ze,w[3]=Z[3]+Ee[3]*Ze,w[4]=Z[4]+Ee[4]*Ze,w[5]=Z[5]+Ee[5]*Ze,w[6]=Z[6]+Ee[6]*Ze,w[7]=Z[7]+Ee[7]*Ze,w[8]=Z[8]+Ee[8]*Ze,w[9]=Z[9]+Ee[9]*Ze,w[10]=Z[10]+Ee[10]*Ze,w[11]=Z[11]+Ee[11]*Ze,w[12]=Z[12]+Ee[12]*Ze,w[13]=Z[13]+Ee[13]*Ze,w[14]=Z[14]+Ee[14]*Ze,w[15]=Z[15]+Ee[15]*Ze,w}function Ue(w,Z){return w[0]===Z[0]&&w[1]===Z[1]&&w[2]===Z[2]&&w[3]===Z[3]&&w[4]===Z[4]&&w[5]===Z[5]&&w[6]===Z[6]&&w[7]===Z[7]&&w[8]===Z[8]&&w[9]===Z[9]&&w[10]===Z[10]&&w[11]===Z[11]&&w[12]===Z[12]&&w[13]===Z[13]&&w[14]===Z[14]&&w[15]===Z[15]}function Le(w,Z){var Ee=w[0],Ze=w[1],Qe=w[2],yt=w[3],St=w[4],jt=w[5],Et=w[6],Qt=w[7],ie=w[8],sr=w[9],Br=w[10],Lr=w[11],nt=w[12],gt=w[13],vt=w[14],hr=w[15],Vr=Z[0],Ur=Z[1],nn=Z[2],Jr=Z[3],Cr=Z[4],Dn=Z[5],Hn=Z[6],bi=Z[7],Ui=Z[8],Ji=Z[9],Ri=Z[10],Ii=Z[11],Y=Z[12],ce=Z[13],ye=Z[14],z=Z[15];return Math.abs(Ee-Vr)<=le.Ib*Math.max(1,Math.abs(Ee),Math.abs(Vr))&&Math.abs(Ze-Ur)<=le.Ib*Math.max(1,Math.abs(Ze),Math.abs(Ur))&&Math.abs(Qe-nn)<=le.Ib*Math.max(1,Math.abs(Qe),Math.abs(nn))&&Math.abs(yt-Jr)<=le.Ib*Math.max(1,Math.abs(yt),Math.abs(Jr))&&Math.abs(St-Cr)<=le.Ib*Math.max(1,Math.abs(St),Math.abs(Cr))&&Math.abs(jt-Dn)<=le.Ib*Math.max(1,Math.abs(jt),Math.abs(Dn))&&Math.abs(Et-Hn)<=le.Ib*Math.max(1,Math.abs(Et),Math.abs(Hn))&&Math.abs(Qt-bi)<=le.Ib*Math.max(1,Math.abs(Qt),Math.abs(bi))&&Math.abs(ie-Ui)<=le.Ib*Math.max(1,Math.abs(ie),Math.abs(Ui))&&Math.abs(sr-Ji)<=le.Ib*Math.max(1,Math.abs(sr),Math.abs(Ji))&&Math.abs(Br-Ri)<=le.Ib*Math.max(1,Math.abs(Br),Math.abs(Ri))&&Math.abs(Lr-Ii)<=le.Ib*Math.max(1,Math.abs(Lr),Math.abs(Ii))&&Math.abs(nt-Y)<=le.Ib*Math.max(1,Math.abs(nt),Math.abs(Y))&&Math.abs(gt-ce)<=le.Ib*Math.max(1,Math.abs(gt),Math.abs(ce))&&Math.abs(vt-ye)<=le.Ib*Math.max(1,Math.abs(vt),Math.abs(ye))&&Math.abs(hr-z)<=le.Ib*Math.max(1,Math.abs(hr),Math.abs(z))}var Ft=Je,er=nr},98333:function(Or,U,E){"use strict";E.d(U,{Ue:function(){return C},al:function(){return A},bA:function(){return tr},fF:function(){return ar}});var le=E(49685);function C(){var de=new le.WT(4);return le.WT!=Float32Array&&(de[0]=0,de[1]=0,de[2]=0,de[3]=0),de}function d(de){var Te=new glMatrix.ARRAY_TYPE(4);return Te[0]=de[0],Te[1]=de[1],Te[2]=de[2],Te[3]=de[3],Te}function A(de,Te,Ue,Le){var Ft=new le.WT(4);return Ft[0]=de,Ft[1]=Te,Ft[2]=Ue,Ft[3]=Le,Ft}function Q(de,Te){return de[0]=Te[0],de[1]=Te[1],de[2]=Te[2],de[3]=Te[3],de}function K(de,Te,Ue,Le,Ft){return de[0]=Te,de[1]=Ue,de[2]=Le,de[3]=Ft,de}function W(de,Te,Ue){return de[0]=Te[0]+Ue[0],de[1]=Te[1]+Ue[1],de[2]=Te[2]+Ue[2],de[3]=Te[3]+Ue[3],de}function L(de,Te,Ue){return de[0]=Te[0]-Ue[0],de[1]=Te[1]-Ue[1],de[2]=Te[2]-Ue[2],de[3]=Te[3]-Ue[3],de}function N(de,Te,Ue){return de[0]=Te[0]*Ue[0],de[1]=Te[1]*Ue[1],de[2]=Te[2]*Ue[2],de[3]=Te[3]*Ue[3],de}function Ne(de,Te,Ue){return de[0]=Te[0]/Ue[0],de[1]=Te[1]/Ue[1],de[2]=Te[2]/Ue[2],de[3]=Te[3]/Ue[3],de}function Ye(de,Te){return de[0]=Math.ceil(Te[0]),de[1]=Math.ceil(Te[1]),de[2]=Math.ceil(Te[2]),de[3]=Math.ceil(Te[3]),de}function Je(de,Te){return de[0]=Math.floor(Te[0]),de[1]=Math.floor(Te[1]),de[2]=Math.floor(Te[2]),de[3]=Math.floor(Te[3]),de}function rt(de,Te,Ue){return de[0]=Math.min(Te[0],Ue[0]),de[1]=Math.min(Te[1],Ue[1]),de[2]=Math.min(Te[2],Ue[2]),de[3]=Math.min(Te[3],Ue[3]),de}function Yt(de,Te,Ue){return de[0]=Math.max(Te[0],Ue[0]),de[1]=Math.max(Te[1],Ue[1]),de[2]=Math.max(Te[2],Ue[2]),de[3]=Math.max(Te[3],Ue[3]),de}function Vt(de,Te){return de[0]=Math.round(Te[0]),de[1]=Math.round(Te[1]),de[2]=Math.round(Te[2]),de[3]=Math.round(Te[3]),de}function tr(de,Te,Ue){return de[0]=Te[0]*Ue,de[1]=Te[1]*Ue,de[2]=Te[2]*Ue,de[3]=Te[3]*Ue,de}function zt(de,Te,Ue,Le){return de[0]=Te[0]+Ue[0]*Le,de[1]=Te[1]+Ue[1]*Le,de[2]=Te[2]+Ue[2]*Le,de[3]=Te[3]+Ue[3]*Le,de}function Tt(de,Te){var Ue=Te[0]-de[0],Le=Te[1]-de[1],Ft=Te[2]-de[2],er=Te[3]-de[3];return Math.hypot(Ue,Le,Ft,er)}function xt(de,Te){var Ue=Te[0]-de[0],Le=Te[1]-de[1],Ft=Te[2]-de[2],er=Te[3]-de[3];return Ue*Ue+Le*Le+Ft*Ft+er*er}function yr(de){var Te=de[0],Ue=de[1],Le=de[2],Ft=de[3];return Math.hypot(Te,Ue,Le,Ft)}function ee(de){var Te=de[0],Ue=de[1],Le=de[2],Ft=de[3];return Te*Te+Ue*Ue+Le*Le+Ft*Ft}function dr(de,Te){return de[0]=-Te[0],de[1]=-Te[1],de[2]=-Te[2],de[3]=-Te[3],de}function Ct(de,Te){return de[0]=1/Te[0],de[1]=1/Te[1],de[2]=1/Te[2],de[3]=1/Te[3],de}function Ke(de,Te){var Ue=Te[0],Le=Te[1],Ft=Te[2],er=Te[3],w=Ue*Ue+Le*Le+Ft*Ft+er*er;return w>0&&(w=1/Math.sqrt(w)),de[0]=Ue*w,de[1]=Le*w,de[2]=Ft*w,de[3]=er*w,de}function Dt(de,Te){return de[0]*Te[0]+de[1]*Te[1]+de[2]*Te[2]+de[3]*Te[3]}function Xe(de,Te,Ue,Le){var Ft=Ue[0]*Le[1]-Ue[1]*Le[0],er=Ue[0]*Le[2]-Ue[2]*Le[0],w=Ue[0]*Le[3]-Ue[3]*Le[0],Z=Ue[1]*Le[2]-Ue[2]*Le[1],Ee=Ue[1]*Le[3]-Ue[3]*Le[1],Ze=Ue[2]*Le[3]-Ue[3]*Le[2],Qe=Te[0],yt=Te[1],St=Te[2],jt=Te[3];return de[0]=yt*Ze-St*Ee+jt*Z,de[1]=-(Qe*Ze)+St*w-jt*er,de[2]=Qe*Ee-yt*w+jt*Ft,de[3]=-(Qe*Z)+yt*er-St*Ft,de}function Ut(de,Te,Ue,Le){var Ft=Te[0],er=Te[1],w=Te[2],Z=Te[3];return de[0]=Ft+Le*(Ue[0]-Ft),de[1]=er+Le*(Ue[1]-er),de[2]=w+Le*(Ue[2]-w),de[3]=Z+Le*(Ue[3]-Z),de}function _r(de,Te){Te=Te||1;var Ue,Le,Ft,er,w,Z;do Ue=glMatrix.RANDOM()*2-1,Le=glMatrix.RANDOM()*2-1,w=Ue*Ue+Le*Le;while(w>=1);do Ft=glMatrix.RANDOM()*2-1,er=glMatrix.RANDOM()*2-1,Z=Ft*Ft+er*er;while(Z>=1);var Ee=Math.sqrt((1-w)/Z);return de[0]=Te*Ue,de[1]=Te*Le,de[2]=Te*Ft*Ee,de[3]=Te*er*Ee,de}function ar(de,Te,Ue){var Le=Te[0],Ft=Te[1],er=Te[2],w=Te[3];return de[0]=Ue[0]*Le+Ue[4]*Ft+Ue[8]*er+Ue[12]*w,de[1]=Ue[1]*Le+Ue[5]*Ft+Ue[9]*er+Ue[13]*w,de[2]=Ue[2]*Le+Ue[6]*Ft+Ue[10]*er+Ue[14]*w,de[3]=Ue[3]*Le+Ue[7]*Ft+Ue[11]*er+Ue[15]*w,de}function zr(de,Te,Ue){var Le=Te[0],Ft=Te[1],er=Te[2],w=Ue[0],Z=Ue[1],Ee=Ue[2],Ze=Ue[3],Qe=Ze*Le+Z*er-Ee*Ft,yt=Ze*Ft+Ee*Le-w*er,St=Ze*er+w*Ft-Z*Le,jt=-w*Le-Z*Ft-Ee*er;return de[0]=Qe*Ze+jt*-w+yt*-Ee-St*-Z,de[1]=yt*Ze+jt*-Z+St*-w-Qe*-Ee,de[2]=St*Ze+jt*-Ee+Qe*-Z-yt*-w,de[3]=Te[3],de}function fe(de){return de[0]=0,de[1]=0,de[2]=0,de[3]=0,de}function Re(de){return"vec4("+de[0]+", "+de[1]+", "+de[2]+", "+de[3]+")"}function ge(de,Te){return de[0]===Te[0]&&de[1]===Te[1]&&de[2]===Te[2]&&de[3]===Te[3]}function _t(de,Te){var Ue=de[0],Le=de[1],Ft=de[2],er=de[3],w=Te[0],Z=Te[1],Ee=Te[2],Ze=Te[3];return Math.abs(Ue-w)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ue),Math.abs(w))&&Math.abs(Le-Z)<=glMatrix.EPSILON*Math.max(1,Math.abs(Le),Math.abs(Z))&&Math.abs(Ft-Ee)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ft),Math.abs(Ee))&&Math.abs(er-Ze)<=glMatrix.EPSILON*Math.max(1,Math.abs(er),Math.abs(Ze))}var pt=null,Nt=null,Bt=null,kr=null,ln=null,yn=null,Vi=null,nr=function(){var de=C();return function(Te,Ue,Le,Ft,er,w){var Z,Ee;for(Ue||(Ue=4),Le||(Le=0),Ft?Ee=Math.min(Ft*Ue+Le,Te.length):Ee=Te.length,Z=Le;Z<Ee;Z+=Ue)de[0]=Te[Z],de[1]=Te[Z+1],de[2]=Te[Z+2],de[3]=Te[Z+3],er(de,de,w),Te[Z]=de[0],Te[Z+1]=de[1],Te[Z+2]=de[2],Te[Z+3]=de[3];return Te}}()},50840:function(Or,U,E){var le;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(C,d,A,Q){"use strict";var K=["","webkit","Moz","MS","ms","o"],W=d.createElement("div"),L="function",N=Math.round,Ne=Math.abs,Ye=Date.now;function Je(xe,ke,lt){return setTimeout(yr(xe,lt),ke)}function rt(xe,ke,lt){return Array.isArray(xe)?(Yt(xe,lt[ke],lt),!0):!1}function Yt(xe,ke,lt){var Xt;if(!!xe)if(xe.forEach)xe.forEach(ke,lt);else if(xe.length!==Q)for(Xt=0;Xt<xe.length;)ke.call(lt,xe[Xt],Xt,xe),Xt++;else for(Xt in xe)xe.hasOwnProperty(Xt)&&ke.call(lt,xe[Xt],Xt,xe)}function Vt(xe,ke,lt){var Xt="DEPRECATED METHOD: "+ke+`
`+lt+` AT 
`;return function(){var Xr=new Error("get-stack-trace"),$n=Xr&&Xr.stack?Xr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",yi=C.console&&(C.console.warn||C.console.log);return yi&&yi.call(C.console,Xt,$n),xe.apply(this,arguments)}}var tr;typeof Object.assign!="function"?tr=function(ke){if(ke===Q||ke===null)throw new TypeError("Cannot convert undefined or null to object");for(var lt=Object(ke),Xt=1;Xt<arguments.length;Xt++){var Xr=arguments[Xt];if(Xr!==Q&&Xr!==null)for(var $n in Xr)Xr.hasOwnProperty($n)&&(lt[$n]=Xr[$n])}return lt}:tr=Object.assign;var zt=Vt(function(ke,lt,Xt){for(var Xr=Object.keys(lt),$n=0;$n<Xr.length;)(!Xt||Xt&&ke[Xr[$n]]===Q)&&(ke[Xr[$n]]=lt[Xr[$n]]),$n++;return ke},"extend","Use `assign`."),Tt=Vt(function(ke,lt){return zt(ke,lt,!0)},"merge","Use `assign`.");function xt(xe,ke,lt){var Xt=ke.prototype,Xr;Xr=xe.prototype=Object.create(Xt),Xr.constructor=xe,Xr._super=Xt,lt&&tr(Xr,lt)}function yr(xe,ke){return function(){return xe.apply(ke,arguments)}}function ee(xe,ke){return typeof xe==L?xe.apply(ke&&ke[0]||Q,ke):xe}function dr(xe,ke){return xe===Q?ke:xe}function Ct(xe,ke,lt){Yt(Ut(ke),function(Xt){xe.addEventListener(Xt,lt,!1)})}function Ke(xe,ke,lt){Yt(Ut(ke),function(Xt){xe.removeEventListener(Xt,lt,!1)})}function Dt(xe,ke){for(;xe;){if(xe==ke)return!0;xe=xe.parentNode}return!1}function Xe(xe,ke){return xe.indexOf(ke)>-1}function Ut(xe){return xe.trim().split(/\s+/g)}function _r(xe,ke,lt){if(xe.indexOf&&!lt)return xe.indexOf(ke);for(var Xt=0;Xt<xe.length;){if(lt&&xe[Xt][lt]==ke||!lt&&xe[Xt]===ke)return Xt;Xt++}return-1}function ar(xe){return Array.prototype.slice.call(xe,0)}function zr(xe,ke,lt){for(var Xt=[],Xr=[],$n=0;$n<xe.length;){var yi=ke?xe[$n][ke]:xe[$n];_r(Xr,yi)<0&&Xt.push(xe[$n]),Xr[$n]=yi,$n++}return lt&&(ke?Xt=Xt.sort(function(Ya,uo){return Ya[ke]>uo[ke]}):Xt=Xt.sort()),Xt}function fe(xe,ke){for(var lt,Xt,Xr=ke[0].toUpperCase()+ke.slice(1),$n=0;$n<K.length;){if(lt=K[$n],Xt=lt?lt+Xr:ke,Xt in xe)return Xt;$n++}return Q}var Re=1;function ge(){return Re++}function _t(xe){var ke=xe.ownerDocument||xe;return ke.defaultView||ke.parentWindow||C}var pt=/mobile|tablet|ip(ad|hone|od)|android/i,Nt="ontouchstart"in C,Bt=fe(C,"PointerEvent")!==Q,kr=Nt&&pt.test(navigator.userAgent),ln="touch",yn="pen",Vi="mouse",nr="kinect",de=25,Te=1,Ue=2,Le=4,Ft=8,er=1,w=2,Z=4,Ee=8,Ze=16,Qe=w|Z,yt=Ee|Ze,St=Qe|yt,jt=["x","y"],Et=["clientX","clientY"];function Qt(xe,ke){var lt=this;this.manager=xe,this.callback=ke,this.element=xe.element,this.target=xe.options.inputTarget,this.domHandler=function(Xt){ee(xe.options.enable,[xe])&&lt.handler(Xt)},this.init()}Qt.prototype={handler:function(){},init:function(){this.evEl&&Ct(this.element,this.evEl,this.domHandler),this.evTarget&&Ct(this.target,this.evTarget,this.domHandler),this.evWin&&Ct(_t(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Ke(this.element,this.evEl,this.domHandler),this.evTarget&&Ke(this.target,this.evTarget,this.domHandler),this.evWin&&Ke(_t(this.element),this.evWin,this.domHandler)}};function ie(xe){var ke,lt=xe.options.inputClass;return lt?ke=lt:Bt?ke=ce:kr?ke=ct:Nt?ke=Rr:ke=Ui,new ke(xe,sr)}function sr(xe,ke,lt){var Xt=lt.pointers.length,Xr=lt.changedPointers.length,$n=ke&Te&&Xt-Xr==0,yi=ke&(Le|Ft)&&Xt-Xr==0;lt.isFirst=!!$n,lt.isFinal=!!yi,$n&&(xe.session={}),lt.eventType=ke,Br(xe,lt),xe.emit("hammer.input",lt),xe.recognize(lt),xe.session.prevInput=lt}function Br(xe,ke){var lt=xe.session,Xt=ke.pointers,Xr=Xt.length;lt.firstInput||(lt.firstInput=gt(ke)),Xr>1&&!lt.firstMultiple?lt.firstMultiple=gt(ke):Xr===1&&(lt.firstMultiple=!1);var $n=lt.firstInput,yi=lt.firstMultiple,no=yi?yi.center:$n.center,Ya=ke.center=vt(Xt);ke.timeStamp=Ye(),ke.deltaTime=ke.timeStamp-$n.timeStamp,ke.angle=nn(no,Ya),ke.distance=Ur(no,Ya),Lr(lt,ke),ke.offsetDirection=Vr(ke.deltaX,ke.deltaY);var uo=hr(ke.deltaTime,ke.deltaX,ke.deltaY);ke.overallVelocityX=uo.x,ke.overallVelocityY=uo.y,ke.overallVelocity=Ne(uo.x)>Ne(uo.y)?uo.x:uo.y,ke.scale=yi?Cr(yi.pointers,Xt):1,ke.rotation=yi?Jr(yi.pointers,Xt):0,ke.maxPointers=lt.prevInput?ke.pointers.length>lt.prevInput.maxPointers?ke.pointers.length:lt.prevInput.maxPointers:ke.pointers.length,nt(lt,ke);var Ko=xe.element;Dt(ke.srcEvent.target,Ko)&&(Ko=ke.srcEvent.target),ke.target=Ko}function Lr(xe,ke){var lt=ke.center,Xt=xe.offsetDelta||{},Xr=xe.prevDelta||{},$n=xe.prevInput||{};(ke.eventType===Te||$n.eventType===Le)&&(Xr=xe.prevDelta={x:$n.deltaX||0,y:$n.deltaY||0},Xt=xe.offsetDelta={x:lt.x,y:lt.y}),ke.deltaX=Xr.x+(lt.x-Xt.x),ke.deltaY=Xr.y+(lt.y-Xt.y)}function nt(xe,ke){var lt=xe.lastInterval||ke,Xt=ke.timeStamp-lt.timeStamp,Xr,$n,yi,no;if(ke.eventType!=Ft&&(Xt>de||lt.velocity===Q)){var Ya=ke.deltaX-lt.deltaX,uo=ke.deltaY-lt.deltaY,Ko=hr(Xt,Ya,uo);$n=Ko.x,yi=Ko.y,Xr=Ne(Ko.x)>Ne(Ko.y)?Ko.x:Ko.y,no=Vr(Ya,uo),xe.lastInterval=ke}else Xr=lt.velocity,$n=lt.velocityX,yi=lt.velocityY,no=lt.direction;ke.velocity=Xr,ke.velocityX=$n,ke.velocityY=yi,ke.direction=no}function gt(xe){for(var ke=[],lt=0;lt<xe.pointers.length;)ke[lt]={clientX:N(xe.pointers[lt].clientX),clientY:N(xe.pointers[lt].clientY)},lt++;return{timeStamp:Ye(),pointers:ke,center:vt(ke),deltaX:xe.deltaX,deltaY:xe.deltaY}}function vt(xe){var ke=xe.length;if(ke===1)return{x:N(xe[0].clientX),y:N(xe[0].clientY)};for(var lt=0,Xt=0,Xr=0;Xr<ke;)lt+=xe[Xr].clientX,Xt+=xe[Xr].clientY,Xr++;return{x:N(lt/ke),y:N(Xt/ke)}}function hr(xe,ke,lt){return{x:ke/xe||0,y:lt/xe||0}}function Vr(xe,ke){return xe===ke?er:Ne(xe)>=Ne(ke)?xe<0?w:Z:ke<0?Ee:Ze}function Ur(xe,ke,lt){lt||(lt=jt);var Xt=ke[lt[0]]-xe[lt[0]],Xr=ke[lt[1]]-xe[lt[1]];return Math.sqrt(Xt*Xt+Xr*Xr)}function nn(xe,ke,lt){lt||(lt=jt);var Xt=ke[lt[0]]-xe[lt[0]],Xr=ke[lt[1]]-xe[lt[1]];return Math.atan2(Xr,Xt)*180/Math.PI}function Jr(xe,ke){return nn(ke[1],ke[0],Et)+nn(xe[1],xe[0],Et)}function Cr(xe,ke){return Ur(ke[0],ke[1],Et)/Ur(xe[0],xe[1],Et)}var Dn={mousedown:Te,mousemove:Ue,mouseup:Le},Hn="mousedown",bi="mousemove mouseup";function Ui(){this.evEl=Hn,this.evWin=bi,this.pressed=!1,Qt.apply(this,arguments)}xt(Ui,Qt,{handler:function(ke){var lt=Dn[ke.type];lt&Te&&ke.button===0&&(this.pressed=!0),lt&Ue&&ke.which!==1&&(lt=Le),!!this.pressed&&(lt&Le&&(this.pressed=!1),this.callback(this.manager,lt,{pointers:[ke],changedPointers:[ke],pointerType:Vi,srcEvent:ke}))}});var Ji={pointerdown:Te,pointermove:Ue,pointerup:Le,pointercancel:Ft,pointerout:Ft},Ri={2:ln,3:yn,4:Vi,5:nr},Ii="pointerdown",Y="pointermove pointerup pointercancel";C.MSPointerEvent&&!C.PointerEvent&&(Ii="MSPointerDown",Y="MSPointerMove MSPointerUp MSPointerCancel");function ce(){this.evEl=Ii,this.evWin=Y,Qt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}xt(ce,Qt,{handler:function(ke){var lt=this.store,Xt=!1,Xr=ke.type.toLowerCase().replace("ms",""),$n=Ji[Xr],yi=Ri[ke.pointerType]||ke.pointerType,no=yi==ln,Ya=_r(lt,ke.pointerId,"pointerId");$n&Te&&(ke.button===0||no)?Ya<0&&(lt.push(ke),Ya=lt.length-1):$n&(Le|Ft)&&(Xt=!0),!(Ya<0)&&(lt[Ya]=ke,this.callback(this.manager,$n,{pointers:lt,changedPointers:[ke],pointerType:yi,srcEvent:ke}),Xt&&lt.splice(Ya,1))}});var ye={touchstart:Te,touchmove:Ue,touchend:Le,touchcancel:Ft},z="touchstart",oe="touchstart touchmove touchend touchcancel";function me(){this.evTarget=z,this.evWin=oe,this.started=!1,Qt.apply(this,arguments)}xt(me,Qt,{handler:function(ke){var lt=ye[ke.type];if(lt===Te&&(this.started=!0),!!this.started){var Xt=Ae.call(this,ke,lt);lt&(Le|Ft)&&Xt[0].length-Xt[1].length==0&&(this.started=!1),this.callback(this.manager,lt,{pointers:Xt[0],changedPointers:Xt[1],pointerType:ln,srcEvent:ke})}}});function Ae(xe,ke){var lt=ar(xe.touches),Xt=ar(xe.changedTouches);return ke&(Le|Ft)&&(lt=zr(lt.concat(Xt),"identifier",!0)),[lt,Xt]}var se={touchstart:Te,touchmove:Ue,touchend:Le,touchcancel:Ft},Ce="touchstart touchmove touchend touchcancel";function ct(){this.evTarget=Ce,this.targetIds={},Qt.apply(this,arguments)}xt(ct,Qt,{handler:function(ke){var lt=se[ke.type],Xt=xr.call(this,ke,lt);!Xt||this.callback(this.manager,lt,{pointers:Xt[0],changedPointers:Xt[1],pointerType:ln,srcEvent:ke})}});function xr(xe,ke){var lt=ar(xe.touches),Xt=this.targetIds;if(ke&(Te|Ue)&&lt.length===1)return Xt[lt[0].identifier]=!0,[lt,lt];var Xr,$n,yi=ar(xe.changedTouches),no=[],Ya=this.target;if($n=lt.filter(function(uo){return Dt(uo.target,Ya)}),ke===Te)for(Xr=0;Xr<$n.length;)Xt[$n[Xr].identifier]=!0,Xr++;for(Xr=0;Xr<yi.length;)Xt[yi[Xr].identifier]&&no.push(yi[Xr]),ke&(Le|Ft)&&delete Xt[yi[Xr].identifier],Xr++;if(!!no.length)return[zr($n.concat(no),"identifier",!0),no]}var Gt=2500,Jt=25;function Rr(){Qt.apply(this,arguments);var xe=yr(this.handler,this);this.touch=new ct(this.manager,xe),this.mouse=new Ui(this.manager,xe),this.primaryTouch=null,this.lastTouches=[]}xt(Rr,Qt,{handler:function(ke,lt,Xt){var Xr=Xt.pointerType==ln,$n=Xt.pointerType==Vi;if(!($n&&Xt.sourceCapabilities&&Xt.sourceCapabilities.firesTouchEvents)){if(Xr)Ln.call(this,lt,Xt);else if($n&&$t.call(this,Xt))return;this.callback(ke,lt,Xt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Ln(xe,ke){xe&Te?(this.primaryTouch=ke.changedPointers[0].identifier,Mn.call(this,ke)):xe&(Le|Ft)&&Mn.call(this,ke)}function Mn(xe){var ke=xe.changedPointers[0];if(ke.identifier===this.primaryTouch){var lt={x:ke.clientX,y:ke.clientY};this.lastTouches.push(lt);var Xt=this.lastTouches,Xr=function(){var $n=Xt.indexOf(lt);$n>-1&&Xt.splice($n,1)};setTimeout(Xr,Gt)}}function $t(xe){for(var ke=xe.srcEvent.clientX,lt=xe.srcEvent.clientY,Xt=0;Xt<this.lastTouches.length;Xt++){var Xr=this.lastTouches[Xt],$n=Math.abs(ke-Xr.x),yi=Math.abs(lt-Xr.y);if($n<=Jt&&yi<=Jt)return!0}return!1}var bn=fe(W.style,"touchAction"),on=bn!==Q,un="compute",wi="auto",xn="manipulation",Oi="none",Yi="pan-x",oi="pan-y",Ki=ca();function zi(xe,ke){this.manager=xe,this.set(ke)}zi.prototype={set:function(xe){xe==un&&(xe=this.compute()),on&&this.manager.element.style&&Ki[xe]&&(this.manager.element.style[bn]=xe),this.actions=xe.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var xe=[];return Yt(this.manager.recognizers,function(ke){ee(ke.options.enable,[ke])&&(xe=xe.concat(ke.getTouchAction()))}),Ai(xe.join(" "))},preventDefaults:function(xe){var ke=xe.srcEvent,lt=xe.offsetDirection;if(this.manager.session.prevented){ke.preventDefault();return}var Xt=this.actions,Xr=Xe(Xt,Oi)&&!Ki[Oi],$n=Xe(Xt,oi)&&!Ki[oi],yi=Xe(Xt,Yi)&&!Ki[Yi];if(Xr){var no=xe.pointers.length===1,Ya=xe.distance<2,uo=xe.deltaTime<250;if(no&&Ya&&uo)return}if(!(yi&&$n)&&(Xr||$n&&lt&Qe||yi&&lt&yt))return this.preventSrc(ke)},preventSrc:function(xe){this.manager.session.prevented=!0,xe.preventDefault()}};function Ai(xe){if(Xe(xe,Oi))return Oi;var ke=Xe(xe,Yi),lt=Xe(xe,oi);return ke&&lt?Oi:ke||lt?ke?Yi:oi:Xe(xe,xn)?xn:wi}function ca(){if(!on)return!1;var xe={},ke=C.CSS&&C.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(lt){xe[lt]=ke?C.CSS.supports("touch-action",lt):!0}),xe}var ba=1,ai=2,ti=4,Gi=8,da=Gi,Xo=16,ya=32;function mi(xe){this.options=tr({},this.defaults,xe||{}),this.id=ge(),this.manager=null,this.options.enable=dr(this.options.enable,!0),this.state=ba,this.simultaneous={},this.requireFail=[]}mi.prototype={defaults:{},set:function(xe){return tr(this.options,xe),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(xe){if(rt(xe,"recognizeWith",this))return this;var ke=this.simultaneous;return xe=Sa(xe,this),ke[xe.id]||(ke[xe.id]=xe,xe.recognizeWith(this)),this},dropRecognizeWith:function(xe){return rt(xe,"dropRecognizeWith",this)?this:(xe=Sa(xe,this),delete this.simultaneous[xe.id],this)},requireFailure:function(xe){if(rt(xe,"requireFailure",this))return this;var ke=this.requireFail;return xe=Sa(xe,this),_r(ke,xe)===-1&&(ke.push(xe),xe.requireFailure(this)),this},dropRequireFailure:function(xe){if(rt(xe,"dropRequireFailure",this))return this;xe=Sa(xe,this);var ke=_r(this.requireFail,xe);return ke>-1&&this.requireFail.splice(ke,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(xe){return!!this.simultaneous[xe.id]},emit:function(xe){var ke=this,lt=this.state;function Xt(Xr){ke.manager.emit(Xr,xe)}lt<Gi&&Xt(ke.options.event+ga(lt)),Xt(ke.options.event),xe.additionalEvent&&Xt(xe.additionalEvent),lt>=Gi&&Xt(ke.options.event+ga(lt))},tryEmit:function(xe){if(this.canEmit())return this.emit(xe);this.state=ya},canEmit:function(){for(var xe=0;xe<this.requireFail.length;){if(!(this.requireFail[xe].state&(ya|ba)))return!1;xe++}return!0},recognize:function(xe){var ke=tr({},xe);if(!ee(this.options.enable,[this,ke])){this.reset(),this.state=ya;return}this.state&(da|Xo|ya)&&(this.state=ba),this.state=this.process(ke),this.state&(ai|ti|Gi|Xo)&&this.tryEmit(ke)},process:function(xe){},getTouchAction:function(){},reset:function(){}};function ga(xe){return xe&Xo?"cancel":xe&Gi?"end":xe&ti?"move":xe&ai?"start":""}function Gs(xe){return xe==Ze?"down":xe==Ee?"up":xe==w?"left":xe==Z?"right":""}function Sa(xe,ke){var lt=ke.manager;return lt?lt.get(xe):xe}function Co(){mi.apply(this,arguments)}xt(Co,mi,{defaults:{pointers:1},attrTest:function(xe){var ke=this.options.pointers;return ke===0||xe.pointers.length===ke},process:function(xe){var ke=this.state,lt=xe.eventType,Xt=ke&(ai|ti),Xr=this.attrTest(xe);return Xt&&(lt&Ft||!Xr)?ke|Xo:Xt||Xr?lt&Le?ke|Gi:ke&ai?ke|ti:ai:ya}});function Wa(){Co.apply(this,arguments),this.pX=null,this.pY=null}xt(Wa,Co,{defaults:{event:"pan",threshold:10,pointers:1,direction:St},getTouchAction:function(){var xe=this.options.direction,ke=[];return xe&Qe&&ke.push(oi),xe&yt&&ke.push(Yi),ke},directionTest:function(xe){var ke=this.options,lt=!0,Xt=xe.distance,Xr=xe.direction,$n=xe.deltaX,yi=xe.deltaY;return Xr&ke.direction||(ke.direction&Qe?(Xr=$n===0?er:$n<0?w:Z,lt=$n!=this.pX,Xt=Math.abs(xe.deltaX)):(Xr=yi===0?er:yi<0?Ee:Ze,lt=yi!=this.pY,Xt=Math.abs(xe.deltaY))),xe.direction=Xr,lt&&Xt>ke.threshold&&Xr&ke.direction},attrTest:function(xe){return Co.prototype.attrTest.call(this,xe)&&(this.state&ai||!(this.state&ai)&&this.directionTest(xe))},emit:function(xe){this.pX=xe.deltaX,this.pY=xe.deltaY;var ke=Gs(xe.direction);ke&&(xe.additionalEvent=this.options.event+ke),this._super.emit.call(this,xe)}});function Xa(){Co.apply(this,arguments)}xt(Xa,Co,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Oi]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.scale-1)>this.options.threshold||this.state&ai)},emit:function(xe){if(xe.scale!==1){var ke=xe.scale<1?"in":"out";xe.additionalEvent=this.options.event+ke}this._super.emit.call(this,xe)}});function Yo(){mi.apply(this,arguments),this._timer=null,this._input=null}xt(Yo,mi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[wi]},process:function(xe){var ke=this.options,lt=xe.pointers.length===ke.pointers,Xt=xe.distance<ke.threshold,Xr=xe.deltaTime>ke.time;if(this._input=xe,!Xt||!lt||xe.eventType&(Le|Ft)&&!Xr)this.reset();else if(xe.eventType&Te)this.reset(),this._timer=Je(function(){this.state=da,this.tryEmit()},ke.time,this);else if(xe.eventType&Le)return da;return ya},reset:function(){clearTimeout(this._timer)},emit:function(xe){this.state===da&&(xe&&xe.eventType&Le?this.manager.emit(this.options.event+"up",xe):(this._input.timeStamp=Ye(),this.manager.emit(this.options.event,this._input)))}});function Zi(){Co.apply(this,arguments)}xt(Zi,Co,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Oi]},attrTest:function(xe){return this._super.attrTest.call(this,xe)&&(Math.abs(xe.rotation)>this.options.threshold||this.state&ai)}});function Ao(){Co.apply(this,arguments)}xt(Ao,Co,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Qe|yt,pointers:1},getTouchAction:function(){return Wa.prototype.getTouchAction.call(this)},attrTest:function(xe){var ke=this.options.direction,lt;return ke&(Qe|yt)?lt=xe.overallVelocity:ke&Qe?lt=xe.overallVelocityX:ke&yt&&(lt=xe.overallVelocityY),this._super.attrTest.call(this,xe)&&ke&xe.offsetDirection&&xe.distance>this.options.threshold&&xe.maxPointers==this.options.pointers&&Ne(lt)>this.options.velocity&&xe.eventType&Le},emit:function(xe){var ke=Gs(xe.offsetDirection);ke&&this.manager.emit(this.options.event+ke,xe),this.manager.emit(this.options.event,xe)}});function Lo(){mi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}xt(Lo,mi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[xn]},process:function(xe){var ke=this.options,lt=xe.pointers.length===ke.pointers,Xt=xe.distance<ke.threshold,Xr=xe.deltaTime<ke.time;if(this.reset(),xe.eventType&Te&&this.count===0)return this.failTimeout();if(Xt&&Xr&&lt){if(xe.eventType!=Le)return this.failTimeout();var $n=this.pTime?xe.timeStamp-this.pTime<ke.interval:!0,yi=!this.pCenter||Ur(this.pCenter,xe.center)<ke.posThreshold;this.pTime=xe.timeStamp,this.pCenter=xe.center,!yi||!$n?this.count=1:this.count+=1,this._input=xe;var no=this.count%ke.taps;if(no===0)return this.hasRequireFailures()?(this._timer=Je(function(){this.state=da,this.tryEmit()},ke.interval,this),ai):da}return ya},failTimeout:function(){return this._timer=Je(function(){this.state=ya},this.options.interval,this),ya},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==da&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function so(xe,ke){return ke=ke||{},ke.recognizers=dr(ke.recognizers,so.defaults.preset),new Da(xe,ke)}so.VERSION="2.0.7",so.defaults={domEvents:!1,touchAction:un,enable:!0,inputTarget:null,inputClass:null,preset:[[Zi,{enable:!1}],[Xa,{enable:!1},["rotate"]],[Ao,{direction:Qe}],[Wa,{direction:Qe},["swipe"]],[Lo],[Lo,{event:"doubletap",taps:2},["tap"]],[Yo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ro=1,Hi=2;function Da(xe,ke){this.options=tr({},so.defaults,ke||{}),this.options.inputTarget=this.options.inputTarget||xe,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=xe,this.input=ie(this),this.touchAction=new zi(this,this.options.touchAction),Ba(this,!0),Yt(this.options.recognizers,function(lt){var Xt=this.add(new lt[0](lt[1]));lt[2]&&Xt.recognizeWith(lt[2]),lt[3]&&Xt.requireFailure(lt[3])},this)}Da.prototype={set:function(xe){return tr(this.options,xe),xe.touchAction&&this.touchAction.update(),xe.inputTarget&&(this.input.destroy(),this.input.target=xe.inputTarget,this.input.init()),this},stop:function(xe){this.session.stopped=xe?Hi:Ro},recognize:function(xe){var ke=this.session;if(!ke.stopped){this.touchAction.preventDefaults(xe);var lt,Xt=this.recognizers,Xr=ke.curRecognizer;(!Xr||Xr&&Xr.state&da)&&(Xr=ke.curRecognizer=null);for(var $n=0;$n<Xt.length;)lt=Xt[$n],ke.stopped!==Hi&&(!Xr||lt==Xr||lt.canRecognizeWith(Xr))?lt.recognize(xe):lt.reset(),!Xr&&lt.state&(ai|ti|Gi)&&(Xr=ke.curRecognizer=lt),$n++}},get:function(xe){if(xe instanceof mi)return xe;for(var ke=this.recognizers,lt=0;lt<ke.length;lt++)if(ke[lt].options.event==xe)return ke[lt];return null},add:function(xe){if(rt(xe,"add",this))return this;var ke=this.get(xe.options.event);return ke&&this.remove(ke),this.recognizers.push(xe),xe.manager=this,this.touchAction.update(),xe},remove:function(xe){if(rt(xe,"remove",this))return this;if(xe=this.get(xe),xe){var ke=this.recognizers,lt=_r(ke,xe);lt!==-1&&(ke.splice(lt,1),this.touchAction.update())}return this},on:function(xe,ke){if(xe!==Q&&ke!==Q){var lt=this.handlers;return Yt(Ut(xe),function(Xt){lt[Xt]=lt[Xt]||[],lt[Xt].push(ke)}),this}},off:function(xe,ke){if(xe!==Q){var lt=this.handlers;return Yt(Ut(xe),function(Xt){ke?lt[Xt]&&lt[Xt].splice(_r(lt[Xt],ke),1):delete lt[Xt]}),this}},emit:function(xe,ke){this.options.domEvents&&_s(xe,ke);var lt=this.handlers[xe]&&this.handlers[xe].slice();if(!(!lt||!lt.length)){ke.type=xe,ke.preventDefault=function(){ke.srcEvent.preventDefault()};for(var Xt=0;Xt<lt.length;)lt[Xt](ke),Xt++}},destroy:function(){this.element&&Ba(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ba(xe,ke){var lt=xe.element;if(!!lt.style){var Xt;Yt(xe.options.cssProps,function(Xr,$n){Xt=fe(lt.style,$n),ke?(xe.oldCssProps[Xt]=lt.style[Xt],lt.style[Xt]=Xr):lt.style[Xt]=xe.oldCssProps[Xt]||""}),ke||(xe.oldCssProps={})}}function _s(xe,ke){var lt=d.createEvent("Event");lt.initEvent(xe,!0,!0),lt.gesture=ke,ke.target.dispatchEvent(lt)}tr(so,{INPUT_START:Te,INPUT_MOVE:Ue,INPUT_END:Le,INPUT_CANCEL:Ft,STATE_POSSIBLE:ba,STATE_BEGAN:ai,STATE_CHANGED:ti,STATE_ENDED:Gi,STATE_RECOGNIZED:da,STATE_CANCELLED:Xo,STATE_FAILED:ya,DIRECTION_NONE:er,DIRECTION_LEFT:w,DIRECTION_RIGHT:Z,DIRECTION_UP:Ee,DIRECTION_DOWN:Ze,DIRECTION_HORIZONTAL:Qe,DIRECTION_VERTICAL:yt,DIRECTION_ALL:St,Manager:Da,Input:Qt,TouchAction:zi,TouchInput:ct,MouseInput:Ui,PointerEventInput:ce,TouchMouseInput:Rr,SingleTouchInput:me,Recognizer:mi,AttrRecognizer:Co,Tap:Lo,Pan:Wa,Swipe:Ao,Pinch:Xa,Rotate:Zi,Press:Yo,on:Ct,off:Ke,each:Yt,merge:Tt,extend:zt,assign:tr,inherit:xt,bindFn:yr,prefixed:fe});var _a=typeof C!="undefined"?C:typeof self!="undefined"?self:{};_a.Hammer=so,le=function(){return so}.call(U,E,U,Or),le!==Q&&(Or.exports=le)})(window,document,"Hammer")},7375:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0});var E=Symbol.for("INJECTION");function le(K,W,L,N){function Ne(){return N&&!Reflect.hasMetadata(E,this,W)&&Reflect.defineMetadata(E,L(),this,W),Reflect.hasMetadata(E,this,W)?Reflect.getMetadata(E,this,W):L()}function Ye(Je){Reflect.defineMetadata(E,Je,this,W)}Object.defineProperty(K,W,{configurable:!0,enumerable:!0,get:Ne,set:Ye})}function C(K,W){return function(L){return function(N,Ne){var Ye=function(){return K.get(L)};le(N,Ne,Ye,W)}}}U.makePropertyInjectDecorator=C;function d(K,W){return function(L,N){return function(Ne,Ye){var Je=function(){return K.getNamed(L,N)};le(Ne,Ye,Je,W)}}}U.makePropertyInjectNamedDecorator=d;function A(K,W){return function(L,N,Ne){return function(Ye,Je){var rt=function(){return K.getTagged(L,N,Ne)};le(Ye,Je,rt,W)}}}U.makePropertyInjectTaggedDecorator=A;function Q(K,W){return function(L){return function(N,Ne){var Ye=function(){return K.getAll(L)};le(N,Ne,Ye,W)}}}U.makePropertyMultiInjectDecorator=Q},84879:function(Or,U,E){"use strict";var le;le={value:!0};var C=E(7375);function d(A,Q){Q===void 0&&(Q=!0);var K=C.makePropertyInjectDecorator(A,Q),W=C.makePropertyInjectNamedDecorator(A,Q),L=C.makePropertyInjectTaggedDecorator(A,Q),N=C.makePropertyMultiInjectDecorator(A,Q);return{lazyInject:K,lazyInjectNamed:W,lazyInjectTagged:L,lazyMultiInject:N}}U.Z=d},99934:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.tagProperty=U.tagParameter=U.decorate=void 0;var le=E(16674),C=E(6867);function d(N,Ne,Ye,Je){var rt=C.TAGGED;Q(rt,N,Ne,Je,Ye)}U.tagParameter=d;function A(N,Ne,Ye){var Je=C.TAGGED_PROP;Q(Je,N.constructor,Ne,Ye)}U.tagProperty=A;function Q(N,Ne,Ye,Je,rt){var Yt={},Vt=typeof rt=="number",tr=rt!==void 0&&Vt?rt.toString():Ye;if(Vt&&Ye!==void 0)throw new Error(le.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(N,Ne)&&(Yt=Reflect.getMetadata(N,Ne));var zt=Yt[tr];if(!Array.isArray(zt))zt=[];else for(var Tt=0,xt=zt;Tt<xt.length;Tt++){var yr=xt[Tt];if(yr.key===Je.key)throw new Error(le.DUPLICATED_METADATA+" "+yr.key.toString())}zt.push(Je),Yt[tr]=zt,Reflect.defineMetadata(N,Yt,Ne)}function K(N,Ne){Reflect.decorate(N,Ne)}function W(N,Ne){return function(Ye,Je){Ne(Ye,Je,N)}}function L(N,Ne,Ye){typeof Ye=="number"?K([W(Ye,N)],Ne):typeof Ye=="string"?Reflect.decorate([N],Ne,Ye):K([N],Ne)}U.decorate=L},5744:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.inject=U.LazyServiceIdentifer=void 0;var le=E(16674),C=E(6867),d=E(47738),A=E(99934),Q=function(){function W(L){this._cb=L}return W.prototype.unwrap=function(){return this._cb()},W}();U.LazyServiceIdentifer=Q;function K(W){return function(L,N,Ne){if(W===void 0)throw new Error(le.UNDEFINED_INJECT_ANNOTATION(L.name));var Ye=new d.Metadata(C.INJECT_TAG,W);typeof Ne=="number"?A.tagParameter(L,N,Ne,Ye):A.tagProperty(L,N,Ye)}}U.inject=K},64315:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.injectable=void 0;var le=E(16674),C=E(6867);function d(){return function(A){if(Reflect.hasOwnMetadata(C.PARAM_TYPES,A))throw new Error(le.DUPLICATED_INJECTABLE_DECORATOR);var Q=Reflect.getMetadata(C.DESIGN_PARAM_TYPES,A)||[];return Reflect.defineMetadata(C.PARAM_TYPES,Q,A),A}}U.injectable=d},71693:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.multiInject=void 0;var le=E(6867),C=E(47738),d=E(99934);function A(Q){return function(K,W,L){var N=new C.Metadata(le.MULTI_INJECT_TAG,Q);typeof L=="number"?d.tagParameter(K,W,L,N):d.tagProperty(K,W,N)}}U.multiInject=A},38085:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.named=void 0;var le=E(6867),C=E(47738),d=E(99934);function A(Q){return function(K,W,L){var N=new C.Metadata(le.NAMED_TAG,Q);typeof L=="number"?d.tagParameter(K,W,L,N):d.tagProperty(K,W,N)}}U.named=A},6515:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.optional=void 0;var le=E(6867),C=E(47738),d=E(99934);function A(){return function(Q,K,W){var L=new C.Metadata(le.OPTIONAL_TAG,!0);typeof W=="number"?d.tagParameter(Q,K,W,L):d.tagProperty(Q,K,L)}}U.optional=A},7014:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.postConstruct=void 0;var le=E(16674),C=E(6867),d=E(47738);function A(){return function(Q,K,W){var L=new d.Metadata(C.POST_CONSTRUCT,K);if(Reflect.hasOwnMetadata(C.POST_CONSTRUCT,Q.constructor))throw new Error(le.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(C.POST_CONSTRUCT,L,Q.constructor)}}U.postConstruct=A},32052:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.tagged=void 0;var le=E(47738),C=E(99934);function d(A,Q){return function(K,W,L){var N=new le.Metadata(A,Q);typeof L=="number"?C.tagParameter(K,W,L,N):C.tagProperty(K,W,N)}}U.tagged=d},55638:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.targetName=void 0;var le=E(6867),C=E(47738),d=E(99934);function A(Q){return function(K,W,L){var N=new C.Metadata(le.NAME_TAG,Q);d.tagParameter(K,W,L,N)}}U.targetName=A},86757:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.unmanaged=void 0;var le=E(6867),C=E(47738),d=E(99934);function A(){return function(Q,K,W){var L=new C.Metadata(le.UNMANAGED_TAG,!0);d.tagParameter(Q,K,W,L)}}U.unmanaged=A},44290:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Binding=void 0;var le=E(28421),C=E(37791),d=function(){function A(Q,K){this.id=C.id(),this.activated=!1,this.serviceIdentifier=Q,this.scope=K,this.type=le.BindingTypeEnum.Invalid,this.constraint=function(W){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return A.prototype.clone=function(){var Q=new A(this.serviceIdentifier,this.scope);return Q.activated=Q.scope===le.BindingScopeEnum.Singleton?this.activated:!1,Q.implementationType=this.implementationType,Q.dynamicValue=this.dynamicValue,Q.scope=this.scope,Q.type=this.type,Q.factory=this.factory,Q.provider=this.provider,Q.constraint=this.constraint,Q.onActivation=this.onActivation,Q.cache=this.cache,Q},A}();U.Binding=d},23184:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingCount=void 0;var E={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};U.BindingCount=E},16674:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.STACK_OVERFLOW=U.CIRCULAR_DEPENDENCY_IN_FACTORY=U.POST_CONSTRUCT_ERROR=U.MULTIPLE_POST_CONSTRUCT_METHODS=U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=U.ARGUMENTS_LENGTH_MISMATCH=U.INVALID_DECORATOR_OPERATION=U.INVALID_TO_SELF_VALUE=U.INVALID_FUNCTION_BINDING=U.INVALID_MIDDLEWARE_RETURN=U.NO_MORE_SNAPSHOTS_AVAILABLE=U.INVALID_BINDING_TYPE=U.NOT_IMPLEMENTED=U.CIRCULAR_DEPENDENCY=U.UNDEFINED_INJECT_ANNOTATION=U.MISSING_INJECT_ANNOTATION=U.MISSING_INJECTABLE_ANNOTATION=U.NOT_REGISTERED=U.CANNOT_UNBIND=U.AMBIGUOUS_MATCH=U.KEY_NOT_FOUND=U.NULL_ARGUMENT=U.DUPLICATED_METADATA=U.DUPLICATED_INJECTABLE_DECORATOR=void 0,U.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",U.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",U.NULL_ARGUMENT="NULL argument",U.KEY_NOT_FOUND="Key Not Found",U.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",U.CANNOT_UNBIND="Could not unbind serviceIdentifier:",U.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",U.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",U.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var E=function(A){return"@inject called with undefined this could mean that the class "+A+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};U.UNDEFINED_INJECT_ANNOTATION=E,U.CIRCULAR_DEPENDENCY="Circular dependency found:",U.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",U.INVALID_BINDING_TYPE="Invalid binding type:",U.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",U.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",U.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",U.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",U.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var le=function(){for(var A=[],Q=0;Q<arguments.length;Q++)A[Q]=arguments[Q];return"The number of constructor arguments in the derived class "+(A[0]+" must be >= than the number of constructor arguments of its base class.")};U.ARGUMENTS_LENGTH_MISMATCH=le,U.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",U.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",U.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",U.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",U.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var C=function(){for(var A=[],Q=0;Q<arguments.length;Q++)A[Q]=arguments[Q];return"@postConstruct error in class "+A[0]+": "+A[1]};U.POST_CONSTRUCT_ERROR=C;var d=function(){for(var A=[],Q=0;Q<arguments.length;Q++)A[Q]=arguments[Q];return"It looks like there is a circular dependency "+("in one of the '"+A[0]+"' bindings. Please investigate bindings with")+("service identifier '"+A[1]+"'.")};U.CIRCULAR_DEPENDENCY_IN_FACTORY=d,U.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.TargetTypeEnum=U.BindingTypeEnum=U.BindingScopeEnum=void 0;var E={Request:"Request",Singleton:"Singleton",Transient:"Transient"};U.BindingScopeEnum=E;var le={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};U.BindingTypeEnum=le;var C={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};U.TargetTypeEnum=C},6867:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.NON_CUSTOM_TAG_KEYS=U.POST_CONSTRUCT=U.DESIGN_PARAM_TYPES=U.PARAM_TYPES=U.TAGGED_PROP=U.TAGGED=U.MULTI_INJECT_TAG=U.INJECT_TAG=U.OPTIONAL_TAG=U.UNMANAGED_TAG=U.NAME_TAG=U.NAMED_TAG=void 0,U.NAMED_TAG="named",U.NAME_TAG="name",U.UNMANAGED_TAG="unmanaged",U.OPTIONAL_TAG="optional",U.INJECT_TAG="inject",U.MULTI_INJECT_TAG="multi_inject",U.TAGGED="inversify:tagged",U.TAGGED_PROP="inversify:tagged_props",U.PARAM_TYPES="inversify:paramtypes",U.DESIGN_PARAM_TYPES="design:paramtypes",U.POST_CONSTRUCT="post_construct";function E(){return[U.INJECT_TAG,U.MULTI_INJECT_TAG,U.NAME_TAG,U.UNMANAGED_TAG,U.NAMED_TAG,U.OPTIONAL_TAG]}U.NON_CUSTOM_TAG_KEYS=E()},51389:function(Or,U,E){"use strict";var le=this&&this.__awaiter||function(zt,Tt,xt,yr){function ee(dr){return dr instanceof xt?dr:new xt(function(Ct){Ct(dr)})}return new(xt||(xt=Promise))(function(dr,Ct){function Ke(Ut){try{Xe(yr.next(Ut))}catch(_r){Ct(_r)}}function Dt(Ut){try{Xe(yr.throw(Ut))}catch(_r){Ct(_r)}}function Xe(Ut){Ut.done?dr(Ut.value):ee(Ut.value).then(Ke,Dt)}Xe((yr=yr.apply(zt,Tt||[])).next())})},C=this&&this.__generator||function(zt,Tt){var xt={label:0,sent:function(){if(dr[0]&1)throw dr[1];return dr[1]},trys:[],ops:[]},yr,ee,dr,Ct;return Ct={next:Ke(0),throw:Ke(1),return:Ke(2)},typeof Symbol=="function"&&(Ct[Symbol.iterator]=function(){return this}),Ct;function Ke(Xe){return function(Ut){return Dt([Xe,Ut])}}function Dt(Xe){if(yr)throw new TypeError("Generator is already executing.");for(;xt;)try{if(yr=1,ee&&(dr=Xe[0]&2?ee.return:Xe[0]?ee.throw||((dr=ee.return)&&dr.call(ee),0):ee.next)&&!(dr=dr.call(ee,Xe[1])).done)return dr;switch(ee=0,dr&&(Xe=[Xe[0]&2,dr.value]),Xe[0]){case 0:case 1:dr=Xe;break;case 4:return xt.label++,{value:Xe[1],done:!1};case 5:xt.label++,ee=Xe[1],Xe=[0];continue;case 7:Xe=xt.ops.pop(),xt.trys.pop();continue;default:if(dr=xt.trys,!(dr=dr.length>0&&dr[dr.length-1])&&(Xe[0]===6||Xe[0]===2)){xt=0;continue}if(Xe[0]===3&&(!dr||Xe[1]>dr[0]&&Xe[1]<dr[3])){xt.label=Xe[1];break}if(Xe[0]===6&&xt.label<dr[1]){xt.label=dr[1],dr=Xe;break}if(dr&&xt.label<dr[2]){xt.label=dr[2],xt.ops.push(Xe);break}dr[2]&&xt.ops.pop(),xt.trys.pop();continue}Xe=Tt.call(zt,xt)}catch(Ut){Xe=[6,Ut],ee=0}finally{yr=dr=0}if(Xe[0]&5)throw Xe[1];return{value:Xe[0]?Xe[1]:void 0,done:!0}}},d=this&&this.__spreadArray||function(zt,Tt){for(var xt=0,yr=Tt.length,ee=zt.length;xt<yr;xt++,ee++)zt[ee]=Tt[xt];return zt};Object.defineProperty(U,"__esModule",{value:!0}),U.Container=void 0;var A=E(44290),Q=E(16674),K=E(28421),W=E(6867),L=E(51377),N=E(86311),Ne=E(31927),Ye=E(15451),Je=E(37791),rt=E(55800),Yt=E(85700),Vt=E(80175),tr=function(){function zt(Tt){this._appliedMiddleware=[];var xt=Tt||{};if(typeof xt!="object")throw new Error(""+Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(xt.defaultScope===void 0)xt.defaultScope=K.BindingScopeEnum.Transient;else if(xt.defaultScope!==K.BindingScopeEnum.Singleton&&xt.defaultScope!==K.BindingScopeEnum.Transient&&xt.defaultScope!==K.BindingScopeEnum.Request)throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(xt.autoBindInjectable===void 0)xt.autoBindInjectable=!1;else if(typeof xt.autoBindInjectable!="boolean")throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(xt.skipBaseClassChecks===void 0)xt.skipBaseClassChecks=!1;else if(typeof xt.skipBaseClassChecks!="boolean")throw new Error(""+Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:xt.autoBindInjectable,defaultScope:xt.defaultScope,skipBaseClassChecks:xt.skipBaseClassChecks},this.id=Je.id(),this._bindingDictionary=new Vt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new L.MetadataReader}return zt.merge=function(Tt,xt){for(var yr=[],ee=2;ee<arguments.length;ee++)yr[ee-2]=arguments[ee];var dr=new zt,Ct=d([Tt,xt],yr).map(function(Xe){return N.getBindingDictionary(Xe)}),Ke=N.getBindingDictionary(dr);function Dt(Xe,Ut){Xe.traverse(function(_r,ar){ar.forEach(function(zr){Ut.add(zr.serviceIdentifier,zr.clone())})})}return Ct.forEach(function(Xe){Dt(Xe,Ke)}),dr},zt.prototype.load=function(){for(var Tt=[],xt=0;xt<arguments.length;xt++)Tt[xt]=arguments[xt];for(var yr=this._getContainerModuleHelpersFactory(),ee=0,dr=Tt;ee<dr.length;ee++){var Ct=dr[ee],Ke=yr(Ct.id);Ct.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)}},zt.prototype.loadAsync=function(){for(var Tt=[],xt=0;xt<arguments.length;xt++)Tt[xt]=arguments[xt];return le(this,void 0,void 0,function(){var yr,ee,dr,Ct,Ke;return C(this,function(Dt){switch(Dt.label){case 0:yr=this._getContainerModuleHelpersFactory(),ee=0,dr=Tt,Dt.label=1;case 1:return ee<dr.length?(Ct=dr[ee],Ke=yr(Ct.id),[4,Ct.registry(Ke.bindFunction,Ke.unbindFunction,Ke.isboundFunction,Ke.rebindFunction)]):[3,4];case 2:Dt.sent(),Dt.label=3;case 3:return ee++,[3,1];case 4:return[2]}})})},zt.prototype.unload=function(){for(var Tt=this,xt=[],yr=0;yr<arguments.length;yr++)xt[yr]=arguments[yr];var ee=function(dr){return function(Ct){return Ct.moduleId===dr}};xt.forEach(function(dr){var Ct=ee(dr.id);Tt._bindingDictionary.removeByCondition(Ct)})},zt.prototype.bind=function(Tt){var xt=this.options.defaultScope||K.BindingScopeEnum.Transient,yr=new A.Binding(Tt,xt);return this._bindingDictionary.add(Tt,yr),new Ye.BindingToSyntax(yr)},zt.prototype.rebind=function(Tt){return this.unbind(Tt),this.bind(Tt)},zt.prototype.unbind=function(Tt){try{this._bindingDictionary.remove(Tt)}catch(xt){throw new Error(Q.CANNOT_UNBIND+" "+rt.getServiceIdentifierAsString(Tt))}},zt.prototype.unbindAll=function(){this._bindingDictionary=new Vt.Lookup},zt.prototype.isBound=function(Tt){var xt=this._bindingDictionary.hasKey(Tt);return!xt&&this.parent&&(xt=this.parent.isBound(Tt)),xt},zt.prototype.isBoundNamed=function(Tt,xt){return this.isBoundTagged(Tt,W.NAMED_TAG,xt)},zt.prototype.isBoundTagged=function(Tt,xt,yr){var ee=!1;if(this._bindingDictionary.hasKey(Tt)){var dr=this._bindingDictionary.get(Tt),Ct=N.createMockRequest(this,Tt,xt,yr);ee=dr.some(function(Ke){return Ke.constraint(Ct)})}return!ee&&this.parent&&(ee=this.parent.isBoundTagged(Tt,xt,yr)),ee},zt.prototype.snapshot=function(){this._snapshots.push(Yt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},zt.prototype.restore=function(){var Tt=this._snapshots.pop();if(Tt===void 0)throw new Error(Q.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Tt.bindings,this._middleware=Tt.middleware},zt.prototype.createChild=function(Tt){var xt=new zt(Tt||this.options);return xt.parent=this,xt},zt.prototype.applyMiddleware=function(){for(var Tt=[],xt=0;xt<arguments.length;xt++)Tt[xt]=arguments[xt];this._appliedMiddleware=this._appliedMiddleware.concat(Tt);var yr=this._middleware?this._middleware:this._planAndResolve();this._middleware=Tt.reduce(function(ee,dr){return dr(ee)},yr)},zt.prototype.applyCustomMetadataReader=function(Tt){this._metadataReader=Tt},zt.prototype.get=function(Tt){return this._get(!1,!1,K.TargetTypeEnum.Variable,Tt)},zt.prototype.getTagged=function(Tt,xt,yr){return this._get(!1,!1,K.TargetTypeEnum.Variable,Tt,xt,yr)},zt.prototype.getNamed=function(Tt,xt){return this.getTagged(Tt,W.NAMED_TAG,xt)},zt.prototype.getAll=function(Tt){return this._get(!0,!0,K.TargetTypeEnum.Variable,Tt)},zt.prototype.getAllTagged=function(Tt,xt,yr){return this._get(!1,!0,K.TargetTypeEnum.Variable,Tt,xt,yr)},zt.prototype.getAllNamed=function(Tt,xt){return this.getAllTagged(Tt,W.NAMED_TAG,xt)},zt.prototype.resolve=function(Tt){var xt=this.createChild();return xt.bind(Tt).toSelf(),this._appliedMiddleware.forEach(function(yr){xt.applyMiddleware(yr)}),xt.get(Tt)},zt.prototype._getContainerModuleHelpersFactory=function(){var Tt=this,xt=function(Ke,Dt){Ke._binding.moduleId=Dt},yr=function(Ke){return function(Dt){var Xe=Tt.bind.bind(Tt),Ut=Xe(Dt);return xt(Ut,Ke),Ut}},ee=function(Ke){return function(Dt){var Xe=Tt.unbind.bind(Tt);Xe(Dt)}},dr=function(Ke){return function(Dt){var Xe=Tt.isBound.bind(Tt);return Xe(Dt)}},Ct=function(Ke){return function(Dt){var Xe=Tt.rebind.bind(Tt),Ut=Xe(Dt);return xt(Ut,Ke),Ut}};return function(Ke){return{bindFunction:yr(Ke),isboundFunction:dr(Ke),rebindFunction:Ct(Ke),unbindFunction:ee(Ke)}}},zt.prototype._get=function(Tt,xt,yr,ee,dr,Ct){var Ke=null,Dt={avoidConstraints:Tt,contextInterceptor:function(Xe){return Xe},isMultiInject:xt,key:dr,serviceIdentifier:ee,targetType:yr,value:Ct};if(this._middleware){if(Ke=this._middleware(Dt),Ke==null)throw new Error(Q.INVALID_MIDDLEWARE_RETURN)}else Ke=this._planAndResolve()(Dt);return Ke},zt.prototype._planAndResolve=function(){var Tt=this;return function(xt){var yr=N.plan(Tt._metadataReader,Tt,xt.isMultiInject,xt.targetType,xt.serviceIdentifier,xt.key,xt.value,xt.avoidConstraints);yr=xt.contextInterceptor(yr);var ee=Ne.resolve(yr);return ee}},zt}();U.Container=tr},33244:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.AsyncContainerModule=U.ContainerModule=void 0;var le=E(37791),C=function(){function A(Q){this.id=le.id(),this.registry=Q}return A}();U.ContainerModule=C;var d=function(){function A(Q){this.id=le.id(),this.registry=Q}return A}();U.AsyncContainerModule=d},85700:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.ContainerSnapshot=void 0;var E=function(){function le(){}return le.of=function(C,d){var A=new le;return A.bindings=C,A.middleware=d,A},le}();U.ContainerSnapshot=E},80175:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Lookup=void 0;var le=E(16674),C=function(){function d(){this._map=new Map}return d.prototype.getMap=function(){return this._map},d.prototype.add=function(A,Q){if(A==null)throw new Error(le.NULL_ARGUMENT);if(Q==null)throw new Error(le.NULL_ARGUMENT);var K=this._map.get(A);K!==void 0?(K.push(Q),this._map.set(A,K)):this._map.set(A,[Q])},d.prototype.get=function(A){if(A==null)throw new Error(le.NULL_ARGUMENT);var Q=this._map.get(A);if(Q!==void 0)return Q;throw new Error(le.KEY_NOT_FOUND)},d.prototype.remove=function(A){if(A==null)throw new Error(le.NULL_ARGUMENT);if(!this._map.delete(A))throw new Error(le.KEY_NOT_FOUND)},d.prototype.removeByCondition=function(A){var Q=this;this._map.forEach(function(K,W){var L=K.filter(function(N){return!A(N)});L.length>0?Q._map.set(W,L):Q._map.delete(W)})},d.prototype.hasKey=function(A){if(A==null)throw new Error(le.NULL_ARGUMENT);return this._map.has(A)},d.prototype.clone=function(){var A=new d;return this._map.forEach(function(Q,K){Q.forEach(function(W){return A.add(K,W.clone())})}),A},d.prototype.traverse=function(A){this._map.forEach(function(Q,K){A(K,Q)})},d}();U.Lookup=C},86700:function(Or,U,E){"use strict";var le;le={value:!0},le=le=le=le=le=le=U.GW=le=le=U.zY=le=le=le=le=le=U.f3=le=le=U.b2=le=le=le=le=le=U.W2=le=void 0;var C=E(6867);le=C;var d=E(51389);Object.defineProperty(U,"W2",{enumerable:!0,get:function(){return d.Container}});var A=E(28421);le={enumerable:!0,get:function(){return A.BindingScopeEnum}},le={enumerable:!0,get:function(){return A.BindingTypeEnum}},le={enumerable:!0,get:function(){return A.TargetTypeEnum}};var Q=E(33244);le={enumerable:!0,get:function(){return Q.AsyncContainerModule}},le={enumerable:!0,get:function(){return Q.ContainerModule}};var K=E(64315);Object.defineProperty(U,"b2",{enumerable:!0,get:function(){return K.injectable}});var W=E(32052);le={enumerable:!0,get:function(){return W.tagged}};var L=E(38085);le={enumerable:!0,get:function(){return L.named}};var N=E(5744);Object.defineProperty(U,"f3",{enumerable:!0,get:function(){return N.inject}}),le={enumerable:!0,get:function(){return N.LazyServiceIdentifer}};var Ne=E(6515);le={enumerable:!0,get:function(){return Ne.optional}};var Ye=E(86757);le={enumerable:!0,get:function(){return Ye.unmanaged}};var Je=E(71693);le={enumerable:!0,get:function(){return Je.multiInject}};var rt=E(55638);le={enumerable:!0,get:function(){return rt.targetName}};var Yt=E(7014);Object.defineProperty(U,"zY",{enumerable:!0,get:function(){return Yt.postConstruct}});var Vt=E(51377);le={enumerable:!0,get:function(){return Vt.MetadataReader}};var tr=E(37791);le={enumerable:!0,get:function(){return tr.id}};var zt=E(99934);Object.defineProperty(U,"GW",{enumerable:!0,get:function(){return zt.decorate}});var Tt=E(80758);le={enumerable:!0,get:function(){return Tt.traverseAncerstors}},le={enumerable:!0,get:function(){return Tt.taggedConstraint}},le={enumerable:!0,get:function(){return Tt.namedConstraint}},le={enumerable:!0,get:function(){return Tt.typeConstraint}};var xt=E(55800);le={enumerable:!0,get:function(){return xt.getServiceIdentifierAsString}};var yr=E(70600);le={enumerable:!0,get:function(){return yr.multiBindToService}}},95228:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Context=void 0;var le=E(37791),C=function(){function d(A){this.id=le.id(),this.container=A}return d.prototype.addPlan=function(A){this.plan=A},d.prototype.setCurrentRequest=function(A){this.currentRequest=A},d}();U.Context=C},47738:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Metadata=void 0;var le=E(6867),C=function(){function d(A,Q){this.key=A,this.value=Q}return d.prototype.toString=function(){return this.key===le.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},d}();U.Metadata=C},51377:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.MetadataReader=void 0;var le=E(6867),C=function(){function d(){}return d.prototype.getConstructorMetadata=function(A){var Q=Reflect.getMetadata(le.PARAM_TYPES,A),K=Reflect.getMetadata(le.TAGGED,A);return{compilerGeneratedMetadata:Q,userGeneratedMetadata:K||{}}},d.prototype.getPropertiesMetadata=function(A){var Q=Reflect.getMetadata(le.TAGGED_PROP,A)||[];return Q},d}();U.MetadataReader=C},55314:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Plan=void 0;var E=function(){function le(C,d){this.parentContext=C,this.rootRequest=d}return le}();U.Plan=E},86311:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.getBindingDictionary=U.createMockRequest=U.plan=void 0;var le=E(23184),C=E(16674),d=E(28421),A=E(6867),Q=E(85265),K=E(55800),W=E(95228),L=E(47738),N=E(55314),Ne=E(6e3),Ye=E(6748),Je=E(18924);function rt(ee){return ee._bindingDictionary}U.getBindingDictionary=rt;function Yt(ee,dr,Ct,Ke,Dt,Xe){var Ut=ee?A.MULTI_INJECT_TAG:A.INJECT_TAG,_r=new L.Metadata(Ut,Ct),ar=new Je.Target(dr,Ke,Ct,_r);if(Dt!==void 0){var zr=new L.Metadata(Dt,Xe);ar.metadata.push(zr)}return ar}function Vt(ee,dr,Ct,Ke,Dt){var Xe=Tt(Ct.container,Dt.serviceIdentifier),Ut=[];return Xe.length===le.BindingCount.NoBindingsAvailable&&Ct.container.options.autoBindInjectable&&typeof Dt.serviceIdentifier=="function"&&ee.getConstructorMetadata(Dt.serviceIdentifier).compilerGeneratedMetadata&&(Ct.container.bind(Dt.serviceIdentifier).toSelf(),Xe=Tt(Ct.container,Dt.serviceIdentifier)),dr?Ut=Xe:Ut=Xe.filter(function(_r){var ar=new Ye.Request(_r.serviceIdentifier,Ct,Ke,_r,Dt);return _r.constraint(ar)}),tr(Dt.serviceIdentifier,Ut,Dt,Ct.container),Ut}function tr(ee,dr,Ct,Ke){switch(dr.length){case le.BindingCount.NoBindingsAvailable:if(Ct.isOptional())return dr;var Dt=K.getServiceIdentifierAsString(ee),Xe=C.NOT_REGISTERED;throw Xe+=K.listMetadataForTarget(Dt,Ct),Xe+=K.listRegisteredBindingsForServiceIdentifier(Ke,Dt,Tt),new Error(Xe);case le.BindingCount.OnlyOneBindingAvailable:if(!Ct.isArray())return dr;case le.BindingCount.MultipleBindingsAvailable:default:if(Ct.isArray())return dr;var Dt=K.getServiceIdentifierAsString(ee),Xe=C.AMBIGUOUS_MATCH+" "+Dt;throw Xe+=K.listRegisteredBindingsForServiceIdentifier(Ke,Dt,Tt),new Error(Xe)}}function zt(ee,dr,Ct,Ke,Dt,Xe){var Ut,_r;if(Dt===null){Ut=Vt(ee,dr,Ke,null,Xe),_r=new Ye.Request(Ct,Ke,null,Ut,Xe);var ar=new N.Plan(Ke,_r);Ke.addPlan(ar)}else Ut=Vt(ee,dr,Ke,Dt,Xe),_r=Dt.addChildRequest(Xe.serviceIdentifier,Ut,Xe);Ut.forEach(function(zr){var fe=null;if(Xe.isArray())fe=_r.addChildRequest(zr.serviceIdentifier,zr,Xe);else{if(zr.cache)return;fe=_r}if(zr.type===d.BindingTypeEnum.Instance&&zr.implementationType!==null){var Re=Ne.getDependencies(ee,zr.implementationType);if(!Ke.container.options.skipBaseClassChecks){var ge=Ne.getBaseClassDependencyCount(ee,zr.implementationType);if(Re.length<ge){var _t=C.ARGUMENTS_LENGTH_MISMATCH(Ne.getFunctionName(zr.implementationType));throw new Error(_t)}}Re.forEach(function(pt){zt(ee,!1,pt.serviceIdentifier,Ke,fe,pt)})}})}function Tt(ee,dr){var Ct=[],Ke=rt(ee);return Ke.hasKey(dr)?Ct=Ke.get(dr):ee.parent!==null&&(Ct=Tt(ee.parent,dr)),Ct}function xt(ee,dr,Ct,Ke,Dt,Xe,Ut,_r){_r===void 0&&(_r=!1);var ar=new W.Context(dr),zr=Yt(Ct,Ke,Dt,"",Xe,Ut);try{return zt(ee,_r,Dt,ar,null,zr),ar}catch(fe){throw Q.isStackOverflowExeption(fe)&&ar.plan&&K.circularDependencyToException(ar.plan.rootRequest),fe}}U.plan=xt;function yr(ee,dr,Ct,Ke){var Dt=new Je.Target(d.TargetTypeEnum.Variable,"",dr,new L.Metadata(Ct,Ke)),Xe=new W.Context(ee),Ut=new Ye.Request(dr,Xe,null,[],Dt);return Ut}U.createMockRequest=yr},88460:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.QueryableString=void 0;var E=function(){function le(C){this.str=C}return le.prototype.startsWith=function(C){return this.str.indexOf(C)===0},le.prototype.endsWith=function(C){var d="",A=C.split("").reverse().join("");return d=this.str.split("").reverse().join(""),this.startsWith.call({str:d},A)},le.prototype.contains=function(C){return this.str.indexOf(C)!==-1},le.prototype.equals=function(C){return this.str===C},le.prototype.value=function(){return this.str},le}();U.QueryableString=E},6e3:function(Or,U,E){"use strict";var le=this&&this.__spreadArray||function(Vt,tr){for(var zt=0,Tt=tr.length,xt=Vt.length;zt<Tt;zt++,xt++)Vt[xt]=tr[zt];return Vt};Object.defineProperty(U,"__esModule",{value:!0}),U.getFunctionName=U.getBaseClassDependencyCount=U.getDependencies=void 0;var C=E(5744),d=E(16674),A=E(28421),Q=E(6867),K=E(55800);Object.defineProperty(U,"getFunctionName",{enumerable:!0,get:function(){return K.getFunctionName}});var W=E(18924);function L(Vt,tr){var zt=K.getFunctionName(tr),Tt=N(Vt,zt,tr,!1);return Tt}U.getDependencies=L;function N(Vt,tr,zt,Tt){var xt=Vt.getConstructorMetadata(zt),yr=xt.compilerGeneratedMetadata;if(yr===void 0){var ee=d.MISSING_INJECTABLE_ANNOTATION+" "+tr+".";throw new Error(ee)}var dr=xt.userGeneratedMetadata,Ct=Object.keys(dr),Ke=zt.length===0&&Ct.length>0,Dt=Ct.length>zt.length,Xe=Ke||Dt?Ct.length:zt.length,Ut=Ye(Tt,tr,yr,dr,Xe),_r=Je(Vt,zt),ar=le(le([],Ut),_r);return ar}function Ne(Vt,tr,zt,Tt,xt){var yr=xt[Vt.toString()]||[],ee=Yt(yr),dr=ee.unmanaged!==!0,Ct=Tt[Vt],Ke=ee.inject||ee.multiInject;if(Ct=Ke||Ct,Ct instanceof C.LazyServiceIdentifer&&(Ct=Ct.unwrap()),dr){var Dt=Ct===Object,Xe=Ct===Function,Ut=Ct===void 0,_r=Dt||Xe||Ut;if(!tr&&_r){var ar=d.MISSING_INJECT_ANNOTATION+" argument "+Vt+" in class "+zt+".";throw new Error(ar)}var zr=new W.Target(A.TargetTypeEnum.ConstructorArgument,ee.targetName,Ct);return zr.metadata=yr,zr}return null}function Ye(Vt,tr,zt,Tt,xt){for(var yr=[],ee=0;ee<xt;ee++){var dr=ee,Ct=Ne(dr,Vt,tr,zt,Tt);Ct!==null&&yr.push(Ct)}return yr}function Je(Vt,tr){for(var zt=Vt.getPropertiesMetadata(tr),Tt=[],xt=Object.keys(zt),yr=0,ee=xt;yr<ee.length;yr++){var dr=ee[yr],Ct=zt[dr],Ke=Yt(zt[dr]),Dt=Ke.targetName||dr,Xe=Ke.inject||Ke.multiInject,Ut=new W.Target(A.TargetTypeEnum.ClassProperty,Dt,Xe);Ut.metadata=Ct,Tt.push(Ut)}var _r=Object.getPrototypeOf(tr.prototype).constructor;if(_r!==Object){var ar=Je(Vt,_r);Tt=le(le([],Tt),ar)}return Tt}function rt(Vt,tr){var zt=Object.getPrototypeOf(tr.prototype).constructor;if(zt!==Object){var Tt=K.getFunctionName(zt),xt=N(Vt,Tt,zt,!0),yr=xt.map(function(Ct){return Ct.metadata.filter(function(Ke){return Ke.key===Q.UNMANAGED_TAG})}),ee=[].concat.apply([],yr).length,dr=xt.length-ee;return dr>0?dr:rt(Vt,zt)}else return 0}U.getBaseClassDependencyCount=rt;function Yt(Vt){var tr={};return Vt.forEach(function(zt){tr[zt.key.toString()]=zt.value}),{inject:tr[Q.INJECT_TAG],multiInject:tr[Q.MULTI_INJECT_TAG],targetName:tr[Q.NAME_TAG],unmanaged:tr[Q.UNMANAGED_TAG]}}},6748:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Request=void 0;var le=E(37791),C=function(){function d(A,Q,K,W,L){this.id=le.id(),this.serviceIdentifier=A,this.parentContext=Q,this.parentRequest=K,this.target=L,this.childRequests=[],this.bindings=Array.isArray(W)?W:[W],this.requestScope=K===null?new Map:null}return d.prototype.addChildRequest=function(A,Q,K){var W=new d(A,this.parentContext,this,Q,K);return this.childRequests.push(W),W},d}();U.Request=C},18924:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.Target=void 0;var le=E(6867),C=E(37791),d=E(47738),A=E(88460),Q=function(){function K(W,L,N,Ne){this.id=C.id(),this.type=W,this.serviceIdentifier=N,this.name=new A.QueryableString(L||""),this.metadata=new Array;var Ye=null;typeof Ne=="string"?Ye=new d.Metadata(le.NAMED_TAG,Ne):Ne instanceof d.Metadata&&(Ye=Ne),Ye!==null&&this.metadata.push(Ye)}return K.prototype.hasTag=function(W){for(var L=0,N=this.metadata;L<N.length;L++){var Ne=N[L];if(Ne.key===W)return!0}return!1},K.prototype.isArray=function(){return this.hasTag(le.MULTI_INJECT_TAG)},K.prototype.matchesArray=function(W){return this.matchesTag(le.MULTI_INJECT_TAG)(W)},K.prototype.isNamed=function(){return this.hasTag(le.NAMED_TAG)},K.prototype.isTagged=function(){return this.metadata.some(function(W){return le.NON_CUSTOM_TAG_KEYS.every(function(L){return W.key!==L})})},K.prototype.isOptional=function(){return this.matchesTag(le.OPTIONAL_TAG)(!0)},K.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(W){return W.key===le.NAMED_TAG})[0]:null},K.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(W){return le.NON_CUSTOM_TAG_KEYS.every(function(L){return W.key!==L})}):null},K.prototype.matchesNamedTag=function(W){return this.matchesTag(le.NAMED_TAG)(W)},K.prototype.matchesTag=function(W){var L=this;return function(N){for(var Ne=0,Ye=L.metadata;Ne<Ye.length;Ne++){var Je=Ye[Ne];if(Je.key===W&&Je.value===N)return!0}return!1}},K}();U.Target=Q},52279:function(Or,U,E){"use strict";var le=this&&this.__spreadArray||function(N,Ne){for(var Ye=0,Je=Ne.length,rt=N.length;Ye<Je;Ye++,rt++)N[rt]=Ne[Ye];return N};Object.defineProperty(U,"__esModule",{value:!0}),U.resolveInstance=void 0;var C=E(16674),d=E(28421),A=E(6867);function Q(N,Ne,Ye){var Je=Ne.filter(function(Yt){return Yt.target!==null&&Yt.target.type===d.TargetTypeEnum.ClassProperty}),rt=Je.map(Ye);return Je.forEach(function(Yt,Vt){var tr="";tr=Yt.target.name.value();var zt=rt[Vt];N[tr]=zt}),N}function K(N,Ne){return new(N.bind.apply(N,le([void 0],Ne)))}function W(N,Ne){if(Reflect.hasMetadata(A.POST_CONSTRUCT,N)){var Ye=Reflect.getMetadata(A.POST_CONSTRUCT,N);try{Ne[Ye.value]()}catch(Je){throw new Error(C.POST_CONSTRUCT_ERROR(N.name,Je.message))}}}function L(N,Ne,Ye){var Je=null;if(Ne.length>0){var rt=Ne.filter(function(Vt){return Vt.target!==null&&Vt.target.type===d.TargetTypeEnum.ConstructorArgument}),Yt=rt.map(Ye);Je=K(N,Yt),Je=Q(Je,Ne,Ye)}else Je=new N;return W(N,Je),Je}U.resolveInstance=L},31927:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.resolve=void 0;var le=E(16674),C=E(28421),d=E(85265),A=E(55800),Q=E(52279),K=function(N,Ne,Ye){try{return Ye()}catch(Je){throw d.isStackOverflowExeption(Je)?new Error(le.CIRCULAR_DEPENDENCY_IN_FACTORY(N,Ne.toString())):Je}},W=function(N){return function(Ne){Ne.parentContext.setCurrentRequest(Ne);var Ye=Ne.bindings,Je=Ne.childRequests,rt=Ne.target&&Ne.target.isArray(),Yt=!Ne.parentRequest||!Ne.parentRequest.target||!Ne.target||!Ne.parentRequest.target.matchesArray(Ne.target.serviceIdentifier);if(rt&&Yt)return Je.map(function(yr){var ee=W(N);return ee(yr)});var Vt=null;if(Ne.target.isOptional()&&Ye.length===0)return;var tr=Ye[0],zt=tr.scope===C.BindingScopeEnum.Singleton,Tt=tr.scope===C.BindingScopeEnum.Request;if(zt&&tr.activated)return tr.cache;if(Tt&&N!==null&&N.has(tr.id))return N.get(tr.id);if(tr.type===C.BindingTypeEnum.ConstantValue)Vt=tr.cache,tr.activated=!0;else if(tr.type===C.BindingTypeEnum.Function)Vt=tr.cache,tr.activated=!0;else if(tr.type===C.BindingTypeEnum.Constructor)Vt=tr.implementationType;else if(tr.type===C.BindingTypeEnum.DynamicValue&&tr.dynamicValue!==null)Vt=K("toDynamicValue",tr.serviceIdentifier,function(){return tr.dynamicValue(Ne.parentContext)});else if(tr.type===C.BindingTypeEnum.Factory&&tr.factory!==null)Vt=K("toFactory",tr.serviceIdentifier,function(){return tr.factory(Ne.parentContext)});else if(tr.type===C.BindingTypeEnum.Provider&&tr.provider!==null)Vt=K("toProvider",tr.serviceIdentifier,function(){return tr.provider(Ne.parentContext)});else if(tr.type===C.BindingTypeEnum.Instance&&tr.implementationType!==null)Vt=Q.resolveInstance(tr.implementationType,Je,W(N));else{var xt=A.getServiceIdentifierAsString(Ne.serviceIdentifier);throw new Error(le.INVALID_BINDING_TYPE+" "+xt)}return typeof tr.onActivation=="function"&&(Vt=tr.onActivation(Ne.parentContext,Vt)),zt&&(tr.cache=Vt,tr.activated=!0),Tt&&N!==null&&!N.has(tr.id)&&N.set(tr.id,Vt),Vt}};function L(N){var Ne=W(N.plan.rootRequest.requestScope);return Ne(N.plan.rootRequest)}U.resolve=L},83366:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingInSyntax=void 0;var le=E(28421),C=E(71325),d=function(){function A(Q){this._binding=Q}return A.prototype.inRequestScope=function(){return this._binding.scope=le.BindingScopeEnum.Request,new C.BindingWhenOnSyntax(this._binding)},A.prototype.inSingletonScope=function(){return this._binding.scope=le.BindingScopeEnum.Singleton,new C.BindingWhenOnSyntax(this._binding)},A.prototype.inTransientScope=function(){return this._binding.scope=le.BindingScopeEnum.Transient,new C.BindingWhenOnSyntax(this._binding)},A}();U.BindingInSyntax=d},74889:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingInWhenOnSyntax=void 0;var le=E(83366),C=E(51811),d=E(98370),A=function(){function Q(K){this._binding=K,this._bindingWhenSyntax=new d.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new C.BindingOnSyntax(this._binding),this._bindingInSyntax=new le.BindingInSyntax(K)}return Q.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Q.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Q.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Q.prototype.when=function(K){return this._bindingWhenSyntax.when(K)},Q.prototype.whenTargetNamed=function(K){return this._bindingWhenSyntax.whenTargetNamed(K)},Q.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Q.prototype.whenTargetTagged=function(K,W){return this._bindingWhenSyntax.whenTargetTagged(K,W)},Q.prototype.whenInjectedInto=function(K){return this._bindingWhenSyntax.whenInjectedInto(K)},Q.prototype.whenParentNamed=function(K){return this._bindingWhenSyntax.whenParentNamed(K)},Q.prototype.whenParentTagged=function(K,W){return this._bindingWhenSyntax.whenParentTagged(K,W)},Q.prototype.whenAnyAncestorIs=function(K){return this._bindingWhenSyntax.whenAnyAncestorIs(K)},Q.prototype.whenNoAncestorIs=function(K){return this._bindingWhenSyntax.whenNoAncestorIs(K)},Q.prototype.whenAnyAncestorNamed=function(K){return this._bindingWhenSyntax.whenAnyAncestorNamed(K)},Q.prototype.whenAnyAncestorTagged=function(K,W){return this._bindingWhenSyntax.whenAnyAncestorTagged(K,W)},Q.prototype.whenNoAncestorNamed=function(K){return this._bindingWhenSyntax.whenNoAncestorNamed(K)},Q.prototype.whenNoAncestorTagged=function(K,W){return this._bindingWhenSyntax.whenNoAncestorTagged(K,W)},Q.prototype.whenAnyAncestorMatches=function(K){return this._bindingWhenSyntax.whenAnyAncestorMatches(K)},Q.prototype.whenNoAncestorMatches=function(K){return this._bindingWhenSyntax.whenNoAncestorMatches(K)},Q.prototype.onActivation=function(K){return this._bindingOnSyntax.onActivation(K)},Q}();U.BindingInWhenOnSyntax=A},51811:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingOnSyntax=void 0;var le=E(98370),C=function(){function d(A){this._binding=A}return d.prototype.onActivation=function(A){return this._binding.onActivation=A,new le.BindingWhenSyntax(this._binding)},d}();U.BindingOnSyntax=C},15451:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingToSyntax=void 0;var le=E(16674),C=E(28421),d=E(74889),A=E(71325),Q=function(){function K(W){this._binding=W}return K.prototype.to=function(W){return this._binding.type=C.BindingTypeEnum.Instance,this._binding.implementationType=W,new d.BindingInWhenOnSyntax(this._binding)},K.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+le.INVALID_TO_SELF_VALUE);var W=this._binding.serviceIdentifier;return this.to(W)},K.prototype.toConstantValue=function(W){return this._binding.type=C.BindingTypeEnum.ConstantValue,this._binding.cache=W,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},K.prototype.toDynamicValue=function(W){return this._binding.type=C.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=W,this._binding.implementationType=null,new d.BindingInWhenOnSyntax(this._binding)},K.prototype.toConstructor=function(W){return this._binding.type=C.BindingTypeEnum.Constructor,this._binding.implementationType=W,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},K.prototype.toFactory=function(W){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=W,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},K.prototype.toFunction=function(W){if(typeof W!="function")throw new Error(le.INVALID_FUNCTION_BINDING);var L=this.toConstantValue(W);return this._binding.type=C.BindingTypeEnum.Function,this._binding.scope=C.BindingScopeEnum.Singleton,L},K.prototype.toAutoFactory=function(W){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=function(L){var N=function(){return L.container.get(W)};return N},this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},K.prototype.toProvider=function(W){return this._binding.type=C.BindingTypeEnum.Provider,this._binding.provider=W,this._binding.scope=C.BindingScopeEnum.Singleton,new A.BindingWhenOnSyntax(this._binding)},K.prototype.toService=function(W){this.toDynamicValue(function(L){return L.container.get(W)})},K}();U.BindingToSyntax=Q},71325:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingWhenOnSyntax=void 0;var le=E(51811),C=E(98370),d=function(){function A(Q){this._binding=Q,this._bindingWhenSyntax=new C.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new le.BindingOnSyntax(this._binding)}return A.prototype.when=function(Q){return this._bindingWhenSyntax.when(Q)},A.prototype.whenTargetNamed=function(Q){return this._bindingWhenSyntax.whenTargetNamed(Q)},A.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},A.prototype.whenTargetTagged=function(Q,K){return this._bindingWhenSyntax.whenTargetTagged(Q,K)},A.prototype.whenInjectedInto=function(Q){return this._bindingWhenSyntax.whenInjectedInto(Q)},A.prototype.whenParentNamed=function(Q){return this._bindingWhenSyntax.whenParentNamed(Q)},A.prototype.whenParentTagged=function(Q,K){return this._bindingWhenSyntax.whenParentTagged(Q,K)},A.prototype.whenAnyAncestorIs=function(Q){return this._bindingWhenSyntax.whenAnyAncestorIs(Q)},A.prototype.whenNoAncestorIs=function(Q){return this._bindingWhenSyntax.whenNoAncestorIs(Q)},A.prototype.whenAnyAncestorNamed=function(Q){return this._bindingWhenSyntax.whenAnyAncestorNamed(Q)},A.prototype.whenAnyAncestorTagged=function(Q,K){return this._bindingWhenSyntax.whenAnyAncestorTagged(Q,K)},A.prototype.whenNoAncestorNamed=function(Q){return this._bindingWhenSyntax.whenNoAncestorNamed(Q)},A.prototype.whenNoAncestorTagged=function(Q,K){return this._bindingWhenSyntax.whenNoAncestorTagged(Q,K)},A.prototype.whenAnyAncestorMatches=function(Q){return this._bindingWhenSyntax.whenAnyAncestorMatches(Q)},A.prototype.whenNoAncestorMatches=function(Q){return this._bindingWhenSyntax.whenNoAncestorMatches(Q)},A.prototype.onActivation=function(Q){return this._bindingOnSyntax.onActivation(Q)},A}();U.BindingWhenOnSyntax=d},98370:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.BindingWhenSyntax=void 0;var le=E(51811),C=E(80758),d=function(){function A(Q){this._binding=Q}return A.prototype.when=function(Q){return this._binding.constraint=Q,new le.BindingOnSyntax(this._binding)},A.prototype.whenTargetNamed=function(Q){return this._binding.constraint=C.namedConstraint(Q),new le.BindingOnSyntax(this._binding)},A.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Q){var K=Q.target!==null&&!Q.target.isNamed()&&!Q.target.isTagged();return K},new le.BindingOnSyntax(this._binding)},A.prototype.whenTargetTagged=function(Q,K){return this._binding.constraint=C.taggedConstraint(Q)(K),new le.BindingOnSyntax(this._binding)},A.prototype.whenInjectedInto=function(Q){return this._binding.constraint=function(K){return C.typeConstraint(Q)(K.parentRequest)},new le.BindingOnSyntax(this._binding)},A.prototype.whenParentNamed=function(Q){return this._binding.constraint=function(K){return C.namedConstraint(Q)(K.parentRequest)},new le.BindingOnSyntax(this._binding)},A.prototype.whenParentTagged=function(Q,K){return this._binding.constraint=function(W){return C.taggedConstraint(Q)(K)(W.parentRequest)},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorIs=function(Q){return this._binding.constraint=function(K){return C.traverseAncerstors(K,C.typeConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorIs=function(Q){return this._binding.constraint=function(K){return!C.traverseAncerstors(K,C.typeConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorNamed=function(Q){return this._binding.constraint=function(K){return C.traverseAncerstors(K,C.namedConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorNamed=function(Q){return this._binding.constraint=function(K){return!C.traverseAncerstors(K,C.namedConstraint(Q))},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorTagged=function(Q,K){return this._binding.constraint=function(W){return C.traverseAncerstors(W,C.taggedConstraint(Q)(K))},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorTagged=function(Q,K){return this._binding.constraint=function(W){return!C.traverseAncerstors(W,C.taggedConstraint(Q)(K))},new le.BindingOnSyntax(this._binding)},A.prototype.whenAnyAncestorMatches=function(Q){return this._binding.constraint=function(K){return C.traverseAncerstors(K,Q)},new le.BindingOnSyntax(this._binding)},A.prototype.whenNoAncestorMatches=function(Q){return this._binding.constraint=function(K){return!C.traverseAncerstors(K,Q)},new le.BindingOnSyntax(this._binding)},A}();U.BindingWhenSyntax=d},80758:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.typeConstraint=U.namedConstraint=U.taggedConstraint=U.traverseAncerstors=void 0;var le=E(6867),C=E(47738),d=function(W,L){var N=W.parentRequest;return N!==null?L(N)?!0:d(N,L):!1};U.traverseAncerstors=d;var A=function(W){return function(L){var N=function(Ne){return Ne!==null&&Ne.target!==null&&Ne.target.matchesTag(W)(L)};return N.metaData=new C.Metadata(W,L),N}};U.taggedConstraint=A;var Q=A(le.NAMED_TAG);U.namedConstraint=Q;var K=function(W){return function(L){var N=null;if(L!==null)if(N=L.bindings[0],typeof W=="string"){var Ne=N.serviceIdentifier;return Ne===W}else{var Ye=L.bindings[0].implementationType;return W===Ye}return!1}};U.typeConstraint=K},70600:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.multiBindToService=void 0;var E=function(le){return function(C){return function(){for(var d=[],A=0;A<arguments.length;A++)d[A]=arguments[A];return d.forEach(function(Q){return le.bind(Q).toService(C)})}}};U.multiBindToService=E},85265:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.isStackOverflowExeption=void 0;var le=E(16674);function C(d){return d instanceof RangeError||d.message===le.STACK_OVERFLOW}U.isStackOverflowExeption=C},37791:function(Or,U){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.id=void 0;var E=0;function le(){return E++}U.id=le},55800:function(Or,U,E){"use strict";Object.defineProperty(U,"__esModule",{value:!0}),U.circularDependencyToException=U.listMetadataForTarget=U.listRegisteredBindingsForServiceIdentifier=U.getServiceIdentifierAsString=U.getFunctionName=void 0;var le=E(16674);function C(N){if(typeof N=="function"){var Ne=N;return Ne.name}else{if(typeof N=="symbol")return N.toString();var Ne=N;return Ne}}U.getServiceIdentifierAsString=C;function d(N,Ne,Ye){var Je="",rt=Ye(N,Ne);return rt.length!==0&&(Je=`
Registered bindings:`,rt.forEach(function(Yt){var Vt="Object";Yt.implementationType!==null&&(Vt=L(Yt.implementationType)),Je=Je+`
 `+Vt,Yt.constraint.metaData&&(Je=Je+" - "+Yt.constraint.metaData)})),Je}U.listRegisteredBindingsForServiceIdentifier=d;function A(N,Ne){return N.parentRequest===null?!1:N.parentRequest.serviceIdentifier===Ne?!0:A(N.parentRequest,Ne)}function Q(N){function Ne(Je,rt){rt===void 0&&(rt=[]);var Yt=C(Je.serviceIdentifier);return rt.push(Yt),Je.parentRequest!==null?Ne(Je.parentRequest,rt):rt}var Ye=Ne(N);return Ye.reverse().join(" --> ")}function K(N){N.childRequests.forEach(function(Ne){if(A(Ne,Ne.serviceIdentifier)){var Ye=Q(Ne);throw new Error(le.CIRCULAR_DEPENDENCY+" "+Ye)}else K(Ne)})}U.circularDependencyToException=K;function W(N,Ne){if(Ne.isTagged()||Ne.isNamed()){var Ye="",Je=Ne.getNamedTag(),rt=Ne.getCustomTags();return Je!==null&&(Ye+=Je.toString()+`
`),rt!==null&&rt.forEach(function(Yt){Ye+=Yt.toString()+`
`})," "+N+`
 `+N+" - "+Ye}else return" "+N}U.listMetadataForTarget=W;function L(N){if(N.name)return N.name;var Ne=N.toString(),Ye=Ne.match(/^function\s*([^\s(]+)/);return Ye?Ye[1]:"Anonymous function: "+Ne}U.getFunctionName=L},18857:function(Or,U,E){"use strict";E.r(U),E.d(U,{Function:function(){return Na},Interpreter:function(){return To},default:function(){return Gu},evaluate:function(){return yu},vm:function(){return le}});var le={};E.r(le),E.d(le,{Script:function(){return rl},compileFunction:function(){return wl},createContext:function(){return mu},runInContext:function(){return Vu},runInNewContext:function(){return Wl}});var C={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},d="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",A={5:d,"5module":d+" export import",6:d+" const class extends export import super"},Q=/^in(stanceof)?$/,K="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",W="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",L=new RegExp("["+K+"]"),N=new RegExp("["+K+W+"]");K=W=null;var Ne=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ye=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Je(m,S){for(var j=65536,O=0;O<S.length;O+=2){if(j+=S[O],j>m)return!1;if(j+=S[O+1],j>=m)return!0}}function rt(m,S){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&L.test(String.fromCharCode(m)):S===!1?!1:Je(m,Ne)}function Yt(m,S){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&N.test(String.fromCharCode(m)):S===!1?!1:Je(m,Ne)||Je(m,Ye)}var Vt=function(S,j){j===void 0&&(j={}),this.label=S,this.keyword=j.keyword,this.beforeExpr=!!j.beforeExpr,this.startsExpr=!!j.startsExpr,this.isLoop=!!j.isLoop,this.isAssign=!!j.isAssign,this.prefix=!!j.prefix,this.postfix=!!j.postfix,this.binop=j.binop||null,this.updateContext=null};function tr(m,S){return new Vt(m,{beforeExpr:!0,binop:S})}var zt={beforeExpr:!0},Tt={startsExpr:!0},xt={};function yr(m,S){return S===void 0&&(S={}),S.keyword=m,xt[m]=new Vt(m,S)}var ee={num:new Vt("num",Tt),regexp:new Vt("regexp",Tt),string:new Vt("string",Tt),name:new Vt("name",Tt),eof:new Vt("eof"),bracketL:new Vt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Vt("]"),braceL:new Vt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Vt("}"),parenL:new Vt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Vt(")"),comma:new Vt(",",zt),semi:new Vt(";",zt),colon:new Vt(":",zt),dot:new Vt("."),question:new Vt("?",zt),questionDot:new Vt("?."),arrow:new Vt("=>",zt),template:new Vt("template"),invalidTemplate:new Vt("invalidTemplate"),ellipsis:new Vt("...",zt),backQuote:new Vt("`",Tt),dollarBraceL:new Vt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Vt("=",{beforeExpr:!0,isAssign:!0}),assign:new Vt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Vt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Vt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:tr("||",1),logicalAND:tr("&&",2),bitwiseOR:tr("|",3),bitwiseXOR:tr("^",4),bitwiseAND:tr("&",5),equality:tr("==/!=/===/!==",6),relational:tr("</>/<=/>=",7),bitShift:tr("<</>>/>>>",8),plusMin:new Vt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:tr("%",10),star:tr("*",10),slash:tr("/",10),starstar:new Vt("**",{beforeExpr:!0}),coalesce:tr("??",1),_break:yr("break"),_case:yr("case",zt),_catch:yr("catch"),_continue:yr("continue"),_debugger:yr("debugger"),_default:yr("default",zt),_do:yr("do",{isLoop:!0,beforeExpr:!0}),_else:yr("else",zt),_finally:yr("finally"),_for:yr("for",{isLoop:!0}),_function:yr("function",Tt),_if:yr("if"),_return:yr("return",zt),_switch:yr("switch"),_throw:yr("throw",zt),_try:yr("try"),_var:yr("var"),_const:yr("const"),_while:yr("while",{isLoop:!0}),_with:yr("with"),_new:yr("new",{beforeExpr:!0,startsExpr:!0}),_this:yr("this",Tt),_super:yr("super",Tt),_class:yr("class",Tt),_extends:yr("extends",zt),_export:yr("export"),_import:yr("import",Tt),_null:yr("null",Tt),_true:yr("true",Tt),_false:yr("false",Tt),_in:yr("in",{beforeExpr:!0,binop:7}),_instanceof:yr("instanceof",{beforeExpr:!0,binop:7}),_typeof:yr("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:yr("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:yr("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},dr=/\r\n?|\n|\u2028|\u2029/,Ct=new RegExp(dr.source,"g");function Ke(m,S){return m===10||m===13||!S&&(m===8232||m===8233)}var Dt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Xe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Ut=Object.prototype,_r=Ut.hasOwnProperty,ar=Ut.toString;function zr(m,S){return _r.call(m,S)}var fe=Array.isArray||function(m){return ar.call(m)==="[object Array]"};function Re(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var ge=function(S,j){this.line=S,this.column=j};ge.prototype.offset=function(S){return new ge(this.line,this.column+S)};var _t=function(S,j,O){this.start=j,this.end=O,S.sourceFile!==null&&(this.source=S.sourceFile)};function pt(m,S){for(var j=1,O=0;;){Ct.lastIndex=O;var ue=Ct.exec(m);if(ue&&ue.index<S)++j,O=ue.index+ue[0].length;else return new ge(j,S-O)}}var Nt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Bt(m){var S={};for(var j in Nt)S[j]=m&&zr(m,j)?m[j]:Nt[j];if(S.ecmaVersion>=2015&&(S.ecmaVersion-=2009),S.allowReserved==null&&(S.allowReserved=S.ecmaVersion<5),fe(S.onToken)){var O=S.onToken;S.onToken=function(ue){return O.push(ue)}}return fe(S.onComment)&&(S.onComment=kr(S,S.onComment)),S}function kr(m,S){return function(j,O,ue,Oe,st,Lt){var Mt={type:j?"Block":"Line",value:O,start:ue,end:Oe};m.locations&&(Mt.loc=new _t(this,st,Lt)),m.ranges&&(Mt.range=[ue,Oe]),S.push(Mt)}}var ln=1,yn=2,Vi=ln|yn,nr=4,de=8,Te=16,Ue=32,Le=64,Ft=128;function er(m,S){return yn|(m?nr:0)|(S?de:0)}var w=0,Z=1,Ee=2,Ze=3,Qe=4,yt=5,St=function(S,j,O){this.options=S=Bt(S),this.sourceFile=S.sourceFile,this.keywords=Re(A[S.ecmaVersion>=6?6:S.sourceType==="module"?"5module":5]);var ue="";if(S.allowReserved!==!0){for(var Oe=S.ecmaVersion;!(ue=C[Oe]);Oe--);S.sourceType==="module"&&(ue+=" await")}this.reservedWords=Re(ue);var st=(ue?ue+" ":"")+C.strict;this.reservedWordsStrict=Re(st),this.reservedWordsStrictBind=Re(st+" "+C.strictBind),this.input=String(j),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(dr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=ee.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=S.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&S.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(ln),this.regexpState=null},jt={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};St.prototype.parse=function(){var S=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(S)},jt.inFunction.get=function(){return(this.currentVarScope().flags&yn)>0},jt.inGenerator.get=function(){return(this.currentVarScope().flags&de)>0},jt.inAsync.get=function(){return(this.currentVarScope().flags&nr)>0},jt.allowSuper.get=function(){return(this.currentThisScope().flags&Le)>0},jt.allowDirectSuper.get=function(){return(this.currentThisScope().flags&Ft)>0},jt.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},St.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&yn)>0},St.extend=function(){for(var S=[],j=arguments.length;j--;)S[j]=arguments[j];for(var O=this,ue=0;ue<S.length;ue++)O=S[ue](O);return O},St.parse=function(S,j){return new this(j,S).parse()},St.parseExpressionAt=function(S,j,O){var ue=new this(O,S,j);return ue.nextToken(),ue.parseExpression()},St.tokenizer=function(S,j){return new this(j,S)},Object.defineProperties(St.prototype,jt);var Et=St.prototype,Qt=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Et.strictDirective=function(m){for(;;){Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length;var S=Qt.exec(this.input.slice(m));if(!S)return!1;if((S[1]||S[2])==="use strict"){Xe.lastIndex=m+S[0].length;var j=Xe.exec(this.input),O=j.index+j[0].length,ue=this.input.charAt(O);return ue===";"||ue==="}"||dr.test(j[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(ue)||ue==="!"&&this.input.charAt(O+1)==="=")}m+=S[0].length,Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length,this.input[m]===";"&&m++}},Et.eat=function(m){return this.type===m?(this.next(),!0):!1},Et.isContextual=function(m){return this.type===ee.name&&this.value===m&&!this.containsEsc},Et.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},Et.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},Et.canInsertSemicolon=function(){return this.type===ee.eof||this.type===ee.braceR||dr.test(this.input.slice(this.lastTokEnd,this.start))},Et.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Et.semicolon=function(){!this.eat(ee.semi)&&!this.insertSemicolon()&&this.unexpected()},Et.afterTrailingComma=function(m,S){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),S||this.next(),!0},Et.expect=function(m){this.eat(m)||this.unexpected()},Et.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function ie(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Et.checkPatternErrors=function(m,S){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var j=S?m.parenthesizedAssign:m.parenthesizedBind;j>-1&&this.raiseRecoverable(j,"Parenthesized pattern")}},Et.checkExpressionErrors=function(m,S){if(!m)return!1;var j=m.shorthandAssign,O=m.doubleProto;if(!S)return j>=0||O>=0;j>=0&&this.raise(j,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Et.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Et.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var sr=St.prototype;sr.parseTopLevel=function(m){var S={};for(m.body||(m.body=[]);this.type!==ee.eof;){var j=this.parseStatement(null,!0,S);m.body.push(j)}if(this.inModule)for(var O=0,ue=Object.keys(this.undefinedExports);O<ue.length;O+=1){var Oe=ue[O];this.raiseRecoverable(this.undefinedExports[Oe].start,"Export '"+Oe+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Br={kind:"loop"},Lr={kind:"switch"};sr.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Xe.lastIndex=this.pos;var S=Xe.exec(this.input),j=this.pos+S[0].length,O=this.input.charCodeAt(j);if(O===91)return!0;if(m)return!1;if(O===123)return!0;if(rt(O,!0)){for(var ue=j+1;Yt(this.input.charCodeAt(ue),!0);)++ue;var Oe=this.input.slice(j,ue);if(!Q.test(Oe))return!0}return!1},sr.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Xe.lastIndex=this.pos;var m=Xe.exec(this.input),S=this.pos+m[0].length;return!dr.test(this.input.slice(this.pos,S))&&this.input.slice(S,S+8)==="function"&&(S+8===this.input.length||!Yt(this.input.charAt(S+8)))},sr.parseStatement=function(m,S,j){var O=this.type,ue=this.startNode(),Oe;switch(this.isLet(m)&&(O=ee._var,Oe="let"),O){case ee._break:case ee._continue:return this.parseBreakContinueStatement(ue,O.keyword);case ee._debugger:return this.parseDebuggerStatement(ue);case ee._do:return this.parseDoStatement(ue);case ee._for:return this.parseForStatement(ue);case ee._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(ue,!1,!m);case ee._class:return m&&this.unexpected(),this.parseClass(ue,!0);case ee._if:return this.parseIfStatement(ue);case ee._return:return this.parseReturnStatement(ue);case ee._switch:return this.parseSwitchStatement(ue);case ee._throw:return this.parseThrowStatement(ue);case ee._try:return this.parseTryStatement(ue);case ee._const:case ee._var:return Oe=Oe||this.value,m&&Oe!=="var"&&this.unexpected(),this.parseVarStatement(ue,Oe);case ee._while:return this.parseWhileStatement(ue);case ee._with:return this.parseWithStatement(ue);case ee.braceL:return this.parseBlock(!0,ue);case ee.semi:return this.parseEmptyStatement(ue);case ee._export:case ee._import:if(this.options.ecmaVersion>10&&O===ee._import){Xe.lastIndex=this.pos;var st=Xe.exec(this.input),Lt=this.pos+st[0].length,Mt=this.input.charCodeAt(Lt);if(Mt===40||Mt===46)return this.parseExpressionStatement(ue,this.parseExpression())}return this.options.allowImportExportEverywhere||(S||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===ee._import?this.parseImport(ue):this.parseExport(ue,j);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(ue,!0,!m);var wr=this.value,jr=this.parseExpression();return O===ee.name&&jr.type==="Identifier"&&this.eat(ee.colon)?this.parseLabeledStatement(ue,wr,jr,m):this.parseExpressionStatement(ue,jr)}},sr.parseBreakContinueStatement=function(m,S){var j=S==="break";this.next(),this.eat(ee.semi)||this.insertSemicolon()?m.label=null:this.type!==ee.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var ue=this.labels[O];if((m.label==null||ue.name===m.label.name)&&(ue.kind!=null&&(j||ue.kind==="loop")||m.label&&j))break}return O===this.labels.length&&this.raise(m.start,"Unsyntactic "+S),this.finishNode(m,j?"BreakStatement":"ContinueStatement")},sr.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},sr.parseDoStatement=function(m){return this.next(),this.labels.push(Br),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(ee._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(ee.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},sr.parseForStatement=function(m){this.next();var S=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Br),this.enterScope(0),this.expect(ee.parenL),this.type===ee.semi)return S>-1&&this.unexpected(S),this.parseFor(m,null);var j=this.isLet();if(this.type===ee._var||this.type===ee._const||j){var O=this.startNode(),ue=j?"let":this.value;return this.next(),this.parseVar(O,!0,ue),this.finishNode(O,"VariableDeclaration"),(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===ee._in?S>-1&&this.unexpected(S):m.await=S>-1),this.parseForIn(m,O)):(S>-1&&this.unexpected(S),this.parseFor(m,O))}var Oe=new ie,st=this.parseExpression(!0,Oe);return this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===ee._in?S>-1&&this.unexpected(S):m.await=S>-1),this.toAssignable(st,!1,Oe),this.checkLVal(st),this.parseForIn(m,st)):(this.checkExpressionErrors(Oe,!0),S>-1&&this.unexpected(S),this.parseFor(m,st))},sr.parseFunctionStatement=function(m,S,j){return this.next(),this.parseFunction(m,gt|(j?0:vt),!1,S)},sr.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(ee._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},sr.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(ee.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},sr.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(ee.braceL),this.labels.push(Lr),this.enterScope(0);for(var S,j=!1;this.type!==ee.braceR;)if(this.type===ee._case||this.type===ee._default){var O=this.type===ee._case;S&&this.finishNode(S,"SwitchCase"),m.cases.push(S=this.startNode()),S.consequent=[],this.next(),O?S.test=this.parseExpression():(j&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),j=!0,S.test=null),this.expect(ee.colon)}else S||this.unexpected(),S.consequent.push(this.parseStatement(null));return this.exitScope(),S&&this.finishNode(S,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},sr.parseThrowStatement=function(m){return this.next(),dr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var nt=[];sr.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===ee._catch){var S=this.startNode();if(this.next(),this.eat(ee.parenL)){S.param=this.parseBindingAtom();var j=S.param.type==="Identifier";this.enterScope(j?Ue:0),this.checkLVal(S.param,j?Qe:Ee),this.expect(ee.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),S.param=null,this.enterScope(0);S.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(S,"CatchClause")}return m.finalizer=this.eat(ee._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},sr.parseVarStatement=function(m,S){return this.next(),this.parseVar(m,!1,S),this.semicolon(),this.finishNode(m,"VariableDeclaration")},sr.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Br),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},sr.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},sr.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},sr.parseLabeledStatement=function(m,S,j,O){for(var ue=0,Oe=this.labels;ue<Oe.length;ue+=1){var st=Oe[ue];st.name===S&&this.raise(j.start,"Label '"+S+"' is already declared")}for(var Lt=this.type.isLoop?"loop":this.type===ee._switch?"switch":null,Mt=this.labels.length-1;Mt>=0;Mt--){var wr=this.labels[Mt];if(wr.statementStart===m.start)wr.statementStart=this.start,wr.kind=Lt;else break}return this.labels.push({name:S,kind:Lt,statementStart:this.start}),m.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),m.label=j,this.finishNode(m,"LabeledStatement")},sr.parseExpressionStatement=function(m,S){return m.expression=S,this.semicolon(),this.finishNode(m,"ExpressionStatement")},sr.parseBlock=function(m,S,j){for(m===void 0&&(m=!0),S===void 0&&(S=this.startNode()),S.body=[],this.expect(ee.braceL),m&&this.enterScope(0);this.type!==ee.braceR;){var O=this.parseStatement(null);S.body.push(O)}return j&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(S,"BlockStatement")},sr.parseFor=function(m,S){return m.init=S,this.expect(ee.semi),m.test=this.type===ee.semi?null:this.parseExpression(),this.expect(ee.semi),m.update=this.type===ee.parenR?null:this.parseExpression(),this.expect(ee.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},sr.parseForIn=function(m,S){var j=this.type===ee._in;return this.next(),S.type==="VariableDeclaration"&&S.declarations[0].init!=null&&(!j||this.options.ecmaVersion<8||this.strict||S.kind!=="var"||S.declarations[0].id.type!=="Identifier")?this.raise(S.start,(j?"for-in":"for-of")+" loop variable declaration may not have an initializer"):S.type==="AssignmentPattern"&&this.raise(S.start,"Invalid left-hand side in for-loop"),m.left=S,m.right=j?this.parseExpression():this.parseMaybeAssign(),this.expect(ee.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,j?"ForInStatement":"ForOfStatement")},sr.parseVar=function(m,S,j){for(m.declarations=[],m.kind=j;;){var O=this.startNode();if(this.parseVarId(O,j),this.eat(ee.eq)?O.init=this.parseMaybeAssign(S):j==="const"&&!(this.type===ee._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(S&&(this.type===ee._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,m.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(ee.comma))break}return m},sr.parseVarId=function(m,S){m.id=this.parseBindingAtom(),this.checkLVal(m.id,S==="var"?Z:Ee,!1)};var gt=1,vt=2,hr=4;sr.parseFunction=function(m,S,j,O){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===ee.star&&S&vt&&this.unexpected(),m.generator=this.eat(ee.star)),this.options.ecmaVersion>=8&&(m.async=!!O),S&gt&&(m.id=S&hr&&this.type!==ee.name?null:this.parseIdent(),m.id&&!(S&vt)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Z:Ee:Ze));var ue=this.yieldPos,Oe=this.awaitPos,st=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(er(m.async,m.generator)),S&gt||(m.id=this.type===ee.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,j,!1),this.yieldPos=ue,this.awaitPos=Oe,this.awaitIdentPos=st,this.finishNode(m,S&gt?"FunctionDeclaration":"FunctionExpression")},sr.parseFunctionParams=function(m){this.expect(ee.parenL),m.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},sr.parseClass=function(m,S){this.next();var j=this.strict;this.strict=!0,this.parseClassId(m,S),this.parseClassSuper(m);var O=this.startNode(),ue=!1;for(O.body=[],this.expect(ee.braceL);this.type!==ee.braceR;){var Oe=this.parseClassElement(m.superClass!==null);Oe&&(O.body.push(Oe),Oe.type==="MethodDefinition"&&Oe.kind==="constructor"&&(ue&&this.raise(Oe.start,"Duplicate constructor in the same class"),ue=!0))}return this.strict=j,this.next(),m.body=this.finishNode(O,"ClassBody"),this.finishNode(m,S?"ClassDeclaration":"ClassExpression")},sr.parseClassElement=function(m){var S=this;if(this.eat(ee.semi))return null;var j=this.startNode(),O=function(Mt,wr){wr===void 0&&(wr=!1);var jr=S.start,qn=S.startLoc;return S.eatContextual(Mt)?S.type!==ee.parenL&&(!wr||!S.canInsertSemicolon())?!0:(j.key&&S.unexpected(),j.computed=!1,j.key=S.startNodeAt(jr,qn),j.key.name=Mt,S.finishNode(j.key,"Identifier"),!1):!1};j.kind="method",j.static=O("static");var ue=this.eat(ee.star),Oe=!1;ue||(this.options.ecmaVersion>=8&&O("async",!0)?(Oe=!0,ue=this.options.ecmaVersion>=9&&this.eat(ee.star)):O("get")?j.kind="get":O("set")&&(j.kind="set")),j.key||this.parsePropertyName(j);var st=j.key,Lt=!1;return!j.computed&&!j.static&&(st.type==="Identifier"&&st.name==="constructor"||st.type==="Literal"&&st.value==="constructor")?(j.kind!=="method"&&this.raise(st.start,"Constructor can't have get/set modifier"),ue&&this.raise(st.start,"Constructor can't be a generator"),Oe&&this.raise(st.start,"Constructor can't be an async method"),j.kind="constructor",Lt=m):j.static&&st.type==="Identifier"&&st.name==="prototype"&&this.raise(st.start,"Classes may not have a static property named prototype"),this.parseClassMethod(j,ue,Oe,Lt),j.kind==="get"&&j.value.params.length!==0&&this.raiseRecoverable(j.value.start,"getter should have no params"),j.kind==="set"&&j.value.params.length!==1&&this.raiseRecoverable(j.value.start,"setter should have exactly one param"),j.kind==="set"&&j.value.params[0].type==="RestElement"&&this.raiseRecoverable(j.value.params[0].start,"Setter cannot use rest params"),j},sr.parseClassMethod=function(m,S,j,O){return m.value=this.parseMethod(S,j,O),this.finishNode(m,"MethodDefinition")},sr.parseClassId=function(m,S){this.type===ee.name?(m.id=this.parseIdent(),S&&this.checkLVal(m.id,Ee,!1)):(S===!0&&this.unexpected(),m.id=null)},sr.parseClassSuper=function(m){m.superClass=this.eat(ee._extends)?this.parseExprSubscripts():null},sr.parseExport=function(m,S){if(this.next(),this.eat(ee.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(S,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==ee.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(ee._default)){this.checkExport(S,"default",this.lastTokStart);var j;if(this.type===ee._function||(j=this.isAsyncFunction())){var O=this.startNode();this.next(),j&&this.next(),m.declaration=this.parseFunction(O,gt|hr,!1,j)}else if(this.type===ee._class){var ue=this.startNode();m.declaration=this.parseClass(ue,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(S,m.declaration.declarations):this.checkExport(S,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(S),this.eatContextual("from"))this.type!==ee.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var Oe=0,st=m.specifiers;Oe<st.length;Oe+=1){var Lt=st[Oe];this.checkUnreserved(Lt.local),this.checkLocalExport(Lt.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},sr.checkExport=function(m,S,j){!m||(zr(m,S)&&this.raiseRecoverable(j,"Duplicate export '"+S+"'"),m[S]=!0)},sr.checkPatternExport=function(m,S){var j=S.type;if(j==="Identifier")this.checkExport(m,S.name,S.start);else if(j==="ObjectPattern")for(var O=0,ue=S.properties;O<ue.length;O+=1){var Oe=ue[O];this.checkPatternExport(m,Oe)}else if(j==="ArrayPattern")for(var st=0,Lt=S.elements;st<Lt.length;st+=1){var Mt=Lt[st];Mt&&this.checkPatternExport(m,Mt)}else j==="Property"?this.checkPatternExport(m,S.value):j==="AssignmentPattern"?this.checkPatternExport(m,S.left):j==="RestElement"?this.checkPatternExport(m,S.argument):j==="ParenthesizedExpression"&&this.checkPatternExport(m,S.expression)},sr.checkVariableExport=function(m,S){if(!!m)for(var j=0,O=S;j<O.length;j+=1){var ue=O[j];this.checkPatternExport(m,ue.id)}},sr.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},sr.parseExportSpecifiers=function(m){var S=[],j=!0;for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(j)j=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(m,O.exported.name,O.exported.start),S.push(this.finishNode(O,"ExportSpecifier"))}return S},sr.parseImport=function(m){return this.next(),this.type===ee.string?(m.specifiers=nt,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===ee.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},sr.parseImportSpecifiers=function(){var m=[],S=!0;if(this.type===ee.name){var j=this.startNode();if(j.local=this.parseIdent(),this.checkLVal(j.local,Ee),m.push(this.finishNode(j,"ImportDefaultSpecifier")),!this.eat(ee.comma))return m}if(this.type===ee.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,Ee),m.push(this.finishNode(O,"ImportNamespaceSpecifier")),m}for(this.expect(ee.braceL);!this.eat(ee.braceR);){if(S)S=!1;else if(this.expect(ee.comma),this.afterTrailingComma(ee.braceR))break;var ue=this.startNode();ue.imported=this.parseIdent(!0),this.eatContextual("as")?ue.local=this.parseIdent():(this.checkUnreserved(ue.imported),ue.local=ue.imported),this.checkLVal(ue.local,Ee),m.push(this.finishNode(ue,"ImportSpecifier"))}return m},sr.adaptDirectivePrologue=function(m){for(var S=0;S<m.length&&this.isDirectiveCandidate(m[S]);++S)m[S].directive=m[S].expression.raw.slice(1,-1)},sr.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var Vr=St.prototype;Vr.toAssignable=function(m,S,j){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",j&&this.checkPatternErrors(j,!0);for(var O=0,ue=m.properties;O<ue.length;O+=1){var Oe=ue[O];this.toAssignable(Oe,S),Oe.type==="RestElement"&&(Oe.argument.type==="ArrayPattern"||Oe.argument.type==="ObjectPattern")&&this.raise(Oe.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,S);break;case"ArrayExpression":m.type="ArrayPattern",j&&this.checkPatternErrors(j,!0),this.toAssignableList(m.elements,S);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,S),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,S);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,S,j);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!S)break;default:this.raise(m.start,"Assigning to rvalue")}else j&&this.checkPatternErrors(j,!0);return m},Vr.toAssignableList=function(m,S){for(var j=m.length,O=0;O<j;O++){var ue=m[O];ue&&this.toAssignable(ue,S)}if(j){var Oe=m[j-1];this.options.ecmaVersion===6&&S&&Oe&&Oe.type==="RestElement"&&Oe.argument.type!=="Identifier"&&this.unexpected(Oe.argument.start)}return m},Vr.parseSpread=function(m){var S=this.startNode();return this.next(),S.argument=this.parseMaybeAssign(!1,m),this.finishNode(S,"SpreadElement")},Vr.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==ee.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},Vr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case ee.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(ee.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case ee.braceL:return this.parseObj(!0)}return this.parseIdent()},Vr.parseBindingList=function(m,S,j){for(var O=[],ue=!0;!this.eat(m);)if(ue?ue=!1:this.expect(ee.comma),S&&this.type===ee.comma)O.push(null);else{if(j&&this.afterTrailingComma(m))break;if(this.type===ee.ellipsis){var Oe=this.parseRestBinding();this.parseBindingListItem(Oe),O.push(Oe),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var st=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(st),O.push(st)}}return O},Vr.parseBindingListItem=function(m){return m},Vr.parseMaybeDefault=function(m,S,j){if(j=j||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(ee.eq))return j;var O=this.startNodeAt(m,S);return O.left=j,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},Vr.checkLVal=function(m,S,j){switch(S===void 0&&(S=w),m.type){case"Identifier":S===Ee&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(S?"Binding ":"Assigning to ")+m.name+" in strict mode"),j&&(zr(j,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),j[m.name]=!0),S!==w&&S!==yt&&this.declareName(m.name,S,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":S&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,ue=m.properties;O<ue.length;O+=1){var Oe=ue[O];this.checkLVal(Oe,S,j)}break;case"Property":this.checkLVal(m.value,S,j);break;case"ArrayPattern":for(var st=0,Lt=m.elements;st<Lt.length;st+=1){var Mt=Lt[st];Mt&&this.checkLVal(Mt,S,j)}break;case"AssignmentPattern":this.checkLVal(m.left,S,j);break;case"RestElement":this.checkLVal(m.argument,S,j);break;case"ParenthesizedExpression":this.checkLVal(m.expression,S,j);break;default:this.raise(m.start,(S?"Binding":"Assigning to")+" rvalue")}};var Ur=St.prototype;Ur.checkPropClash=function(m,S,j){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var O=m.key,ue;switch(O.type){case"Identifier":ue=O.name;break;case"Literal":ue=String(O.value);break;default:return}var Oe=m.kind;if(this.options.ecmaVersion>=6){ue==="__proto__"&&Oe==="init"&&(S.proto&&(j?j.doubleProto<0&&(j.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),S.proto=!0);return}ue="$"+ue;var st=S[ue];if(st){var Lt;Oe==="init"?Lt=this.strict&&st.init||st.get||st.set:Lt=st.init||st[Oe],Lt&&this.raiseRecoverable(O.start,"Redefinition of property")}else st=S[ue]={init:!1,get:!1,set:!1};st[Oe]=!0}},Ur.parseExpression=function(m,S){var j=this.start,O=this.startLoc,ue=this.parseMaybeAssign(m,S);if(this.type===ee.comma){var Oe=this.startNodeAt(j,O);for(Oe.expressions=[ue];this.eat(ee.comma);)Oe.expressions.push(this.parseMaybeAssign(m,S));return this.finishNode(Oe,"SequenceExpression")}return ue},Ur.parseMaybeAssign=function(m,S,j){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var O=!1,ue=-1,Oe=-1;S?(ue=S.parenthesizedAssign,Oe=S.trailingComma,S.parenthesizedAssign=S.trailingComma=-1):(S=new ie,O=!0);var st=this.start,Lt=this.startLoc;(this.type===ee.parenL||this.type===ee.name)&&(this.potentialArrowAt=this.start);var Mt=this.parseMaybeConditional(m,S);if(j&&(Mt=j.call(this,Mt,st,Lt)),this.type.isAssign){var wr=this.startNodeAt(st,Lt);return wr.operator=this.value,wr.left=this.type===ee.eq?this.toAssignable(Mt,!1,S):Mt,O||(S.parenthesizedAssign=S.trailingComma=S.doubleProto=-1),S.shorthandAssign>=wr.left.start&&(S.shorthandAssign=-1),this.checkLVal(Mt),this.next(),wr.right=this.parseMaybeAssign(m),this.finishNode(wr,"AssignmentExpression")}else O&&this.checkExpressionErrors(S,!0);return ue>-1&&(S.parenthesizedAssign=ue),Oe>-1&&(S.trailingComma=Oe),Mt},Ur.parseMaybeConditional=function(m,S){var j=this.start,O=this.startLoc,ue=this.parseExprOps(m,S);if(this.checkExpressionErrors(S))return ue;if(this.eat(ee.question)){var Oe=this.startNodeAt(j,O);return Oe.test=ue,Oe.consequent=this.parseMaybeAssign(),this.expect(ee.colon),Oe.alternate=this.parseMaybeAssign(m),this.finishNode(Oe,"ConditionalExpression")}return ue},Ur.parseExprOps=function(m,S){var j=this.start,O=this.startLoc,ue=this.parseMaybeUnary(S,!1);return this.checkExpressionErrors(S)||ue.start===j&&ue.type==="ArrowFunctionExpression"?ue:this.parseExprOp(ue,j,O,-1,m)},Ur.parseExprOp=function(m,S,j,O,ue){var Oe=this.type.binop;if(Oe!=null&&(!ue||this.type!==ee._in)&&Oe>O){var st=this.type===ee.logicalOR||this.type===ee.logicalAND,Lt=this.type===ee.coalesce;Lt&&(Oe=ee.logicalAND.binop);var Mt=this.value;this.next();var wr=this.start,jr=this.startLoc,qn=this.parseExprOp(this.parseMaybeUnary(null,!1),wr,jr,Oe,ue),Pi=this.buildBinary(S,j,m,qn,Mt,st||Lt);return(st&&this.type===ee.coalesce||Lt&&(this.type===ee.logicalOR||this.type===ee.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Pi,S,j,O,ue)}return m},Ur.buildBinary=function(m,S,j,O,ue,Oe){var st=this.startNodeAt(m,S);return st.left=j,st.operator=ue,st.right=O,this.finishNode(st,Oe?"LogicalExpression":"BinaryExpression")},Ur.parseMaybeUnary=function(m,S){var j=this.start,O=this.startLoc,ue;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))ue=this.parseAwait(),S=!0;else if(this.type.prefix){var Oe=this.startNode(),st=this.type===ee.incDec;Oe.operator=this.value,Oe.prefix=!0,this.next(),Oe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),st?this.checkLVal(Oe.argument):this.strict&&Oe.operator==="delete"&&Oe.argument.type==="Identifier"?this.raiseRecoverable(Oe.start,"Deleting local variable in strict mode"):S=!0,ue=this.finishNode(Oe,st?"UpdateExpression":"UnaryExpression")}else{if(ue=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return ue;for(;this.type.postfix&&!this.canInsertSemicolon();){var Lt=this.startNodeAt(j,O);Lt.operator=this.value,Lt.prefix=!1,Lt.argument=ue,this.checkLVal(ue),this.next(),ue=this.finishNode(Lt,"UpdateExpression")}}return!S&&this.eat(ee.starstar)?this.buildBinary(j,O,ue,this.parseMaybeUnary(null,!1),"**",!1):ue},Ur.parseExprSubscripts=function(m){var S=this.start,j=this.startLoc,O=this.parseExprAtom(m);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var ue=this.parseSubscripts(O,S,j);return m&&ue.type==="MemberExpression"&&(m.parenthesizedAssign>=ue.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=ue.start&&(m.parenthesizedBind=-1)),ue},Ur.parseSubscripts=function(m,S,j,O){for(var ue=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,Oe=!1;;){var st=this.parseSubscript(m,S,j,O,ue,Oe);if(st.optional&&(Oe=!0),st===m||st.type==="ArrowFunctionExpression"){if(Oe){var Lt=this.startNodeAt(S,j);Lt.expression=st,st=this.finishNode(Lt,"ChainExpression")}return st}m=st}},Ur.parseSubscript=function(m,S,j,O,ue,Oe){var st=this.options.ecmaVersion>=11,Lt=st&&this.eat(ee.questionDot);O&&Lt&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Mt=this.eat(ee.bracketL);if(Mt||Lt&&this.type!==ee.parenL&&this.type!==ee.backQuote||this.eat(ee.dot)){var wr=this.startNodeAt(S,j);wr.object=m,wr.property=Mt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),wr.computed=!!Mt,Mt&&this.expect(ee.bracketR),st&&(wr.optional=Lt),m=this.finishNode(wr,"MemberExpression")}else if(!O&&this.eat(ee.parenL)){var jr=new ie,qn=this.yieldPos,Pi=this.awaitPos,ci=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var ei=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1,jr);if(ue&&!Lt&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(jr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=qn,this.awaitPos=Pi,this.awaitIdentPos=ci,this.parseArrowExpression(this.startNodeAt(S,j),ei,!0);this.checkExpressionErrors(jr,!0),this.yieldPos=qn||this.yieldPos,this.awaitPos=Pi||this.awaitPos,this.awaitIdentPos=ci||this.awaitIdentPos;var Ea=this.startNodeAt(S,j);Ea.callee=m,Ea.arguments=ei,st&&(Ea.optional=Lt),m=this.finishNode(Ea,"CallExpression")}else if(this.type===ee.backQuote){(Lt||Oe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Fa=this.startNodeAt(S,j);Fa.tag=m,Fa.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(Fa,"TaggedTemplateExpression")}return m},Ur.parseExprAtom=function(m){this.type===ee.slash&&this.readRegexp();var S,j=this.potentialArrowAt===this.start;switch(this.type){case ee._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),S=this.startNode(),this.next(),this.type===ee.parenL&&!this.allowDirectSuper&&this.raise(S.start,"super() call outside constructor of a subclass"),this.type!==ee.dot&&this.type!==ee.bracketL&&this.type!==ee.parenL&&this.unexpected(),this.finishNode(S,"Super");case ee._this:return S=this.startNode(),this.next(),this.finishNode(S,"ThisExpression");case ee.name:var O=this.start,ue=this.startLoc,Oe=this.containsEsc,st=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Oe&&st.name==="async"&&!this.canInsertSemicolon()&&this.eat(ee._function))return this.parseFunction(this.startNodeAt(O,ue),0,!1,!0);if(j&&!this.canInsertSemicolon()){if(this.eat(ee.arrow))return this.parseArrowExpression(this.startNodeAt(O,ue),[st],!1);if(this.options.ecmaVersion>=8&&st.name==="async"&&this.type===ee.name&&!Oe)return st=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(ee.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,ue),[st],!0)}return st;case ee.regexp:var Lt=this.value;return S=this.parseLiteral(Lt.value),S.regex={pattern:Lt.pattern,flags:Lt.flags},S;case ee.num:case ee.string:return this.parseLiteral(this.value);case ee._null:case ee._true:case ee._false:return S=this.startNode(),S.value=this.type===ee._null?null:this.type===ee._true,S.raw=this.type.keyword,this.next(),this.finishNode(S,"Literal");case ee.parenL:var Mt=this.start,wr=this.parseParenAndDistinguishExpression(j);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(wr)&&(m.parenthesizedAssign=Mt),m.parenthesizedBind<0&&(m.parenthesizedBind=Mt)),wr;case ee.bracketL:return S=this.startNode(),this.next(),S.elements=this.parseExprList(ee.bracketR,!0,!0,m),this.finishNode(S,"ArrayExpression");case ee.braceL:return this.parseObj(!1,m);case ee._function:return S=this.startNode(),this.next(),this.parseFunction(S,0);case ee._class:return this.parseClass(this.startNode(),!1);case ee._new:return this.parseNew();case ee.backQuote:return this.parseTemplate();case ee._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Ur.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var S=this.parseIdent(!0);switch(this.type){case ee.parenL:return this.parseDynamicImport(m);case ee.dot:return m.meta=S,this.parseImportMeta(m);default:this.unexpected()}},Ur.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(ee.parenR)){var S=this.start;this.eat(ee.comma)&&this.eat(ee.parenR)?this.raiseRecoverable(S,"Trailing comma is not allowed in import()"):this.unexpected(S)}return this.finishNode(m,"ImportExpression")},Ur.parseImportMeta=function(m){this.next();var S=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),S&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Ur.parseLiteral=function(m){var S=this.startNode();return S.value=m,S.raw=this.input.slice(this.start,this.end),S.raw.charCodeAt(S.raw.length-1)===110&&(S.bigint=S.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(S,"Literal")},Ur.parseParenExpression=function(){this.expect(ee.parenL);var m=this.parseExpression();return this.expect(ee.parenR),m},Ur.parseParenAndDistinguishExpression=function(m){var S=this.start,j=this.startLoc,O,ue=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Oe=this.start,st=this.startLoc,Lt=[],Mt=!0,wr=!1,jr=new ie,qn=this.yieldPos,Pi=this.awaitPos,ci;for(this.yieldPos=0,this.awaitPos=0;this.type!==ee.parenR;)if(Mt?Mt=!1:this.expect(ee.comma),ue&&this.afterTrailingComma(ee.parenR,!0)){wr=!0;break}else if(this.type===ee.ellipsis){ci=this.start,Lt.push(this.parseParenItem(this.parseRestBinding())),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Lt.push(this.parseMaybeAssign(!1,jr,this.parseParenItem));var ei=this.start,Ea=this.startLoc;if(this.expect(ee.parenR),m&&!this.canInsertSemicolon()&&this.eat(ee.arrow))return this.checkPatternErrors(jr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=qn,this.awaitPos=Pi,this.parseParenArrowList(S,j,Lt);(!Lt.length||wr)&&this.unexpected(this.lastTokStart),ci&&this.unexpected(ci),this.checkExpressionErrors(jr,!0),this.yieldPos=qn||this.yieldPos,this.awaitPos=Pi||this.awaitPos,Lt.length>1?(O=this.startNodeAt(Oe,st),O.expressions=Lt,this.finishNodeAt(O,"SequenceExpression",ei,Ea)):O=Lt[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Fa=this.startNodeAt(S,j);return Fa.expression=O,this.finishNode(Fa,"ParenthesizedExpression")}else return O},Ur.parseParenItem=function(m){return m},Ur.parseParenArrowList=function(m,S,j){return this.parseArrowExpression(this.startNodeAt(m,S),j)};var nn=[];Ur.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),S=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(ee.dot)){m.meta=S;var j=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),j&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var O=this.start,ue=this.startLoc,Oe=this.type===ee._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),O,ue,!0),Oe&&m.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(ee.parenL)?m.arguments=this.parseExprList(ee.parenR,this.options.ecmaVersion>=8,!1):m.arguments=nn,this.finishNode(m,"NewExpression")},Ur.parseTemplateElement=function(m){var S=m.isTagged,j=this.startNode();return this.type===ee.invalidTemplate?(S||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),j.value={raw:this.value,cooked:null}):j.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),j.tail=this.type===ee.backQuote,this.finishNode(j,"TemplateElement")},Ur.parseTemplate=function(m){m===void 0&&(m={});var S=m.isTagged;S===void 0&&(S=!1);var j=this.startNode();this.next(),j.expressions=[];var O=this.parseTemplateElement({isTagged:S});for(j.quasis=[O];!O.tail;)this.type===ee.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(ee.dollarBraceL),j.expressions.push(this.parseExpression()),this.expect(ee.braceR),j.quasis.push(O=this.parseTemplateElement({isTagged:S}));return this.next(),this.finishNode(j,"TemplateLiteral")},Ur.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===ee.name||this.type===ee.num||this.type===ee.string||this.type===ee.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===ee.star)&&!dr.test(this.input.slice(this.lastTokEnd,this.start))},Ur.parseObj=function(m,S){var j=this.startNode(),O=!0,ue={};for(j.properties=[],this.next();!this.eat(ee.braceR);){if(O)O=!1;else if(this.expect(ee.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(ee.braceR))break;var Oe=this.parseProperty(m,S);m||this.checkPropClash(Oe,ue,S),j.properties.push(Oe)}return this.finishNode(j,m?"ObjectPattern":"ObjectExpression")},Ur.parseProperty=function(m,S){var j=this.startNode(),O,ue,Oe,st;if(this.options.ecmaVersion>=9&&this.eat(ee.ellipsis))return m?(j.argument=this.parseIdent(!1),this.type===ee.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(j,"RestElement")):(this.type===ee.parenL&&S&&(S.parenthesizedAssign<0&&(S.parenthesizedAssign=this.start),S.parenthesizedBind<0&&(S.parenthesizedBind=this.start)),j.argument=this.parseMaybeAssign(!1,S),this.type===ee.comma&&S&&S.trailingComma<0&&(S.trailingComma=this.start),this.finishNode(j,"SpreadElement"));this.options.ecmaVersion>=6&&(j.method=!1,j.shorthand=!1,(m||S)&&(Oe=this.start,st=this.startLoc),m||(O=this.eat(ee.star)));var Lt=this.containsEsc;return this.parsePropertyName(j),!m&&!Lt&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(j)?(ue=!0,O=this.options.ecmaVersion>=9&&this.eat(ee.star),this.parsePropertyName(j,S)):ue=!1,this.parsePropertyValue(j,m,O,ue,Oe,st,S,Lt),this.finishNode(j,"Property")},Ur.parsePropertyValue=function(m,S,j,O,ue,Oe,st,Lt){if((j||O)&&this.type===ee.colon&&this.unexpected(),this.eat(ee.colon))m.value=S?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,st),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===ee.parenL)S&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(j,O);else if(!S&&!Lt&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==ee.comma&&this.type!==ee.braceR&&this.type!==ee.eq){(j||O)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var Mt=m.kind==="get"?0:1;if(m.value.params.length!==Mt){var wr=m.value.start;m.kind==="get"?this.raiseRecoverable(wr,"getter should have no params"):this.raiseRecoverable(wr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((j||O)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=ue),m.kind="init",S?m.value=this.parseMaybeDefault(ue,Oe,m.key):this.type===ee.eq&&st?(st.shorthandAssign<0&&(st.shorthandAssign=this.start),m.value=this.parseMaybeDefault(ue,Oe,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Ur.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(ee.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(ee.bracketR),m.key;m.computed=!1}return m.key=this.type===ee.num||this.type===ee.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Ur.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Ur.parseMethod=function(m,S,j){var O=this.startNode(),ue=this.yieldPos,Oe=this.awaitPos,st=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=m),this.options.ecmaVersion>=8&&(O.async=!!S),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(er(S,O.generator)|Le|(j?Ft:0)),this.expect(ee.parenL),O.params=this.parseBindingList(ee.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=ue,this.awaitPos=Oe,this.awaitIdentPos=st,this.finishNode(O,"FunctionExpression")},Ur.parseArrowExpression=function(m,S,j){var O=this.yieldPos,ue=this.awaitPos,Oe=this.awaitIdentPos;return this.enterScope(er(j,!1)|Te),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!j),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(S,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=O,this.awaitPos=ue,this.awaitIdentPos=Oe,this.finishNode(m,"ArrowFunctionExpression")},Ur.parseFunctionBody=function(m,S,j){var O=S&&this.type!==ee.braceL,ue=this.strict,Oe=!1;if(O)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var st=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!ue||st)&&(Oe=this.strictDirective(this.end),Oe&&st&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Lt=this.labels;this.labels=[],Oe&&(this.strict=!0),this.checkParams(m,!ue&&!Oe&&!S&&!j&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,yt),m.body=this.parseBlock(!1,void 0,Oe&&!ue),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Lt}this.exitScope()},Ur.isSimpleParamList=function(m){for(var S=0,j=m;S<j.length;S+=1){var O=j[S];if(O.type!=="Identifier")return!1}return!0},Ur.checkParams=function(m,S){for(var j={},O=0,ue=m.params;O<ue.length;O+=1){var Oe=ue[O];this.checkLVal(Oe,Z,S?null:j)}},Ur.parseExprList=function(m,S,j,O){for(var ue=[],Oe=!0;!this.eat(m);){if(Oe)Oe=!1;else if(this.expect(ee.comma),S&&this.afterTrailingComma(m))break;var st=void 0;j&&this.type===ee.comma?st=null:this.type===ee.ellipsis?(st=this.parseSpread(O),O&&this.type===ee.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):st=this.parseMaybeAssign(!1,O),ue.push(st)}return ue},Ur.checkUnreserved=function(m){var S=m.start,j=m.end,O=m.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(S,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(S,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(S,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(S,j).indexOf("\\")!==-1)){var ue=this.strict?this.reservedWordsStrict:this.reservedWords;ue.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(S,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(S,"The keyword '"+O+"' is reserved"))}},Ur.parseIdent=function(m,S){var j=this.startNode();return this.type===ee.name?j.name=this.value:this.type.keyword?(j.name=this.type.keyword,(j.name==="class"||j.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(j,"Identifier"),m||(this.checkUnreserved(j),j.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=j.start)),j},Ur.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var S=this.startNode();return this.next(),this.type===ee.semi||this.canInsertSemicolon()||this.type!==ee.star&&!this.type.startsExpr?(S.delegate=!1,S.argument=null):(S.delegate=this.eat(ee.star),S.argument=this.parseMaybeAssign(m)),this.finishNode(S,"YieldExpression")},Ur.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var Jr=St.prototype;Jr.raise=function(m,S){var j=pt(this.input,m);S+=" ("+j.line+":"+j.column+")";var O=new SyntaxError(S);throw O.pos=m,O.loc=j,O.raisedAt=this.pos,O},Jr.raiseRecoverable=Jr.raise,Jr.curPosition=function(){if(this.options.locations)return new ge(this.curLine,this.pos-this.lineStart)};var Cr=St.prototype,Dn=function(S){this.flags=S,this.var=[],this.lexical=[],this.functions=[]};Cr.enterScope=function(m){this.scopeStack.push(new Dn(m))},Cr.exitScope=function(){this.scopeStack.pop()},Cr.treatFunctionsAsVarInScope=function(m){return m.flags&yn||!this.inModule&&m.flags&ln},Cr.declareName=function(m,S,j){var O=!1;if(S===Ee){var ue=this.currentScope();O=ue.lexical.indexOf(m)>-1||ue.functions.indexOf(m)>-1||ue.var.indexOf(m)>-1,ue.lexical.push(m),this.inModule&&ue.flags&ln&&delete this.undefinedExports[m]}else if(S===Qe){var Oe=this.currentScope();Oe.lexical.push(m)}else if(S===Ze){var st=this.currentScope();this.treatFunctionsAsVar?O=st.lexical.indexOf(m)>-1:O=st.lexical.indexOf(m)>-1||st.var.indexOf(m)>-1,st.functions.push(m)}else for(var Lt=this.scopeStack.length-1;Lt>=0;--Lt){var Mt=this.scopeStack[Lt];if(Mt.lexical.indexOf(m)>-1&&!(Mt.flags&Ue&&Mt.lexical[0]===m)||!this.treatFunctionsAsVarInScope(Mt)&&Mt.functions.indexOf(m)>-1){O=!0;break}if(Mt.var.push(m),this.inModule&&Mt.flags&ln&&delete this.undefinedExports[m],Mt.flags&Vi)break}O&&this.raiseRecoverable(j,"Identifier '"+m+"' has already been declared")},Cr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Cr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Cr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var S=this.scopeStack[m];if(S.flags&Vi)return S}},Cr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var S=this.scopeStack[m];if(S.flags&Vi&&!(S.flags&Te))return S}};var Hn=function(S,j,O){this.type="",this.start=j,this.end=0,S.options.locations&&(this.loc=new _t(S,O)),S.options.directSourceFile&&(this.sourceFile=S.options.directSourceFile),S.options.ranges&&(this.range=[j,0])},bi=St.prototype;bi.startNode=function(){return new Hn(this,this.start,this.startLoc)},bi.startNodeAt=function(m,S){return new Hn(this,m,S)};function Ui(m,S,j,O){return m.type=S,m.end=j,this.options.locations&&(m.loc.end=O),this.options.ranges&&(m.range[1]=j),m}bi.finishNode=function(m,S){return Ui.call(this,m,S,this.lastTokEnd,this.lastTokEndLoc)},bi.finishNodeAt=function(m,S,j,O){return Ui.call(this,m,S,j,O)};var Ji=function(S,j,O,ue,Oe){this.token=S,this.isExpr=!!j,this.preserveSpace=!!O,this.override=ue,this.generator=!!Oe},Ri={b_stat:new Ji("{",!1),b_expr:new Ji("{",!0),b_tmpl:new Ji("${",!1),p_stat:new Ji("(",!1),p_expr:new Ji("(",!0),q_tmpl:new Ji("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new Ji("function",!1),f_expr:new Ji("function",!0),f_expr_gen:new Ji("function",!0,!1,null,!0),f_gen:new Ji("function",!1,!1,null,!0)},Ii=St.prototype;Ii.initialContext=function(){return[Ri.b_stat]},Ii.braceIsBlock=function(m){var S=this.curContext();return S===Ri.f_expr||S===Ri.f_stat?!0:m===ee.colon&&(S===Ri.b_stat||S===Ri.b_expr)?!S.isExpr:m===ee._return||m===ee.name&&this.exprAllowed?dr.test(this.input.slice(this.lastTokEnd,this.start)):m===ee._else||m===ee.semi||m===ee.eof||m===ee.parenR||m===ee.arrow?!0:m===ee.braceL?S===Ri.b_stat:m===ee._var||m===ee._const||m===ee.name?!1:!this.exprAllowed},Ii.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var S=this.context[m];if(S.token==="function")return S.generator}return!1},Ii.updateContext=function(m){var S,j=this.type;j.keyword&&m===ee.dot?this.exprAllowed=!1:(S=j.updateContext)?S.call(this,m):this.exprAllowed=j.beforeExpr},ee.parenR.updateContext=ee.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Ri.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},ee.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Ri.b_stat:Ri.b_expr),this.exprAllowed=!0},ee.dollarBraceL.updateContext=function(){this.context.push(Ri.b_tmpl),this.exprAllowed=!0},ee.parenL.updateContext=function(m){var S=m===ee._if||m===ee._for||m===ee._with||m===ee._while;this.context.push(S?Ri.p_stat:Ri.p_expr),this.exprAllowed=!0},ee.incDec.updateContext=function(){},ee._function.updateContext=ee._class.updateContext=function(m){m.beforeExpr&&m!==ee.semi&&m!==ee._else&&!(m===ee._return&&dr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===ee.colon||m===ee.braceL)&&this.curContext()===Ri.b_stat)?this.context.push(Ri.f_expr):this.context.push(Ri.f_stat),this.exprAllowed=!1},ee.backQuote.updateContext=function(){this.curContext()===Ri.q_tmpl?this.context.pop():this.context.push(Ri.q_tmpl),this.exprAllowed=!1},ee.star.updateContext=function(m){if(m===ee._function){var S=this.context.length-1;this.context[S]===Ri.f_expr?this.context[S]=Ri.f_expr_gen:this.context[S]=Ri.f_gen}this.exprAllowed=!0},ee.name.updateContext=function(m){var S=!1;this.options.ecmaVersion>=6&&m!==ee.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(S=!0),this.exprAllowed=S};var Y="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ce=Y+" Extended_Pictographic",ye=ce,z={9:Y,10:ce,11:ye},oe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",me="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ae=me+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",se=Ae+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ce={9:me,10:Ae,11:se},ct={};function xr(m){var S=ct[m]={binary:Re(z[m]+" "+oe),nonBinary:{General_Category:Re(oe),Script:Re(Ce[m])}};S.nonBinary.Script_Extensions=S.nonBinary.Script,S.nonBinary.gc=S.nonBinary.General_Category,S.nonBinary.sc=S.nonBinary.Script,S.nonBinary.scx=S.nonBinary.Script_Extensions}xr(9),xr(10),xr(11);var Gt=St.prototype,Jt=function(S){this.parser=S,this.validFlags="gim"+(S.options.ecmaVersion>=6?"uy":"")+(S.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ct[S.options.ecmaVersion>=11?11:S.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Jt.prototype.reset=function(S,j,O){var ue=O.indexOf("u")!==-1;this.start=S|0,this.source=j+"",this.flags=O,this.switchU=ue&&this.parser.options.ecmaVersion>=6,this.switchN=ue&&this.parser.options.ecmaVersion>=9},Jt.prototype.raise=function(S){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+S)},Jt.prototype.at=function(S,j){j===void 0&&(j=!1);var O=this.source,ue=O.length;if(S>=ue)return-1;var Oe=O.charCodeAt(S);if(!(j||this.switchU)||Oe<=55295||Oe>=57344||S+1>=ue)return Oe;var st=O.charCodeAt(S+1);return st>=56320&&st<=57343?(Oe<<10)+st-56613888:Oe},Jt.prototype.nextIndex=function(S,j){j===void 0&&(j=!1);var O=this.source,ue=O.length;if(S>=ue)return ue;var Oe=O.charCodeAt(S),st;return!(j||this.switchU)||Oe<=55295||Oe>=57344||S+1>=ue||(st=O.charCodeAt(S+1))<56320||st>57343?S+1:S+2},Jt.prototype.current=function(S){return S===void 0&&(S=!1),this.at(this.pos,S)},Jt.prototype.lookahead=function(S){return S===void 0&&(S=!1),this.at(this.nextIndex(this.pos,S),S)},Jt.prototype.advance=function(S){S===void 0&&(S=!1),this.pos=this.nextIndex(this.pos,S)},Jt.prototype.eat=function(S,j){return j===void 0&&(j=!1),this.current(j)===S?(this.advance(j),!0):!1};function Rr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Gt.validateRegExpFlags=function(m){for(var S=m.validFlags,j=m.flags,O=0;O<j.length;O++){var ue=j.charAt(O);S.indexOf(ue)===-1&&this.raise(m.start,"Invalid regular expression flag"),j.indexOf(ue,O+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Gt.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Gt.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var S=0,j=m.backReferenceNames;S<j.length;S+=1){var O=j[S];m.groupNames.indexOf(O)===-1&&m.raise("Invalid named capture referenced")}},Gt.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Gt.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Gt.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Gt.regexp_eatAssertion=function(m){var S=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=S}if(m.eat(40)&&m.eat(63)){var j=!1;if(this.options.ecmaVersion>=9&&(j=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!j,!0}return m.pos=S,!1},Gt.regexp_eatQuantifier=function(m,S){return S===void 0&&(S=!1),this.regexp_eatQuantifierPrefix(m,S)?(m.eat(63),!0):!1},Gt.regexp_eatQuantifierPrefix=function(m,S){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,S)},Gt.regexp_eatBracedQuantifier=function(m,S){var j=m.pos;if(m.eat(123)){var O=0,ue=-1;if(this.regexp_eatDecimalDigits(m)&&(O=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(ue=m.lastIntValue),m.eat(125)))return ue!==-1&&ue<O&&!S&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!S&&m.raise("Incomplete quantifier"),m.pos=j}return!1},Gt.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Gt.regexp_eatReverseSolidusAtomEscape=function(m){var S=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=S}return!1},Gt.regexp_eatUncapturingGroup=function(m){var S=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=S}return!1},Gt.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Gt.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Gt.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Gt.regexp_eatSyntaxCharacter=function(m){var S=m.current();return Ln(S)?(m.lastIntValue=S,m.advance(),!0):!1};function Ln(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Gt.regexp_eatPatternCharacters=function(m){for(var S=m.pos,j=0;(j=m.current())!==-1&&!Ln(j);)m.advance();return m.pos!==S},Gt.regexp_eatExtendedPatternCharacter=function(m){var S=m.current();return S!==-1&&S!==36&&!(S>=40&&S<=43)&&S!==46&&S!==63&&S!==91&&S!==94&&S!==124?(m.advance(),!0):!1},Gt.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Gt.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Gt.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Rr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Rr(m.lastIntValue);return!0}return!1},Gt.regexp_eatRegExpIdentifierStart=function(m){var S=m.pos,j=this.options.ecmaVersion>=11,O=m.current(j);return m.advance(j),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(O=m.lastIntValue),Mn(O)?(m.lastIntValue=O,!0):(m.pos=S,!1)};function Mn(m){return rt(m,!0)||m===36||m===95}Gt.regexp_eatRegExpIdentifierPart=function(m){var S=m.pos,j=this.options.ecmaVersion>=11,O=m.current(j);return m.advance(j),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,j)&&(O=m.lastIntValue),$t(O)?(m.lastIntValue=O,!0):(m.pos=S,!1)};function $t(m){return Yt(m,!0)||m===36||m===95||m===8204||m===8205}Gt.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Gt.regexp_eatBackReference=function(m){var S=m.pos;if(this.regexp_eatDecimalEscape(m)){var j=m.lastIntValue;if(m.switchU)return j>m.maxBackReference&&(m.maxBackReference=j),!0;if(j<=m.numCapturingParens)return!0;m.pos=S}return!1},Gt.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Gt.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Gt.regexp_eatCControlLetter=function(m){var S=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=S}return!1},Gt.regexp_eatZero=function(m){return m.current()===48&&!Oi(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Gt.regexp_eatControlEscape=function(m){var S=m.current();return S===116?(m.lastIntValue=9,m.advance(),!0):S===110?(m.lastIntValue=10,m.advance(),!0):S===118?(m.lastIntValue=11,m.advance(),!0):S===102?(m.lastIntValue=12,m.advance(),!0):S===114?(m.lastIntValue=13,m.advance(),!0):!1},Gt.regexp_eatControlLetter=function(m){var S=m.current();return bn(S)?(m.lastIntValue=S%32,m.advance(),!0):!1};function bn(m){return m>=65&&m<=90||m>=97&&m<=122}Gt.regexp_eatRegExpUnicodeEscapeSequence=function(m,S){S===void 0&&(S=!1);var j=m.pos,O=S||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var ue=m.lastIntValue;if(O&&ue>=55296&&ue<=56319){var Oe=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var st=m.lastIntValue;if(st>=56320&&st<=57343)return m.lastIntValue=(ue-55296)*1024+(st-56320)+65536,!0}m.pos=Oe,m.lastIntValue=ue}return!0}if(O&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&on(m.lastIntValue))return!0;O&&m.raise("Invalid unicode escape"),m.pos=j}return!1};function on(m){return m>=0&&m<=1114111}Gt.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var S=m.current();return S!==99&&(!m.switchN||S!==107)?(m.lastIntValue=S,m.advance(),!0):!1},Gt.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var S=m.current();if(S>=49&&S<=57){do m.lastIntValue=10*m.lastIntValue+(S-48),m.advance();while((S=m.current())>=48&&S<=57);return!0}return!1},Gt.regexp_eatCharacterClassEscape=function(m){var S=m.current();if(un(S))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(S===80||S===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function un(m){return m===100||m===68||m===115||m===83||m===119||m===87}Gt.regexp_eatUnicodePropertyValueExpression=function(m){var S=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var j=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var O=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,j,O),!0}}if(m.pos=S,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var ue=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,ue),!0}return!1},Gt.regexp_validateUnicodePropertyNameAndValue=function(m,S,j){zr(m.unicodeProperties.nonBinary,S)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[S].test(j)||m.raise("Invalid property value")},Gt.regexp_validateUnicodePropertyNameOrValue=function(m,S){m.unicodeProperties.binary.test(S)||m.raise("Invalid property name")},Gt.regexp_eatUnicodePropertyName=function(m){var S=0;for(m.lastStringValue="";wi(S=m.current());)m.lastStringValue+=Rr(S),m.advance();return m.lastStringValue!==""};function wi(m){return bn(m)||m===95}Gt.regexp_eatUnicodePropertyValue=function(m){var S=0;for(m.lastStringValue="";xn(S=m.current());)m.lastStringValue+=Rr(S),m.advance();return m.lastStringValue!==""};function xn(m){return wi(m)||Oi(m)}Gt.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Gt.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Gt.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var S=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var j=m.lastIntValue;m.switchU&&(S===-1||j===-1)&&m.raise("Invalid character class"),S!==-1&&j!==-1&&S>j&&m.raise("Range out of order in character class")}}},Gt.regexp_eatClassAtom=function(m){var S=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var j=m.current();(j===99||Ki(j))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=S}var O=m.current();return O!==93?(m.lastIntValue=O,m.advance(),!0):!1},Gt.regexp_eatClassEscape=function(m){var S=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=S}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Gt.regexp_eatClassControlLetter=function(m){var S=m.current();return Oi(S)||S===95?(m.lastIntValue=S%32,m.advance(),!0):!1},Gt.regexp_eatHexEscapeSequence=function(m){var S=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=S}return!1},Gt.regexp_eatDecimalDigits=function(m){var S=m.pos,j=0;for(m.lastIntValue=0;Oi(j=m.current());)m.lastIntValue=10*m.lastIntValue+(j-48),m.advance();return m.pos!==S};function Oi(m){return m>=48&&m<=57}Gt.regexp_eatHexDigits=function(m){var S=m.pos,j=0;for(m.lastIntValue=0;Yi(j=m.current());)m.lastIntValue=16*m.lastIntValue+oi(j),m.advance();return m.pos!==S};function Yi(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function oi(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Gt.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var S=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var j=m.lastIntValue;S<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=S*64+j*8+m.lastIntValue:m.lastIntValue=S*8+j}else m.lastIntValue=S;return!0}return!1},Gt.regexp_eatOctalDigit=function(m){var S=m.current();return Ki(S)?(m.lastIntValue=S-48,m.advance(),!0):(m.lastIntValue=0,!1)};function Ki(m){return m>=48&&m<=55}Gt.regexp_eatFixedHexDigits=function(m,S){var j=m.pos;m.lastIntValue=0;for(var O=0;O<S;++O){var ue=m.current();if(!Yi(ue))return m.pos=j,!1;m.lastIntValue=16*m.lastIntValue+oi(ue),m.advance()}return!0};var zi=function(S){this.type=S.type,this.value=S.value,this.start=S.start,this.end=S.end,S.options.locations&&(this.loc=new _t(S,S.startLoc,S.endLoc)),S.options.ranges&&(this.range=[S.start,S.end])},Ai=St.prototype;Ai.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new zi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},Ai.getToken=function(){return this.next(),new zi(this)},typeof Symbol!="undefined"&&(Ai[Symbol.iterator]=function(){var m=this;return{next:function(){var S=m.getToken();return{done:S.type===ee.eof,value:S}}}}),Ai.curContext=function(){return this.context[this.context.length-1]},Ai.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(ee.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},Ai.readToken=function(m){return rt(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},Ai.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var S=this.input.charCodeAt(this.pos+1);return(m<<10)+S-56613888},Ai.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),S=this.pos,j=this.input.indexOf("*/",this.pos+=2);if(j===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=j+2,this.options.locations){Ct.lastIndex=S;for(var O;(O=Ct.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(S+2,j),S,this.pos,m,this.curPosition())},Ai.skipLineComment=function(m){for(var S=this.pos,j=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!Ke(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(S+m,this.pos),S,this.pos,j,this.curPosition())},Ai.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Dt.test(String.fromCharCode(m)))++this.pos;else break e}}},Ai.finishToken=function(m,S){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var j=this.type;this.type=m,this.value=S,this.updateContext(j)},Ai.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var S=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&S===46?(this.pos+=3,this.finishToken(ee.ellipsis)):(++this.pos,this.finishToken(ee.dot))},Ai.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(ee.assign,2):this.finishOp(ee.slash,1)},Ai.readToken_mult_modulo_exp=function(m){var S=this.input.charCodeAt(this.pos+1),j=1,O=m===42?ee.star:ee.modulo;return this.options.ecmaVersion>=7&&m===42&&S===42&&(++j,O=ee.starstar,S=this.input.charCodeAt(this.pos+2)),S===61?this.finishOp(ee.assign,j+1):this.finishOp(O,j)},Ai.readToken_pipe_amp=function(m){var S=this.input.charCodeAt(this.pos+1);if(S===m){if(this.options.ecmaVersion>=12){var j=this.input.charCodeAt(this.pos+2);if(j===61)return this.finishOp(ee.assign,3)}return this.finishOp(m===124?ee.logicalOR:ee.logicalAND,2)}return S===61?this.finishOp(ee.assign,2):this.finishOp(m===124?ee.bitwiseOR:ee.bitwiseAND,1)},Ai.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(ee.assign,2):this.finishOp(ee.bitwiseXOR,1)},Ai.readToken_plus_min=function(m){var S=this.input.charCodeAt(this.pos+1);return S===m?S===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||dr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(ee.incDec,2):S===61?this.finishOp(ee.assign,2):this.finishOp(ee.plusMin,1)},Ai.readToken_lt_gt=function(m){var S=this.input.charCodeAt(this.pos+1),j=1;return S===m?(j=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+j)===61?this.finishOp(ee.assign,j+1):this.finishOp(ee.bitShift,j)):S===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(S===61&&(j=2),this.finishOp(ee.relational,j))},Ai.readToken_eq_excl=function(m){var S=this.input.charCodeAt(this.pos+1);return S===61?this.finishOp(ee.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&S===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(ee.arrow)):this.finishOp(m===61?ee.eq:ee.prefix,1)},Ai.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var S=this.input.charCodeAt(this.pos+1);if(S===46){var j=this.input.charCodeAt(this.pos+2);if(j<48||j>57)return this.finishOp(ee.questionDot,2)}if(S===63){if(m>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(ee.assign,3)}return this.finishOp(ee.coalesce,2)}}return this.finishOp(ee.question,1)},Ai.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(ee.parenL);case 41:return++this.pos,this.finishToken(ee.parenR);case 59:return++this.pos,this.finishToken(ee.semi);case 44:return++this.pos,this.finishToken(ee.comma);case 91:return++this.pos,this.finishToken(ee.bracketL);case 93:return++this.pos,this.finishToken(ee.bracketR);case 123:return++this.pos,this.finishToken(ee.braceL);case 125:return++this.pos,this.finishToken(ee.braceR);case 58:return++this.pos,this.finishToken(ee.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(ee.backQuote);case 48:var S=this.input.charCodeAt(this.pos+1);if(S===120||S===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(S===111||S===79)return this.readRadixNumber(8);if(S===98||S===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(ee.prefix,1)}this.raise(this.pos,"Unexpected character '"+ai(m)+"'")},Ai.finishOp=function(m,S){var j=this.input.slice(this.pos,this.pos+S);return this.pos+=S,this.finishToken(m,j)},Ai.readRegexp=function(){for(var m,S,j=this.pos;;){this.pos>=this.input.length&&this.raise(j,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(dr.test(O)&&this.raise(j,"Unterminated regular expression"),m)m=!1;else{if(O==="[")S=!0;else if(O==="]"&&S)S=!1;else if(O==="/"&&!S)break;m=O==="\\"}++this.pos}var ue=this.input.slice(j,this.pos);++this.pos;var Oe=this.pos,st=this.readWord1();this.containsEsc&&this.unexpected(Oe);var Lt=this.regexpState||(this.regexpState=new Jt(this));Lt.reset(j,ue,st),this.validateRegExpFlags(Lt),this.validateRegExpPattern(Lt);var Mt=null;try{Mt=new RegExp(ue,st)}catch(wr){}return this.finishToken(ee.regexp,{pattern:ue,flags:st,value:Mt})},Ai.readInt=function(m,S,j){for(var O=this.options.ecmaVersion>=12&&S===void 0,ue=j&&this.input.charCodeAt(this.pos)===48,Oe=this.pos,st=0,Lt=0,Mt=0,wr=S==null?Infinity:S;Mt<wr;++Mt,++this.pos){var jr=this.input.charCodeAt(this.pos),qn=void 0;if(O&&jr===95){ue&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Lt===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Mt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Lt=jr;continue}if(jr>=97?qn=jr-97+10:jr>=65?qn=jr-65+10:jr>=48&&jr<=57?qn=jr-48:qn=Infinity,qn>=m)break;Lt=jr,st=st*m+qn}return O&&Lt===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Oe||S!=null&&this.pos-Oe!==S?null:st};function ca(m,S){return S?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function ba(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}Ai.readRadixNumber=function(m){var S=this.pos;this.pos+=2;var j=this.readInt(m);return j==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(j=ba(this.input.slice(S,this.pos)),++this.pos):rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,j)},Ai.readNumber=function(m){var S=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(S,"Invalid number");var j=this.pos-S>=2&&this.input.charCodeAt(S)===48;j&&this.strict&&this.raise(S,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!j&&!m&&this.options.ecmaVersion>=11&&O===110){var ue=ba(this.input.slice(S,this.pos));return++this.pos,rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(ee.num,ue)}j&&/[89]/.test(this.input.slice(S,this.pos))&&(j=!1),O===46&&!j&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!j&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(S,"Invalid number")),rt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Oe=ca(this.input.slice(S,this.pos),j);return this.finishToken(ee.num,Oe)},Ai.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),S;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var j=++this.pos;S=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,S>1114111&&this.invalidStringToken(j,"Code point out of bounds")}else S=this.readHexChar(4);return S};function ai(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Ai.readString=function(m){for(var S="",j=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===m)break;O===92?(S+=this.input.slice(j,this.pos),S+=this.readEscapedChar(!1),j=this.pos):(Ke(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return S+=this.input.slice(j,this.pos++),this.finishToken(ee.string,S)};var ti={};Ai.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===ti)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},Ai.invalidStringToken=function(m,S){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw ti;this.raise(m,S)},Ai.readTmplToken=function(){for(var m="",S=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var j=this.input.charCodeAt(this.pos);if(j===96||j===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===ee.template||this.type===ee.invalidTemplate)?j===36?(this.pos+=2,this.finishToken(ee.dollarBraceL)):(++this.pos,this.finishToken(ee.backQuote)):(m+=this.input.slice(S,this.pos),this.finishToken(ee.template,m));if(j===92)m+=this.input.slice(S,this.pos),m+=this.readEscapedChar(!0),S=this.pos;else if(Ke(j)){switch(m+=this.input.slice(S,this.pos),++this.pos,j){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(j);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),S=this.pos}else++this.pos}},Ai.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(ee.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},Ai.readEscapedChar=function(m){var S=this.input.charCodeAt(++this.pos);switch(++this.pos,S){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ai(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var j=this.pos-1;return this.invalidStringToken(j,"Invalid escape sequence in template string"),null}default:if(S>=48&&S<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],ue=parseInt(O,8);return ue>255&&(O=O.slice(0,-1),ue=parseInt(O,8)),this.pos+=O.length-1,S=this.input.charCodeAt(this.pos),(O!=="0"||S===56||S===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-O.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(ue)}return Ke(S)?"":String.fromCharCode(S)}},Ai.readHexChar=function(m){var S=this.pos,j=this.readInt(16,m);return j===null&&this.invalidStringToken(S,"Bad character escape sequence"),j},Ai.readWord1=function(){this.containsEsc=!1;for(var m="",S=!0,j=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var ue=this.fullCharCodeAtPos();if(Yt(ue,O))this.pos+=ue<=65535?1:2;else if(ue===92){this.containsEsc=!0,m+=this.input.slice(j,this.pos);var Oe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var st=this.readCodePoint();(S?rt:Yt)(st,O)||this.invalidStringToken(Oe,"Invalid Unicode escape"),m+=ai(st),j=this.pos}else break;S=!1}return m+this.input.slice(j,this.pos)},Ai.readWord=function(){var m=this.readWord1(),S=ee.name;return this.keywords.test(m)&&(S=xt[m]),this.finishToken(S,m)};var Gi="7.4.1";St.acorn={Parser:St,version:Gi,defaultOptions:Nt,Position:ge,SourceLocation:_t,getLineInfo:pt,Node:Hn,TokenType:Vt,tokTypes:ee,keywordTypes:xt,TokContext:Ji,tokContexts:Ri,isIdentifierChar:Yt,isIdentifierStart:rt,Token:zi,isNewLine:Ke,lineBreak:dr,lineBreakG:Ct,nonASCIIwhitespace:Dt};function da(m,S){return St.parse(m,S)}function Xo(m,S,j){return St.parseExpressionAt(m,S,j)}function ya(m,S){return St.tokenizer(m,S)}function mi(m,S){m.prototype=Object.create(S.prototype),m.prototype.constructor=m,m.__proto__=S}function ga(m){var S=typeof Map=="function"?new Map:void 0;return ga=function(O){if(O===null||!Co(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof S!="undefined"){if(S.has(O))return S.get(O);S.set(O,ue)}function ue(){return Sa(O,arguments,Xa(this).constructor)}return ue.prototype=Object.create(O.prototype,{constructor:{value:ue,enumerable:!1,writable:!0,configurable:!0}}),Wa(ue,O)},ga(m)}function Gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Sa(m,S,j){return Gs()?Sa=Reflect.construct:Sa=function(ue,Oe,st){var Lt=[null];Lt.push.apply(Lt,Oe);var Mt=Function.bind.apply(ue,Lt),wr=new Mt;return st&&Wa(wr,st.prototype),wr},Sa.apply(null,arguments)}function Co(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Wa(m,S){return Wa=Object.setPrototypeOf||function(O,ue){return O.__proto__=ue,O},Wa(m,S)}function Xa(m){return Xa=Object.setPrototypeOf?Object.getPrototypeOf:function(j){return j.__proto__||Object.getPrototypeOf(j)},Xa(m)}var Yo=function(m){mi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(Error)),Zi=function(m){mi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(SyntaxError)),Ao=function(m){mi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(ReferenceError)),Lo=function(m){mi(S,m);function S(){return m.apply(this,arguments)||this}return S}(ga(TypeError)),so=function(m){mi(S,m);function S(){return m.apply(this,arguments)||this}return S}(Yo),Ro=function(m){mi(S,m);function S(){return m.apply(this,arguments)||this}return S}(Zi),Hi=function(m){mi(S,m);function S(){return m.apply(this,arguments)||this}return S}(Ao),Da={UnknownError:[3001,"%0",so],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",so],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Hi],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Hi],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Hi],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Hi],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Hi],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Hi],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Hi],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Hi],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Hi],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Hi],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ao],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ao],IsNotConstructor:[2003,"%0 is not a constructor",Lo]};function Ba(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function _s(m,S,j){return Ba()?_s=Reflect.construct:_s=function(ue,Oe,st){var Lt=[null];Lt.push.apply(Lt,Oe);var Mt=Function.bind.apply(ue,Lt),wr=new Mt;return st&&_a(wr,st.prototype),wr},_s.apply(null,arguments)}function _a(m,S){return _a=Object.setPrototypeOf||function(O,ue){return O.__proto__=ue,O},_a(m,S)}var xe="0.0.2";function ke(m,S){Object.defineProperty(m,"name",{value:S,writable:!1,enumerable:!1,configurable:!0})}var lt=Object.prototype.hasOwnProperty,Xt=Symbol("Break"),Xr=Symbol("Continue"),$n=Symbol("DefaultCase"),yi=Symbol("EmptyStatementReturn"),no=Symbol("WithScopeName"),Ya=Symbol("SuperScopeName"),uo=Symbol("RootScopeName"),Ko=Symbol("GlobalScopeName");function Hs(m){return typeof m=="function"}var xs=function(){function m(j){this.interpreter=j}var S=m.prototype;return S.generator=function(){var O=this.interpreter;function ue(){return this.getCurrentScope()}function Oe(){return this.getGlobalScope()}function st(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:ue.bind(O),getGlobalScope:Oe.bind(O),getCurrentContext:st.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},m}();function po(m,S,j){if(j===void 0&&(j=!0),!(m instanceof xs))throw new Error("Illegal call");if(typeof S!="string")return S;if(!!S){var O=m.generator(),ue=O.getOptions(),Oe={timeout:ue.timeout,_initEnv:function(){j||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},st=j?O.getGlobalScope():O.getCurrentScope(),Lt=new To(st,Oe);return Lt.evaluate(S)}}Object.defineProperty(po,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function fs(m){if(!(m instanceof xs))throw new Error("Illegal call");for(var S=m.generator(),j=arguments.length,O=new Array(j>1?j-1:0),ue=1;ue<j;ue++)O[ue-1]=arguments[ue];var Oe=O.pop(),st=new To(S.getGlobalScope(),S.getOptions()),Lt=`
		    (function anonymous(`+O.join(",")+`){
		        `+Oe+`
		    });
		    `;return st.evaluate(Lt)}Object.defineProperty(fs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var zo=function(S){this.value=S},$o=function(S){this.value=S},yo=function(S){this.value=S},Si=function(S,j,O){j===void 0&&(j=null),this.name=O,this.parent=j,this.data=S,this.labelStack=[]};function Ts(){}function Ps(m,S){return m===void 0&&(m=null),new Si(Object.create(null),m,S)}function bs(m){return Object.create(m)}var Ca={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:po,Function:fs};typeof JSON!="undefined"&&(Ca.JSON=JSON),typeof Promise!="undefined"&&(Ca.Promise=Promise),typeof Set!="undefined"&&(Ca.Set=Set),typeof Map!="undefined"&&(Ca.Map=Map),typeof Symbol!="undefined"&&(Ca.Symbol=Symbol),typeof Proxy!="undefined"&&(Ca.Proxy=Proxy),typeof WeakMap!="undefined"&&(Ca.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Ca.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Ca.Reflect=Reflect);var To=function(){function m(j,O){j===void 0&&(j=m.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||m.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?m.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=j||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var S=m.prototype;return S.initEnvironment=function(O){var ue;if(O instanceof Si)ue=O;else{var Oe=null,st=this.createSuperScope(O);this.options.rootContext&&(Oe=new Si(bs(this.options.rootContext),st,uo)),ue=new Si(O,Oe||st,Ko)}this.globalScope=ue,this.currentScope=this.globalScope,this.globalContext=ue.data,this.currentContext=ue.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Lt=this.options._initEnv;Lt&&Lt.call(this)},S.getExecStartTime=function(){return this.execStartTime},S.getExecutionTime=function(){return this.execEndTime-this.execStartTime},S.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},S.getOptions=function(){return this.options},S.getGlobalScope=function(){return this.globalScope},S.getCurrentScope=function(){return this.currentScope},S.getCurrentContext=function(){return this.currentContext},S.isInterruptThrow=function(O){return O instanceof so||O instanceof Hi||O instanceof Ro},S.createSuperScope=function(O){var ue=Object.assign({},Ca),Oe=Object.keys(ue);return Oe.forEach(function(st){st in O&&delete ue[st]}),new Si(ue,null,Ya)},S.setCurrentContext=function(O){this.currentContext=O},S.setCurrentScope=function(O){this.currentScope=O},S.evaluate=function(O){O===void 0&&(O="");var ue;if(!!O)return ue=da(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(ue,O)},S.appendCode=function(O){return this.evaluate(O)},S.evaluateNode=function(O,ue){var Oe=this;ue===void 0&&(ue=""),this.value=void 0,this.source=ue,this.sourceList.push(ue),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var st=this.getCurrentScope(),Lt=this.getCurrentContext(),Mt=st.labelStack.concat([]),wr=this.callStack.concat([]),jr=function(){Oe.setCurrentScope(st),Oe.setCurrentContext(Lt),st.labelStack=Mt,Oe.callStack=wr};try{var qn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),qn()}catch(Pi){throw Pi}finally{jr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},S.createErrorMessage=function(O,ue,Oe){var st=O[1].replace("%0",String(ue));return Oe!==null&&(st+=this.getNodePosition(Oe||this.lastExecNode)),st},S.createError=function(O,ue){return new ue(O)},S.createThrowError=function(O,ue){return this.createError(O,ue)},S.createInternalThrowError=function(O,ue,Oe){return this.createError(this.createErrorMessage(O,ue,Oe),O[2])},S.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,ue=Date.now();return ue-this.execStartTime>O},S.getNodePosition=function(O){if(O){var ue="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+ue:""}return""},S.createClosure=function(O){var ue=this,Oe;switch(O.type){case"BinaryExpression":Oe=this.binaryExpressionHandler(O);break;case"LogicalExpression":Oe=this.logicalExpressionHandler(O);break;case"UnaryExpression":Oe=this.unaryExpressionHandler(O);break;case"UpdateExpression":Oe=this.updateExpressionHandler(O);break;case"ObjectExpression":Oe=this.objectExpressionHandler(O);break;case"ArrayExpression":Oe=this.arrayExpressionHandler(O);break;case"CallExpression":Oe=this.callExpressionHandler(O);break;case"NewExpression":Oe=this.newExpressionHandler(O);break;case"MemberExpression":Oe=this.memberExpressionHandler(O);break;case"ThisExpression":Oe=this.thisExpressionHandler(O);break;case"SequenceExpression":Oe=this.sequenceExpressionHandler(O);break;case"Literal":Oe=this.literalHandler(O);break;case"Identifier":Oe=this.identifierHandler(O);break;case"AssignmentExpression":Oe=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":Oe=this.functionDeclarationHandler(O);break;case"VariableDeclaration":Oe=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":Oe=this.programHandler(O);break;case"ExpressionStatement":Oe=this.expressionStatementHandler(O);break;case"EmptyStatement":Oe=this.emptyStatementHandler(O);break;case"ReturnStatement":Oe=this.returnStatementHandler(O);break;case"FunctionExpression":Oe=this.functionExpressionHandler(O);break;case"IfStatement":Oe=this.ifStatementHandler(O);break;case"ConditionalExpression":Oe=this.conditionalExpressionHandler(O);break;case"ForStatement":Oe=this.forStatementHandler(O);break;case"WhileStatement":Oe=this.whileStatementHandler(O);break;case"DoWhileStatement":Oe=this.doWhileStatementHandler(O);break;case"ForInStatement":Oe=this.forInStatementHandler(O);break;case"WithStatement":Oe=this.withStatementHandler(O);break;case"ThrowStatement":Oe=this.throwStatementHandler(O);break;case"TryStatement":Oe=this.tryStatementHandler(O);break;case"ContinueStatement":Oe=this.continueStatementHandler(O);break;case"BreakStatement":Oe=this.breakStatementHandler(O);break;case"SwitchStatement":Oe=this.switchStatementHandler(O);break;case"LabeledStatement":Oe=this.labeledStatementHandler(O);break;case"DebuggerStatement":Oe=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(Da.NodeTypeSyntaxError,O.type,O)}return function(){var st=ue.options.timeout;if(st&&st>0&&ue.checkTimeout())throw ue.createInternalThrowError(Da.ExecutionTimeOutError,st,null);return ue.lastExecNode=O,Oe.apply(void 0,arguments)}},S.binaryExpressionHandler=function(O){var ue=this,Oe=this.createClosure(O.left),st=this.createClosure(O.right);return function(){var Lt=Oe(),Mt=st();switch(O.operator){case"==":return Lt==Mt;case"!=":return Lt!=Mt;case"===":return Lt===Mt;case"!==":return Lt!==Mt;case"<":return Lt<Mt;case"<=":return Lt<=Mt;case">":return Lt>Mt;case">=":return Lt>=Mt;case"<<":return Lt<<Mt;case">>":return Lt>>Mt;case">>>":return Lt>>>Mt;case"+":return Lt+Mt;case"-":return Lt-Mt;case"*":return Lt*Mt;case"**":return Math.pow(Lt,Mt);case"/":return Lt/Mt;case"%":return Lt%Mt;case"|":return Lt|Mt;case"^":return Lt^Mt;case"&":return Lt&Mt;case"in":return Lt in Mt;case"instanceof":return Lt instanceof Mt;default:throw ue.createInternalThrowError(Da.BinaryOperatorSyntaxError,O.operator,O)}}},S.logicalExpressionHandler=function(O){var ue=this,Oe=this.createClosure(O.left),st=this.createClosure(O.right);return function(){switch(O.operator){case"||":return Oe()||st();case"&&":return Oe()&&st();default:throw ue.createInternalThrowError(Da.LogicalOperatorSyntaxError,O.operator,O)}}},S.unaryExpressionHandler=function(O){var ue=this;switch(O.operator){case"delete":var Oe=this.createObjectGetter(O.argument),st=this.createNameGetter(O.argument);return function(){var jr=Oe(),qn=st();return delete jr[qn]};default:var Lt;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var Mt=this.createObjectGetter(O.argument),wr=this.createNameGetter(O.argument);Lt=function(){return Mt()[wr()]}}else Lt=this.createClosure(O.argument);return function(){var jr=Lt();switch(O.operator){case"-":return-jr;case"+":return+jr;case"!":return!jr;case"~":return~jr;case"void":return;case"typeof":return typeof jr;default:throw ue.createInternalThrowError(Da.UnaryOperatorSyntaxError,O.operator,O)}}}},S.updateExpressionHandler=function(O){var ue=this,Oe=this.createObjectGetter(O.argument),st=this.createNameGetter(O.argument);return function(){var Lt=Oe(),Mt=st();switch(ue.assertVariable(Lt,Mt,O),O.operator){case"++":return O.prefix?++Lt[Mt]:Lt[Mt]++;case"--":return O.prefix?--Lt[Mt]:Lt[Mt]--;default:throw ue.createInternalThrowError(Da.UpdateOperatorSyntaxError,O.operator,O)}}},S.objectExpressionHandler=function(O){var ue=this,Oe=[];function st(Mt){return Mt.type==="Identifier"?Mt.name:Mt.type==="Literal"?Mt.value:this.throwError(Da.ObjectStructureSyntaxError,Mt.type,Mt)}var Lt=Object.create(null);return O.properties.forEach(function(Mt){var wr=Mt.kind,jr=st(Mt.key);(!Lt[jr]||wr==="init")&&(Lt[jr]={}),Lt[jr][wr]=ue.createClosure(Mt.value),Oe.push({key:jr,property:Mt})}),function(){for(var Mt={},wr=Oe.length,jr=0;jr<wr;jr++){var qn=Oe[jr],Pi=qn.key,ci=Lt[Pi],ei=ci.init?ci.init():void 0,Ea=ci.get?ci.get():function(){},Fa=ci.set?ci.set():function(Ms){};if("set"in ci||"get"in ci){var Qi={configurable:!0,enumerable:!0,get:Ea,set:Fa};Object.defineProperty(Mt,Pi,Qi)}else{var hs=qn.property,go=hs.kind;hs.key.type==="Identifier"&&hs.value.type==="FunctionExpression"&&go==="init"&&!hs.value.id&&ke(ei,hs.key.name),Mt[Pi]=ei}}return Mt}},S.arrayExpressionHandler=function(O){var ue=this,Oe=O.elements.map(function(st){return st&&ue.createClosure(st)});return function(){for(var st=Oe.length,Lt=Array(st),Mt=0;Mt<st;Mt++){var wr=Oe[Mt];wr&&(Lt[Mt]=wr())}return Lt}},S.safeObjectGet=function(O,ue,Oe){return O[ue]},S.createCallFunctionGetter=function(O){var ue=this;switch(O.type){case"MemberExpression":var Oe=this.createClosure(O.object),st=this.createMemberKeyGetter(O),Lt=this.source;return function(){var wr=Oe(),jr=st(),qn=ue.safeObjectGet(wr,jr,O);if(!qn||!Hs(qn)){var Pi=Lt.slice(O.start,O.end);throw ue.createInternalThrowError(Da.FunctionUndefinedReferenceError,Pi,O)}return qn.__IS_EVAL_FUNC?function(ci){return qn(new xs(ue),ci,!0)}:qn.__IS_FUNCTION_FUNC?function(){for(var ci=arguments.length,ei=new Array(ci),Ea=0;Ea<ci;Ea++)ei[Ea]=arguments[Ea];return qn.apply(void 0,[new xs(ue)].concat(ei))}:qn.bind(wr)};default:var Mt=this.createClosure(O);return function(){var wr="";O.type==="Identifier"&&(wr=O.name);var jr=Mt();if(!jr||!Hs(jr))throw ue.createInternalThrowError(Da.FunctionUndefinedReferenceError,wr,O);if(O.type==="Identifier"&&jr.__IS_EVAL_FUNC&&wr==="eval")return function(ci){var ei=ue.getScopeFromName(wr,ue.getCurrentScope()),Ea=ei.name===Ya||ei.name===Ko||ei.name===uo;return jr(new xs(ue),ci,!Ea)};if(jr.__IS_EVAL_FUNC)return function(ci){return jr(new xs(ue),ci,!0)};if(jr.__IS_FUNCTION_FUNC)return function(){for(var ci=arguments.length,ei=new Array(ci),Ea=0;Ea<ci;Ea++)ei[Ea]=arguments[Ea];return jr.apply(void 0,[new xs(ue)].concat(ei))};var qn=ue.options.globalContextInFunction;if(O.type==="Identifier"){var Pi=ue.getIdentifierScope(O);Pi.name===no&&(qn=Pi.data)}return jr.bind(qn)}}},S.callExpressionHandler=function(O){var ue=this,Oe=this.createCallFunctionGetter(O.callee),st=O.arguments.map(function(Lt){return ue.createClosure(Lt)});return function(){return Oe().apply(void 0,st.map(function(Lt){return Lt()}))}},S.functionExpressionHandler=function(O){var ue=this,Oe=this,st=this.source,Lt=this.collectDeclVars,Mt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var wr=O.id?O.id.name:"",jr=O.params.length,qn=O.params.map(function(Ea){return ue.createParamNameGetter(Ea)}),Pi=this.createClosure(O.body),ci=this.collectDeclVars,ei=this.collectDeclFuncs;return this.collectDeclVars=Lt,this.collectDeclFuncs=Mt,function(){var Ea=Oe.getCurrentScope(),Fa=function Qi(){for(var hs=arguments.length,go=new Array(hs),Ms=0;Ms<hs;Ms++)go[Ms]=arguments[Ms];Oe.callStack.push(""+wr);var iu=Oe.getCurrentScope(),Ds=Ps(Ea,"FunctionScope("+wr+")");Oe.setCurrentScope(Ds),Oe.addDeclarationsToScope(ci,ei,Ds),wr&&(Ds.data[wr]=Qi),Ds.data.arguments=arguments,qn.forEach(function(Xs,Ys){Ds.data[Xs()]=go[Ys]});var nl=Oe.getCurrentContext();Oe.setCurrentContext(this);var Ws=Pi();if(Oe.setCurrentContext(nl),Oe.setCurrentScope(iu),Oe.callStack.pop(),Ws instanceof zo)return Ws.value};return ke(Fa,wr),Object.defineProperty(Fa,"length",{value:jr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Fa,"toString",{value:function(){return st.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Fa,"valueOf",{value:function(){return st.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Fa}},S.newExpressionHandler=function(O){var ue=this,Oe=this.source,st=this.createClosure(O.callee),Lt=O.arguments.map(function(Mt){return ue.createClosure(Mt)});return function(){var Mt=st();if(!Hs(Mt)||Mt.__IS_EVAL_FUNC){var wr=O.callee,jr=Oe.slice(wr.start,wr.end);throw ue.createInternalThrowError(Da.IsNotConstructor,jr,O)}return Mt.__IS_FUNCTION_FUNC?Mt.apply(void 0,[new xs(ue)].concat(Lt.map(function(qn){return qn()}))):_s(Mt,Lt.map(function(qn){return qn()}))}},S.memberExpressionHandler=function(O){var ue=this.createClosure(O.object),Oe=this.createMemberKeyGetter(O);return function(){var st=ue(),Lt=Oe();return st[Lt]}},S.thisExpressionHandler=function(O){var ue=this;return function(){return ue.getCurrentContext()}},S.sequenceExpressionHandler=function(O){var ue=this,Oe=O.expressions.map(function(st){return ue.createClosure(st)});return function(){for(var st,Lt=Oe.length,Mt=0;Mt<Lt;Mt++){var wr=Oe[Mt];st=wr()}return st}},S.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},S.identifierHandler=function(O){var ue=this;return function(){var Oe=ue.getCurrentScope(),st=ue.getScopeDataFromName(O.name,Oe);return ue.assertVariable(st,O.name,O),st[O.name]}},S.getIdentifierScope=function(O){var ue=this.getCurrentScope(),Oe=this.getScopeFromName(O.name,ue);return Oe},S.assignmentExpressionHandler=function(O){var ue=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var Oe=this.createObjectGetter(O.left),st=this.createNameGetter(O.left),Lt=this.createClosure(O.right);return function(){var Mt=Oe(),wr=st(),jr=Lt();switch(O.operator!=="="&&ue.assertVariable(Mt,wr,O),O.operator){case"=":return Mt[wr]=jr;case"+=":return Mt[wr]+=jr;case"-=":return Mt[wr]-=jr;case"*=":return Mt[wr]*=jr;case"**=":return Mt[wr]=Math.pow(Mt[wr],jr);case"/=":return Mt[wr]/=jr;case"%=":return Mt[wr]%=jr;case"<<=":return Mt[wr]<<=jr;case">>=":return Mt[wr]>>=jr;case">>>=":return Mt[wr]>>>=jr;case"&=":return Mt[wr]&=jr;case"^=":return Mt[wr]^=jr;case"|=":return Mt[wr]|=jr;default:throw ue.createInternalThrowError(Da.AssignmentExpressionSyntaxError,O.type,O)}}},S.functionDeclarationHandler=function(O){if(O.id){var ue=this.functionExpressionHandler(O);Object.defineProperty(ue,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,ue)}return function(){return yi}},S.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(Da.VariableTypeSyntaxError,O.type,O)},S.variableDeclarationHandler=function(O){for(var ue=this,Oe,st=[],Lt=0;Lt<O.declarations.length;Lt++){var Mt=O.declarations[Lt];this.varDeclaration(this.getVariableName(Mt.id)),Mt.init&&st.push({type:"AssignmentExpression",operator:"=",left:Mt.id,right:Mt.init})}return st.length&&(Oe=this.createClosure({type:"BlockStatement",body:st})),function(){if(Oe){var wr=ue.isVarDeclMode;ue.isVarDeclMode=!0,Oe(),ue.isVarDeclMode=wr}return yi}},S.assertVariable=function(O,ue,Oe){if(O===this.globalScope.data&&!(ue in O))throw this.createInternalThrowError(Da.VariableUndefinedReferenceError,ue,Oe)},S.programHandler=function(O){var ue=this,Oe=O.body.map(function(st){return ue.createClosure(st)});return function(){for(var st=yi,Lt=0;Lt<Oe.length;Lt++){var Mt=Oe[Lt],wr=ue.setValue(Mt());if(wr!==yi&&(st=wr,st instanceof zo||st instanceof $o||st instanceof yo||st===Xt||st===Xr))break}return st}},S.expressionStatementHandler=function(O){return this.createClosure(O.expression)},S.emptyStatementHandler=function(O){return function(){return yi}},S.returnStatementHandler=function(O){var ue=O.argument?this.createClosure(O.argument):Ts;return function(){return new zo(ue())}},S.ifStatementHandler=function(O){var ue=this.createClosure(O.test),Oe=this.createClosure(O.consequent),st=O.alternate?this.createClosure(O.alternate):function(){return yi};return function(){return ue()?Oe():st()}},S.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},S.forStatementHandler=function(O){var ue=this,Oe=Ts,st=O.test?this.createClosure(O.test):function(){return!0},Lt=Ts,Mt=this.createClosure(O.body);return O.type==="ForStatement"&&(Oe=O.init?this.createClosure(O.init):Oe,Lt=O.update?this.createClosure(O.update):Ts),function(wr){var jr,qn=yi,Pi=O.type==="DoWhileStatement";for(wr&&wr.type==="LabeledStatement"&&(jr=wr.label.name),Oe();Pi||st();Lt()){Pi=!1;var ci=ue.setValue(Mt());if(!(ci===yi||ci===Xr)){if(ci===Xt)break;if(qn=ci,qn instanceof yo&&qn.value===jr){qn=yi;continue}if(qn instanceof zo||qn instanceof $o||qn instanceof yo)break}}return qn}},S.whileStatementHandler=function(O){return this.forStatementHandler(O)},S.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},S.forInStatementHandler=function(O){var ue=this,Oe=O.left,st=this.createClosure(O.right),Lt=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),Oe=O.left.declarations[0].id),function(Mt){var wr,jr=yi,qn;Mt&&Mt.type==="LabeledStatement"&&(wr=Mt.label.name);var Pi=st();for(qn in Pi){ue.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Oe,right:{type:"Literal",value:qn}})();var ci=ue.setValue(Lt());if(!(ci===yi||ci===Xr)){if(ci===Xt)break;if(jr=ci,jr instanceof yo&&jr.value===wr){jr=yi;continue}if(jr instanceof zo||jr instanceof $o||jr instanceof yo)break}}return jr}},S.withStatementHandler=function(O){var ue=this,Oe=this.createClosure(O.object),st=this.createClosure(O.body);return function(){var Lt=Oe(),Mt=ue.getCurrentScope(),wr=new Si(Lt,Mt,no);ue.setCurrentScope(wr);var jr=ue.setValue(st());return ue.setCurrentScope(Mt),jr}},S.throwStatementHandler=function(O){var ue=this,Oe=this.createClosure(O.argument);return function(){throw ue.setValue(void 0),Oe()}},S.tryStatementHandler=function(O){var ue=this,Oe=this.createClosure(O.block),st=O.handler?this.catchClauseHandler(O.handler):null,Lt=O.finalizer?this.createClosure(O.finalizer):null;return function(){var Mt=ue.getCurrentScope(),wr=ue.getCurrentContext(),jr=Mt.labelStack.concat([]),qn=ue.callStack.concat([]),Pi=yi,ci,ei,Ea=function(){ue.setCurrentScope(Mt),ue.setCurrentContext(wr),Mt.labelStack=jr,ue.callStack=qn};try{Pi=ue.setValue(Oe()),Pi instanceof zo&&(ci=Pi)}catch(Fa){if(Ea(),ue.isInterruptThrow(Fa))throw Fa;if(st)try{Pi=ue.setValue(st(Fa)),Pi instanceof zo&&(ci=Pi)}catch(Qi){if(Ea(),ue.isInterruptThrow(Qi))throw Qi;ei=Qi}}if(Lt)try{Pi=Lt(),Pi instanceof zo&&(ci=Pi)}catch(Fa){if(Ea(),ue.isInterruptThrow(Fa))throw Fa;ei=Fa}if(ei)throw ei;return ci||Pi}},S.catchClauseHandler=function(O){var ue=this,Oe=this.createParamNameGetter(O.param),st=this.createClosure(O.body);return function(Lt){var Mt,wr=ue.getCurrentScope(),jr=wr.data,qn=Oe(),Pi=lt.call(jr,qn),ci=jr[qn];return jr[qn]=Lt,Mt=st(),Pi?jr[qn]=ci:delete jr[qn],Mt}},S.continueStatementHandler=function(O){return function(){return O.label?new yo(O.label.name):Xr}},S.breakStatementHandler=function(O){return function(){return O.label?new $o(O.label.name):Xt}},S.switchStatementHandler=function(O){var ue=this,Oe=this.createClosure(O.discriminant),st=O.cases.map(function(Lt){return ue.switchCaseHandler(Lt)});return function(){for(var Lt=Oe(),Mt=!1,wr,jr,qn,Pi=0;Pi<st.length;Pi++){var ci=st[Pi](),ei=ci.testClosure();if(ei===$n){qn=ci;continue}if(Mt||ei===Lt){if(Mt=!0,jr=ue.setValue(ci.bodyClosure()),jr===yi)continue;if(jr===Xt||(wr=jr,wr instanceof zo||wr instanceof $o||wr instanceof yo||wr===Xr))break}}if(!Mt&&qn){jr=ue.setValue(qn.bodyClosure());var Ea=jr===yi||jr===Xt||jr===Xr;Ea||(wr=jr)}return wr}},S.switchCaseHandler=function(O){var ue=O.test?this.createClosure(O.test):function(){return $n},Oe=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:ue,bodyClosure:Oe}}},S.labeledStatementHandler=function(O){var ue=this,Oe=O.label.name,st=this.createClosure(O.body);return function(){var Lt,Mt=ue.getCurrentScope();return Mt.labelStack.push(Oe),Lt=st(O),Lt instanceof $o&&Lt.value===Oe&&(Lt=yi),Mt.labelStack.pop(),Lt}},S.debuggerStatementHandler=function(O){return function(){debugger;return yi}},S.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(Da.ParamTypeSyntaxError,O.type,O)},S.createObjectKeyGetter=function(O){var ue;return O.type==="Identifier"?ue=function(){return O.name}:ue=this.createClosure(O),function(){return ue()}},S.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},S.createObjectGetter=function(O){var ue=this;switch(O.type){case"Identifier":return function(){return ue.getScopeDataFromName(O.name,ue.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,O.type,O)}},S.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(Da.AssignmentTypeSyntaxError,O.type,O)}},S.varDeclaration=function(O){var ue=this.collectDeclVars;ue[O]=void 0},S.funcDeclaration=function(O,ue){var Oe=this.collectDeclFuncs;Oe[O]=ue},S.addDeclarationsToScope=function(O,ue,Oe){var st=Oe.data;for(var Lt in ue){var Mt=ue[Lt];st[Lt]=Mt&&Mt()}for(var wr in O)wr in st||(st[wr]=void 0)},S.getScopeValue=function(O,ue){var Oe=this.getScopeFromName(O,ue);return Oe.data[O]},S.getScopeDataFromName=function(O,ue){return this.getScopeFromName(O,ue).data},S.getScopeFromName=function(O,ue){var Oe=ue;do if(O in Oe.data)return Oe;while(Oe=Oe.parent);return this.globalScope},S.setValue=function(O){var ue=this.callStack.length;return this.isVarDeclMode||ue||O===yi||O===Xt||O===Xr||O instanceof $o||O instanceof yo||(this.value=O instanceof zo?O.value:O),O},S.getValue=function(){return this.value},m}();To.version=xe,To.eval=po,To.Function=fs,To.ecmaVersion=5,To.globalContextInFunction=void 0,To.global=Object.create(null);function mu(m){return m===void 0&&(m=Object.create(null)),m}function wl(m,S,j){S===void 0&&(S=[]),j===void 0&&(j={});var O=j.parsingContext,ue=j.timeout===void 0?0:j.timeout,Oe=`
    (function anonymous(`+S.join(",")+`){
         `+m+`
    });
    `,st=new To(O,{ecmaVersion:j.ecmaVersion,timeout:ue,rootContext:j.rootContext,globalContextInFunction:j.globalContextInFunction});return st.evaluate(Oe)}function Vu(m,S,j){var O=new To(S,j);return O.evaluate(m)}var Wl=Vu,rl=function(){function m(j){this._code=j}var S=m.prototype;return S.runInContext=function(O){return Vu(this._code,O)},S.runInNewContext=function(O){return Vu(this._code,O)},m}(),yu=function(m,S,j){return Vu(m,S,j)};function Na(){for(var m=arguments.length,S=new Array(m),j=0;j<m;j++)S[j]=arguments[j];var O=S.pop();return wl(O||"",S)}var Gu=yu},88307:function(Or,U,E){(function(le,C){Or.exports=C(E(18857))})(this,function(le){"use strict";var C=function(V){return V instanceof Uint8Array||V instanceof Uint16Array||V instanceof Uint32Array||V instanceof Int8Array||V instanceof Int16Array||V instanceof Int32Array||V instanceof Float32Array||V instanceof Float64Array||V instanceof Uint8ClampedArray},d=function(V,Me){for(var $e=Object.keys(Me),ir=0;ir<$e.length;++ir)V[$e[ir]]=Me[$e[ir]];return V},A=`
`;function Q(V){return typeof atob!="undefined"?atob(V):"base64:"+V}function K(V){var Me=new Error("(regl) "+V);throw console.error(Me),Me}function W(V,Me){V||K(Me)}function L(V){return V?": "+V:""}function N(V,Me,$e){V in Me||K("unknown parameter ("+V+")"+L($e)+". possible values: "+Object.keys(Me).join())}function Ne(V,Me){C(V)||K("invalid parameter type"+L(Me)+". must be a typed array")}function Ye(V,Me){switch(Me){case"number":return typeof V=="number";case"object":return typeof V=="object";case"string":return typeof V=="string";case"boolean":return typeof V=="boolean";case"function":return typeof V=="function";case"undefined":return typeof V=="undefined";case"symbol":return typeof V=="symbol"}}function Je(V,Me,$e){Ye(V,Me)||K("invalid parameter type"+L($e)+". expected "+Me+", got "+typeof V)}function rt(V,Me){V>=0&&(V|0)===V||K("invalid parameter type, ("+V+")"+L(Me)+". must be a nonnegative integer")}function Yt(V,Me,$e){Me.indexOf(V)<0&&K("invalid value"+L($e)+". must be one of: "+Me)}var Vt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function tr(V){Object.keys(V).forEach(function(Me){Vt.indexOf(Me)<0&&K('invalid regl constructor argument "'+Me+'". must be one of '+Vt)})}function zt(V,Me){for(V=V+"";V.length<Me;)V=" "+V;return V}function Tt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function xt(V,Me){this.number=V,this.line=Me,this.errors=[]}function yr(V,Me,$e){this.file=V,this.line=Me,this.message=$e}function ee(){var V=new Error,Me=(V.stack||V).toString(),$e=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Me);if($e)return $e[1];var ir=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Me);return ir?ir[1]:"unknown"}function dr(){var V=new Error,Me=(V.stack||V).toString(),$e=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Me);if($e)return $e[1];var ir=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Me);return ir?ir[1]:"unknown"}function Ct(V,Me){var $e=V.split(`
`),ir=1,Mr=0,rr={unknown:new Tt,0:new Tt};rr.unknown.name=rr[0].name=Me||ee(),rr.unknown.lines.push(new xt(0,""));for(var Er=0;Er<$e.length;++Er){var Fr=$e[Er],Gr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Fr);if(Gr)switch(Gr[1]){case"line":var Kr=/(\d+)(\s+\d+)?/.exec(Gr[2]);Kr&&(ir=Kr[1]|0,Kr[2]&&(Mr=Kr[2]|0,Mr in rr||(rr[Mr]=new Tt)));break;case"define":var Qr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Gr[2]);Qr&&(rr[Mr].name=Qr[1]?Q(Qr[2]):Qr[2]);break}rr[Mr].lines.push(new xt(ir++,Fr))}return Object.keys(rr).forEach(function(en){var pn=rr[en];pn.lines.forEach(function(Wr){pn.index[Wr.number]=Wr})}),rr}function Ke(V){var Me=[];return V.split(`
`).forEach(function($e){if(!($e.length<5)){var ir=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec($e);ir?Me.push(new yr(ir[1]|0,ir[2]|0,ir[3].trim())):$e.length>0&&Me.push(new yr("unknown",0,$e))}}),Me}function Dt(V,Me){Me.forEach(function($e){var ir=V[$e.file];if(ir){var Mr=ir.index[$e.line];if(Mr){Mr.errors.push($e),ir.hasErrors=!0;return}}V.unknown.hasErrors=!0,V.unknown.lines[0].errors.push($e)})}function Xe(V,Me,$e,ir,Mr){if(!V.getShaderParameter(Me,V.COMPILE_STATUS)){var rr=V.getShaderInfoLog(Me),Er=ir===V.FRAGMENT_SHADER?"fragment":"vertex";ge($e,"string",Er+" shader source must be a string",Mr);var Fr=Ct($e,Mr),Gr=Ke(rr);Dt(Fr,Gr),Object.keys(Fr).forEach(function(Kr){var Qr=Fr[Kr];if(!Qr.hasErrors)return;var en=[""],pn=[""];function Wr(qr,Rt){en.push(qr),pn.push(Rt||"")}Wr("file number "+Kr+": "+Qr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Qr.lines.forEach(function(qr){if(qr.errors.length>0){Wr(zt(qr.number,4)+"|  ","background-color:yellow; font-weight:bold"),Wr(qr.line+A,"color:red; background-color:yellow; font-weight:bold");var Rt=0;qr.errors.forEach(function(pr){var Yr=pr.message,wn=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Yr);if(wn){var Tr=wn[1];switch(Yr=wn[2],Tr){case"assign":Tr="=";break}Rt=Math.max(qr.line.indexOf(Tr,Rt),0)}else Rt=0;Wr(zt("| ",6)),Wr(zt("^^^",Rt+3)+A,"font-weight:bold"),Wr(zt("| ",6)),Wr(Yr+A,"font-weight:bold")}),Wr(zt("| ",6)+A)}else Wr(zt(qr.number,4)+"|  "),Wr(qr.line+A,"color:red")}),typeof document!="undefined"&&!window.chrome?(pn[0]=en.join("%c"),console.log.apply(console,pn)):console.log(en.join(""))}),W.raise("Error compiling "+Er+" shader, "+Fr[0].name)}}function Ut(V,Me,$e,ir,Mr){if(!V.getProgramParameter(Me,V.LINK_STATUS)){var rr=V.getProgramInfoLog(Me),Er=Ct($e,Mr),Fr=Ct(ir,Mr),Gr='Error linking program with vertex shader, "'+Fr[0].name+'", and fragment shader "'+Er[0].name+'"';typeof document!="undefined"?console.log("%c"+Gr+A+"%c"+rr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Gr+A+rr),W.raise(Gr)}}function _r(V){V._commandRef=ee()}function ar(V,Me,$e,ir){_r(V);function Mr(Gr){return Gr?ir.id(Gr):0}V._fragId=Mr(V.static.frag),V._vertId=Mr(V.static.vert);function rr(Gr,Kr){Object.keys(Kr).forEach(function(Qr){Gr[ir.id(Qr)]=!0})}var Er=V._uniformSet={};rr(Er,Me.static),rr(Er,Me.dynamic);var Fr=V._attributeSet={};rr(Fr,$e.static),rr(Fr,$e.dynamic),V._hasCount="count"in V.static||"count"in V.dynamic||"elements"in V.static||"elements"in V.dynamic}function zr(V,Me){var $e=dr();K(V+" in command "+(Me||ee())+($e==="unknown"?"":" called from "+$e))}function fe(V,Me,$e){V||zr(Me,$e||ee())}function Re(V,Me,$e,ir){V in Me||zr("unknown parameter ("+V+")"+L($e)+". possible values: "+Object.keys(Me).join(),ir||ee())}function ge(V,Me,$e,ir){Ye(V,Me)||zr("invalid parameter type"+L($e)+". expected "+Me+", got "+typeof V,ir||ee())}function _t(V){V()}function pt(V,Me,$e){V.texture?Yt(V.texture._texture.internalformat,Me,"unsupported texture format for attachment"):Yt(V.renderbuffer._renderbuffer.format,$e,"unsupported renderbuffer format for attachment")}var Nt=33071,Bt=9728,kr=9984,ln=9985,yn=9986,Vi=9987,nr=5120,de=5121,Te=5122,Ue=5123,Le=5124,Ft=5125,er=5126,w=32819,Z=32820,Ee=33635,Ze=34042,Qe=36193,yt={};yt[nr]=yt[de]=1,yt[Te]=yt[Ue]=yt[Qe]=yt[Ee]=yt[w]=yt[Z]=2,yt[Le]=yt[Ft]=yt[er]=yt[Ze]=4;function St(V,Me){return V===Z||V===w||V===Ee?2:V===Ze?4:yt[V]*Me}function jt(V){return!(V&V-1)&&!!V}function Et(V,Me,$e){var ir,Mr=Me.width,rr=Me.height,Er=Me.channels;W(Mr>0&&Mr<=$e.maxTextureSize&&rr>0&&rr<=$e.maxTextureSize,"invalid texture shape"),(V.wrapS!==Nt||V.wrapT!==Nt)&&W(jt(Mr)&&jt(rr),"incompatible wrap mode for texture, both width and height must be power of 2"),Me.mipmask===1?Mr!==1&&rr!==1&&W(V.minFilter!==kr&&V.minFilter!==yn&&V.minFilter!==ln&&V.minFilter!==Vi,"min filter requires mipmap"):(W(jt(Mr)&&jt(rr),"texture must be a square power of 2 to support mipmapping"),W(Me.mipmask===(Mr<<1)-1,"missing or incomplete mipmap data")),Me.type===er&&($e.extensions.indexOf("oes_texture_float_linear")<0&&W(V.minFilter===Bt&&V.magFilter===Bt,"filter not supported, must enable oes_texture_float_linear"),W(!V.genMipmaps,"mipmap generation not supported with float textures"));var Fr=Me.images;for(ir=0;ir<16;++ir)if(Fr[ir]){var Gr=Mr>>ir,Kr=rr>>ir;W(Me.mipmask&1<<ir,"missing mipmap data");var Qr=Fr[ir];if(W(Qr.width===Gr&&Qr.height===Kr,"invalid shape for mip images"),W(Qr.format===Me.format&&Qr.internalformat===Me.internalformat&&Qr.type===Me.type,"incompatible type for mip image"),!Qr.compressed)if(Qr.data){var en=Math.ceil(St(Qr.type,Er)*Gr/Qr.unpackAlignment)*Qr.unpackAlignment;W(Qr.data.byteLength===en*Kr,"invalid data for image, buffer size is inconsistent with image format")}else Qr.element||Qr.copy}else V.genMipmaps||W((Me.mipmask&1<<ir)==0,"extra mipmap data");Me.compressed&&W(!V.genMipmaps,"mipmap generation for compressed images not supported")}function Qt(V,Me,$e,ir){var Mr=V.width,rr=V.height,Er=V.channels;W(Mr>0&&Mr<=ir.maxTextureSize&&rr>0&&rr<=ir.maxTextureSize,"invalid texture shape"),W(Mr===rr,"cube map must be square"),W(Me.wrapS===Nt&&Me.wrapT===Nt,"wrap mode not supported by cube map");for(var Fr=0;Fr<$e.length;++Fr){var Gr=$e[Fr];W(Gr.width===Mr&&Gr.height===rr,"inconsistent cube map face shape"),Me.genMipmaps&&(W(!Gr.compressed,"can not generate mipmap for compressed textures"),W(Gr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Kr=Gr.images,Qr=0;Qr<16;++Qr){var en=Kr[Qr];if(en){var pn=Mr>>Qr,Wr=rr>>Qr;W(Gr.mipmask&1<<Qr,"missing mipmap data"),W(en.width===pn&&en.height===Wr,"invalid shape for mip images"),W(en.format===V.format&&en.internalformat===V.internalformat&&en.type===V.type,"incompatible type for mip image"),en.compressed||(en.data?W(en.data.byteLength===pn*Wr*Math.max(St(en.type,Er),en.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):en.element||en.copy)}}}}var ie=d(W,{optional:_t,raise:K,commandRaise:zr,command:fe,parameter:N,commandParameter:Re,constructor:tr,type:Je,commandType:ge,isTypedArray:Ne,nni:rt,oneOf:Yt,shaderError:Xe,linkError:Ut,callSite:dr,saveCommandRef:_r,saveDrawInfo:ar,framebufferFormat:pt,guessCommand:ee,texture2D:Et,textureCube:Qt}),sr=0,Br=0,Lr=5,nt=6;function gt(V,Me){this.id=sr++,this.type=V,this.data=Me}function vt(V){return V.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function hr(V){if(V.length===0)return[];var Me=V.charAt(0),$e=V.charAt(V.length-1);if(V.length>1&&Me===$e&&(Me==='"'||Me==="'"))return['"'+vt(V.substr(1,V.length-2))+'"'];var ir=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(V);if(ir)return hr(V.substr(0,ir.index)).concat(hr(ir[1])).concat(hr(V.substr(ir.index+ir[0].length)));var Mr=V.split(".");if(Mr.length===1)return['"'+vt(V)+'"'];for(var rr=[],Er=0;Er<Mr.length;++Er)rr=rr.concat(hr(Mr[Er]));return rr}function Vr(V){return"["+hr(V).join("][")+"]"}function Ur(V,Me){return new gt(V,Vr(Me+""))}function nn(V){return typeof V=="function"&&!V._reglType||V instanceof gt}function Jr(V,Me){if(typeof V=="function")return new gt(Br,V);if(typeof V=="number"||typeof V=="boolean")return new gt(Lr,V);if(Array.isArray(V))return new gt(nt,V.map(function($e,ir){return Jr($e,Me+"["+ir+"]")}));if(V instanceof gt)return V;ie(!1,"invalid option type in uniform "+Me)}var Cr={DynamicVariable:gt,define:Ur,isDynamic:nn,unbox:Jr,accessor:Vr},Dn={next:typeof requestAnimationFrame=="function"?function(V){return requestAnimationFrame(V)}:function(V){return setTimeout(V,16)},cancel:typeof cancelAnimationFrame=="function"?function(V){return cancelAnimationFrame(V)}:clearTimeout},Hn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",bi=Hn?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Ui(){var V={"":0},Me=[""];return{id:function($e){var ir=V[$e];return ir||(ir=V[$e]=Me.length,Me.push($e),ir)},str:function($e){return Me[$e]}}}function Ji(V,Me,$e){var ir=document.createElement("canvas");d(ir.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),V.appendChild(ir),V===document.body&&(ir.style.position="absolute",d(V.style,{margin:0,padding:0}));function Mr(){var Fr=window.innerWidth,Gr=window.innerHeight;if(V!==document.body){var Kr=ir.getBoundingClientRect();Fr=Kr.right-Kr.left,Gr=Kr.bottom-Kr.top}ir.width=$e*Fr,ir.height=$e*Gr}var rr;V!==document.body&&typeof ResizeObserver=="function"?(rr=new ResizeObserver(function(){setTimeout(Mr)}),rr.observe(V)):window.addEventListener("resize",Mr,!1);function Er(){rr?rr.disconnect():window.removeEventListener("resize",Mr),V.removeChild(ir)}return Mr(),{canvas:ir,onDestroy:Er}}function Ri(V,Me){function $e(ir){try{return V.getContext(ir,Me)}catch(Mr){return null}}return $e("webgl")||$e("experimental-webgl")||$e("webgl-experimental")}function Ii(V){return typeof V.nodeName=="string"&&typeof V.appendChild=="function"&&typeof V.getBoundingClientRect=="function"}function Y(V){return typeof V.drawArrays=="function"||typeof V.drawElements=="function"}function ce(V){return typeof V=="string"?V.split():(ie(Array.isArray(V),"invalid extension array"),V)}function ye(V){return typeof V=="string"?(ie(typeof document!="undefined","not supported outside of DOM"),document.querySelector(V)):V}function z(V){var Me=V||{},$e,ir,Mr,rr,Er={},Fr=[],Gr=[],Kr=typeof window=="undefined"?1:window.devicePixelRatio,Qr=!1,en=function(qr){qr&&ie.raise(qr)},pn=function(){};if(typeof Me=="string"?(ie(typeof document!="undefined","selector queries only supported in DOM environments"),$e=document.querySelector(Me),ie($e,"invalid query string for element")):typeof Me=="object"?Ii(Me)?$e=Me:Y(Me)?(rr=Me,Mr=rr.canvas):(ie.constructor(Me),"gl"in Me?rr=Me.gl:"canvas"in Me?Mr=ye(Me.canvas):"container"in Me&&(ir=ye(Me.container)),"attributes"in Me&&(Er=Me.attributes,ie.type(Er,"object","invalid context attributes")),"extensions"in Me&&(Fr=ce(Me.extensions)),"optionalExtensions"in Me&&(Gr=ce(Me.optionalExtensions)),"onDone"in Me&&(ie.type(Me.onDone,"function","invalid or missing onDone callback"),en=Me.onDone),"profile"in Me&&(Qr=!!Me.profile),"pixelRatio"in Me&&(Kr=+Me.pixelRatio,ie(Kr>0,"invalid pixel ratio"))):ie.raise("invalid arguments to regl"),$e&&($e.nodeName.toLowerCase()==="canvas"?Mr=$e:ir=$e),!rr){if(!Mr){ie(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Wr=Ji(ir||document.body,en,Kr);if(!Wr)return null;Mr=Wr.canvas,pn=Wr.onDestroy}Er.premultipliedAlpha===void 0&&(Er.premultipliedAlpha=!0),rr=Ri(Mr,Er)}return rr?{gl:rr,canvas:Mr,container:ir,extensions:Fr,optionalExtensions:Gr,pixelRatio:Kr,profile:Qr,onDone:en,onDestroy:pn}:(pn(),en("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function oe(V,Me){var $e={};function ir(Fr){ie.type(Fr,"string","extension name must be string");var Gr=Fr.toLowerCase(),Kr;try{Kr=$e[Gr]=Mr(Fr)}catch(Qr){}return!!Kr}function Mr(Fr){return V.getExtension(Fr)?V.getExtension(Fr):V.getExtension(Fr.toLowerCase())?V.getExtension(Fr.toLowerCase()):null}for(var rr=0;rr<Me.extensions.length;++rr){var Er=Me.extensions[rr];if(!ir(Er))return Me.onDestroy(),Me.onDone('"'+Er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Me.optionalExtensions.forEach(ir),{extensions:$e,restore:function(){Object.keys($e).forEach(function(Fr){if($e[Fr]&&!ir(Fr))throw new Error("(regl): error restoring extension "+Fr)})}}}function me(V,Me){for(var $e=Array(V),ir=0;ir<V;++ir)$e[ir]=Me(ir);return $e}var Ae=5120,se=5121,Ce=5122,ct=5123,xr=5124,Gt=5125,Jt=5126;function Rr(V){for(var Me=16;Me<=1<<28;Me*=16)if(V<=Me)return Me;return 0}function Ln(V){var Me,$e;return Me=(V>65535)<<4,V>>>=Me,$e=(V>255)<<3,V>>>=$e,Me|=$e,$e=(V>15)<<2,V>>>=$e,Me|=$e,$e=(V>3)<<1,V>>>=$e,Me|=$e,Me|V>>1}function Mn(){var V=me(8,function(){return[]});function Me(rr){var Er=Rr(rr),Fr=V[Ln(Er)>>2];return Fr.length>0?Fr.pop():new ArrayBuffer(Er)}function $e(rr){V[Ln(rr.byteLength)>>2].push(rr)}function ir(rr,Er){var Fr=null;switch(rr){case Ae:Fr=new Int8Array(Me(Er),0,Er);break;case se:Fr=new Uint8Array(Me(Er),0,Er);break;case Ce:Fr=new Int16Array(Me(2*Er),0,Er);break;case ct:Fr=new Uint16Array(Me(2*Er),0,Er);break;case xr:Fr=new Int32Array(Me(4*Er),0,Er);break;case Gt:Fr=new Uint32Array(Me(4*Er),0,Er);break;case Jt:Fr=new Float32Array(Me(4*Er),0,Er);break;default:return null}return Fr.length!==Er?Fr.subarray(0,Er):Fr}function Mr(rr){$e(rr.buffer)}return{alloc:Me,free:$e,allocType:ir,freeType:Mr}}var $t=Mn();$t.zero=Mn();var bn=3408,on=3410,un=3411,wi=3412,xn=3413,Oi=3414,Yi=3415,oi=33901,Ki=33902,zi=3379,Ai=3386,ca=34921,ba=36347,ai=36348,ti=35661,Gi=35660,da=34930,Xo=36349,ya=34076,mi=34024,ga=7936,Gs=7937,Sa=7938,Co=35724,Wa=34047,Xa=36063,Yo=34852,Zi=3553,Ao=34067,Lo=34069,so=33984,Ro=6408,Hi=5126,Da=5121,Ba=36160,_s=36053,_a=36064,xe=16384,ke=function(V,Me){var $e=1;Me.ext_texture_filter_anisotropic&&($e=V.getParameter(Wa));var ir=1,Mr=1;Me.webgl_draw_buffers&&(ir=V.getParameter(Yo),Mr=V.getParameter(Xa));var rr=!!Me.oes_texture_float;if(rr){var Er=V.createTexture();V.bindTexture(Zi,Er),V.texImage2D(Zi,0,Ro,1,1,0,Ro,Hi,null);var Fr=V.createFramebuffer();if(V.bindFramebuffer(Ba,Fr),V.framebufferTexture2D(Ba,_a,Zi,Er,0),V.bindTexture(Zi,null),V.checkFramebufferStatus(Ba)!==_s)rr=!1;else{V.viewport(0,0,1,1),V.clearColor(1,0,0,1),V.clear(xe);var Gr=$t.allocType(Hi,4);V.readPixels(0,0,1,1,Ro,Hi,Gr),V.getError()?rr=!1:(V.deleteFramebuffer(Fr),V.deleteTexture(Er),rr=Gr[0]===1),$t.freeType(Gr)}}var Kr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Qr=!0;if(!Kr){var en=V.createTexture(),pn=$t.allocType(Da,36);V.activeTexture(so),V.bindTexture(Ao,en),V.texImage2D(Lo,0,Ro,3,3,0,Ro,Da,pn),$t.freeType(pn),V.bindTexture(Ao,null),V.deleteTexture(en),Qr=!V.getError()}return{colorBits:[V.getParameter(on),V.getParameter(un),V.getParameter(wi),V.getParameter(xn)],depthBits:V.getParameter(Oi),stencilBits:V.getParameter(Yi),subpixelBits:V.getParameter(bn),extensions:Object.keys(Me).filter(function(Wr){return!!Me[Wr]}),maxAnisotropic:$e,maxDrawbuffers:ir,maxColorAttachments:Mr,pointSizeDims:V.getParameter(oi),lineWidthDims:V.getParameter(Ki),maxViewportDims:V.getParameter(Ai),maxCombinedTextureUnits:V.getParameter(ti),maxCubeMapSize:V.getParameter(ya),maxRenderbufferSize:V.getParameter(mi),maxTextureUnits:V.getParameter(da),maxTextureSize:V.getParameter(zi),maxAttributes:V.getParameter(ca),maxVertexUniforms:V.getParameter(ba),maxVertexTextureUnits:V.getParameter(Gi),maxVaryingVectors:V.getParameter(ai),maxFragmentUniforms:V.getParameter(Xo),glsl:V.getParameter(Co),renderer:V.getParameter(Gs),vendor:V.getParameter(ga),version:V.getParameter(Sa),readFloat:rr,npotTextureCube:Qr}};function lt(V){return!!V&&typeof V=="object"&&Array.isArray(V.shape)&&Array.isArray(V.stride)&&typeof V.offset=="number"&&V.shape.length===V.stride.length&&(Array.isArray(V.data)||C(V.data))}var Xt=function(V){return Object.keys(V).map(function(Me){return V[Me]})},Xr={shape:Ko,flatten:uo};function $n(V,Me,$e){for(var ir=0;ir<Me;++ir)$e[ir]=V[ir]}function yi(V,Me,$e,ir){for(var Mr=0,rr=0;rr<Me;++rr)for(var Er=V[rr],Fr=0;Fr<$e;++Fr)ir[Mr++]=Er[Fr]}function no(V,Me,$e,ir,Mr,rr){for(var Er=rr,Fr=0;Fr<Me;++Fr)for(var Gr=V[Fr],Kr=0;Kr<$e;++Kr)for(var Qr=Gr[Kr],en=0;en<ir;++en)Mr[Er++]=Qr[en]}function Ya(V,Me,$e,ir,Mr){for(var rr=1,Er=$e+1;Er<Me.length;++Er)rr*=Me[Er];var Fr=Me[$e];if(Me.length-$e==4){var Gr=Me[$e+1],Kr=Me[$e+2],Qr=Me[$e+3];for(Er=0;Er<Fr;++Er)no(V[Er],Gr,Kr,Qr,ir,Mr),Mr+=rr}else for(Er=0;Er<Fr;++Er)Ya(V[Er],Me,$e+1,ir,Mr),Mr+=rr}function uo(V,Me,$e,ir){var Mr=1;if(Me.length)for(var rr=0;rr<Me.length;++rr)Mr*=Me[rr];else Mr=0;var Er=ir||$t.allocType($e,Mr);switch(Me.length){case 0:break;case 1:$n(V,Me[0],Er);break;case 2:yi(V,Me[0],Me[1],Er);break;case 3:no(V,Me[0],Me[1],Me[2],Er,0);break;default:Ya(V,Me,0,Er,0)}return Er}function Ko(V){for(var Me=[],$e=V;$e.length;$e=$e[0])Me.push($e.length);return Me}var Hs={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},xs=5120,po=5122,fs=5124,zo=5121,$o=5123,yo=5125,Si=5126,Ts=5126,Ps={int8:xs,int16:po,int32:fs,uint8:zo,uint16:$o,uint32:yo,float:Si,float32:Ts},bs=35048,Ca=35040,To={dynamic:bs,stream:Ca,static:35044},mu=Xr.flatten,wl=Xr.shape,Vu=35044,Wl=35040,rl=5121,yu=5126,Na=[];Na[5120]=1,Na[5122]=2,Na[5124]=4,Na[5121]=1,Na[5123]=2,Na[5125]=4,Na[5126]=4;function Gu(V){return Hs[Object.prototype.toString.call(V)]|0}function m(V,Me){for(var $e=0;$e<Me.length;++$e)V[$e]=Me[$e]}function S(V,Me,$e,ir,Mr,rr,Er){for(var Fr=0,Gr=0;Gr<$e;++Gr)for(var Kr=0;Kr<ir;++Kr)V[Fr++]=Me[Mr*Gr+rr*Kr+Er]}function j(V,Me,$e,ir){var Mr=0,rr={};function Er(Rt){this.id=Mr++,this.buffer=V.createBuffer(),this.type=Rt,this.usage=Vu,this.byteLength=0,this.dimension=1,this.dtype=rl,this.persistentData=null,$e.profile&&(this.stats={size:0})}Er.prototype.bind=function(){V.bindBuffer(this.type,this.buffer)},Er.prototype.destroy=function(){pn(this)};var Fr=[];function Gr(Rt,pr){var Yr=Fr.pop();return Yr||(Yr=new Er(Rt)),Yr.bind(),en(Yr,pr,Wl,0,1,!1),Yr}function Kr(Rt){Fr.push(Rt)}function Qr(Rt,pr,Yr){Rt.byteLength=pr.byteLength,V.bufferData(Rt.type,pr,Yr)}function en(Rt,pr,Yr,wn,Tr,Sn){var rn;if(Rt.usage=Yr,Array.isArray(pr)){if(Rt.dtype=wn||yu,pr.length>0){var ui;if(Array.isArray(pr[0])){rn=wl(pr);for(var Ar=1,br=1;br<rn.length;++br)Ar*=rn[br];Rt.dimension=Ar,ui=mu(pr,rn,Rt.dtype),Qr(Rt,ui,Yr),Sn?Rt.persistentData=ui:$t.freeType(ui)}else if(typeof pr[0]=="number"){Rt.dimension=Tr;var Xn=$t.allocType(Rt.dtype,pr.length);m(Xn,pr),Qr(Rt,Xn,Yr),Sn?Rt.persistentData=Xn:$t.freeType(Xn)}else C(pr[0])?(Rt.dimension=pr[0].length,Rt.dtype=wn||Gu(pr[0])||yu,ui=mu(pr,[pr.length,pr[0].length],Rt.dtype),Qr(Rt,ui,Yr),Sn?Rt.persistentData=ui:$t.freeType(ui)):ie.raise("invalid buffer data")}}else if(C(pr))Rt.dtype=wn||Gu(pr),Rt.dimension=Tr,Qr(Rt,pr,Yr),Sn&&(Rt.persistentData=new Uint8Array(new Uint8Array(pr.buffer)));else if(lt(pr)){rn=pr.shape;var fn=pr.stride,$r=pr.offset,gn=0,En=0,Ni=0,ki=0;rn.length===1?(gn=rn[0],En=1,Ni=fn[0],ki=0):rn.length===2?(gn=rn[0],En=rn[1],Ni=fn[0],ki=fn[1]):ie.raise("invalid shape"),Rt.dtype=wn||Gu(pr.data)||yu,Rt.dimension=En;var Tn=$t.allocType(Rt.dtype,gn*En);S(Tn,pr.data,gn,En,Ni,ki,$r),Qr(Rt,Tn,Yr),Sn?Rt.persistentData=Tn:$t.freeType(Tn)}else pr instanceof ArrayBuffer?(Rt.dtype=rl,Rt.dimension=Tr,Qr(Rt,pr,Yr),Sn&&(Rt.persistentData=new Uint8Array(new Uint8Array(pr)))):ie.raise("invalid buffer data")}function pn(Rt){Me.bufferCount--,ir(Rt);var pr=Rt.buffer;ie(pr,"buffer must not be deleted already"),V.deleteBuffer(pr),Rt.buffer=null,delete rr[Rt.id]}function Wr(Rt,pr,Yr,wn){Me.bufferCount++;var Tr=new Er(pr);rr[Tr.id]=Tr;function Sn(Ar){var br=Vu,Xn=null,fn=0,$r=0,gn=1;return Array.isArray(Ar)||C(Ar)||lt(Ar)||Ar instanceof ArrayBuffer?Xn=Ar:typeof Ar=="number"?fn=Ar|0:Ar&&(ie.type(Ar,"object","buffer arguments must be an object, a number or an array"),"data"in Ar&&(ie(Xn===null||Array.isArray(Xn)||C(Xn)||lt(Xn),"invalid data for buffer"),Xn=Ar.data),"usage"in Ar&&(ie.parameter(Ar.usage,To,"invalid buffer usage"),br=To[Ar.usage]),"type"in Ar&&(ie.parameter(Ar.type,Ps,"invalid buffer type"),$r=Ps[Ar.type]),"dimension"in Ar&&(ie.type(Ar.dimension,"number","invalid dimension"),gn=Ar.dimension|0),"length"in Ar&&(ie.nni(fn,"buffer length must be a nonnegative integer"),fn=Ar.length|0)),Tr.bind(),Xn?en(Tr,Xn,br,$r,gn,wn):(fn&&V.bufferData(Tr.type,fn,br),Tr.dtype=$r||rl,Tr.usage=br,Tr.dimension=gn,Tr.byteLength=fn),$e.profile&&(Tr.stats.size=Tr.byteLength*Na[Tr.dtype]),Sn}function rn(Ar,br){ie(br+Ar.byteLength<=Tr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Ar.byteLength+" starting from offset "+br+" to a buffer of size "+Tr.byteLength),V.bufferSubData(Tr.type,br,Ar)}function ui(Ar,br){var Xn=(br||0)|0,fn;if(Tr.bind(),C(Ar)||Ar instanceof ArrayBuffer)rn(Ar,Xn);else if(Array.isArray(Ar)){if(Ar.length>0)if(typeof Ar[0]=="number"){var $r=$t.allocType(Tr.dtype,Ar.length);m($r,Ar),rn($r,Xn),$t.freeType($r)}else if(Array.isArray(Ar[0])||C(Ar[0])){fn=wl(Ar);var gn=mu(Ar,fn,Tr.dtype);rn(gn,Xn),$t.freeType(gn)}else ie.raise("invalid buffer data")}else if(lt(Ar)){fn=Ar.shape;var En=Ar.stride,Ni=0,ki=0,Tn=0,Cn=0;fn.length===1?(Ni=fn[0],ki=1,Tn=En[0],Cn=0):fn.length===2?(Ni=fn[0],ki=fn[1],Tn=En[0],Cn=En[1]):ie.raise("invalid shape");var xi=Array.isArray(Ar.data)?Tr.dtype:Gu(Ar.data),Di=$t.allocType(xi,Ni*ki);S(Di,Ar.data,Ni,ki,Tn,Cn,Ar.offset),rn(Di,Xn),$t.freeType(Di)}else ie.raise("invalid data for buffer subdata");return Sn}return Yr||Sn(Rt),Sn._reglType="buffer",Sn._buffer=Tr,Sn.subdata=ui,$e.profile&&(Sn.stats=Tr.stats),Sn.destroy=function(){pn(Tr)},Sn}function qr(){Xt(rr).forEach(function(Rt){Rt.buffer=V.createBuffer(),V.bindBuffer(Rt.type,Rt.buffer),V.bufferData(Rt.type,Rt.persistentData||Rt.byteLength,Rt.usage)})}return $e.profile&&(Me.getTotalBufferSize=function(){var Rt=0;return Object.keys(rr).forEach(function(pr){Rt+=rr[pr].stats.size}),Rt}),{create:Wr,createStream:Gr,destroyStream:Kr,clear:function(){Xt(rr).forEach(pn),Fr.forEach(pn)},getBuffer:function(Rt){return Rt&&Rt._buffer instanceof Er?Rt._buffer:null},restore:qr,_initBuffer:en}}var O=0,ue=0,Oe=1,st=1,Lt=4,Mt=4,wr={points:O,point:ue,lines:Oe,line:st,triangles:Lt,triangle:Mt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},jr=0,qn=1,Pi=4,ci=5120,ei=5121,Ea=5122,Fa=5123,Qi=5124,hs=5125,go=34963,Ms=35040,iu=35044;function Ds(V,Me,$e,ir){var Mr={},rr=0,Er={uint8:ei,uint16:Fa};Me.oes_element_index_uint&&(Er.uint32=hs);function Fr(qr){this.id=rr++,Mr[this.id]=this,this.buffer=qr,this.primType=Pi,this.vertCount=0,this.type=0}Fr.prototype.bind=function(){this.buffer.bind()};var Gr=[];function Kr(qr){var Rt=Gr.pop();return Rt||(Rt=new Fr($e.create(null,go,!0,!1)._buffer)),en(Rt,qr,Ms,-1,-1,0,0),Rt}function Qr(qr){Gr.push(qr)}function en(qr,Rt,pr,Yr,wn,Tr,Sn){qr.buffer.bind();var rn;if(Rt){var ui=Sn;!Sn&&(!C(Rt)||lt(Rt)&&!C(Rt.data))&&(ui=Me.oes_element_index_uint?hs:Fa),$e._initBuffer(qr.buffer,Rt,pr,ui,3)}else V.bufferData(go,Tr,pr),qr.buffer.dtype=rn||ei,qr.buffer.usage=pr,qr.buffer.dimension=3,qr.buffer.byteLength=Tr;if(rn=Sn,!Sn){switch(qr.buffer.dtype){case ei:case ci:rn=ei;break;case Fa:case Ea:rn=Fa;break;case hs:case Qi:rn=hs;break;default:ie.raise("unsupported type for element array")}qr.buffer.dtype=rn}qr.type=rn,ie(rn!==hs||!!Me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Ar=wn;Ar<0&&(Ar=qr.buffer.byteLength,rn===Fa?Ar>>=1:rn===hs&&(Ar>>=2)),qr.vertCount=Ar;var br=Yr;if(Yr<0){br=Pi;var Xn=qr.buffer.dimension;Xn===1&&(br=jr),Xn===2&&(br=qn),Xn===3&&(br=Pi)}qr.primType=br}function pn(qr){ir.elementsCount--,ie(qr.buffer!==null,"must not double destroy elements"),delete Mr[qr.id],qr.buffer.destroy(),qr.buffer=null}function Wr(qr,Rt){var pr=$e.create(null,go,!0),Yr=new Fr(pr._buffer);ir.elementsCount++;function wn(Tr){if(!Tr)pr(),Yr.primType=Pi,Yr.vertCount=0,Yr.type=ei;else if(typeof Tr=="number")pr(Tr),Yr.primType=Pi,Yr.vertCount=Tr|0,Yr.type=ei;else{var Sn=null,rn=iu,ui=-1,Ar=-1,br=0,Xn=0;Array.isArray(Tr)||C(Tr)||lt(Tr)?Sn=Tr:(ie.type(Tr,"object","invalid arguments for elements"),"data"in Tr&&(Sn=Tr.data,ie(Array.isArray(Sn)||C(Sn)||lt(Sn),"invalid data for element buffer")),"usage"in Tr&&(ie.parameter(Tr.usage,To,"invalid element buffer usage"),rn=To[Tr.usage]),"primitive"in Tr&&(ie.parameter(Tr.primitive,wr,"invalid element buffer primitive"),ui=wr[Tr.primitive]),"count"in Tr&&(ie(typeof Tr.count=="number"&&Tr.count>=0,"invalid vertex count for elements"),Ar=Tr.count|0),"type"in Tr&&(ie.parameter(Tr.type,Er,"invalid buffer type"),Xn=Er[Tr.type]),"length"in Tr?br=Tr.length|0:(br=Ar,Xn===Fa||Xn===Ea?br*=2:(Xn===hs||Xn===Qi)&&(br*=4))),en(Yr,Sn,rn,ui,Ar,br,Xn)}return wn}return wn(qr),wn._reglType="elements",wn._elements=Yr,wn.subdata=function(Tr,Sn){return pr.subdata(Tr,Sn),wn},wn.destroy=function(){pn(Yr)},wn}return{create:Wr,createStream:Kr,destroyStream:Qr,getElements:function(qr){return typeof qr=="function"&&qr._elements instanceof Fr?qr._elements:null},clear:function(){Xt(Mr).forEach(pn)}}}var nl=new Float32Array(1),Ws=new Uint32Array(nl.buffer),Xs=5123;function Ys(V){for(var Me=$t.allocType(Xs,V.length),$e=0;$e<V.length;++$e)if(isNaN(V[$e]))Me[$e]=65535;else if(V[$e]===Infinity)Me[$e]=31744;else if(V[$e]===-Infinity)Me[$e]=64512;else{nl[0]=V[$e];var ir=Ws[0],Mr=ir>>>31<<15,rr=(ir<<1>>>24)-127,Er=ir>>13&(1<<10)-1;if(rr<-24)Me[$e]=Mr;else if(rr<-14){var Fr=-14-rr;Me[$e]=Mr+(Er+(1<<10)>>Fr)}else rr>15?Me[$e]=Mr+31744:Me[$e]=Mr+(rr+15<<10)+Er}return Me}function io(V){return Array.isArray(V)||C(V)}var Cu=function(V){return!(V&V-1)&&!!V},il=34467,ps=3553,Xl=34067,au=34069,Fs=6408,hc=6406,Au=6407,Aa=6409,Tu=6410,Yl=32854,Pu=32855,pc=36194,dc=32819,Dc=32820,Fc=33635,Cl=34042,gu=6402,al=34041,ol=35904,Hu=35906,sl=36193,Wu=33776,Bs=33777,vc=33778,mc=33779,Bc=35986,Xu=35987,Al=34798,Kl=35840,yc=35841,Yu=35842,Tl=35843,Pl=36196,Mu=5121,$l=5123,Ua=5125,Iu=5126,ul=10242,Jl=10243,Ql=10497,Ku=33071,Jc=33648,ll=10240,Ka=10241,cl=9728,$u=9729,Ks=9984,ra=9985,Za=9986,Ss=9987,Ml=33170,Ou=4352,Il=4353,Qc=4354,qc=34046,Ol=3317,ql=37440,Lu=37441,ko=37443,Ns=37444,fl=33984,_o=[Ks,Za,ra,Ss],Fn=[0,Aa,Tu,Au,Fs],lo={};lo[Aa]=lo[hc]=lo[gu]=1,lo[al]=lo[Tu]=2,lo[Au]=lo[ol]=3,lo[Fs]=lo[Hu]=4;function Ru(V){return"[object "+V+"]"}var hl=Ru("HTMLCanvasElement"),$s=Ru("OffscreenCanvas"),Is=Ru("CanvasRenderingContext2D"),gc=Ru("ImageBitmap"),vn=Ru("HTMLImageElement"),ec=Ru("HTMLVideoElement"),tc=Object.keys(Hs).concat([hl,$s,Is,gc,vn,ec]),ku=[];ku[Mu]=1,ku[Iu]=4,ku[sl]=2,ku[$l]=2,ku[Ua]=4;var Va=[];Va[Yl]=2,Va[Pu]=2,Va[pc]=2,Va[al]=4,Va[Wu]=.5,Va[Bs]=.5,Va[vc]=1,Va[mc]=1,Va[Bc]=.5,Va[Xu]=1,Va[Al]=1,Va[Kl]=.5,Va[yc]=.25,Va[Yu]=.5,Va[Tl]=.25,Va[Pl]=.5;function Os(V){return Array.isArray(V)&&(V.length===0||typeof V[0]=="number")}function rc(V){if(!Array.isArray(V))return!1;var Me=V.length;return!(Me===0||!io(V[0]))}function _u(V){return Object.prototype.toString.call(V)}function Ls(V){return _u(V)===hl}function ou(V){return _u(V)===$s}function Nc(V){return _u(V)===Is}function Ll(V){return _u(V)===gc}function _c(V){return _u(V)===vn}function zc(V){return _u(V)===ec}function Js(V){var Me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Me&&V&&V.getContext)}function Rs(V){if(!V)return!1;if(Js(V))return!0;var Me=_u(V);return tc.indexOf(Me)>=0?!0:Os(V)||rc(V)||lt(V)}function qi(V){return Hs[Object.prototype.toString.call(V)]|0}function xu(V,Me){var $e=Me.length;switch(V.type){case Mu:case $l:case Ua:case Iu:var ir=$t.allocType(V.type,$e);ir.set(Me),V.data=ir;break;case sl:V.data=Ys(Me);break;default:ie.raise("unsupported texture type, must specify a typed array")}}function zs(V,Me){return $t.allocType(V.type===sl?Iu:V.type,Me)}function Uo(V,Me){V.type===sl?(V.data=Ys(Me),$t.freeType(Me)):V.data=Me}function pl(V,Me,$e,ir,Mr,rr){for(var Er=V.width,Fr=V.height,Gr=V.channels,Kr=Er*Fr*Gr,Qr=zs(V,Kr),en=0,pn=0;pn<Fr;++pn)for(var Wr=0;Wr<Er;++Wr)for(var qr=0;qr<Gr;++qr)Qr[en++]=Me[$e*Wr+ir*pn+Mr*qr+rr];Uo(V,Qr)}function su(V,Me,$e,ir,Mr,rr){var Er;if(typeof Va[V]!="undefined"?Er=Va[V]:Er=lo[V]*ku[Me],rr&&(Er*=6),Mr){for(var Fr=0,Gr=$e;Gr>=1;)Fr+=Er*Gr*Gr,Gr/=2;return Fr}else return Er*$e*ir}function uu(V,Me,$e,ir,Mr,rr,Er){var Fr={"don't care":Ou,"dont care":Ou,nice:Qc,fast:Il},Gr={repeat:Ql,clamp:Ku,mirror:Jc},Kr={nearest:cl,linear:$u},Qr=d({mipmap:Ss,"nearest mipmap nearest":Ks,"linear mipmap nearest":ra,"nearest mipmap linear":Za,"linear mipmap linear":Ss},Kr),en={none:0,browser:Ns},pn={uint8:Mu,rgba4:dc,rgb565:Fc,"rgb5 a1":Dc},Wr={alpha:hc,luminance:Aa,"luminance alpha":Tu,rgb:Au,rgba:Fs,rgba4:Yl,"rgb5 a1":Pu,rgb565:pc},qr={};Me.ext_srgb&&(Wr.srgb=ol,Wr.srgba=Hu),Me.oes_texture_float&&(pn.float32=pn.float=Iu),Me.oes_texture_half_float&&(pn.float16=pn["half float"]=sl),Me.webgl_depth_texture&&(d(Wr,{depth:gu,"depth stencil":al}),d(pn,{uint16:$l,uint32:Ua,"depth stencil":Cl})),Me.webgl_compressed_texture_s3tc&&d(qr,{"rgb s3tc dxt1":Wu,"rgba s3tc dxt1":Bs,"rgba s3tc dxt3":vc,"rgba s3tc dxt5":mc}),Me.webgl_compressed_texture_atc&&d(qr,{"rgb atc":Bc,"rgba atc explicit alpha":Xu,"rgba atc interpolated alpha":Al}),Me.webgl_compressed_texture_pvrtc&&d(qr,{"rgb pvrtc 4bppv1":Kl,"rgb pvrtc 2bppv1":yc,"rgba pvrtc 4bppv1":Yu,"rgba pvrtc 2bppv1":Tl}),Me.webgl_compressed_texture_etc1&&(qr["rgb etc1"]=Pl);var Rt=Array.prototype.slice.call(V.getParameter(il)||new Uint32Array(0));Object.keys(qr).forEach(function(Ve){var lr=qr[Ve];Rt.indexOf(lr)>=0&&(Wr[Ve]=lr)});var pr=Object.keys(Wr);$e.textureFormats=pr;var Yr=[];Object.keys(Wr).forEach(function(Ve){var lr=Wr[Ve];Yr[lr]=Ve});var wn=[];Object.keys(pn).forEach(function(Ve){var lr=pn[Ve];wn[lr]=Ve});var Tr=[];Object.keys(Kr).forEach(function(Ve){var lr=Kr[Ve];Tr[lr]=Ve});var Sn=[];Object.keys(Qr).forEach(function(Ve){var lr=Qr[Ve];Sn[lr]=Ve});var rn=[];Object.keys(Gr).forEach(function(Ve){var lr=Gr[Ve];rn[lr]=Ve});var ui=pr.reduce(function(Ve,lr){var Kt=Wr[lr];return Kt===Aa||Kt===hc||Kt===Aa||Kt===Tu||Kt===gu||Kt===al||Me.ext_srgb&&(Kt===ol||Kt===Hu)?Ve[Kt]=Kt:Kt===Pu||lr.indexOf("rgba")>=0?Ve[Kt]=Fs:Ve[Kt]=Au,Ve},{});function Ar(){this.internalformat=Fs,this.format=Fs,this.type=Mu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Ns,this.width=0,this.height=0,this.channels=0}function br(Ve,lr){Ve.internalformat=lr.internalformat,Ve.format=lr.format,Ve.type=lr.type,Ve.compressed=lr.compressed,Ve.premultiplyAlpha=lr.premultiplyAlpha,Ve.flipY=lr.flipY,Ve.unpackAlignment=lr.unpackAlignment,Ve.colorSpace=lr.colorSpace,Ve.width=lr.width,Ve.height=lr.height,Ve.channels=lr.channels}function Xn(Ve,lr){if(!(typeof lr!="object"||!lr)){if("premultiplyAlpha"in lr&&(ie.type(lr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ve.premultiplyAlpha=lr.premultiplyAlpha),"flipY"in lr&&(ie.type(lr.flipY,"boolean","invalid texture flip"),Ve.flipY=lr.flipY),"alignment"in lr&&(ie.oneOf(lr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ve.unpackAlignment=lr.alignment),"colorSpace"in lr&&(ie.parameter(lr.colorSpace,en,"invalid colorSpace"),Ve.colorSpace=en[lr.colorSpace]),"type"in lr){var Kt=lr.type;ie(Me.oes_texture_float||!(Kt==="float"||Kt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ie(Me.oes_texture_half_float||!(Kt==="half float"||Kt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ie(Me.webgl_depth_texture||!(Kt==="uint16"||Kt==="uint32"||Kt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(Kt,pn,"invalid texture type"),Ve.type=pn[Kt]}var Nn=Ve.width,oa=Ve.height,De=Ve.channels,be=!1;"shape"in lr?(ie(Array.isArray(lr.shape)&&lr.shape.length>=2,"shape must be an array"),Nn=lr.shape[0],oa=lr.shape[1],lr.shape.length===3&&(De=lr.shape[2],ie(De>0&&De<=4,"invalid number of channels"),be=!0),ie(Nn>=0&&Nn<=$e.maxTextureSize,"invalid width"),ie(oa>=0&&oa<=$e.maxTextureSize,"invalid height")):("radius"in lr&&(Nn=oa=lr.radius,ie(Nn>=0&&Nn<=$e.maxTextureSize,"invalid radius")),"width"in lr&&(Nn=lr.width,ie(Nn>=0&&Nn<=$e.maxTextureSize,"invalid width")),"height"in lr&&(oa=lr.height,ie(oa>=0&&oa<=$e.maxTextureSize,"invalid height")),"channels"in lr&&(De=lr.channels,ie(De>0&&De<=4,"invalid number of channels"),be=!0)),Ve.width=Nn|0,Ve.height=oa|0,Ve.channels=De|0;var tt=!1;if("format"in lr){var kt=lr.format;ie(Me.webgl_depth_texture||!(kt==="depth"||kt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ie.parameter(kt,Wr,"invalid texture format");var or=Ve.internalformat=Wr[kt];Ve.format=ui[or],kt in pn&&("type"in lr||(Ve.type=pn[kt])),kt in qr&&(Ve.compressed=!0),tt=!0}!be&&tt?Ve.channels=lo[Ve.format]:be&&!tt?Ve.channels!==Fn[Ve.format]&&(Ve.format=Ve.internalformat=Fn[Ve.channels]):tt&&be&&ie(Ve.channels===lo[Ve.format],"number of channels inconsistent with specified format")}}function fn(Ve){V.pixelStorei(ql,Ve.flipY),V.pixelStorei(Lu,Ve.premultiplyAlpha),V.pixelStorei(ko,Ve.colorSpace),V.pixelStorei(Ol,Ve.unpackAlignment)}function $r(){Ar.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function gn(Ve,lr){var Kt=null;if(Rs(lr)?Kt=lr:lr&&(ie.type(lr,"object","invalid pixel data type"),Xn(Ve,lr),"x"in lr&&(Ve.xOffset=lr.x|0),"y"in lr&&(Ve.yOffset=lr.y|0),Rs(lr.data)&&(Kt=lr.data)),ie(!Ve.compressed||Kt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),lr.copy){ie(!Kt,"can not specify copy and data field for the same texture");var Nn=Mr.viewportWidth,oa=Mr.viewportHeight;Ve.width=Ve.width||Nn-Ve.xOffset,Ve.height=Ve.height||oa-Ve.yOffset,Ve.needsCopy=!0,ie(Ve.xOffset>=0&&Ve.xOffset<Nn&&Ve.yOffset>=0&&Ve.yOffset<oa&&Ve.width>0&&Ve.width<=Nn&&Ve.height>0&&Ve.height<=oa,"copy texture read out of bounds")}else if(!Kt)Ve.width=Ve.width||1,Ve.height=Ve.height||1,Ve.channels=Ve.channels||4;else if(C(Kt))Ve.channels=Ve.channels||4,Ve.data=Kt,!("type"in lr)&&Ve.type===Mu&&(Ve.type=qi(Kt));else if(Os(Kt))Ve.channels=Ve.channels||4,xu(Ve,Kt),Ve.alignment=1,Ve.needsFree=!0;else if(lt(Kt)){var De=Kt.data;!Array.isArray(De)&&Ve.type===Mu&&(Ve.type=qi(De));var be=Kt.shape,tt=Kt.stride,kt,or,mt,ut,et,Ie;be.length===3?(mt=be[2],Ie=tt[2]):(ie(be.length===2,"invalid ndarray pixel data, must be 2 or 3D"),mt=1,Ie=1),kt=be[0],or=be[1],ut=tt[0],et=tt[1],Ve.alignment=1,Ve.width=kt,Ve.height=or,Ve.channels=mt,Ve.format=Ve.internalformat=Fn[mt],Ve.needsFree=!0,pl(Ve,De,ut,et,Ie,Kt.offset)}else if(Js(Kt)||Ls(Kt)||ou(Kt)||Nc(Kt))Js(Kt)||Ls(Kt)||ou(Kt)?Ve.element=Kt:Ve.element=Kt.canvas,Ve.width=Ve.element.width,Ve.height=Ve.element.height,Ve.channels=4;else if(Ll(Kt))Ve.element=Kt,Ve.width=Kt.width,Ve.height=Kt.height,Ve.channels=4;else if(_c(Kt))Ve.element=Kt,Ve.width=Kt.naturalWidth,Ve.height=Kt.naturalHeight,Ve.channels=4;else if(zc(Kt))Ve.element=Kt,Ve.width=Kt.videoWidth,Ve.height=Kt.videoHeight,Ve.channels=4;else if(rc(Kt)){var at=Ve.width||Kt[0].length,Be=Ve.height||Kt.length,It=Ve.channels;io(Kt[0][0])?It=It||Kt[0][0].length:It=It||1;for(var Ht=Xr.shape(Kt),Dr=1,hn=0;hn<Ht.length;++hn)Dr*=Ht[hn];var cn=zs(Ve,Dr);Xr.flatten(Kt,Ht,"",cn),Uo(Ve,cn),Ve.alignment=1,Ve.width=at,Ve.height=Be,Ve.channels=It,Ve.format=Ve.internalformat=Fn[It],Ve.needsFree=!0}Ve.type===Iu?ie($e.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ve.type===sl&&ie($e.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function En(Ve,lr,Kt){var Nn=Ve.element,oa=Ve.data,De=Ve.internalformat,be=Ve.format,tt=Ve.type,kt=Ve.width,or=Ve.height;fn(Ve),Nn?V.texImage2D(lr,Kt,be,be,tt,Nn):Ve.compressed?V.compressedTexImage2D(lr,Kt,De,kt,or,0,oa):Ve.needsCopy?(ir(),V.copyTexImage2D(lr,Kt,be,Ve.xOffset,Ve.yOffset,kt,or,0)):V.texImage2D(lr,Kt,be,kt,or,0,be,tt,oa||null)}function Ni(Ve,lr,Kt,Nn,oa){var De=Ve.element,be=Ve.data,tt=Ve.internalformat,kt=Ve.format,or=Ve.type,mt=Ve.width,ut=Ve.height;fn(Ve),De?V.texSubImage2D(lr,oa,Kt,Nn,kt,or,De):Ve.compressed?V.compressedTexSubImage2D(lr,oa,Kt,Nn,tt,mt,ut,be):Ve.needsCopy?(ir(),V.copyTexSubImage2D(lr,oa,Kt,Nn,Ve.xOffset,Ve.yOffset,mt,ut)):V.texSubImage2D(lr,oa,Kt,Nn,mt,ut,kt,or,be)}var ki=[];function Tn(){return ki.pop()||new $r}function Cn(Ve){Ve.needsFree&&$t.freeType(Ve.data),$r.call(Ve),ki.push(Ve)}function xi(){Ar.call(this),this.genMipmaps=!1,this.mipmapHint=Ou,this.mipmask=0,this.images=Array(16)}function Di(Ve,lr,Kt){var Nn=Ve.images[0]=Tn();Ve.mipmask=1,Nn.width=Ve.width=lr,Nn.height=Ve.height=Kt,Nn.channels=Ve.channels=4}function ia(Ve,lr){var Kt=null;if(Rs(lr))Kt=Ve.images[0]=Tn(),br(Kt,Ve),gn(Kt,lr),Ve.mipmask=1;else if(Xn(Ve,lr),Array.isArray(lr.mipmap))for(var Nn=lr.mipmap,oa=0;oa<Nn.length;++oa)Kt=Ve.images[oa]=Tn(),br(Kt,Ve),Kt.width>>=oa,Kt.height>>=oa,gn(Kt,Nn[oa]),Ve.mipmask|=1<<oa;else Kt=Ve.images[0]=Tn(),br(Kt,Ve),gn(Kt,lr),Ve.mipmask=1;br(Ve,Ve.images[0]),Ve.compressed&&(Ve.internalformat===Wu||Ve.internalformat===Bs||Ve.internalformat===vc||Ve.internalformat===mc)&&ie(Ve.width%4==0&&Ve.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function So(Ve,lr){for(var Kt=Ve.images,Nn=0;Nn<Kt.length;++Nn){if(!Kt[Nn])return;En(Kt[Nn],lr,Nn)}}var Mo=[];function la(){var Ve=Mo.pop()||new xi;Ar.call(Ve),Ve.mipmask=0;for(var lr=0;lr<16;++lr)Ve.images[lr]=null;return Ve}function Qo(Ve){for(var lr=Ve.images,Kt=0;Kt<lr.length;++Kt)lr[Kt]&&Cn(lr[Kt]),lr[Kt]=null;Mo.push(Ve)}function to(){this.minFilter=cl,this.magFilter=cl,this.wrapS=Ku,this.wrapT=Ku,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ou}function Cs(Ve,lr){if("min"in lr){var Kt=lr.min;ie.parameter(Kt,Qr),Ve.minFilter=Qr[Kt],_o.indexOf(Ve.minFilter)>=0&&!("faces"in lr)&&(Ve.genMipmaps=!0)}if("mag"in lr){var Nn=lr.mag;ie.parameter(Nn,Kr),Ve.magFilter=Kr[Nn]}var oa=Ve.wrapS,De=Ve.wrapT;if("wrap"in lr){var be=lr.wrap;typeof be=="string"?(ie.parameter(be,Gr),oa=De=Gr[be]):Array.isArray(be)&&(ie.parameter(be[0],Gr),ie.parameter(be[1],Gr),oa=Gr[be[0]],De=Gr[be[1]])}else{if("wrapS"in lr){var tt=lr.wrapS;ie.parameter(tt,Gr),oa=Gr[tt]}if("wrapT"in lr){var kt=lr.wrapT;ie.parameter(kt,Gr),De=Gr[kt]}}if(Ve.wrapS=oa,Ve.wrapT=De,"anisotropic"in lr){var or=lr.anisotropic;ie(typeof or=="number"&&or>=1&&or<=$e.maxAnisotropic,"aniso samples must be between 1 and "),Ve.anisotropic=lr.anisotropic}if("mipmap"in lr){var mt=!1;switch(typeof lr.mipmap){case"string":ie.parameter(lr.mipmap,Fr,"invalid mipmap hint"),Ve.mipmapHint=Fr[lr.mipmap],Ve.genMipmaps=!0,mt=!0;break;case"boolean":mt=Ve.genMipmaps=lr.mipmap;break;case"object":ie(Array.isArray(lr.mipmap),"invalid mipmap type"),Ve.genMipmaps=!1,mt=!0;break;default:ie.raise("invalid mipmap type")}mt&&!("min"in lr)&&(Ve.minFilter=Ks)}}function ss(Ve,lr){V.texParameteri(lr,Ka,Ve.minFilter),V.texParameteri(lr,ll,Ve.magFilter),V.texParameteri(lr,ul,Ve.wrapS),V.texParameteri(lr,Jl,Ve.wrapT),Me.ext_texture_filter_anisotropic&&V.texParameteri(lr,qc,Ve.anisotropic),Ve.genMipmaps&&(V.hint(Ml,Ve.mipmapHint),V.generateMipmap(lr))}var qo=0,us={},es=$e.maxTextureUnits,Bo=Array(es).map(function(){return null});function Fi(Ve){Ar.call(this),this.mipmask=0,this.internalformat=Fs,this.id=qo++,this.refCount=1,this.target=Ve,this.texture=V.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new to,Er.profile&&(this.stats={size:0})}function Vo(Ve){V.activeTexture(fl),V.bindTexture(Ve.target,Ve.texture)}function Ra(){var Ve=Bo[0];Ve?V.bindTexture(Ve.target,Ve.texture):V.bindTexture(ps,null)}function Go(Ve){var lr=Ve.texture;ie(lr,"must not double destroy texture");var Kt=Ve.unit,Nn=Ve.target;Kt>=0&&(V.activeTexture(fl+Kt),V.bindTexture(Nn,null),Bo[Kt]=null),V.deleteTexture(lr),Ve.texture=null,Ve.params=null,Ve.pixels=null,Ve.refCount=0,delete us[Ve.id],rr.textureCount--}d(Fi.prototype,{bind:function(){var Ve=this;Ve.bindCount+=1;var lr=Ve.unit;if(lr<0){for(var Kt=0;Kt<es;++Kt){var Nn=Bo[Kt];if(Nn){if(Nn.bindCount>0)continue;Nn.unit=-1}Bo[Kt]=Ve,lr=Kt;break}lr>=es&&ie.raise("insufficient number of texture units"),Er.profile&&rr.maxTextureUnits<lr+1&&(rr.maxTextureUnits=lr+1),Ve.unit=lr,V.activeTexture(fl+lr),V.bindTexture(Ve.target,Ve.texture)}return lr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Go(this)}});function Mi(Ve,lr){var Kt=new Fi(ps);us[Kt.id]=Kt,rr.textureCount++;function Nn(be,tt){var kt=Kt.texInfo;to.call(kt);var or=la();return typeof be=="number"?typeof tt=="number"?Di(or,be|0,tt|0):Di(or,be|0,be|0):be?(ie.type(be,"object","invalid arguments to regl.texture"),Cs(kt,be),ia(or,be)):Di(or,1,1),kt.genMipmaps&&(or.mipmask=(or.width<<1)-1),Kt.mipmask=or.mipmask,br(Kt,or),ie.texture2D(kt,or,$e),Kt.internalformat=or.internalformat,Nn.width=or.width,Nn.height=or.height,Vo(Kt),So(or,ps),ss(kt,ps),Ra(),Qo(or),Er.profile&&(Kt.stats.size=su(Kt.internalformat,Kt.type,or.width,or.height,kt.genMipmaps,!1)),Nn.format=Yr[Kt.internalformat],Nn.type=wn[Kt.type],Nn.mag=Tr[kt.magFilter],Nn.min=Sn[kt.minFilter],Nn.wrapS=rn[kt.wrapS],Nn.wrapT=rn[kt.wrapT],Nn}function oa(be,tt,kt,or){ie(!!be,"must specify image data");var mt=tt|0,ut=kt|0,et=or|0,Ie=Tn();return br(Ie,Kt),Ie.width=0,Ie.height=0,gn(Ie,be),Ie.width=Ie.width||(Kt.width>>et)-mt,Ie.height=Ie.height||(Kt.height>>et)-ut,ie(Kt.type===Ie.type&&Kt.format===Ie.format&&Kt.internalformat===Ie.internalformat,"incompatible format for texture.subimage"),ie(mt>=0&&ut>=0&&mt+Ie.width<=Kt.width&&ut+Ie.height<=Kt.height,"texture.subimage write out of bounds"),ie(Kt.mipmask&1<<et,"missing mipmap data"),ie(Ie.data||Ie.element||Ie.needsCopy,"missing image data"),Vo(Kt),Ni(Ie,ps,mt,ut,et),Ra(),Cn(Ie),Nn}function De(be,tt){var kt=be|0,or=tt|0||kt;if(kt===Kt.width&&or===Kt.height)return Nn;Nn.width=Kt.width=kt,Nn.height=Kt.height=or,Vo(Kt);for(var mt=0;Kt.mipmask>>mt;++mt){var ut=kt>>mt,et=or>>mt;if(!ut||!et)break;V.texImage2D(ps,mt,Kt.format,ut,et,0,Kt.format,Kt.type,null)}return Ra(),Er.profile&&(Kt.stats.size=su(Kt.internalformat,Kt.type,kt,or,!1,!1)),Nn}return Nn(Ve,lr),Nn.subimage=oa,Nn.resize=De,Nn._reglType="texture2d",Nn._texture=Kt,Er.profile&&(Nn.stats=Kt.stats),Nn.destroy=function(){Kt.decRef()},Nn}function aa(Ve,lr,Kt,Nn,oa,De){var be=new Fi(Xl);us[be.id]=be,rr.cubeCount++;var tt=new Array(6);function kt(ut,et,Ie,at,Be,It){var Ht,Dr=be.texInfo;for(to.call(Dr),Ht=0;Ht<6;++Ht)tt[Ht]=la();if(typeof ut=="number"||!ut){var hn=ut|0||1;for(Ht=0;Ht<6;++Ht)Di(tt[Ht],hn,hn)}else if(typeof ut=="object")if(et)ia(tt[0],ut),ia(tt[1],et),ia(tt[2],Ie),ia(tt[3],at),ia(tt[4],Be),ia(tt[5],It);else if(Cs(Dr,ut),Xn(be,ut),"faces"in ut){var cn=ut.faces;for(ie(Array.isArray(cn)&&cn.length===6,"cube faces must be a length 6 array"),Ht=0;Ht<6;++Ht)ie(typeof cn[Ht]=="object"&&!!cn[Ht],"invalid input for cube map face"),br(tt[Ht],be),ia(tt[Ht],cn[Ht])}else for(Ht=0;Ht<6;++Ht)ia(tt[Ht],ut);else ie.raise("invalid arguments to cube map");for(br(be,tt[0]),ie.optional(function(){$e.npotTextureCube||ie(Cu(be.width)&&Cu(be.height),"your browser does not support non power or two texture dimensions")}),Dr.genMipmaps?be.mipmask=(tt[0].width<<1)-1:be.mipmask=tt[0].mipmask,ie.textureCube(be,Dr,tt,$e),be.internalformat=tt[0].internalformat,kt.width=tt[0].width,kt.height=tt[0].height,Vo(be),Ht=0;Ht<6;++Ht)So(tt[Ht],au+Ht);for(ss(Dr,Xl),Ra(),Er.profile&&(be.stats.size=su(be.internalformat,be.type,kt.width,kt.height,Dr.genMipmaps,!0)),kt.format=Yr[be.internalformat],kt.type=wn[be.type],kt.mag=Tr[Dr.magFilter],kt.min=Sn[Dr.minFilter],kt.wrapS=rn[Dr.wrapS],kt.wrapT=rn[Dr.wrapT],Ht=0;Ht<6;++Ht)Qo(tt[Ht]);return kt}function or(ut,et,Ie,at,Be){ie(!!et,"must specify image data"),ie(typeof ut=="number"&&ut===(ut|0)&&ut>=0&&ut<6,"invalid face");var It=Ie|0,Ht=at|0,Dr=Be|0,hn=Tn();return br(hn,be),hn.width=0,hn.height=0,gn(hn,et),hn.width=hn.width||(be.width>>Dr)-It,hn.height=hn.height||(be.height>>Dr)-Ht,ie(be.type===hn.type&&be.format===hn.format&&be.internalformat===hn.internalformat,"incompatible format for texture.subimage"),ie(It>=0&&Ht>=0&&It+hn.width<=be.width&&Ht+hn.height<=be.height,"texture.subimage write out of bounds"),ie(be.mipmask&1<<Dr,"missing mipmap data"),ie(hn.data||hn.element||hn.needsCopy,"missing image data"),Vo(be),Ni(hn,au+ut,It,Ht,Dr),Ra(),Cn(hn),kt}function mt(ut){var et=ut|0;if(et!==be.width){kt.width=be.width=et,kt.height=be.height=et,Vo(be);for(var Ie=0;Ie<6;++Ie)for(var at=0;be.mipmask>>at;++at)V.texImage2D(au+Ie,at,be.format,et>>at,et>>at,0,be.format,be.type,null);return Ra(),Er.profile&&(be.stats.size=su(be.internalformat,be.type,kt.width,kt.height,!1,!0)),kt}}return kt(Ve,lr,Kt,Nn,oa,De),kt.subimage=or,kt.resize=mt,kt._reglType="textureCube",kt._texture=be,Er.profile&&(kt.stats=be.stats),kt.destroy=function(){be.decRef()},kt}function ha(){for(var Ve=0;Ve<es;++Ve)V.activeTexture(fl+Ve),V.bindTexture(ps,null),Bo[Ve]=null;Xt(us).forEach(Go),rr.cubeCount=0,rr.textureCount=0}Er.profile&&(rr.getTotalTextureSize=function(){var Ve=0;return Object.keys(us).forEach(function(lr){Ve+=us[lr].stats.size}),Ve});function oo(){for(var Ve=0;Ve<es;++Ve){var lr=Bo[Ve];lr&&(lr.bindCount=0,lr.unit=-1,Bo[Ve]=null)}Xt(us).forEach(function(Kt){Kt.texture=V.createTexture(),V.bindTexture(Kt.target,Kt.texture);for(var Nn=0;Nn<32;++Nn)if((Kt.mipmask&1<<Nn)!=0)if(Kt.target===ps)V.texImage2D(ps,Nn,Kt.internalformat,Kt.width>>Nn,Kt.height>>Nn,0,Kt.internalformat,Kt.type,null);else for(var oa=0;oa<6;++oa)V.texImage2D(au+oa,Nn,Kt.internalformat,Kt.width>>Nn,Kt.height>>Nn,0,Kt.internalformat,Kt.type,null);ss(Kt.texInfo,Kt.target)})}function el(){for(var Ve=0;Ve<es;++Ve){var lr=Bo[Ve];lr&&(lr.bindCount=0,lr.unit=-1,Bo[Ve]=null),V.activeTexture(fl+Ve),V.bindTexture(ps,null),V.bindTexture(Xl,null)}}return{create2D:Mi,createCube:aa,clear:ha,getTexture:function(Ve){return null},restore:oo,refresh:el}}var xo=36161,Du=32854,ii=32855,Wn=36194,Rl=33189,is=36168,Qs=34041,Jo=35907,lu=34836,xc=34842,nc=34843,Wi=[];Wi[Du]=2,Wi[ii]=2,Wi[Wn]=2,Wi[Rl]=2,Wi[is]=1,Wi[Qs]=4,Wi[Jo]=4,Wi[lu]=16,Wi[xc]=8,Wi[nc]=6;function Do(V,Me,$e){return Wi[V]*Me*$e}var Uc=function(V,Me,$e,ir,Mr){var rr={rgba4:Du,rgb565:Wn,"rgb5 a1":ii,depth:Rl,stencil:is,"depth stencil":Qs};Me.ext_srgb&&(rr.srgba=Jo),Me.ext_color_buffer_half_float&&(rr.rgba16f=xc,rr.rgb16f=nc),Me.webgl_color_buffer_float&&(rr.rgba32f=lu);var Er=[];Object.keys(rr).forEach(function(Wr){var qr=rr[Wr];Er[qr]=Wr});var Fr=0,Gr={};function Kr(Wr){this.id=Fr++,this.refCount=1,this.renderbuffer=Wr,this.format=Du,this.width=0,this.height=0,Mr.profile&&(this.stats={size:0})}Kr.prototype.decRef=function(){--this.refCount<=0&&Qr(this)};function Qr(Wr){var qr=Wr.renderbuffer;ie(qr,"must not double destroy renderbuffer"),V.bindRenderbuffer(xo,null),V.deleteRenderbuffer(qr),Wr.renderbuffer=null,Wr.refCount=0,delete Gr[Wr.id],ir.renderbufferCount--}function en(Wr,qr){var Rt=new Kr(V.createRenderbuffer());Gr[Rt.id]=Rt,ir.renderbufferCount++;function pr(wn,Tr){var Sn=0,rn=0,ui=Du;if(typeof wn=="object"&&wn){var Ar=wn;if("shape"in Ar){var br=Ar.shape;ie(Array.isArray(br)&&br.length>=2,"invalid renderbuffer shape"),Sn=br[0]|0,rn=br[1]|0}else"radius"in Ar&&(Sn=rn=Ar.radius|0),"width"in Ar&&(Sn=Ar.width|0),"height"in Ar&&(rn=Ar.height|0);"format"in Ar&&(ie.parameter(Ar.format,rr,"invalid renderbuffer format"),ui=rr[Ar.format])}else typeof wn=="number"?(Sn=wn|0,typeof Tr=="number"?rn=Tr|0:rn=Sn):wn?ie.raise("invalid arguments to renderbuffer constructor"):Sn=rn=1;if(ie(Sn>0&&rn>0&&Sn<=$e.maxRenderbufferSize&&rn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),!(Sn===Rt.width&&rn===Rt.height&&ui===Rt.format))return pr.width=Rt.width=Sn,pr.height=Rt.height=rn,Rt.format=ui,V.bindRenderbuffer(xo,Rt.renderbuffer),V.renderbufferStorage(xo,ui,Sn,rn),ie(V.getError()===0,"invalid render buffer format"),Mr.profile&&(Rt.stats.size=Do(Rt.format,Rt.width,Rt.height)),pr.format=Er[Rt.format],pr}function Yr(wn,Tr){var Sn=wn|0,rn=Tr|0||Sn;return Sn===Rt.width&&rn===Rt.height||(ie(Sn>0&&rn>0&&Sn<=$e.maxRenderbufferSize&&rn<=$e.maxRenderbufferSize,"invalid renderbuffer size"),pr.width=Rt.width=Sn,pr.height=Rt.height=rn,V.bindRenderbuffer(xo,Rt.renderbuffer),V.renderbufferStorage(xo,Rt.format,Sn,rn),ie(V.getError()===0,"invalid render buffer format"),Mr.profile&&(Rt.stats.size=Do(Rt.format,Rt.width,Rt.height))),pr}return pr(Wr,qr),pr.resize=Yr,pr._reglType="renderbuffer",pr._renderbuffer=Rt,Mr.profile&&(pr.stats=Rt.stats),pr.destroy=function(){Rt.decRef()},pr}Mr.profile&&(ir.getTotalRenderbufferSize=function(){var Wr=0;return Object.keys(Gr).forEach(function(qr){Wr+=Gr[qr].stats.size}),Wr});function pn(){Xt(Gr).forEach(function(Wr){Wr.renderbuffer=V.createRenderbuffer(),V.bindRenderbuffer(xo,Wr.renderbuffer),V.renderbufferStorage(xo,Wr.format,Wr.width,Wr.height)}),V.bindRenderbuffer(xo,null)}return{create:en,clear:function(){Xt(Gr).forEach(Qr)},restore:pn}},Es=36160,ic=36161,ws=3553,ds=34069,dl=36064,cu=36096,kl=36128,Ju=33306,Dl=36053,Zc=36054,Fl=36055,vl=36057,bc=36061,Fu=36193,Bu=5121,Sc=5126,Nu=6407,Us=6408,Ec=6402,zu=[Nu,Us],Bl=[];Bl[Us]=4,Bl[Nu]=3;var Qu=[];Qu[Bu]=1,Qu[Sc]=4,Qu[Fu]=2;var i=32854,u=32855,o=36194,h=33189,g=36168,b=34041,P=35907,D=34836,H=34842,ae=34843,Se=[i,u,o,P,H,ae,D],we={};we[Dl]="complete",we[Zc]="incomplete attachment",we[vl]="incomplete dimensions",we[Fl]="incomplete, missing attachment",we[bc]="unsupported";function Pe(V,Me,$e,ir,Mr,rr){var Er={cur:null,next:null,dirty:!1,setFBO:null},Fr=["rgba"],Gr=["rgba4","rgb565","rgb5 a1"];Me.ext_srgb&&Gr.push("srgba"),Me.ext_color_buffer_half_float&&Gr.push("rgba16f","rgb16f"),Me.webgl_color_buffer_float&&Gr.push("rgba32f");var Kr=["uint8"];Me.oes_texture_half_float&&Kr.push("half float","float16"),Me.oes_texture_float&&Kr.push("float","float32");function Qr($r,gn,En){this.target=$r,this.texture=gn,this.renderbuffer=En;var Ni=0,ki=0;gn?(Ni=gn.width,ki=gn.height):En&&(Ni=En.width,ki=En.height),this.width=Ni,this.height=ki}function en($r){$r&&($r.texture&&$r.texture._texture.decRef(),$r.renderbuffer&&$r.renderbuffer._renderbuffer.decRef())}function pn($r,gn,En){if(!!$r)if($r.texture){var Ni=$r.texture._texture,ki=Math.max(1,Ni.width),Tn=Math.max(1,Ni.height);ie(ki===gn&&Tn===En,"inconsistent width/height for supplied texture"),Ni.refCount+=1}else{var Cn=$r.renderbuffer._renderbuffer;ie(Cn.width===gn&&Cn.height===En,"inconsistent width/height for renderbuffer"),Cn.refCount+=1}}function Wr($r,gn){gn&&(gn.texture?V.framebufferTexture2D(Es,$r,gn.target,gn.texture._texture.texture,0):V.framebufferRenderbuffer(Es,$r,ic,gn.renderbuffer._renderbuffer.renderbuffer))}function qr($r){var gn=ws,En=null,Ni=null,ki=$r;typeof $r=="object"&&(ki=$r.data,"target"in $r&&(gn=$r.target|0)),ie.type(ki,"function","invalid attachment data");var Tn=ki._reglType;return Tn==="texture2d"?(En=ki,ie(gn===ws)):Tn==="textureCube"?(En=ki,ie(gn>=ds&&gn<ds+6,"invalid cube map target")):Tn==="renderbuffer"?(Ni=ki,gn=ic):ie.raise("invalid regl object for attachment"),new Qr(gn,En,Ni)}function Rt($r,gn,En,Ni,ki){if(En){var Tn=ir.create2D({width:$r,height:gn,format:Ni,type:ki});return Tn._texture.refCount=0,new Qr(ws,Tn,null)}else{var Cn=Mr.create({width:$r,height:gn,format:Ni});return Cn._renderbuffer.refCount=0,new Qr(ic,null,Cn)}}function pr($r){return $r&&($r.texture||$r.renderbuffer)}function Yr($r,gn,En){$r&&($r.texture?$r.texture.resize(gn,En):$r.renderbuffer&&$r.renderbuffer.resize(gn,En),$r.width=gn,$r.height=En)}var wn=0,Tr={};function Sn(){this.id=wn++,Tr[this.id]=this,this.framebuffer=V.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function rn($r){$r.colorAttachments.forEach(en),en($r.depthAttachment),en($r.stencilAttachment),en($r.depthStencilAttachment)}function ui($r){var gn=$r.framebuffer;ie(gn,"must not double destroy framebuffer"),V.deleteFramebuffer(gn),$r.framebuffer=null,rr.framebufferCount--,delete Tr[$r.id]}function Ar($r){var gn;V.bindFramebuffer(Es,$r.framebuffer);var En=$r.colorAttachments;for(gn=0;gn<En.length;++gn)Wr(dl+gn,En[gn]);for(gn=En.length;gn<$e.maxColorAttachments;++gn)V.framebufferTexture2D(Es,dl+gn,ws,null,0);V.framebufferTexture2D(Es,Ju,ws,null,0),V.framebufferTexture2D(Es,cu,ws,null,0),V.framebufferTexture2D(Es,kl,ws,null,0),Wr(cu,$r.depthAttachment),Wr(kl,$r.stencilAttachment),Wr(Ju,$r.depthStencilAttachment);var Ni=V.checkFramebufferStatus(Es);!V.isContextLost()&&Ni!==Dl&&ie.raise("framebuffer configuration not supported, status = "+we[Ni]),V.bindFramebuffer(Es,Er.next?Er.next.framebuffer:null),Er.cur=Er.next,V.getError()}function br($r,gn){var En=new Sn;rr.framebufferCount++;function Ni(Tn,Cn){var xi;ie(Er.next!==En,"can not update framebuffer which is currently in use");var Di=0,ia=0,So=!0,Mo=!0,la=null,Qo=!0,to="rgba",Cs="uint8",ss=1,qo=null,us=null,es=null,Bo=!1;if(typeof Tn=="number")Di=Tn|0,ia=Cn|0||Di;else if(!Tn)Di=ia=1;else{ie.type(Tn,"object","invalid arguments for framebuffer");var Fi=Tn;if("shape"in Fi){var Vo=Fi.shape;ie(Array.isArray(Vo)&&Vo.length>=2,"invalid shape for framebuffer"),Di=Vo[0],ia=Vo[1]}else"radius"in Fi&&(Di=ia=Fi.radius),"width"in Fi&&(Di=Fi.width),"height"in Fi&&(ia=Fi.height);("color"in Fi||"colors"in Fi)&&(la=Fi.color||Fi.colors,Array.isArray(la)&&ie(la.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),la||("colorCount"in Fi&&(ss=Fi.colorCount|0,ie(ss>0,"invalid color buffer count")),"colorTexture"in Fi&&(Qo=!!Fi.colorTexture,to="rgba4"),"colorType"in Fi&&(Cs=Fi.colorType,Qo?(ie(Me.oes_texture_float||!(Cs==="float"||Cs==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ie(Me.oes_texture_half_float||!(Cs==="half float"||Cs==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Cs==="half float"||Cs==="float16"?(ie(Me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),to="rgba16f"):(Cs==="float"||Cs==="float32")&&(ie(Me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),to="rgba32f"),ie.oneOf(Cs,Kr,"invalid color type")),"colorFormat"in Fi&&(to=Fi.colorFormat,Fr.indexOf(to)>=0?Qo=!0:Gr.indexOf(to)>=0?Qo=!1:ie.optional(function(){Qo?ie.oneOf(Fi.colorFormat,Fr,"invalid color format for texture"):ie.oneOf(Fi.colorFormat,Gr,"invalid color format for renderbuffer")}))),("depthTexture"in Fi||"depthStencilTexture"in Fi)&&(Bo=!!(Fi.depthTexture||Fi.depthStencilTexture),ie(!Bo||Me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Fi&&(typeof Fi.depth=="boolean"?So=Fi.depth:(qo=Fi.depth,Mo=!1)),"stencil"in Fi&&(typeof Fi.stencil=="boolean"?Mo=Fi.stencil:(us=Fi.stencil,So=!1)),"depthStencil"in Fi&&(typeof Fi.depthStencil=="boolean"?So=Mo=Fi.depthStencil:(es=Fi.depthStencil,So=!1,Mo=!1))}var Ra=null,Go=null,Mi=null,aa=null;if(Array.isArray(la))Ra=la.map(qr);else if(la)Ra=[qr(la)];else for(Ra=new Array(ss),xi=0;xi<ss;++xi)Ra[xi]=Rt(Di,ia,Qo,to,Cs);ie(Me.webgl_draw_buffers||Ra.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ie(Ra.length<=$e.maxColorAttachments,"too many color attachments, not supported"),Di=Di||Ra[0].width,ia=ia||Ra[0].height,qo?Go=qr(qo):So&&!Mo&&(Go=Rt(Di,ia,Bo,"depth","uint32")),us?Mi=qr(us):Mo&&!So&&(Mi=Rt(Di,ia,!1,"stencil","uint8")),es?aa=qr(es):!qo&&!us&&Mo&&So&&(aa=Rt(Di,ia,Bo,"depth stencil","depth stencil")),ie(!!qo+!!us+!!es<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var ha=null;for(xi=0;xi<Ra.length;++xi)if(pn(Ra[xi],Di,ia),ie(!Ra[xi]||Ra[xi].texture&&zu.indexOf(Ra[xi].texture._texture.format)>=0||Ra[xi].renderbuffer&&Se.indexOf(Ra[xi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+xi+" is invalid"),Ra[xi]&&Ra[xi].texture){var oo=Bl[Ra[xi].texture._texture.format]*Qu[Ra[xi].texture._texture.type];ha===null?ha=oo:ie(ha===oo,"all color attachments much have the same number of bits per pixel.")}return pn(Go,Di,ia),ie(!Go||Go.texture&&Go.texture._texture.format===Ec||Go.renderbuffer&&Go.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),pn(Mi,Di,ia),ie(!Mi||Mi.renderbuffer&&Mi.renderbuffer._renderbuffer.format===g,"invalid stencil attachment for framebuffer object"),pn(aa,Di,ia),ie(!aa||aa.texture&&aa.texture._texture.format===b||aa.renderbuffer&&aa.renderbuffer._renderbuffer.format===b,"invalid depth-stencil attachment for framebuffer object"),rn(En),En.width=Di,En.height=ia,En.colorAttachments=Ra,En.depthAttachment=Go,En.stencilAttachment=Mi,En.depthStencilAttachment=aa,Ni.color=Ra.map(pr),Ni.depth=pr(Go),Ni.stencil=pr(Mi),Ni.depthStencil=pr(aa),Ni.width=En.width,Ni.height=En.height,Ar(En),Ni}function ki(Tn,Cn){ie(Er.next!==En,"can not resize a framebuffer which is currently in use");var xi=Math.max(Tn|0,1),Di=Math.max(Cn|0||xi,1);if(xi===En.width&&Di===En.height)return Ni;for(var ia=En.colorAttachments,So=0;So<ia.length;++So)Yr(ia[So],xi,Di);return Yr(En.depthAttachment,xi,Di),Yr(En.stencilAttachment,xi,Di),Yr(En.depthStencilAttachment,xi,Di),En.width=Ni.width=xi,En.height=Ni.height=Di,Ar(En),Ni}return Ni($r,gn),d(Ni,{resize:ki,_reglType:"framebuffer",_framebuffer:En,destroy:function(){ui(En),rn(En)},use:function(Tn){Er.setFBO({framebuffer:Ni},Tn)}})}function Xn($r){var gn=Array(6);function En(ki){var Tn;ie(gn.indexOf(Er.next)<0,"can not update framebuffer which is currently in use");var Cn={color:null},xi=0,Di=null,ia="rgba",So="uint8",Mo=1;if(typeof ki=="number")xi=ki|0;else if(!ki)xi=1;else{ie.type(ki,"object","invalid arguments for framebuffer");var la=ki;if("shape"in la){var Qo=la.shape;ie(Array.isArray(Qo)&&Qo.length>=2,"invalid shape for framebuffer"),ie(Qo[0]===Qo[1],"cube framebuffer must be square"),xi=Qo[0]}else"radius"in la&&(xi=la.radius|0),"width"in la?(xi=la.width|0,"height"in la&&ie(la.height===xi,"must be square")):"height"in la&&(xi=la.height|0);("color"in la||"colors"in la)&&(Di=la.color||la.colors,Array.isArray(Di)&&ie(Di.length===1||Me.webgl_draw_buffers,"multiple render targets not supported")),Di||("colorCount"in la&&(Mo=la.colorCount|0,ie(Mo>0,"invalid color buffer count")),"colorType"in la&&(ie.oneOf(la.colorType,Kr,"invalid color type"),So=la.colorType),"colorFormat"in la&&(ia=la.colorFormat,ie.oneOf(la.colorFormat,Fr,"invalid color format for texture"))),"depth"in la&&(Cn.depth=la.depth),"stencil"in la&&(Cn.stencil=la.stencil),"depthStencil"in la&&(Cn.depthStencil=la.depthStencil)}var to;if(Di)if(Array.isArray(Di))for(to=[],Tn=0;Tn<Di.length;++Tn)to[Tn]=Di[Tn];else to=[Di];else{to=Array(Mo);var Cs={radius:xi,format:ia,type:So};for(Tn=0;Tn<Mo;++Tn)to[Tn]=ir.createCube(Cs)}for(Cn.color=Array(to.length),Tn=0;Tn<to.length;++Tn){var ss=to[Tn];ie(typeof ss=="function"&&ss._reglType==="textureCube","invalid cube map"),xi=xi||ss.width,ie(ss.width===xi&&ss.height===xi,"invalid cube map shape"),Cn.color[Tn]={target:ds,data:to[Tn]}}for(Tn=0;Tn<6;++Tn){for(var qo=0;qo<to.length;++qo)Cn.color[qo].target=ds+Tn;Tn>0&&(Cn.depth=gn[0].depth,Cn.stencil=gn[0].stencil,Cn.depthStencil=gn[0].depthStencil),gn[Tn]?gn[Tn](Cn):gn[Tn]=br(Cn)}return d(En,{width:xi,height:xi,color:to})}function Ni(ki){var Tn,Cn=ki|0;if(ie(Cn>0&&Cn<=$e.maxCubeMapSize,"invalid radius for cube fbo"),Cn===En.width)return En;var xi=En.color;for(Tn=0;Tn<xi.length;++Tn)xi[Tn].resize(Cn);for(Tn=0;Tn<6;++Tn)gn[Tn].resize(Cn);return En.width=En.height=Cn,En}return En($r),d(En,{faces:gn,resize:Ni,_reglType:"framebufferCube",destroy:function(){gn.forEach(function(ki){ki.destroy()})}})}function fn(){Er.cur=null,Er.next=null,Er.dirty=!0,Xt(Tr).forEach(function($r){$r.framebuffer=V.createFramebuffer(),Ar($r)})}return d(Er,{getFramebuffer:function($r){if(typeof $r=="function"&&$r._reglType==="framebuffer"){var gn=$r._framebuffer;if(gn instanceof Sn)return gn}return null},create:br,createCube:Xn,clear:function(){Xt(Tr).forEach(ui)},restore:fn})}var He=5126,je=34962,it=34963,ze=["attributes","elements","offset","count","primitive","instances"];function ot(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=He,this.offset=0,this.stride=0,this.divisor=0}function bt(V,Me,$e,ir,Mr,rr,Er){for(var Fr=$e.maxAttributes,Gr=new Array(Fr),Kr=0;Kr<Fr;++Kr)Gr[Kr]=new ot;var Qr=0,en={},pn={Record:ot,scope:{},state:Gr,currentVAO:null,targetVAO:null,restore:qr()?rn:function(){},createVAO:ui,getVAO:pr,destroyBuffer:Wr,setVAO:qr()?Yr:wn,clear:qr()?Tr:function(){}};function Wr(Ar){for(var br=0;br<Gr.length;++br){var Xn=Gr[br];Xn.buffer===Ar&&(V.disableVertexAttribArray(br),Xn.buffer=null)}}function qr(){return Me.oes_vertex_array_object}function Rt(){return Me.angle_instanced_arrays}function pr(Ar){return typeof Ar=="function"&&Ar._vao?Ar._vao:null}function Yr(Ar){if(Ar!==pn.currentVAO){var br=qr();Ar?br.bindVertexArrayOES(Ar.vao):br.bindVertexArrayOES(null),pn.currentVAO=Ar}}function wn(Ar){if(Ar!==pn.currentVAO){if(Ar)Ar.bindAttrs();else{for(var br=Rt(),Xn=0;Xn<Gr.length;++Xn){var fn=Gr[Xn];fn.buffer?(V.enableVertexAttribArray(Xn),fn.buffer.bind(),V.vertexAttribPointer(Xn,fn.size,fn.type,fn.normalized,fn.stride,fn.offfset),br&&fn.divisor&&br.vertexAttribDivisorANGLE(Xn,fn.divisor)):(V.disableVertexAttribArray(Xn),V.vertexAttrib4f(Xn,fn.x,fn.y,fn.z,fn.w))}Er.elements?V.bindBuffer(it,Er.elements.buffer.buffer):V.bindBuffer(it,null)}pn.currentVAO=Ar}}function Tr(){Xt(en).forEach(function(Ar){Ar.destroy()})}function Sn(){this.id=++Qr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var Ar=qr();Ar?this.vao=Ar.createVertexArrayOES():this.vao=null,en[this.id]=this,this.buffers=[]}Sn.prototype.bindAttrs=function(){for(var Ar=Rt(),br=this.attributes,Xn=0;Xn<br.length;++Xn){var fn=br[Xn];fn.buffer?(V.enableVertexAttribArray(Xn),V.bindBuffer(je,fn.buffer.buffer),V.vertexAttribPointer(Xn,fn.size,fn.type,fn.normalized,fn.stride,fn.offset),Ar&&fn.divisor&&Ar.vertexAttribDivisorANGLE(Xn,fn.divisor)):(V.disableVertexAttribArray(Xn),V.vertexAttrib4f(Xn,fn.x,fn.y,fn.z,fn.w))}for(var $r=br.length;$r<Fr;++$r)V.disableVertexAttribArray($r);var gn=rr.getElements(this.elements);gn?V.bindBuffer(it,gn.buffer.buffer):V.bindBuffer(it,null)},Sn.prototype.refresh=function(){var Ar=qr();Ar&&(Ar.bindVertexArrayOES(this.vao),this.bindAttrs(),pn.currentVAO=null,Ar.bindVertexArrayOES(null))},Sn.prototype.destroy=function(){if(this.vao){var Ar=qr();this===pn.currentVAO&&(pn.currentVAO=null,Ar.bindVertexArrayOES(null)),Ar.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),en[this.id]&&(delete en[this.id],ir.vaoCount-=1)};function rn(){var Ar=qr();Ar&&Xt(en).forEach(function(br){br.refresh()})}function ui(Ar){var br=new Sn;ir.vaoCount+=1;function Xn(fn){var $r;if(Array.isArray(fn))$r=fn,br.elements&&br.ownsElements&&br.elements.destroy(),br.elements=null,br.ownsElements=!1,br.offset=0,br.count=0,br.instances=-1,br.primitive=4;else{if(ie(typeof fn=="object","invalid arguments for create vao"),ie("attributes"in fn,"must specify attributes for vao"),fn.elements){var gn=fn.elements;br.ownsElements?typeof gn=="function"&&gn._reglType==="elements"?(br.elements.destroy(),br.ownsElements=!1):(br.elements(gn),br.ownsElements=!1):rr.getElements(fn.elements)?(br.elements=fn.elements,br.ownsElements=!1):(br.elements=rr.create(fn.elements),br.ownsElements=!0)}else br.elements=null,br.ownsElements=!1;$r=fn.attributes,br.offset=0,br.count=-1,br.instances=-1,br.primitive=4,br.elements&&(br.count=br.elements._elements.vertCount,br.primitive=br.elements._elements.primType),"offset"in fn&&(br.offset=fn.offset|0),"count"in fn&&(br.count=fn.count|0),"instances"in fn&&(br.instances=fn.instances|0),"primitive"in fn&&(ie(fn.primitive in wr,"bad primitive type: "+fn.primitive),br.primitive=wr[fn.primitive]),ie.optional(()=>{for(var So=Object.keys(fn),Mo=0;Mo<So.length;++Mo)ie(ze.indexOf(So[Mo])>=0,'invalid option for vao: "'+So[Mo]+'" valid options are '+ze)}),ie(Array.isArray($r),"attributes must be an array")}ie($r.length<Fr,"too many attributes"),ie($r.length>0,"must specify at least one attribute");var En={},Ni=br.attributes;Ni.length=$r.length;for(var ki=0;ki<$r.length;++ki){var Tn=$r[ki],Cn=Ni[ki]=new ot,xi=Tn.data||Tn;if(Array.isArray(xi)||C(xi)||lt(xi)){var Di;br.buffers[ki]&&(Di=br.buffers[ki],C(xi)&&Di._buffer.byteLength>=xi.byteLength?Di.subdata(xi):(Di.destroy(),br.buffers[ki]=null)),br.buffers[ki]||(Di=br.buffers[ki]=Mr.create(Tn,je,!1,!0)),Cn.buffer=Mr.getBuffer(Di),Cn.size=Cn.buffer.dimension|0,Cn.normalized=!1,Cn.type=Cn.buffer.dtype,Cn.offset=0,Cn.stride=0,Cn.divisor=0,Cn.state=1,En[ki]=1}else Mr.getBuffer(Tn)?(Cn.buffer=Mr.getBuffer(Tn),Cn.size=Cn.buffer.dimension|0,Cn.normalized=!1,Cn.type=Cn.buffer.dtype,Cn.offset=0,Cn.stride=0,Cn.divisor=0,Cn.state=1):Mr.getBuffer(Tn.buffer)?(Cn.buffer=Mr.getBuffer(Tn.buffer),Cn.size=(+Tn.size||Cn.buffer.dimension)|0,Cn.normalized=!!Tn.normalized||!1,"type"in Tn?(ie.parameter(Tn.type,Ps,"invalid buffer type"),Cn.type=Ps[Tn.type]):Cn.type=Cn.buffer.dtype,Cn.offset=(Tn.offset||0)|0,Cn.stride=(Tn.stride||0)|0,Cn.divisor=(Tn.divisor||0)|0,Cn.state=1,ie(Cn.size>=1&&Cn.size<=4,"size must be between 1 and 4"),ie(Cn.offset>=0,"invalid offset"),ie(Cn.stride>=0&&Cn.stride<=255,"stride must be between 0 and 255"),ie(Cn.divisor>=0,"divisor must be positive"),ie(!Cn.divisor||!!Me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Tn?(ie(ki>0,"first attribute must not be a constant"),Cn.x=+Tn.x||0,Cn.y=+Tn.y||0,Cn.z=+Tn.z||0,Cn.w=+Tn.w||0,Cn.state=2):ie(!1,"invalid attribute spec for location "+ki)}for(var ia=0;ia<br.buffers.length;++ia)!En[ia]&&br.buffers[ia]&&(br.buffers[ia].destroy(),br.buffers[ia]=null);return br.refresh(),Xn}return Xn.destroy=function(){for(var fn=0;fn<br.buffers.length;++fn)br.buffers[fn]&&br.buffers[fn].destroy();br.buffers.length=0,br.ownsElements&&(br.elements.destroy(),br.elements=null,br.ownsElements=!1),br.destroy()},Xn._vao=br,Xn._reglType="vao",Xn(Ar)}return pn}var Zt=35632,fr=35633,ur=35718,gr=35721;function Nr(V,Me,$e,ir){var Mr={},rr={};function Er(Rt,pr,Yr,wn){this.name=Rt,this.id=pr,this.location=Yr,this.info=wn}function Fr(Rt,pr){for(var Yr=0;Yr<Rt.length;++Yr)if(Rt[Yr].id===pr.id){Rt[Yr].location=pr.location;return}Rt.push(pr)}function Gr(Rt,pr,Yr){var wn=Rt===Zt?Mr:rr,Tr=wn[pr];if(!Tr){var Sn=Me.str(pr);Tr=V.createShader(Rt),V.shaderSource(Tr,Sn),V.compileShader(Tr),ie.shaderError(V,Tr,Sn,Rt,Yr),wn[pr]=Tr}return Tr}var Kr={},Qr=[],en=0;function pn(Rt,pr){this.id=en++,this.fragId=Rt,this.vertId=pr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ir.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Wr(Rt,pr,Yr){var wn,Tr,Sn=Gr(Zt,Rt.fragId),rn=Gr(fr,Rt.vertId),ui=Rt.program=V.createProgram();if(V.attachShader(ui,Sn),V.attachShader(ui,rn),Yr)for(wn=0;wn<Yr.length;++wn){var Ar=Yr[wn];V.bindAttribLocation(ui,Ar[0],Ar[1])}V.linkProgram(ui),ie.linkError(V,ui,Me.str(Rt.fragId),Me.str(Rt.vertId),pr);var br=V.getProgramParameter(ui,ur);ir.profile&&(Rt.stats.uniformsCount=br);var Xn=Rt.uniforms;for(wn=0;wn<br;++wn)if(Tr=V.getActiveUniform(ui,wn),Tr)if(Tr.size>1)for(var fn=0;fn<Tr.size;++fn){var $r=Tr.name.replace("[0]","["+fn+"]");Fr(Xn,new Er($r,Me.id($r),V.getUniformLocation(ui,$r),Tr))}else Fr(Xn,new Er(Tr.name,Me.id(Tr.name),V.getUniformLocation(ui,Tr.name),Tr));var gn=V.getProgramParameter(ui,gr);ir.profile&&(Rt.stats.attributesCount=gn);var En=Rt.attributes;for(wn=0;wn<gn;++wn)Tr=V.getActiveAttrib(ui,wn),Tr&&Fr(En,new Er(Tr.name,Me.id(Tr.name),V.getAttribLocation(ui,Tr.name),Tr))}ir.profile&&($e.getMaxUniformsCount=function(){var Rt=0;return Qr.forEach(function(pr){pr.stats.uniformsCount>Rt&&(Rt=pr.stats.uniformsCount)}),Rt},$e.getMaxAttributesCount=function(){var Rt=0;return Qr.forEach(function(pr){pr.stats.attributesCount>Rt&&(Rt=pr.stats.attributesCount)}),Rt});function qr(){Mr={},rr={};for(var Rt=0;Rt<Qr.length;++Rt)Wr(Qr[Rt],null,Qr[Rt].attributes.map(function(pr){return[pr.location,pr.name]}))}return{clear:function(){var Rt=V.deleteShader.bind(V);Xt(Mr).forEach(Rt),Mr={},Xt(rr).forEach(Rt),rr={},Qr.forEach(function(pr){V.deleteProgram(pr.program)}),Qr.length=0,Kr={},$e.shaderCount=0},program:function(Rt,pr,Yr,wn){ie.command(Rt>=0,"missing vertex shader",Yr),ie.command(pr>=0,"missing fragment shader",Yr);var Tr=Kr[pr];Tr||(Tr=Kr[pr]={});var Sn=Tr[Rt];if(Sn&&(Sn.refCount++,!wn))return Sn;var rn=new pn(pr,Rt);return $e.shaderCount++,Wr(rn,Yr,wn),Sn||(Tr[Rt]=rn),Qr.push(rn),d(rn,{destroy:function(){if(rn.refCount--,rn.refCount<=0){V.deleteProgram(rn.program);var ui=Qr.indexOf(rn);Qr.splice(ui,1),$e.shaderCount--}Tr[rn.vertId].refCount<=0&&(V.deleteShader(rr[rn.vertId]),delete rr[rn.vertId],delete Kr[rn.fragId][rn.vertId]),Object.keys(Kr[rn.fragId]).length||(V.deleteShader(Mr[rn.fragId]),delete Mr[rn.fragId],delete Kr[rn.fragId])}})},restore:qr,shader:Gr,frag:-1,vert:-1}}var an=6408,Hr=5121,Rn=3333,ri=5126;function hi(V,Me,$e,ir,Mr,rr,Er){function Fr(Qr){var en;Me.next===null?(ie(Mr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),en=Hr):(ie(Me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),en=Me.next.colorAttachments[0].texture._texture.type,ie.optional(function(){rr.oes_texture_float?(ie(en===Hr||en===ri,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),en===ri&&ie(Er.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ie(en===Hr,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var pn=0,Wr=0,qr=ir.framebufferWidth,Rt=ir.framebufferHeight,pr=null;C(Qr)?pr=Qr:Qr&&(ie.type(Qr,"object","invalid arguments to regl.read()"),pn=Qr.x|0,Wr=Qr.y|0,ie(pn>=0&&pn<ir.framebufferWidth,"invalid x offset for regl.read"),ie(Wr>=0&&Wr<ir.framebufferHeight,"invalid y offset for regl.read"),qr=(Qr.width||ir.framebufferWidth-pn)|0,Rt=(Qr.height||ir.framebufferHeight-Wr)|0,pr=Qr.data||null),pr&&(en===Hr?ie(pr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):en===ri&&ie(pr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ie(qr>0&&qr+pn<=ir.framebufferWidth,"invalid width for read pixels"),ie(Rt>0&&Rt+Wr<=ir.framebufferHeight,"invalid height for read pixels"),$e();var Yr=qr*Rt*4;return pr||(en===Hr?pr=new Uint8Array(Yr):en===ri&&(pr=pr||new Float32Array(Yr))),ie.isTypedArray(pr,"data buffer for regl.read() must be a typedarray"),ie(pr.byteLength>=Yr,"data buffer for regl.read() too small"),V.pixelStorei(Rn,4),V.readPixels(pn,Wr,qr,Rt,an,en,pr),pr}function Gr(Qr){var en;return Me.setFBO({framebuffer:Qr.framebuffer},function(){en=Fr(Qr)}),en}function Kr(Qr){return!Qr||!("framebuffer"in Qr)?Fr(Qr):Gr(Qr)}return Kr}function ni(V){return Array.prototype.slice.call(V)}function ea(V){return ni(V).join("")}function Un(){var V=0,Me=[],$e=[];function ir(en){for(var pn=0;pn<$e.length;++pn)if($e[pn]===en)return Me[pn];var Wr="g"+V++;return Me.push(Wr),$e.push(en),Wr}function Mr(){var en=[];function pn(){en.push.apply(en,ni(arguments))}var Wr=[];function qr(){var Rt="v"+V++;return Wr.push(Rt),arguments.length>0&&(en.push(Rt,"="),en.push.apply(en,ni(arguments)),en.push(";")),Rt}return d(pn,{def:qr,toString:function(){return ea([Wr.length>0?"var "+Wr.join(",")+";":"",ea(en)])}})}function rr(){var en=Mr(),pn=Mr(),Wr=en.toString,qr=pn.toString;function Rt(pr,Yr){pn(pr,Yr,"=",en.def(pr,Yr),";")}return d(function(){en.apply(en,ni(arguments))},{def:en.def,entry:en,exit:pn,save:Rt,set:function(pr,Yr,wn){Rt(pr,Yr),en(pr,Yr,"=",wn,";")},toString:function(){return Wr()+qr()}})}function Er(){var en=ea(arguments),pn=rr(),Wr=rr(),qr=pn.toString,Rt=Wr.toString;return d(pn,{then:function(){return pn.apply(pn,ni(arguments)),this},else:function(){return Wr.apply(Wr,ni(arguments)),this},toString:function(){var pr=Rt();return pr&&(pr="else{"+pr+"}"),ea(["if(",en,"){",qr(),"}",pr])}})}var Fr=Mr(),Gr={};function Kr(en,pn){var Wr=[];function qr(){var Tr="a"+Wr.length;return Wr.push(Tr),Tr}pn=pn||0;for(var Rt=0;Rt<pn;++Rt)qr();var pr=rr(),Yr=pr.toString,wn=Gr[en]=d(pr,{arg:qr,toString:function(){return ea(["function(",Wr.join(),"){",Yr(),"}"])}});return wn}function Qr(){var en=['"use strict";',Fr,"return {"];Object.keys(Gr).forEach(function(Rt){en.push('"',Rt,'":',Gr[Rt].toString(),",")}),en.push("}");var pn=ea(en).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Wr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",qr=Wr?le.Function.apply(null,Me.concat(pn)):Function.apply(null,Me.concat(pn));return qr.apply(null,$e)}return{global:Fr,link:ir,block:Mr,proc:Kr,scope:rr,cond:Er,compile:Qr}}var gi="xyzw".split(""),te=5121,q=1,R=2,F=0,re=1,pe=2,dt=3,wt=4,At=5,qt=6,Pr="dither",mn="blend.enable",Zn="blend.color",Jn="blend.equation",_i="blend.func",si="depth.enable",ji="depth.func",$i="depth.range",xa="depth.mask",ao="colorMask",La="cull.enable",co="cull.face",Ga="frontFace",ta="lineWidth",va="polygonOffset.enable",za="polygonOffset.offset",fa="sample.alpha",Ta="sample.enable",bo="sample.coverage",Fo="stencil.enable",ua="stencil.mask",Zo="stencil.func",fo="stencil.opFront",qs="stencil.opBack",wc="scissor.enable",Nl="scissor.box",qu="viewport",fu="profile",zl="framebuffer",Zs="vert",ml="frag",yl="elements",hu="primitive",Po="count",ef="offset",tf="instances",hf="vao",Ff="Width",eu="Height",rf=zl+Ff,Cc=zl+eu,dp=qu+Ff,Ul=qu+eu,nh="drawingBuffer",Ac=nh+Ff,pf=nh+eu,Hp=[_i,Jn,Zo,fo,qs,bo,qu,Nl,za],df=34962,Ph=34963,Wp=35632,vp=35633,ih=3553,Mh=34067,Bf=2884,Ih=3042,nf=3024,Oh=2960,as=2929,Nf=3089,Lh=32823,ah=32926,oh=32928,af=5126,zf=35664,Uf=35665,gl=35666,Zf=5124,of=35667,sh=35668,Tc=35669,Rh=35670,vf=35671,mf=35672,yf=35673,Zl=35674,bu=35675,gf=35676,jf=35678,_f=35680,kh=4,xf=1028,_l=1029,uh=2304,Vf=2305,Dh=32775,lh=32776,mp=519,Pc=7680,jc=0,Fh=1,bf=32774,sf=513,Uu=36160,yp=36064,jl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Bh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],xl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ac={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Nh={frag:Wp,vert:vp},ch={cw:uh,ccw:Vf};function Sf(V){return Array.isArray(V)||C(V)||lt(V)}function fh(V){return V.sort(function(Me,$e){return Me===qu?-1:$e===qu?1:Me<$e?-1:1})}function vs(V,Me,$e,ir){this.thisDep=V,this.contextDep=Me,this.propDep=$e,this.append=ir}function jo(V){return V&&!(V.thisDep||V.contextDep||V.propDep)}function os(V){return new vs(!1,!1,!1,V)}function pu(V,Me){var $e=V.type;if($e===F){var ir=V.data.length;return new vs(!0,ir>=1,ir>=2,Me)}else if($e===wt){var Mr=V.data;return new vs(Mr.thisDep,Mr.contextDep,Mr.propDep,Me)}else{if($e===At)return new vs(!1,!1,!1,Me);if($e===qt){for(var rr=!1,Er=!1,Fr=!1,Gr=0;Gr<V.data.length;++Gr){var Kr=V.data[Gr];if(Kr.type===re)Fr=!0;else if(Kr.type===pe)Er=!0;else if(Kr.type===dt)rr=!0;else if(Kr.type===F){rr=!0;var Qr=Kr.data;Qr>=1&&(Er=!0),Qr>=2&&(Fr=!0)}else Kr.type===wt&&(rr=rr||Kr.data.thisDep,Er=Er||Kr.data.contextDep,Fr=Fr||Kr.data.propDep)}return new vs(rr,Er,Fr,Me)}else return new vs($e===dt,$e===pe,$e===re,Me)}}var hh=new vs(!1,!1,!1,function(){});function zh(V,Me,$e,ir,Mr,rr,Er,Fr,Gr,Kr,Qr,en,pn,Wr,qr){var Rt=Kr.Record,pr={add:32774,subtract:32778,"reverse subtract":32779};$e.ext_blend_minmax&&(pr.min=Dh,pr.max=lh);var Yr=$e.angle_instanced_arrays,wn=$e.webgl_draw_buffers,Tr=$e.oes_vertex_array_object,Sn={dirty:!0,profile:qr.profile},rn={},ui=[],Ar={},br={};function Xn(De){return De.replace(".","_")}function fn(De,be,tt){var kt=Xn(De);ui.push(De),rn[kt]=Sn[kt]=!!tt,Ar[kt]=be}function $r(De,be,tt){var kt=Xn(De);ui.push(De),Array.isArray(tt)?(Sn[kt]=tt.slice(),rn[kt]=tt.slice()):Sn[kt]=rn[kt]=tt,br[kt]=be}fn(Pr,nf),fn(mn,Ih),$r(Zn,"blendColor",[0,0,0,0]),$r(Jn,"blendEquationSeparate",[bf,bf]),$r(_i,"blendFuncSeparate",[Fh,jc,Fh,jc]),fn(si,as,!0),$r(ji,"depthFunc",sf),$r($i,"depthRange",[0,1]),$r(xa,"depthMask",!0),$r(ao,ao,[!0,!0,!0,!0]),fn(La,Bf),$r(co,"cullFace",_l),$r(Ga,Ga,Vf),$r(ta,ta,1),fn(va,Lh),$r(za,"polygonOffset",[0,0]),fn(fa,ah),fn(Ta,oh),$r(bo,"sampleCoverage",[1,!1]),fn(Fo,Oh),$r(ua,"stencilMask",-1),$r(Zo,"stencilFunc",[mp,0,-1]),$r(fo,"stencilOpSeparate",[xf,Pc,Pc,Pc]),$r(qs,"stencilOpSeparate",[_l,Pc,Pc,Pc]),fn(wc,Nf),$r(Nl,"scissor",[0,0,V.drawingBufferWidth,V.drawingBufferHeight]),$r(qu,qu,[0,0,V.drawingBufferWidth,V.drawingBufferHeight]);var gn={gl:V,context:pn,strings:Me,next:rn,current:Sn,draw:en,elements:rr,buffer:Mr,shader:Qr,attributes:Kr.state,vao:Kr,uniforms:Gr,framebuffer:Fr,extensions:$e,timer:Wr,isBufferArgs:Sf},En={primTypes:wr,compareFuncs:xl,blendFuncs:jl,blendEquations:pr,stencilOps:ac,glTypes:Ps,orientationType:ch};ie.optional(function(){gn.isArrayLike=io}),wn&&(En.backBuffer=[_l],En.drawBuffer=me(ir.maxDrawbuffers,function(De){return De===0?[0]:me(De,function(be){return yp+be})}));var Ni=0;function ki(){var De=Un(),be=De.link,tt=De.global;De.id=Ni++,De.batchId="0";var kt=be(gn),or=De.shared={props:"a0"};Object.keys(gn).forEach(function(at){or[at]=tt.def(kt,".",at)}),ie.optional(function(){De.CHECK=be(ie),De.commandStr=ie.guessCommand(),De.command=be(De.commandStr),De.assert=function(at,Be,It){at("if(!(",Be,"))",this.CHECK,".commandRaise(",be(It),",",this.command,");")},En.invalidBlendCombinations=Bh});var mt=De.next={},ut=De.current={};Object.keys(br).forEach(function(at){Array.isArray(Sn[at])&&(mt[at]=tt.def(or.next,".",at),ut[at]=tt.def(or.current,".",at))});var et=De.constants={};Object.keys(En).forEach(function(at){et[at]=tt.def(JSON.stringify(En[at]))}),De.invoke=function(at,Be){switch(Be.type){case F:var It=["this",or.context,or.props,De.batchId];return at.def(be(Be.data),".call(",It.slice(0,Math.max(Be.data.length+1,4)),")");case re:return at.def(or.props,Be.data);case pe:return at.def(or.context,Be.data);case dt:return at.def("this",Be.data);case wt:return Be.data.append(De,at),Be.data.ref;case At:return Be.data.toString();case qt:return Be.data.map(function(Ht){return De.invoke(at,Ht)})}},De.attribCache={};var Ie={};return De.scopeAttrib=function(at){var Be=Me.id(at);if(Be in Ie)return Ie[Be];var It=Kr.scope[Be];It||(It=Kr.scope[Be]=new Rt);var Ht=Ie[Be]=be(It);return Ht},De}function Tn(De){var be=De.static,tt=De.dynamic,kt;if(fu in be){var or=!!be[fu];kt=os(function(ut,et){return or}),kt.enable=or}else if(fu in tt){var mt=tt[fu];kt=pu(mt,function(ut,et){return ut.invoke(et,mt)})}return kt}function Cn(De,be){var tt=De.static,kt=De.dynamic;if(zl in tt){var or=tt[zl];return or?(or=Fr.getFramebuffer(or),ie.command(or,"invalid framebuffer object"),os(function(ut,et){var Ie=ut.link(or),at=ut.shared;et.set(at.framebuffer,".next",Ie);var Be=at.context;return et.set(Be,"."+rf,Ie+".width"),et.set(Be,"."+Cc,Ie+".height"),Ie})):os(function(ut,et){var Ie=ut.shared;et.set(Ie.framebuffer,".next","null");var at=Ie.context;return et.set(at,"."+rf,at+"."+Ac),et.set(at,"."+Cc,at+"."+pf),"null"})}else if(zl in kt){var mt=kt[zl];return pu(mt,function(ut,et){var Ie=ut.invoke(et,mt),at=ut.shared,Be=at.framebuffer,It=et.def(Be,".getFramebuffer(",Ie,")");ie.optional(function(){ut.assert(et,"!"+Ie+"||"+It,"invalid framebuffer object")}),et.set(Be,".next",It);var Ht=at.context;return et.set(Ht,"."+rf,It+"?"+It+".width:"+Ht+"."+Ac),et.set(Ht,"."+Cc,It+"?"+It+".height:"+Ht+"."+pf),It})}else return null}function xi(De,be,tt){var kt=De.static,or=De.dynamic;function mt(Ie){if(Ie in kt){var at=kt[Ie];ie.commandType(at,"object","invalid "+Ie,tt.commandStr);var Be=!0,It=at.x|0,Ht=at.y|0,Dr,hn;return"width"in at?(Dr=at.width|0,ie.command(Dr>=0,"invalid "+Ie,tt.commandStr)):Be=!1,"height"in at?(hn=at.height|0,ie.command(hn>=0,"invalid "+Ie,tt.commandStr)):Be=!1,new vs(!Be&&be&&be.thisDep,!Be&&be&&be.contextDep,!Be&&be&&be.propDep,function(sn,Kn){var In=sn.shared.context,Gn=Dr;"width"in at||(Gn=Kn.def(In,".",rf,"-",It));var An=hn;return"height"in at||(An=Kn.def(In,".",Cc,"-",Ht)),[It,Ht,Gn,An]})}else if(Ie in or){var cn=or[Ie],Pn=pu(cn,function(sn,Kn){var In=sn.invoke(Kn,cn);ie.optional(function(){sn.assert(Kn,In+"&&typeof "+In+'==="object"',"invalid "+Ie)});var Gn=sn.shared.context,An=Kn.def(In,".x|0"),jn=Kn.def(In,".y|0"),pi=Kn.def('"width" in ',In,"?",In,".width|0:","(",Gn,".",rf,"-",An,")"),Ja=Kn.def('"height" in ',In,"?",In,".height|0:","(",Gn,".",Cc,"-",jn,")");return ie.optional(function(){sn.assert(Kn,pi+">=0&&"+Ja+">=0","invalid "+Ie)}),[An,jn,pi,Ja]});return be&&(Pn.thisDep=Pn.thisDep||be.thisDep,Pn.contextDep=Pn.contextDep||be.contextDep,Pn.propDep=Pn.propDep||be.propDep),Pn}else return be?new vs(be.thisDep,be.contextDep,be.propDep,function(sn,Kn){var In=sn.shared.context;return[0,0,Kn.def(In,".",rf),Kn.def(In,".",Cc)]}):null}var ut=mt(qu);if(ut){var et=ut;ut=new vs(ut.thisDep,ut.contextDep,ut.propDep,function(Ie,at){var Be=et.append(Ie,at),It=Ie.shared.context;return at.set(It,"."+dp,Be[2]),at.set(It,"."+Ul,Be[3]),Be})}return{viewport:ut,scissor_box:mt(Nl)}}function Di(De,be){var tt=De.static,kt=typeof tt[ml]=="string"&&typeof tt[Zs]=="string";if(kt){if(Object.keys(be.dynamic).length>0)return null;var or=be.static,mt=Object.keys(or);if(mt.length>0&&typeof or[mt[0]]=="number"){for(var ut=[],et=0;et<mt.length;++et)ie(typeof or[mt[et]]=="number","must specify all vertex attribute locations when using vaos"),ut.push([or[mt[et]]|0,mt[et]]);return ut}}return null}function ia(De,be,tt){var kt=De.static,or=De.dynamic;function mt(Be){if(Be in kt){var It=Me.id(kt[Be]);ie.optional(function(){Qr.shader(Nh[Be],It,ie.guessCommand())});var Ht=os(function(){return It});return Ht.id=It,Ht}else if(Be in or){var Dr=or[Be];return pu(Dr,function(hn,cn){var Pn=hn.invoke(cn,Dr),sn=cn.def(hn.shared.strings,".id(",Pn,")");return ie.optional(function(){cn(hn.shared.shader,".shader(",Nh[Be],",",sn,",",hn.command,");")}),sn})}return null}var ut=mt(ml),et=mt(Zs),Ie=null,at;return jo(ut)&&jo(et)?(Ie=Qr.program(et.id,ut.id,null,tt),at=os(function(Be,It){return Be.link(Ie)})):at=new vs(ut&&ut.thisDep||et&&et.thisDep,ut&&ut.contextDep||et&&et.contextDep,ut&&ut.propDep||et&&et.propDep,function(Be,It){var Ht=Be.shared.shader,Dr;ut?Dr=ut.append(Be,It):Dr=It.def(Ht,".",ml);var hn;et?hn=et.append(Be,It):hn=It.def(Ht,".",Zs);var cn=Ht+".program("+hn+","+Dr;return ie.optional(function(){cn+=","+Be.command}),It.def(cn+")")}),{frag:ut,vert:et,progVar:at,program:Ie}}function So(De,be){var tt=De.static,kt=De.dynamic,or={},mt=!1;function ut(){if(hf in tt){var Kn=tt[hf];return Kn!==null&&Kr.getVAO(Kn)===null&&(Kn=Kr.createVAO(Kn)),mt=!0,or.vao=Kn,os(function(Gn){var An=Kr.getVAO(Kn);return An?Gn.link(An):"null"})}else if(hf in kt){mt=!0;var In=kt[hf];return pu(In,function(Gn,An){var jn=Gn.invoke(An,In);return An.def(Gn.shared.vao+".getVAO("+jn+")")})}return null}var et=ut(),Ie=!1;function at(){if(yl in tt){var Kn=tt[yl];if(or.elements=Kn,Sf(Kn)){var In=or.elements=rr.create(Kn,!0);Kn=rr.getElements(In),Ie=!0}else Kn&&(Kn=rr.getElements(Kn),Ie=!0,ie.command(Kn,"invalid elements",be.commandStr));var Gn=os(function(jn,pi){if(Kn){var Ja=jn.link(Kn);return jn.ELEMENTS=Ja,Ja}return jn.ELEMENTS=null,null});return Gn.value=Kn,Gn}else if(yl in kt){Ie=!0;var An=kt[yl];return pu(An,function(jn,pi){var Ja=jn.shared,Ho=Ja.isBufferArgs,Zu=Ja.elements,Ha=jn.invoke(pi,An),Pa=pi.def("null"),js=pi.def(Ho,"(",Ha,")"),Su=jn.cond(js).then(Pa,"=",Zu,".createStream(",Ha,");").else(Pa,"=",Zu,".getElements(",Ha,");");return ie.optional(function(){jn.assert(Su.else,"!"+Ha+"||"+Pa,"invalid elements")}),pi.entry(Su),pi.exit(jn.cond(js).then(Zu,".destroyStream(",Pa,");")),jn.ELEMENTS=Pa,Pa})}else if(mt)return new vs(et.thisDep,et.contextDep,et.propDep,function(jn,pi){return pi.def(jn.shared.vao+".currentVAO?"+jn.shared.elements+".getElements("+jn.shared.vao+".currentVAO.elements):null")});return null}var Be=at();function It(){if(hu in tt){var Kn=tt[hu];return or.primitive=Kn,ie.commandParameter(Kn,wr,"invalid primitve",be.commandStr),os(function(Gn,An){return wr[Kn]})}else if(hu in kt){var In=kt[hu];return pu(In,function(Gn,An){var jn=Gn.constants.primTypes,pi=Gn.invoke(An,In);return ie.optional(function(){Gn.assert(An,pi+" in "+jn,"invalid primitive, must be one of "+Object.keys(wr))}),An.def(jn,"[",pi,"]")})}else{if(Ie)return jo(Be)?Be.value?os(function(Gn,An){return An.def(Gn.ELEMENTS,".primType")}):os(function(){return kh}):new vs(Be.thisDep,Be.contextDep,Be.propDep,function(Gn,An){var jn=Gn.ELEMENTS;return An.def(jn,"?",jn,".primType:",kh)});if(mt)return new vs(et.thisDep,et.contextDep,et.propDep,function(Gn,An){return An.def(Gn.shared.vao+".currentVAO?"+Gn.shared.vao+".currentVAO.primitive:"+kh)})}return null}function Ht(Kn,In){if(Kn in tt){var Gn=tt[Kn]|0;return In?or.offset=Gn:or.instances=Gn,ie.command(!In||Gn>=0,"invalid "+Kn,be.commandStr),os(function(jn,pi){return In&&(jn.OFFSET=Gn),Gn})}else if(Kn in kt){var An=kt[Kn];return pu(An,function(jn,pi){var Ja=jn.invoke(pi,An);return In&&(jn.OFFSET=Ja,ie.optional(function(){jn.assert(pi,Ja+">=0","invalid "+Kn)})),Ja})}else if(In){if(Ie)return os(function(jn,pi){return jn.OFFSET=0,0});if(mt)return new vs(et.thisDep,et.contextDep,et.propDep,function(jn,pi){return pi.def(jn.shared.vao+".currentVAO?"+jn.shared.vao+".currentVAO.offset:0")})}else if(mt)return new vs(et.thisDep,et.contextDep,et.propDep,function(jn,pi){return pi.def(jn.shared.vao+".currentVAO?"+jn.shared.vao+".currentVAO.instances:-1")});return null}var Dr=Ht(ef,!0);function hn(){if(Po in tt){var Kn=tt[Po]|0;return or.count=Kn,ie.command(typeof Kn=="number"&&Kn>=0,"invalid vertex count",be.commandStr),os(function(){return Kn})}else if(Po in kt){var In=kt[Po];return pu(In,function(pi,Ja){var Ho=pi.invoke(Ja,In);return ie.optional(function(){pi.assert(Ja,"typeof "+Ho+'==="number"&&'+Ho+">=0&&"+Ho+"===("+Ho+"|0)","invalid vertex count")}),Ho})}else if(Ie)if(jo(Be)){if(Be)return Dr?new vs(Dr.thisDep,Dr.contextDep,Dr.propDep,function(pi,Ja){var Ho=Ja.def(pi.ELEMENTS,".vertCount-",pi.OFFSET);return ie.optional(function(){pi.assert(Ja,Ho+">=0","invalid vertex offset/element buffer too small")}),Ho}):os(function(pi,Ja){return Ja.def(pi.ELEMENTS,".vertCount")});var Gn=os(function(){return-1});return ie.optional(function(){Gn.MISSING=!0}),Gn}else{var An=new vs(Be.thisDep||Dr.thisDep,Be.contextDep||Dr.contextDep,Be.propDep||Dr.propDep,function(pi,Ja){var Ho=pi.ELEMENTS;return pi.OFFSET?Ja.def(Ho,"?",Ho,".vertCount-",pi.OFFSET,":-1"):Ja.def(Ho,"?",Ho,".vertCount:-1")});return ie.optional(function(){An.DYNAMIC=!0}),An}else if(mt){var jn=new vs(et.thisDep,et.contextDep,et.propDep,function(pi,Ja){return Ja.def(pi.shared.vao,".currentVAO?",pi.shared.vao,".currentVAO.count:-1")});return jn}return null}var cn=It(),Pn=hn(),sn=Ht(tf,!1);return{elements:Be,primitive:cn,count:Pn,instances:sn,offset:Dr,vao:et,vaoActive:mt,elementsActive:Ie,static:or}}function Mo(De,be){var tt=De.static,kt=De.dynamic,or={};return ui.forEach(function(mt){var ut=Xn(mt);function et(Ie,at){if(mt in tt){var Be=Ie(tt[mt]);or[ut]=os(function(){return Be})}else if(mt in kt){var It=kt[mt];or[ut]=pu(It,function(Ht,Dr){return at(Ht,Dr,Ht.invoke(Dr,It))})}}switch(mt){case La:case mn:case Pr:case Fo:case si:case wc:case va:case fa:case Ta:case xa:return et(function(Ie){return ie.commandType(Ie,"boolean",mt,be.commandStr),Ie},function(Ie,at,Be){return ie.optional(function(){Ie.assert(at,"typeof "+Be+'==="boolean"',"invalid flag "+mt,Ie.commandStr)}),Be});case ji:return et(function(Ie){return ie.commandParameter(Ie,xl,"invalid "+mt,be.commandStr),xl[Ie]},function(Ie,at,Be){var It=Ie.constants.compareFuncs;return ie.optional(function(){Ie.assert(at,Be+" in "+It,"invalid "+mt+", must be one of "+Object.keys(xl))}),at.def(It,"[",Be,"]")});case $i:return et(function(Ie){return ie.command(io(Ie)&&Ie.length===2&&typeof Ie[0]=="number"&&typeof Ie[1]=="number"&&Ie[0]<=Ie[1],"depth range is 2d array",be.commandStr),Ie},function(Ie,at,Be){ie.optional(function(){Ie.assert(at,Ie.shared.isArrayLike+"("+Be+")&&"+Be+".length===2&&typeof "+Be+'[0]==="number"&&typeof '+Be+'[1]==="number"&&'+Be+"[0]<="+Be+"[1]","depth range must be a 2d array")});var It=at.def("+",Be,"[0]"),Ht=at.def("+",Be,"[1]");return[It,Ht]});case _i:return et(function(Ie){ie.commandType(Ie,"object","blend.func",be.commandStr);var at="srcRGB"in Ie?Ie.srcRGB:Ie.src,Be="srcAlpha"in Ie?Ie.srcAlpha:Ie.src,It="dstRGB"in Ie?Ie.dstRGB:Ie.dst,Ht="dstAlpha"in Ie?Ie.dstAlpha:Ie.dst;return ie.commandParameter(at,jl,ut+".srcRGB",be.commandStr),ie.commandParameter(Be,jl,ut+".srcAlpha",be.commandStr),ie.commandParameter(It,jl,ut+".dstRGB",be.commandStr),ie.commandParameter(Ht,jl,ut+".dstAlpha",be.commandStr),ie.command(Bh.indexOf(at+", "+It)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+at+", "+It+")",be.commandStr),[jl[at],jl[It],jl[Be],jl[Ht]]},function(Ie,at,Be){var It=Ie.constants.blendFuncs;ie.optional(function(){Ie.assert(at,Be+"&&typeof "+Be+'==="object"',"invalid blend func, must be an object")});function Ht(In,Gn){var An=at.def('"',In,Gn,'" in ',Be,"?",Be,".",In,Gn,":",Be,".",In);return ie.optional(function(){Ie.assert(at,An+" in "+It,"invalid "+mt+"."+In+Gn+", must be one of "+Object.keys(jl))}),An}var Dr=Ht("src","RGB"),hn=Ht("dst","RGB");ie.optional(function(){var In=Ie.constants.invalidBlendCombinations;Ie.assert(at,In+".indexOf("+Dr+'+", "+'+hn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var cn=at.def(It,"[",Dr,"]"),Pn=at.def(It,"[",Ht("src","Alpha"),"]"),sn=at.def(It,"[",hn,"]"),Kn=at.def(It,"[",Ht("dst","Alpha"),"]");return[cn,sn,Pn,Kn]});case Jn:return et(function(Ie){if(typeof Ie=="string")return ie.commandParameter(Ie,pr,"invalid "+mt,be.commandStr),[pr[Ie],pr[Ie]];if(typeof Ie=="object")return ie.commandParameter(Ie.rgb,pr,mt+".rgb",be.commandStr),ie.commandParameter(Ie.alpha,pr,mt+".alpha",be.commandStr),[pr[Ie.rgb],pr[Ie.alpha]];ie.commandRaise("invalid blend.equation",be.commandStr)},function(Ie,at,Be){var It=Ie.constants.blendEquations,Ht=at.def(),Dr=at.def(),hn=Ie.cond("typeof ",Be,'==="string"');return ie.optional(function(){function cn(Pn,sn,Kn){Ie.assert(Pn,Kn+" in "+It,"invalid "+sn+", must be one of "+Object.keys(pr))}cn(hn.then,mt,Be),Ie.assert(hn.else,Be+"&&typeof "+Be+'==="object"',"invalid "+mt),cn(hn.else,mt+".rgb",Be+".rgb"),cn(hn.else,mt+".alpha",Be+".alpha")}),hn.then(Ht,"=",Dr,"=",It,"[",Be,"];"),hn.else(Ht,"=",It,"[",Be,".rgb];",Dr,"=",It,"[",Be,".alpha];"),at(hn),[Ht,Dr]});case Zn:return et(function(Ie){return ie.command(io(Ie)&&Ie.length===4,"blend.color must be a 4d array",be.commandStr),me(4,function(at){return+Ie[at]})},function(Ie,at,Be){return ie.optional(function(){Ie.assert(at,Ie.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","blend.color must be a 4d array")}),me(4,function(It){return at.def("+",Be,"[",It,"]")})});case ua:return et(function(Ie){return ie.commandType(Ie,"number",ut,be.commandStr),Ie|0},function(Ie,at,Be){return ie.optional(function(){Ie.assert(at,"typeof "+Be+'==="number"',"invalid stencil.mask")}),at.def(Be,"|0")});case Zo:return et(function(Ie){ie.commandType(Ie,"object",ut,be.commandStr);var at=Ie.cmp||"keep",Be=Ie.ref||0,It="mask"in Ie?Ie.mask:-1;return ie.commandParameter(at,xl,mt+".cmp",be.commandStr),ie.commandType(Be,"number",mt+".ref",be.commandStr),ie.commandType(It,"number",mt+".mask",be.commandStr),[xl[at],Be,It]},function(Ie,at,Be){var It=Ie.constants.compareFuncs;ie.optional(function(){function cn(){Ie.assert(at,Array.prototype.join.call(arguments,""),"invalid stencil.func")}cn(Be+"&&typeof ",Be,'==="object"'),cn('!("cmp" in ',Be,")||(",Be,".cmp in ",It,")")});var Ht=at.def('"cmp" in ',Be,"?",It,"[",Be,".cmp]",":",Pc),Dr=at.def(Be,".ref|0"),hn=at.def('"mask" in ',Be,"?",Be,".mask|0:-1");return[Ht,Dr,hn]});case fo:case qs:return et(function(Ie){ie.commandType(Ie,"object",ut,be.commandStr);var at=Ie.fail||"keep",Be=Ie.zfail||"keep",It=Ie.zpass||"keep";return ie.commandParameter(at,ac,mt+".fail",be.commandStr),ie.commandParameter(Be,ac,mt+".zfail",be.commandStr),ie.commandParameter(It,ac,mt+".zpass",be.commandStr),[mt===qs?_l:xf,ac[at],ac[Be],ac[It]]},function(Ie,at,Be){var It=Ie.constants.stencilOps;ie.optional(function(){Ie.assert(at,Be+"&&typeof "+Be+'==="object"',"invalid "+mt)});function Ht(Dr){return ie.optional(function(){Ie.assert(at,'!("'+Dr+'" in '+Be+")||("+Be+"."+Dr+" in "+It+")","invalid "+mt+"."+Dr+", must be one of "+Object.keys(ac))}),at.def('"',Dr,'" in ',Be,"?",It,"[",Be,".",Dr,"]:",Pc)}return[mt===qs?_l:xf,Ht("fail"),Ht("zfail"),Ht("zpass")]});case za:return et(function(Ie){ie.commandType(Ie,"object",ut,be.commandStr);var at=Ie.factor|0,Be=Ie.units|0;return ie.commandType(at,"number",ut+".factor",be.commandStr),ie.commandType(Be,"number",ut+".units",be.commandStr),[at,Be]},function(Ie,at,Be){ie.optional(function(){Ie.assert(at,Be+"&&typeof "+Be+'==="object"',"invalid "+mt)});var It=at.def(Be,".factor|0"),Ht=at.def(Be,".units|0");return[It,Ht]});case co:return et(function(Ie){var at=0;return Ie==="front"?at=xf:Ie==="back"&&(at=_l),ie.command(!!at,ut,be.commandStr),at},function(Ie,at,Be){return ie.optional(function(){Ie.assert(at,Be+'==="front"||'+Be+'==="back"',"invalid cull.face")}),at.def(Be,'==="front"?',xf,":",_l)});case ta:return et(function(Ie){return ie.command(typeof Ie=="number"&&Ie>=ir.lineWidthDims[0]&&Ie<=ir.lineWidthDims[1],"invalid line width, must be a positive number between "+ir.lineWidthDims[0]+" and "+ir.lineWidthDims[1],be.commandStr),Ie},function(Ie,at,Be){return ie.optional(function(){Ie.assert(at,"typeof "+Be+'==="number"&&'+Be+">="+ir.lineWidthDims[0]+"&&"+Be+"<="+ir.lineWidthDims[1],"invalid line width")}),Be});case Ga:return et(function(Ie){return ie.commandParameter(Ie,ch,ut,be.commandStr),ch[Ie]},function(Ie,at,Be){return ie.optional(function(){Ie.assert(at,Be+'==="cw"||'+Be+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),at.def(Be+'==="cw"?'+uh+":"+Vf)});case ao:return et(function(Ie){return ie.command(io(Ie)&&Ie.length===4,"color.mask must be length 4 array",be.commandStr),Ie.map(function(at){return!!at})},function(Ie,at,Be){return ie.optional(function(){Ie.assert(at,Ie.shared.isArrayLike+"("+Be+")&&"+Be+".length===4","invalid color.mask")}),me(4,function(It){return"!!"+Be+"["+It+"]"})});case bo:return et(function(Ie){ie.command(typeof Ie=="object"&&Ie,ut,be.commandStr);var at="value"in Ie?Ie.value:1,Be=!!Ie.invert;return ie.command(typeof at=="number"&&at>=0&&at<=1,"sample.coverage.value must be a number between 0 and 1",be.commandStr),[at,Be]},function(Ie,at,Be){ie.optional(function(){Ie.assert(at,Be+"&&typeof "+Be+'==="object"',"invalid sample.coverage")});var It=at.def('"value" in ',Be,"?+",Be,".value:1"),Ht=at.def("!!",Be,".invert");return[It,Ht]})}}),or}function la(De,be){var tt=De.static,kt=De.dynamic,or={};return Object.keys(tt).forEach(function(mt){var ut=tt[mt],et;if(typeof ut=="number"||typeof ut=="boolean")et=os(function(){return ut});else if(typeof ut=="function"){var Ie=ut._reglType;Ie==="texture2d"||Ie==="textureCube"?et=os(function(at){return at.link(ut)}):Ie==="framebuffer"||Ie==="framebufferCube"?(ie.command(ut.color.length>0,'missing color attachment for framebuffer sent to uniform "'+mt+'"',be.commandStr),et=os(function(at){return at.link(ut.color[0])})):ie.commandRaise('invalid data for uniform "'+mt+'"',be.commandStr)}else io(ut)?et=os(function(at){var Be=at.global.def("[",me(ut.length,function(It){return ie.command(typeof ut[It]=="number"||typeof ut[It]=="boolean","invalid uniform "+mt,at.commandStr),ut[It]}),"]");return Be}):ie.commandRaise('invalid or missing data for uniform "'+mt+'"',be.commandStr);et.value=ut,or[mt]=et}),Object.keys(kt).forEach(function(mt){var ut=kt[mt];or[mt]=pu(ut,function(et,Ie){return et.invoke(Ie,ut)})}),or}function Qo(De,be){var tt=De.static,kt=De.dynamic,or={};return Object.keys(tt).forEach(function(mt){var ut=tt[mt],et=Me.id(mt),Ie=new Rt;if(Sf(ut))Ie.state=q,Ie.buffer=Mr.getBuffer(Mr.create(ut,df,!1,!0)),Ie.type=0;else{var at=Mr.getBuffer(ut);if(at)Ie.state=q,Ie.buffer=at,Ie.type=0;else if(ie.command(typeof ut=="object"&&ut,"invalid data for attribute "+mt,be.commandStr),"constant"in ut){var Be=ut.constant;Ie.buffer="null",Ie.state=R,typeof Be=="number"?Ie.x=Be:(ie.command(io(Be)&&Be.length>0&&Be.length<=4,"invalid constant for attribute "+mt,be.commandStr),gi.forEach(function(sn,Kn){Kn<Be.length&&(Ie[sn]=Be[Kn])}))}else{Sf(ut.buffer)?at=Mr.getBuffer(Mr.create(ut.buffer,df,!1,!0)):at=Mr.getBuffer(ut.buffer),ie.command(!!at,'missing buffer for attribute "'+mt+'"',be.commandStr);var It=ut.offset|0;ie.command(It>=0,'invalid offset for attribute "'+mt+'"',be.commandStr);var Ht=ut.stride|0;ie.command(Ht>=0&&Ht<256,'invalid stride for attribute "'+mt+'", must be integer betweeen [0, 255]',be.commandStr);var Dr=ut.size|0;ie.command(!("size"in ut)||Dr>0&&Dr<=4,'invalid size for attribute "'+mt+'", must be 1,2,3,4',be.commandStr);var hn=!!ut.normalized,cn=0;"type"in ut&&(ie.commandParameter(ut.type,Ps,"invalid type for attribute "+mt,be.commandStr),cn=Ps[ut.type]);var Pn=ut.divisor|0;ie.optional(function(){"divisor"in ut&&(ie.command(Pn===0||Yr,'cannot specify divisor for attribute "'+mt+'", instancing not supported',be.commandStr),ie.command(Pn>=0,'invalid divisor for attribute "'+mt+'"',be.commandStr));var sn=be.commandStr,Kn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(ut).forEach(function(In){ie.command(Kn.indexOf(In)>=0,'unknown parameter "'+In+'" for attribute pointer "'+mt+'" (valid parameters are '+Kn+")",sn)})}),Ie.buffer=at,Ie.state=q,Ie.size=Dr,Ie.normalized=hn,Ie.type=cn||at.dtype,Ie.offset=It,Ie.stride=Ht,Ie.divisor=Pn}}or[mt]=os(function(sn,Kn){var In=sn.attribCache;if(et in In)return In[et];var Gn={isStream:!1};return Object.keys(Ie).forEach(function(An){Gn[An]=Ie[An]}),Ie.buffer&&(Gn.buffer=sn.link(Ie.buffer),Gn.type=Gn.type||Gn.buffer+".dtype"),In[et]=Gn,Gn})}),Object.keys(kt).forEach(function(mt){var ut=kt[mt];function et(Ie,at){var Be=Ie.invoke(at,ut),It=Ie.shared,Ht=Ie.constants,Dr=It.isBufferArgs,hn=It.buffer;ie.optional(function(){Ie.assert(at,Be+"&&(typeof "+Be+'==="object"||typeof '+Be+'==="function")&&('+Dr+"("+Be+")||"+hn+".getBuffer("+Be+")||"+hn+".getBuffer("+Be+".buffer)||"+Dr+"("+Be+'.buffer)||("constant" in '+Be+"&&(typeof "+Be+'.constant==="number"||'+It.isArrayLike+"("+Be+".constant))))",'invalid dynamic attribute "'+mt+'"')});var cn={isStream:at.def(!1)},Pn=new Rt;Pn.state=q,Object.keys(Pn).forEach(function(Gn){cn[Gn]=at.def(""+Pn[Gn])});var sn=cn.buffer,Kn=cn.type;at("if(",Dr,"(",Be,")){",cn.isStream,"=true;",sn,"=",hn,".createStream(",df,",",Be,");",Kn,"=",sn,".dtype;","}else{",sn,"=",hn,".getBuffer(",Be,");","if(",sn,"){",Kn,"=",sn,".dtype;",'}else if("constant" in ',Be,"){",cn.state,"=",R,";","if(typeof "+Be+'.constant === "number"){',cn[gi[0]],"=",Be,".constant;",gi.slice(1).map(function(Gn){return cn[Gn]}).join("="),"=0;","}else{",gi.map(function(Gn,An){return cn[Gn]+"="+Be+".constant.length>"+An+"?"+Be+".constant["+An+"]:0;"}).join(""),"}}else{","if(",Dr,"(",Be,".buffer)){",sn,"=",hn,".createStream(",df,",",Be,".buffer);","}else{",sn,"=",hn,".getBuffer(",Be,".buffer);","}",Kn,'="type" in ',Be,"?",Ht.glTypes,"[",Be,".type]:",sn,".dtype;",cn.normalized,"=!!",Be,".normalized;");function In(Gn){at(cn[Gn],"=",Be,".",Gn,"|0;")}return In("size"),In("offset"),In("stride"),In("divisor"),at("}}"),at.exit("if(",cn.isStream,"){",hn,".destroyStream(",sn,");","}"),cn}or[mt]=pu(ut,et)}),or}function to(De){var be=De.static,tt=De.dynamic,kt={};return Object.keys(be).forEach(function(or){var mt=be[or];kt[or]=os(function(ut,et){return typeof mt=="number"||typeof mt=="boolean"?""+mt:ut.link(mt)})}),Object.keys(tt).forEach(function(or){var mt=tt[or];kt[or]=pu(mt,function(ut,et){return ut.invoke(et,mt)})}),kt}function Cs(De,be,tt,kt,or){var mt=De.static,ut=De.dynamic;ie.optional(function(){var In=[zl,Zs,ml,yl,hu,ef,Po,tf,fu,hf].concat(ui);function Gn(An){Object.keys(An).forEach(function(jn){ie.command(In.indexOf(jn)>=0,'unknown parameter "'+jn+'"',or.commandStr)})}Gn(mt),Gn(ut)});var et=Di(De,be),Ie=Cn(De,or),at=xi(De,Ie,or),Be=So(De,or),It=Mo(De,or),Ht=ia(De,or,et);function Dr(In){var Gn=at[In];Gn&&(It[In]=Gn)}Dr(qu),Dr(Xn(Nl));var hn=Object.keys(It).length>0,cn={framebuffer:Ie,draw:Be,shader:Ht,state:It,dirty:hn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(cn.profile=Tn(De,or),cn.uniforms=la(tt,or),cn.drawVAO=cn.scopeVAO=Be.vao,!cn.drawVAO&&Ht.program&&!et&&$e.angle_instanced_arrays&&Be.static.elements){var Pn=!0,sn=Ht.program.attributes.map(function(In){var Gn=be.static[In];return Pn=Pn&&!!Gn,Gn});if(Pn&&sn.length>0){var Kn=Kr.getVAO(Kr.createVAO({attributes:sn,elements:Be.static.elements}));cn.drawVAO=new vs(null,null,null,function(In,Gn){return In.link(Kn)}),cn.useVAO=!0}}return et?cn.useVAO=!0:cn.attributes=Qo(be,or),cn.context=to(kt,or),cn}function ss(De,be,tt){var kt=De.shared,or=kt.context,mt=De.scope();Object.keys(tt).forEach(function(ut){be.save(or,"."+ut);var et=tt[ut],Ie=et.append(De,be);Array.isArray(Ie)?mt(or,".",ut,"=[",Ie.join(),"];"):mt(or,".",ut,"=",Ie,";")}),be(mt)}function qo(De,be,tt,kt){var or=De.shared,mt=or.gl,ut=or.framebuffer,et;wn&&(et=be.def(or.extensions,".webgl_draw_buffers"));var Ie=De.constants,at=Ie.drawBuffer,Be=Ie.backBuffer,It;tt?It=tt.append(De,be):It=be.def(ut,".next"),kt||be("if(",It,"!==",ut,".cur){"),be("if(",It,"){",mt,".bindFramebuffer(",Uu,",",It,".framebuffer);"),wn&&be(et,".drawBuffersWEBGL(",at,"[",It,".colorAttachments.length]);"),be("}else{",mt,".bindFramebuffer(",Uu,",null);"),wn&&be(et,".drawBuffersWEBGL(",Be,");"),be("}",ut,".cur=",It,";"),kt||be("}")}function us(De,be,tt){var kt=De.shared,or=kt.gl,mt=De.current,ut=De.next,et=kt.current,Ie=kt.next,at=De.cond(et,".dirty");ui.forEach(function(Be){var It=Xn(Be);if(!(It in tt.state)){var Ht,Dr;if(It in ut){Ht=ut[It],Dr=mt[It];var hn=me(Sn[It].length,function(Pn){return at.def(Ht,"[",Pn,"]")});at(De.cond(hn.map(function(Pn,sn){return Pn+"!=="+Dr+"["+sn+"]"}).join("||")).then(or,".",br[It],"(",hn,");",hn.map(function(Pn,sn){return Dr+"["+sn+"]="+Pn}).join(";"),";"))}else{Ht=at.def(Ie,".",It);var cn=De.cond(Ht,"!==",et,".",It);at(cn),It in Ar?cn(De.cond(Ht).then(or,".enable(",Ar[It],");").else(or,".disable(",Ar[It],");"),et,".",It,"=",Ht,";"):cn(or,".",br[It],"(",Ht,");",et,".",It,"=",Ht,";")}}}),Object.keys(tt.state).length===0&&at(et,".dirty=false;"),be(at)}function es(De,be,tt,kt){var or=De.shared,mt=De.current,ut=or.current,et=or.gl;fh(Object.keys(tt)).forEach(function(Ie){var at=tt[Ie];if(!(kt&&!kt(at))){var Be=at.append(De,be);if(Ar[Ie]){var It=Ar[Ie];jo(at)?Be?be(et,".enable(",It,");"):be(et,".disable(",It,");"):be(De.cond(Be).then(et,".enable(",It,");").else(et,".disable(",It,");")),be(ut,".",Ie,"=",Be,";")}else if(io(Be)){var Ht=mt[Ie];be(et,".",br[Ie],"(",Be,");",Be.map(function(Dr,hn){return Ht+"["+hn+"]="+Dr}).join(";"),";")}else be(et,".",br[Ie],"(",Be,");",ut,".",Ie,"=",Be,";")}})}function Bo(De,be){Yr&&(De.instancing=be.def(De.shared.extensions,".angle_instanced_arrays"))}function Fi(De,be,tt,kt,or){var mt=De.shared,ut=De.stats,et=mt.current,Ie=mt.timer,at=tt.profile;function Be(){var In=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return In||typeof performance=="undefined"?"Date.now()":"performance.now()"}var It,Ht;function Dr(In){It=be.def(),In(It,"=",Be(),";"),typeof or=="string"?In(ut,".count+=",or,";"):In(ut,".count++;"),Wr&&(kt?(Ht=be.def(),In(Ht,"=",Ie,".getNumPendingQueries();")):In(Ie,".beginQuery(",ut,");"))}function hn(In){In(ut,".cpuTime+=",Be(),"-",It,";"),Wr&&(kt?In(Ie,".pushScopeStats(",Ht,",",Ie,".getNumPendingQueries(),",ut,");"):In(Ie,".endQuery();"))}function cn(In){var Gn=be.def(et,".profile");be(et,".profile=",In,";"),be.exit(et,".profile=",Gn,";")}var Pn;if(at){if(jo(at)){at.enable?(Dr(be),hn(be.exit),cn("true")):cn("false");return}Pn=at.append(De,be),cn(Pn)}else Pn=be.def(et,".profile");var sn=De.block();Dr(sn),be("if(",Pn,"){",sn,"}");var Kn=De.block();hn(Kn),be.exit("if(",Pn,"){",Kn,"}")}function Vo(De,be,tt,kt,or){var mt=De.shared;function ut(Ie){switch(Ie){case zf:case of:case vf:return 2;case Uf:case sh:case mf:return 3;case gl:case Tc:case yf:return 4;default:return 1}}function et(Ie,at,Be){var It=mt.gl,Ht=be.def(Ie,".location"),Dr=be.def(mt.attributes,"[",Ht,"]"),hn=Be.state,cn=Be.buffer,Pn=[Be.x,Be.y,Be.z,Be.w],sn=["buffer","normalized","offset","stride"];function Kn(){be("if(!",Dr,".buffer){",It,".enableVertexAttribArray(",Ht,");}");var Gn=Be.type,An;if(Be.size?An=be.def(Be.size,"||",at):An=at,be("if(",Dr,".type!==",Gn,"||",Dr,".size!==",An,"||",sn.map(function(pi){return Dr+"."+pi+"!=="+Be[pi]}).join("||"),"){",It,".bindBuffer(",df,",",cn,".buffer);",It,".vertexAttribPointer(",[Ht,An,Gn,Be.normalized,Be.stride,Be.offset],");",Dr,".type=",Gn,";",Dr,".size=",An,";",sn.map(function(pi){return Dr+"."+pi+"="+Be[pi]+";"}).join(""),"}"),Yr){var jn=Be.divisor;be("if(",Dr,".divisor!==",jn,"){",De.instancing,".vertexAttribDivisorANGLE(",[Ht,jn],");",Dr,".divisor=",jn,";}")}}function In(){be("if(",Dr,".buffer){",It,".disableVertexAttribArray(",Ht,");",Dr,".buffer=null;","}if(",gi.map(function(Gn,An){return Dr+"."+Gn+"!=="+Pn[An]}).join("||"),"){",It,".vertexAttrib4f(",Ht,",",Pn,");",gi.map(function(Gn,An){return Dr+"."+Gn+"="+Pn[An]+";"}).join(""),"}")}hn===q?Kn():hn===R?In():(be("if(",hn,"===",q,"){"),Kn(),be("}else{"),In(),be("}"))}kt.forEach(function(Ie){var at=Ie.name,Be=tt.attributes[at],It;if(Be){if(!or(Be))return;It=Be.append(De,be)}else{if(!or(hh))return;var Ht=De.scopeAttrib(at);ie.optional(function(){De.assert(be,Ht+".state","missing attribute "+at)}),It={},Object.keys(new Rt).forEach(function(Dr){It[Dr]=be.def(Ht,".",Dr)})}et(De.link(Ie),ut(Ie.info.type),It)})}function Ra(De,be,tt,kt,or,mt){for(var ut=De.shared,et=ut.gl,Ie,at=0;at<kt.length;++at){var Be=kt[at],It=Be.name,Ht=Be.info.type,Dr=tt.uniforms[It],hn=De.link(Be),cn=hn+".location",Pn;if(Dr){if(!or(Dr))continue;if(jo(Dr)){var sn=Dr.value;if(ie.command(sn!==null&&typeof sn!="undefined",'missing uniform "'+It+'"',De.commandStr),Ht===jf||Ht===_f){ie.command(typeof sn=="function"&&(Ht===jf&&(sn._reglType==="texture2d"||sn._reglType==="framebuffer")||Ht===_f&&(sn._reglType==="textureCube"||sn._reglType==="framebufferCube")),"invalid texture for uniform "+It,De.commandStr);var Kn=De.link(sn._texture||sn.color[0]._texture);be(et,".uniform1i(",cn,",",Kn+".bind());"),be.exit(Kn,".unbind();")}else if(Ht===Zl||Ht===bu||Ht===gf){ie.optional(function(){ie.command(io(sn),"invalid matrix for uniform "+It,De.commandStr),ie.command(Ht===Zl&&sn.length===4||Ht===bu&&sn.length===9||Ht===gf&&sn.length===16,"invalid length for matrix uniform "+It,De.commandStr)});var In=De.global.def("new Float32Array(["+Array.prototype.slice.call(sn)+"])"),Gn=2;Ht===bu?Gn=3:Ht===gf&&(Gn=4),be(et,".uniformMatrix",Gn,"fv(",cn,",false,",In,");")}else{switch(Ht){case af:ie.commandType(sn,"number","uniform "+It,De.commandStr),Ie="1f";break;case zf:ie.command(io(sn)&&sn.length===2,"uniform "+It,De.commandStr),Ie="2f";break;case Uf:ie.command(io(sn)&&sn.length===3,"uniform "+It,De.commandStr),Ie="3f";break;case gl:ie.command(io(sn)&&sn.length===4,"uniform "+It,De.commandStr),Ie="4f";break;case Rh:ie.commandType(sn,"boolean","uniform "+It,De.commandStr),Ie="1i";break;case Zf:ie.commandType(sn,"number","uniform "+It,De.commandStr),Ie="1i";break;case vf:ie.command(io(sn)&&sn.length===2,"uniform "+It,De.commandStr),Ie="2i";break;case of:ie.command(io(sn)&&sn.length===2,"uniform "+It,De.commandStr),Ie="2i";break;case mf:ie.command(io(sn)&&sn.length===3,"uniform "+It,De.commandStr),Ie="3i";break;case sh:ie.command(io(sn)&&sn.length===3,"uniform "+It,De.commandStr),Ie="3i";break;case yf:ie.command(io(sn)&&sn.length===4,"uniform "+It,De.commandStr),Ie="4i";break;case Tc:ie.command(io(sn)&&sn.length===4,"uniform "+It,De.commandStr),Ie="4i";break}be(et,".uniform",Ie,"(",cn,",",io(sn)?Array.prototype.slice.call(sn):sn,");")}continue}else Pn=Dr.append(De,be)}else{if(!or(hh))continue;Pn=be.def(ut.uniforms,"[",Me.id(It),"]")}Ht===jf?(ie(!Array.isArray(Pn),"must specify a scalar prop for textures"),be("if(",Pn,"&&",Pn,'._reglType==="framebuffer"){',Pn,"=",Pn,".color[0];","}")):Ht===_f&&(ie(!Array.isArray(Pn),"must specify a scalar prop for cube maps"),be("if(",Pn,"&&",Pn,'._reglType==="framebufferCube"){',Pn,"=",Pn,".color[0];","}")),ie.optional(function(){function js(vu,sc){De.assert(be,vu,'bad data or missing for uniform "'+It+'".  '+sc)}function Su(vu){ie(!Array.isArray(Pn),"must not specify an array type for uniform"),js("typeof "+Pn+'==="'+vu+'"',"invalid type, expected "+vu)}function du(vu,sc){Array.isArray(Pn)?ie(Pn.length===vu,"must have length "+vu):js(ut.isArrayLike+"("+Pn+")&&"+Pn+".length==="+vu,"invalid vector, should have length "+vu,De.commandStr)}function vh(vu){ie(!Array.isArray(Pn),"must not specify a value type"),js("typeof "+Pn+'==="function"&&'+Pn+'._reglType==="texture'+(vu===ih?"2d":"Cube")+'"',"invalid texture type",De.commandStr)}switch(Ht){case Zf:Su("number");break;case of:du(2,"number");break;case sh:du(3,"number");break;case Tc:du(4,"number");break;case af:Su("number");break;case zf:du(2,"number");break;case Uf:du(3,"number");break;case gl:du(4,"number");break;case Rh:Su("boolean");break;case vf:du(2,"boolean");break;case mf:du(3,"boolean");break;case yf:du(4,"boolean");break;case Zl:du(4,"number");break;case bu:du(9,"number");break;case gf:du(16,"number");break;case jf:vh(ih);break;case _f:vh(Mh);break}});var An=1;switch(Ht){case jf:case _f:var jn=be.def(Pn,"._texture");be(et,".uniform1i(",cn,",",jn,".bind());"),be.exit(jn,".unbind();");continue;case Zf:case Rh:Ie="1i";break;case of:case vf:Ie="2i",An=2;break;case sh:case mf:Ie="3i",An=3;break;case Tc:case yf:Ie="4i",An=4;break;case af:Ie="1f";break;case zf:Ie="2f",An=2;break;case Uf:Ie="3f",An=3;break;case gl:Ie="4f",An=4;break;case Zl:Ie="Matrix2fv";break;case bu:Ie="Matrix3fv";break;case gf:Ie="Matrix4fv";break}if(Ie.charAt(0)==="M"){be(et,".uniform",Ie,"(",cn,",");var pi=Math.pow(Ht-Zl+2,2),Ja=De.global.def("new Float32Array(",pi,")");Array.isArray(Pn)?be("false,(",me(pi,function(js){return Ja+"["+js+"]="+Pn[js]}),",",Ja,")"):be("false,(Array.isArray(",Pn,")||",Pn," instanceof Float32Array)?",Pn,":(",me(pi,function(js){return Ja+"["+js+"]="+Pn+"["+js+"]"}),",",Ja,")"),be(");")}else if(An>1){for(var Ho=[],Zu=[],Ha=0;Ha<An;++Ha)Array.isArray(Pn)?Zu.push(Pn[Ha]):Zu.push(be.def(Pn+"["+Ha+"]")),mt&&Ho.push(be.def());mt&&be("if(!",De.batchId,"||",Ho.map(function(js,Su){return js+"!=="+Zu[Su]}).join("||"),"){",Ho.map(function(js,Su){return js+"="+Zu[Su]+";"}).join("")),be(et,".uniform",Ie,"(",cn,",",Zu.join(","),");"),mt&&be("}")}else{if(ie(!Array.isArray(Pn),"uniform value must not be an array"),mt){var Pa=be.def();be("if(!",De.batchId,"||",Pa,"!==",Pn,"){",Pa,"=",Pn,";")}be(et,".uniform",Ie,"(",cn,",",Pn,");"),mt&&be("}")}}}function Go(De,be,tt,kt){var or=De.shared,mt=or.gl,ut=or.draw,et=kt.draw;function Ie(){var An=et.elements,jn,pi=be;return An?((An.contextDep&&kt.contextDynamic||An.propDep)&&(pi=tt),jn=An.append(De,pi),et.elementsActive&&pi("if("+jn+")"+mt+".bindBuffer("+Ph+","+jn+".buffer.buffer);")):(jn=pi.def(),pi(jn,"=",ut,".",yl,";","if(",jn,"){",mt,".bindBuffer(",Ph,",",jn,".buffer.buffer);}","else if(",or.vao,".currentVAO){",jn,"=",De.shared.elements+".getElements("+or.vao,".currentVAO.elements);",Tr?"":"if("+jn+")"+mt+".bindBuffer("+Ph+","+jn+".buffer.buffer);","}")),jn}function at(){var An=et.count,jn,pi=be;return An?((An.contextDep&&kt.contextDynamic||An.propDep)&&(pi=tt),jn=An.append(De,pi),ie.optional(function(){An.MISSING&&De.assert(be,"false","missing vertex count"),An.DYNAMIC&&De.assert(pi,jn+">=0","missing vertex count")})):(jn=pi.def(ut,".",Po),ie.optional(function(){De.assert(pi,jn+">=0","missing vertex count")})),jn}var Be=Ie();function It(An){var jn=et[An];return jn?jn.contextDep&&kt.contextDynamic||jn.propDep?jn.append(De,tt):jn.append(De,be):be.def(ut,".",An)}var Ht=It(hu),Dr=It(ef),hn=at();if(typeof hn=="number"){if(hn===0)return}else tt("if(",hn,"){"),tt.exit("}");var cn,Pn;Yr&&(cn=It(tf),Pn=De.instancing);var sn=Be+".type",Kn=et.elements&&jo(et.elements)&&!et.vaoActive;function In(){function An(){tt(Pn,".drawElementsInstancedANGLE(",[Ht,hn,sn,Dr+"<<(("+sn+"-"+te+")>>1)",cn],");")}function jn(){tt(Pn,".drawArraysInstancedANGLE(",[Ht,Dr,hn,cn],");")}Be&&Be!=="null"?Kn?An():(tt("if(",Be,"){"),An(),tt("}else{"),jn(),tt("}")):jn()}function Gn(){function An(){tt(mt+".drawElements("+[Ht,hn,sn,Dr+"<<(("+sn+"-"+te+")>>1)"]+");")}function jn(){tt(mt+".drawArrays("+[Ht,Dr,hn]+");")}Be&&Be!=="null"?Kn?An():(tt("if(",Be,"){"),An(),tt("}else{"),jn(),tt("}")):jn()}Yr&&(typeof cn!="number"||cn>=0)?typeof cn=="string"?(tt("if(",cn,">0){"),In(),tt("}else if(",cn,"<0){"),Gn(),tt("}")):In():Gn()}function Mi(De,be,tt,kt,or){var mt=ki(),ut=mt.proc("body",or);return ie.optional(function(){mt.commandStr=be.commandStr,mt.command=mt.link(be.commandStr)}),Yr&&(mt.instancing=ut.def(mt.shared.extensions,".angle_instanced_arrays")),De(mt,ut,tt,kt),mt.compile().body}function aa(De,be,tt,kt){Bo(De,be),tt.useVAO?tt.drawVAO?be(De.shared.vao,".setVAO(",tt.drawVAO.append(De,be),");"):be(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(be(De.shared.vao,".setVAO(null);"),Vo(De,be,tt,kt.attributes,function(){return!0})),Ra(De,be,tt,kt.uniforms,function(){return!0},!1),Go(De,be,be,tt)}function ha(De,be){var tt=De.proc("draw",1);Bo(De,tt),ss(De,tt,be.context),qo(De,tt,be.framebuffer),us(De,tt,be),es(De,tt,be.state),Fi(De,tt,be,!1,!0);var kt=be.shader.progVar.append(De,tt);if(tt(De.shared.gl,".useProgram(",kt,".program);"),be.shader.program)aa(De,tt,be,be.shader.program);else{tt(De.shared.vao,".setVAO(null);");var or=De.global.def("{}"),mt=tt.def(kt,".id"),ut=tt.def(or,"[",mt,"]");tt(De.cond(ut).then(ut,".call(this,a0);").else(ut,"=",or,"[",mt,"]=",De.link(function(et){return Mi(aa,De,be,et,1)}),"(",kt,");",ut,".call(this,a0);"))}Object.keys(be.state).length>0&&tt(De.shared.current,".dirty=true;"),De.shared.vao&&tt(De.shared.vao,".setVAO(null);")}function oo(De,be,tt,kt){De.batchId="a1",Bo(De,be);function or(){return!0}Vo(De,be,tt,kt.attributes,or),Ra(De,be,tt,kt.uniforms,or,!1),Go(De,be,be,tt)}function el(De,be,tt,kt){Bo(De,be);var or=tt.contextDep,mt=be.def(),ut="a0",et="a1",Ie=be.def();De.shared.props=Ie,De.batchId=mt;var at=De.scope(),Be=De.scope();be(at.entry,"for(",mt,"=0;",mt,"<",et,";++",mt,"){",Ie,"=",ut,"[",mt,"];",Be,"}",at.exit);function It(sn){return sn.contextDep&&or||sn.propDep}function Ht(sn){return!It(sn)}if(tt.needsContext&&ss(De,Be,tt.context),tt.needsFramebuffer&&qo(De,Be,tt.framebuffer),es(De,Be,tt.state,It),tt.profile&&It(tt.profile)&&Fi(De,Be,tt,!1,!0),kt)tt.useVAO?tt.drawVAO?It(tt.drawVAO)?Be(De.shared.vao,".setVAO(",tt.drawVAO.append(De,Be),");"):at(De.shared.vao,".setVAO(",tt.drawVAO.append(De,at),");"):at(De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"):(at(De.shared.vao,".setVAO(null);"),Vo(De,at,tt,kt.attributes,Ht),Vo(De,Be,tt,kt.attributes,It)),Ra(De,at,tt,kt.uniforms,Ht,!1),Ra(De,Be,tt,kt.uniforms,It,!0),Go(De,at,Be,tt);else{var Dr=De.global.def("{}"),hn=tt.shader.progVar.append(De,Be),cn=Be.def(hn,".id"),Pn=Be.def(Dr,"[",cn,"]");Be(De.shared.gl,".useProgram(",hn,".program);","if(!",Pn,"){",Pn,"=",Dr,"[",cn,"]=",De.link(function(sn){return Mi(oo,De,tt,sn,2)}),"(",hn,");}",Pn,".call(this,a0[",mt,"],",mt,");")}}function Ve(De,be){var tt=De.proc("batch",2);De.batchId="0",Bo(De,tt);var kt=!1,or=!0;Object.keys(be.context).forEach(function(Dr){kt=kt||be.context[Dr].propDep}),kt||(ss(De,tt,be.context),or=!1);var mt=be.framebuffer,ut=!1;mt?(mt.propDep?kt=ut=!0:mt.contextDep&&kt&&(ut=!0),ut||qo(De,tt,mt)):qo(De,tt,null),be.state.viewport&&be.state.viewport.propDep&&(kt=!0);function et(Dr){return Dr.contextDep&&kt||Dr.propDep}us(De,tt,be),es(De,tt,be.state,function(Dr){return!et(Dr)}),(!be.profile||!et(be.profile))&&Fi(De,tt,be,!1,"a1"),be.contextDep=kt,be.needsContext=or,be.needsFramebuffer=ut;var Ie=be.shader.progVar;if(Ie.contextDep&&kt||Ie.propDep)el(De,tt,be,null);else{var at=Ie.append(De,tt);if(tt(De.shared.gl,".useProgram(",at,".program);"),be.shader.program)el(De,tt,be,be.shader.program);else{tt(De.shared.vao,".setVAO(null);");var Be=De.global.def("{}"),It=tt.def(at,".id"),Ht=tt.def(Be,"[",It,"]");tt(De.cond(Ht).then(Ht,".call(this,a0,a1);").else(Ht,"=",Be,"[",It,"]=",De.link(function(Dr){return Mi(el,De,be,Dr,2)}),"(",at,");",Ht,".call(this,a0,a1);"))}}Object.keys(be.state).length>0&&tt(De.shared.current,".dirty=true;"),De.shared.vao&&tt(De.shared.vao,".setVAO(null);")}function lr(De,be){var tt=De.proc("scope",3);De.batchId="a2";var kt=De.shared,or=kt.current;ss(De,tt,be.context),be.framebuffer&&be.framebuffer.append(De,tt),fh(Object.keys(be.state)).forEach(function(ut){var et=be.state[ut],Ie=et.append(De,tt);io(Ie)?Ie.forEach(function(at,Be){tt.set(De.next[ut],"["+Be+"]",at)}):tt.set(kt.next,"."+ut,Ie)}),Fi(De,tt,be,!0,!0),[yl,ef,Po,tf,hu].forEach(function(ut){var et=be.draw[ut];!et||tt.set(kt.draw,"."+ut,""+et.append(De,tt))}),Object.keys(be.uniforms).forEach(function(ut){var et=be.uniforms[ut].append(De,tt);Array.isArray(et)&&(et="["+et.join()+"]"),tt.set(kt.uniforms,"["+Me.id(ut)+"]",et)}),Object.keys(be.attributes).forEach(function(ut){var et=be.attributes[ut].append(De,tt),Ie=De.scopeAttrib(ut);Object.keys(new Rt).forEach(function(at){tt.set(Ie,"."+at,et[at])})}),be.scopeVAO&&tt.set(kt.vao,".targetVAO",be.scopeVAO.append(De,tt));function mt(ut){var et=be.shader[ut];et&&tt.set(kt.shader,"."+ut,et.append(De,tt))}mt(Zs),mt(ml),Object.keys(be.state).length>0&&(tt(or,".dirty=true;"),tt.exit(or,".dirty=true;")),tt("a1(",De.shared.context,",a0,",De.batchId,");")}function Kt(De){if(!(typeof De!="object"||io(De))){for(var be=Object.keys(De),tt=0;tt<be.length;++tt)if(Cr.isDynamic(De[be[tt]]))return!0;return!1}}function Nn(De,be,tt){var kt=be.static[tt];if(!kt||!Kt(kt))return;var or=De.global,mt=Object.keys(kt),ut=!1,et=!1,Ie=!1,at=De.global.def("{}");mt.forEach(function(It){var Ht=kt[It];if(Cr.isDynamic(Ht)){typeof Ht=="function"&&(Ht=kt[It]=Cr.unbox(Ht));var Dr=pu(Ht,null);ut=ut||Dr.thisDep,Ie=Ie||Dr.propDep,et=et||Dr.contextDep}else{switch(or(at,".",It,"="),typeof Ht){case"number":or(Ht);break;case"string":or('"',Ht,'"');break;case"object":Array.isArray(Ht)&&or("[",Ht.join(),"]");break;default:or(De.link(Ht));break}or(";")}});function Be(It,Ht){mt.forEach(function(Dr){var hn=kt[Dr];if(!!Cr.isDynamic(hn)){var cn=It.invoke(Ht,hn);Ht(at,".",Dr,"=",cn,";")}})}be.dynamic[tt]=new Cr.DynamicVariable(wt,{thisDep:ut,contextDep:et,propDep:Ie,ref:at,append:Be}),delete be.static[tt]}function oa(De,be,tt,kt,or){var mt=ki();mt.stats=mt.link(or),Object.keys(be.static).forEach(function(et){Nn(mt,be,et)}),Hp.forEach(function(et){Nn(mt,De,et)});var ut=Cs(De,be,tt,kt,mt);return ha(mt,ut),lr(mt,ut),Ve(mt,ut),d(mt.compile(),{destroy:function(){ut.shader.program.destroy()}})}return{next:rn,current:Sn,procs:function(){var De=ki(),be=De.proc("poll"),tt=De.proc("refresh"),kt=De.block();be(kt),tt(kt);var or=De.shared,mt=or.gl,ut=or.next,et=or.current;kt(et,".dirty=false;"),qo(De,be),qo(De,tt,null,!0);var Ie;Yr&&(Ie=De.link(Yr)),$e.oes_vertex_array_object&&tt(De.link($e.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var at=0;at<ir.maxAttributes;++at){var Be=tt.def(or.attributes,"[",at,"]"),It=De.cond(Be,".buffer");It.then(mt,".enableVertexAttribArray(",at,");",mt,".bindBuffer(",df,",",Be,".buffer.buffer);",mt,".vertexAttribPointer(",at,",",Be,".size,",Be,".type,",Be,".normalized,",Be,".stride,",Be,".offset);").else(mt,".disableVertexAttribArray(",at,");",mt,".vertexAttrib4f(",at,",",Be,".x,",Be,".y,",Be,".z,",Be,".w);",Be,".buffer=null;"),tt(It),Yr&&tt(Ie,".vertexAttribDivisorANGLE(",at,",",Be,".divisor);")}return tt(De.shared.vao,".currentVAO=null;",De.shared.vao,".setVAO(",De.shared.vao,".targetVAO);"),Object.keys(Ar).forEach(function(Ht){var Dr=Ar[Ht],hn=kt.def(ut,".",Ht),cn=De.block();cn("if(",hn,"){",mt,".enable(",Dr,")}else{",mt,".disable(",Dr,")}",et,".",Ht,"=",hn,";"),tt(cn),be("if(",hn,"!==",et,".",Ht,"){",cn,"}")}),Object.keys(br).forEach(function(Ht){var Dr=br[Ht],hn=Sn[Ht],cn,Pn,sn=De.block();if(sn(mt,".",Dr,"("),io(hn)){var Kn=hn.length;cn=De.global.def(ut,".",Ht),Pn=De.global.def(et,".",Ht),sn(me(Kn,function(In){return cn+"["+In+"]"}),");",me(Kn,function(In){return Pn+"["+In+"]="+cn+"["+In+"];"}).join("")),be("if(",me(Kn,function(In){return cn+"["+In+"]!=="+Pn+"["+In+"]"}).join("||"),"){",sn,"}")}else cn=kt.def(ut,".",Ht),Pn=kt.def(et,".",Ht),sn(cn,");",et,".",Ht,"=",cn,";"),be("if(",cn,"!==",Pn,"){",sn,"}");tt(sn)}),De.compile()}(),compile:oa}}function Uh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Zh=34918,ph=34919,jh=35007,Vh=function(V,Me){if(!Me.ext_disjoint_timer_query)return null;var $e=[];function ir(){return $e.pop()||Me.ext_disjoint_timer_query.createQueryEXT()}function Mr(Yr){$e.push(Yr)}var rr=[];function Er(Yr){var wn=ir();Me.ext_disjoint_timer_query.beginQueryEXT(jh,wn),rr.push(wn),Wr(rr.length-1,rr.length,Yr)}function Fr(){Me.ext_disjoint_timer_query.endQueryEXT(jh)}function Gr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Kr=[];function Qr(){return Kr.pop()||new Gr}function en(Yr){Kr.push(Yr)}var pn=[];function Wr(Yr,wn,Tr){var Sn=Qr();Sn.startQueryIndex=Yr,Sn.endQueryIndex=wn,Sn.sum=0,Sn.stats=Tr,pn.push(Sn)}var qr=[],Rt=[];function pr(){var Yr,wn,Tr=rr.length;if(Tr!==0){Rt.length=Math.max(Rt.length,Tr+1),qr.length=Math.max(qr.length,Tr+1),qr[0]=0,Rt[0]=0;var Sn=0;for(Yr=0,wn=0;wn<rr.length;++wn){var rn=rr[wn];Me.ext_disjoint_timer_query.getQueryObjectEXT(rn,ph)?(Sn+=Me.ext_disjoint_timer_query.getQueryObjectEXT(rn,Zh),Mr(rn)):rr[Yr++]=rn,qr[wn+1]=Sn,Rt[wn+1]=Yr}for(rr.length=Yr,Yr=0,wn=0;wn<pn.length;++wn){var ui=pn[wn],Ar=ui.startQueryIndex,br=ui.endQueryIndex;ui.sum+=qr[br]-qr[Ar];var Xn=Rt[Ar],fn=Rt[br];fn===Xn?(ui.stats.gpuTime+=ui.sum/1e6,en(ui)):(ui.startQueryIndex=Xn,ui.endQueryIndex=fn,pn[Yr++]=ui)}pn.length=Yr}}return{beginQuery:Er,endQuery:Fr,pushScopeStats:Wr,update:pr,getNumPendingQueries:function(){return rr.length},clear:function(){$e.push.apply($e,rr);for(var Yr=0;Yr<$e.length;Yr++)Me.ext_disjoint_timer_query.deleteQueryEXT($e[Yr]);rr.length=0,$e.length=0},restore:function(){rr.length=0,$e.length=0}}},gp=16384,_p=256,Ef=1024,Gh=34962,Mc="webglcontextlost",wf="webglcontextrestored",$a=1,Hh=2,oc=3;function Ic(V,Me){for(var $e=0;$e<V.length;++$e)if(V[$e]===Me)return $e;return-1}function dh(V){var Me=z(V);if(!Me)return null;var $e=Me.gl,ir=$e.getContextAttributes(),Mr=$e.isContextLost(),rr=oe($e,Me);if(!rr)return null;var Er=Ui(),Fr=Uh(),Gr=rr.extensions,Kr=Vh($e,Gr),Qr=bi(),en=$e.drawingBufferWidth,pn=$e.drawingBufferHeight,Wr={tick:0,time:0,viewportWidth:en,viewportHeight:pn,framebufferWidth:en,framebufferHeight:pn,drawingBufferWidth:en,drawingBufferHeight:pn,pixelRatio:Me.pixelRatio},qr={},Rt={elements:null,primitive:4,count:-1,offset:0,instances:-1},pr=ke($e,Gr),Yr=j($e,Fr,Me,Sn),wn=Ds($e,Gr,Yr,Fr),Tr=bt($e,Gr,pr,Fr,Yr,wn,Rt);function Sn(Mi){return Tr.destroyBuffer(Mi)}var rn=Nr($e,Er,Fr,Me),ui=uu($e,Gr,pr,function(){Xn.procs.poll()},Wr,Fr,Me),Ar=Uc($e,Gr,pr,Fr,Me),br=Pe($e,Gr,pr,ui,Ar,Fr),Xn=zh($e,Er,Gr,pr,Yr,wn,ui,br,qr,Tr,rn,Rt,Wr,Kr,Me),fn=hi($e,br,Xn.procs.poll,Wr,ir,Gr,pr),$r=Xn.next,gn=$e.canvas,En=[],Ni=[],ki=[],Tn=[Me.onDestroy],Cn=null;function xi(){if(En.length===0){Kr&&Kr.update(),Cn=null;return}Cn=Dn.next(xi),Bo();for(var Mi=En.length-1;Mi>=0;--Mi){var aa=En[Mi];aa&&aa(Wr,null,0)}$e.flush(),Kr&&Kr.update()}function Di(){!Cn&&En.length>0&&(Cn=Dn.next(xi))}function ia(){Cn&&(Dn.cancel(xi),Cn=null)}function So(Mi){Mi.preventDefault(),Mr=!0,ia(),Ni.forEach(function(aa){aa()})}function Mo(Mi){$e.getError(),Mr=!1,rr.restore(),rn.restore(),Yr.restore(),ui.restore(),Ar.restore(),br.restore(),Tr.restore(),Kr&&Kr.restore(),Xn.procs.refresh(),Di(),ki.forEach(function(aa){aa()})}var la=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!la&&gn&&(gn.addEventListener(Mc,So,!1),gn.addEventListener(wf,Mo,!1));function Qo(){En.length=0,ia(),!la&&gn&&(gn.removeEventListener(Mc,So),gn.removeEventListener(wf,Mo)),rn.clear(),br.clear(),Ar.clear(),Tr.clear(),ui.clear(),wn.clear(),Yr.clear(),Kr&&Kr.clear(),Tn.forEach(function(Mi){Mi()})}function to(Mi){ie(!!Mi,"invalid args to regl({...})"),ie.type(Mi,"object","invalid args to regl({...})");function aa(mt){var ut=d({},mt);delete ut.uniforms,delete ut.attributes,delete ut.context,delete ut.vao,"stencil"in ut&&ut.stencil.op&&(ut.stencil.opBack=ut.stencil.opFront=ut.stencil.op,delete ut.stencil.op);function et(Ie){if(Ie in ut){var at=ut[Ie];delete ut[Ie],Object.keys(at).forEach(function(Be){ut[Ie+"."+Be]=at[Be]})}}return et("blend"),et("depth"),et("cull"),et("stencil"),et("polygonOffset"),et("scissor"),et("sample"),"vao"in mt&&(ut.vao=mt.vao),ut}function ha(mt,ut){var et={},Ie={};return Object.keys(mt).forEach(function(at){var Be=mt[at];if(Cr.isDynamic(Be)){Ie[at]=Cr.unbox(Be,at);return}else if(ut&&Array.isArray(Be)){for(var It=0;It<Be.length;++It)if(Cr.isDynamic(Be[It])){Ie[at]=Cr.unbox(Be,at);return}}et[at]=Be}),{dynamic:Ie,static:et}}var oo=ha(Mi.context||{},!0),el=ha(Mi.uniforms||{},!0),Ve=ha(Mi.attributes||{},!1),lr=ha(aa(Mi),!1),Kt={gpuTime:0,cpuTime:0,count:0},Nn=Xn.compile(lr,Ve,el,oo,Kt),oa=Nn.draw,De=Nn.batch,be=Nn.scope,tt=[];function kt(mt){for(;tt.length<mt;)tt.push(null);return tt}function or(mt,ut){var et;if(Mr&&ie.raise("context lost"),typeof mt=="function")return be.call(this,null,mt,0);if(typeof ut=="function")if(typeof mt=="number")for(et=0;et<mt;++et)be.call(this,null,ut,et);else if(Array.isArray(mt))for(et=0;et<mt.length;++et)be.call(this,mt[et],ut,et);else return be.call(this,mt,ut,0);else if(typeof mt=="number"){if(mt>0)return De.call(this,kt(mt|0),mt|0)}else if(Array.isArray(mt)){if(mt.length)return De.call(this,mt,mt.length)}else return oa.call(this,mt)}return d(or,{stats:Kt,destroy:function(){Nn.destroy()}})}var Cs=br.setFBO=to({framebuffer:Cr.define.call(null,$a,"framebuffer")});function ss(Mi,aa){var ha=0;Xn.procs.poll();var oo=aa.color;oo&&($e.clearColor(+oo[0]||0,+oo[1]||0,+oo[2]||0,+oo[3]||0),ha|=gp),"depth"in aa&&($e.clearDepth(+aa.depth),ha|=_p),"stencil"in aa&&($e.clearStencil(aa.stencil|0),ha|=Ef),ie(!!ha,"called regl.clear with no buffer specified"),$e.clear(ha)}function qo(Mi){if(ie(typeof Mi=="object"&&Mi,"regl.clear() takes an object as input"),"framebuffer"in Mi)if(Mi.framebuffer&&Mi.framebuffer_reglType==="framebufferCube")for(var aa=0;aa<6;++aa)Cs(d({framebuffer:Mi.framebuffer.faces[aa]},Mi),ss);else Cs(Mi,ss);else ss(null,Mi)}function us(Mi){ie.type(Mi,"function","regl.frame() callback must be a function"),En.push(Mi);function aa(){var ha=Ic(En,Mi);ie(ha>=0,"cannot cancel a frame twice");function oo(){var el=Ic(En,oo);En[el]=En[En.length-1],En.length-=1,En.length<=0&&ia()}En[ha]=oo}return Di(),{cancel:aa}}function es(){var Mi=$r.viewport,aa=$r.scissor_box;Mi[0]=Mi[1]=aa[0]=aa[1]=0,Wr.viewportWidth=Wr.framebufferWidth=Wr.drawingBufferWidth=Mi[2]=aa[2]=$e.drawingBufferWidth,Wr.viewportHeight=Wr.framebufferHeight=Wr.drawingBufferHeight=Mi[3]=aa[3]=$e.drawingBufferHeight}function Bo(){Wr.tick+=1,Wr.time=Vo(),es(),Xn.procs.poll()}function Fi(){ui.refresh(),es(),Xn.procs.refresh(),Kr&&Kr.update()}function Vo(){return(bi()-Qr)/1e3}Fi();function Ra(Mi,aa){ie.type(aa,"function","listener callback must be a function");var ha;switch(Mi){case"frame":return us(aa);case"lost":ha=Ni;break;case"restore":ha=ki;break;case"destroy":ha=Tn;break;default:ie.raise("invalid event, must be one of frame,lost,restore,destroy")}return ha.push(aa),{cancel:function(){for(var oo=0;oo<ha.length;++oo)if(ha[oo]===aa){ha[oo]=ha[ha.length-1],ha.pop();return}}}}var Go=d(to,{clear:qo,prop:Cr.define.bind(null,$a),context:Cr.define.bind(null,Hh),this:Cr.define.bind(null,oc),draw:to({}),buffer:function(Mi){return Yr.create(Mi,Gh,!1,!1)},elements:function(Mi){return wn.create(Mi,!1)},texture:ui.create2D,cube:ui.createCube,renderbuffer:Ar.create,framebuffer:br.create,framebufferCube:br.createCube,vao:Tr.createVAO,attributes:ir,frame:us,on:Ra,limits:pr,hasExtension:function(Mi){return pr.extensions.indexOf(Mi.toLowerCase())>=0},read:fn,destroy:Qo,_gl:$e,_refresh:Fi,poll:function(){Bo(),Kr&&Kr.update()},now:Vo,stats:Fr});return Me.onDone(null,Go),Go}return dh})},49029:function(Or){var U=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function E(le){return le.match(U)||[]}Or.exports=E},29750:function(Or){function U(E,le,C){return E===E&&(C!==void 0&&(E=E<=C?E:C),le!==void 0&&(E=E>=le?E:le)),E}Or.exports=U},18674:function(Or){function U(E){return function(le){return E==null?void 0:E[le]}}Or.exports=U},98805:function(Or,U,E){var le=E(40180),C=E(62689),d=E(83140),A=E(79833);function Q(K){return function(W){W=A(W);var L=C(W)?d(W):void 0,N=L?L[0]:W.charAt(0),Ne=L?le(L,1).join(""):W.slice(1);return N[K]()+Ne}}Or.exports=Q},35393:function(Or,U,E){var le=E(62663),C=E(53816),d=E(58748),A="['\u2019]",Q=RegExp(A,"g");function K(W){return function(L){return le(d(C(L).replace(Q,"")),W,"")}}Or.exports=K},69389:function(Or,U,E){var le=E(18674),C={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},d=le(C);Or.exports=d},93157:function(Or){var U=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function E(le){return U.test(le)}Or.exports=E},2757:function(Or){var U="\\ud800-\\udfff",E="\\u0300-\\u036f",le="\\ufe20-\\ufe2f",C="\\u20d0-\\u20ff",d=E+le+C,A="\\u2700-\\u27bf",Q="a-z\\xdf-\\xf6\\xf8-\\xff",K="\\xac\\xb1\\xd7\\xf7",W="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",L="\\u2000-\\u206f",N=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ne="A-Z\\xc0-\\xd6\\xd8-\\xde",Ye="\\ufe0e\\ufe0f",Je=K+W+L+N,rt="['\u2019]",Yt="["+Je+"]",Vt="["+d+"]",tr="\\d+",zt="["+A+"]",Tt="["+Q+"]",xt="[^"+U+Je+tr+A+Q+Ne+"]",yr="\\ud83c[\\udffb-\\udfff]",ee="(?:"+Vt+"|"+yr+")",dr="[^"+U+"]",Ct="(?:\\ud83c[\\udde6-\\uddff]){2}",Ke="[\\ud800-\\udbff][\\udc00-\\udfff]",Dt="["+Ne+"]",Xe="\\u200d",Ut="(?:"+Tt+"|"+xt+")",_r="(?:"+Dt+"|"+xt+")",ar="(?:"+rt+"(?:d|ll|m|re|s|t|ve))?",zr="(?:"+rt+"(?:D|LL|M|RE|S|T|VE))?",fe=ee+"?",Re="["+Ye+"]?",ge="(?:"+Xe+"(?:"+[dr,Ct,Ke].join("|")+")"+Re+fe+")*",_t="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",pt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Nt=Re+fe+ge,Bt="(?:"+[zt,Ct,Ke].join("|")+")"+Nt,kr=RegExp([Dt+"?"+Tt+"+"+ar+"(?="+[Yt,Dt,"$"].join("|")+")",_r+"+"+zr+"(?="+[Yt,Dt+Ut,"$"].join("|")+")",Dt+"?"+Ut+"+"+ar,Dt+"+"+zr,pt,_t,tr,Bt].join("|"),"g");function ln(yn){return yn.match(kr)||[]}Or.exports=ln},68929:function(Or,U,E){var le=E(48403),C=E(35393),d=C(function(A,Q,K){return Q=Q.toLowerCase(),A+(K?le(Q):Q)});Or.exports=d},48403:function(Or,U,E){var le=E(79833),C=E(11700);function d(A){return C(le(A).toLowerCase())}Or.exports=d},74691:function(Or,U,E){var le=E(29750),C=E(14841);function d(A,Q,K){return K===void 0&&(K=Q,Q=void 0),K!==void 0&&(K=C(K),K=K===K?K:0),Q!==void 0&&(Q=C(Q),Q=Q===Q?Q:0),le(C(A),Q,K)}Or.exports=d},53816:function(Or,U,E){var le=E(69389),C=E(79833),d=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,A="\\u0300-\\u036f",Q="\\ufe20-\\ufe2f",K="\\u20d0-\\u20ff",W=A+Q+K,L="["+W+"]",N=RegExp(L,"g");function Ne(Ye){return Ye=C(Ye),Ye&&Ye.replace(d,le).replace(N,"")}Or.exports=Ne},14293:function(Or){function U(E){return E==null}Or.exports=U},81763:function(Or,U,E){var le=E(44239),C=E(37005),d="[object Number]";function A(Q){return typeof Q=="number"||C(Q)&&le(Q)==d}Or.exports=A},30236:function(Or,U,E){var le=E(42980),C=E(21463),d=C(function(A,Q,K,W){le(A,Q,K,W)});Or.exports=d},44908:function(Or,U,E){var le=E(45652);function C(d){return d&&d.length?le(d):[]}Or.exports=C},11700:function(Or,U,E){var le=E(98805),C=le("toUpperCase");Or.exports=C},58748:function(Or,U,E){var le=E(49029),C=E(93157),d=E(79833),A=E(2757);function Q(K,W,L){return K=d(K),W=L?void 0:W,W===void 0?C(K)?A(K):le(K):K.match(W)||[]}Or.exports=Q},6158:function(Or){(function(U,E){Or.exports=E()})(this,function(){"use strict";var U,E,le;function C(d,A){if(!U)U=A;else if(!E)E=A;else{var Q="var sharedChunk = {}; ("+U+")(sharedChunk); ("+E+")(sharedChunk);",K={};U(K),le=A(K),typeof window!="undefined"&&(le.workerUrl=window.URL.createObjectURL(new Blob([Q],{type:"text/javascript"})))}}return C(["exports"],function(d){"use strict";function A(e,t){return e(t={exports:{}},t.exports),t.exports}var Q=K;function K(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}K.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},K.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},K.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},K.prototype.solveCurveX=function(e,t){var r,f,v,y,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(y=this.sampleCurveX(v)-e,Math.abs(y)<t)return v;var M=this.sampleCurveDerivativeX(v);if(Math.abs(M)<1e-6)break;v-=y/M}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(y=this.sampleCurveX(v),Math.abs(y-e)<t)return v;e>y?r=v:f=v,v=.5*(f-r)+r}return v},K.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var W=L;function L(e,t){this.x=e,this.y=t}L.prototype={clone:function(){return new L(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},L.convert=function(e){return e instanceof L?e:Array.isArray(e)?new L(e[0],e[1]):e};var N=typeof self!="undefined"?self:{},Ne=Math.pow(2,53)-1;function Ye(e,t,r,f){var v=new Q(e,t,r,f);return function(y){return v.solve(y)}}var Je=Ye(.25,.1,.25,1);function rt(e,t,r){return Math.min(r,Math.max(t,e))}function Yt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Vt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var x in y)e[x]=y[x]}return e}var tr=1;function zt(){return tr++}function Tt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function xt(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function yr(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function ee(e,t){return e.indexOf(t,e.length-t.length)!==-1}function dr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function Ct(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function Ke(e){return Array.isArray(e)?e.map(Ke):typeof e=="object"&&e?dr(e,Ke):e}var Dt={};function Xe(e){Dt[e]||(typeof console!="undefined"&&console.warn(e),Dt[e]=!0)}function Ut(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function _r(e){for(var t=0,r=0,f=e.length,v=f-1,y=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(y=e[r]).x)*(y.y+x.y);return t}function ar(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function zr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,y,x){var M=y||x;return t[v]=!M||M.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var fe=null;function Re(e){if(fe==null){var t=e.navigator?e.navigator.userAgent:null;fe=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return fe}function ge(e){try{var t=N[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var _t,pt,Nt,Bt,kr=N.performance&&N.performance.now?N.performance.now.bind(N.performance):Date.now.bind(Date),ln=N.requestAnimationFrame||N.mozRequestAnimationFrame||N.webkitRequestAnimationFrame||N.msRequestAnimationFrame,yn=N.cancelAnimationFrame||N.mozCancelAnimationFrame||N.webkitCancelAnimationFrame||N.msCancelAnimationFrame,Vi={now:kr,frame:function(e){var t=ln(e);return{cancel:function(){return yn(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=N.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return _t||(_t=N.document.createElement("a")),_t.href=e,_t.href},hardwareConcurrency:N.navigator&&N.navigator.hardwareConcurrency||4,get devicePixelRatio(){return N.devicePixelRatio},get prefersReducedMotion(){return!!N.matchMedia&&(pt==null&&(pt=N.matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}},nr={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},de={supported:!1,testSupport:function(e){!Te&&Bt&&(Ue?Le(e):Nt=e)}},Te=!1,Ue=!1;function Le(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Bt),e.isContextLost())return;de.supported=!0}catch(r){}e.deleteTexture(t),Te=!0}N.document&&((Bt=N.document.createElement("img")).onload=function(){Nt&&Le(Nt),Nt=null,Ue=!0},Bt.onerror=function(){Te=!0,Nt=null},Bt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Ft="01",er=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function w(e){return e.indexOf("mapbox:")===0}er.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ft,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},er.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},er.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},er.prototype.normalizeStyleURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},er.prototype.normalizeGlyphsURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},er.prototype.normalizeSourceURL=function(e,t){if(!w(e))return e;var r=Qe(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},er.prototype.normalizeSpriteURL=function(e,t,r,f){var v=Qe(e);return w(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,yt(v))},er.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!w(e))return e;var r=Qe(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Vi.devicePixelRatio>=2||t===512?"@2x":"")+(de.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var y=0,x=v;y<x.length;y+=1){var M=x[y].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(r.params)||nr.ACCESS_TOKEN;return nr.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},er.prototype.canonicalizeTileURL=function(e,t){var r=Qe(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(y){return!y.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},er.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&w(t),f=[],v=0,y=e.tiles||[];v<y.length;v+=1){var x=y[v];Ee(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},er.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=Qe(nr.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!nr.REQUIRE_ACCESS_TOKEN)return yt(e);if(!(t=t||nr.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(y){return y.indexOf("access_token")===-1}),e.params.push("access_token="+t),yt(e)};var Z=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ee(e){return Z.test(e)}var Ze=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qe(e){var t=e.match(Ze);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function yt(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function St(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(N.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var jt=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};jt.prototype.getStorageKey=function(e){var t,r=St(nr.ACCESS_TOKEN);return t=r&&r.u?N.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):nr.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},jt.prototype.fetchEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=N.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=N.localStorage.getItem(r);v&&(this.anonId=v)}catch(y){Xe("Unable to read from LocalStorage")}},jt.prototype.saveEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{N.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&N.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Xe("Unable to write to LocalStorage")}},jt.prototype.processRequests=function(e){},jt.prototype.postEvent=function(e,t,r,f){var v=this;if(nr.EVENTS_URL){var y=Qe(nr.EVENTS_URL);y.params.push("access_token="+(f||nr.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Ft,userId:this.anonId},M=t?Vt(x,t):x,B={url:yt(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Ii(B,function(G){v.pendingRequest=null,r(G),v.saveEventData(),v.processRequests(f)})}},jt.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var Et,Qt,ie=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,y){this.skuToken=v,(nr.EVENTS_URL&&y||nr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return w(x)||Ee(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},y)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),y=v.id,x=v.timestamp;y&&this.success[y]||(this.anonId||this.fetchEventData(),xt(this.anonId)||(this.anonId=Tt()),this.postEvent(x,{skuToken:this.skuToken},function(M){M||y&&(f.success[y]=!0)},r))}},t}(jt),sr=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){nr.EVENTS_URL&&nr.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return w(v)||Ee(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=St(nr.ACCESS_TOKEN),y=v?v.u:nr.ACCESS_TOKEN,x=y!==this.eventData.tokenU;xt(this.anonId)||(this.anonId=Tt(),x=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var B=new Date(this.eventData.lastSuccess),G=new Date(M),$=(M-this.eventData.lastSuccess)/864e5;x=x||$>=1||$<-1||B.getDate()!==G.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(ne){ne||(f.eventData.lastSuccess=M,f.eventData.tokenU=y)},r)}},t}(jt)),Br=sr.postTurnstileEvent.bind(sr),Lr=new ie,nt=Lr.postMapLoadEvent.bind(Lr),gt=500,vt=50;function hr(){N.caches&&!Et&&(Et=N.caches.open("mapbox-tiles"))}function Vr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Ur,nn=1/0;function Jr(){return Ur==null&&(Ur=N.OffscreenCanvas&&new N.OffscreenCanvas(1,1).getContext("2d")&&typeof N.createImageBitmap=="function"),Ur}var Cr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Cr);var Dn=function(e){function t(r,f,v){f===401&&Ee(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),Hn=ar()?function(){return self.worker&&self.worker.referrer}:function(){return(N.location.protocol==="blob:"?N.parent:N).location.href},bi,Ui,Ji=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Hn())&&!/^\w+:/.test(r))){if(N.fetch&&N.Request&&N.AbortController&&N.Request.prototype.hasOwnProperty("signal"))return function(f,v){var y,x=new N.AbortController,M=new N.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Hn(),signal:x.signal}),B=!1,G=!1,$=(y=M.url).indexOf("sku=")>0&&Ee(y);f.type==="json"&&M.headers.set("Accept","application/json");var ne=function(_e,Ge,We){if(!G){if(_e&&_e.message!=="SecurityError"&&Xe(_e),Ge&&We)return he(Ge);var ht=Date.now();N.fetch(M).then(function(qe){if(qe.ok){var Pt=$?qe.clone():null;return he(qe,Pt,ht)}return v(new Dn(qe.statusText,qe.status,f.url))}).catch(function(qe){qe.code!==20&&v(new Error(qe.message))})}},he=function(_e,Ge,We){(f.type==="arrayBuffer"?_e.arrayBuffer():f.type==="json"?_e.json():_e.text()).then(function(ht){G||(Ge&&We&&function(qe,Pt,Wt){if(hr(),Et){var cr={status:Pt.status,statusText:Pt.statusText,headers:new N.Headers};Pt.headers.forEach(function(Ir,tn){return cr.headers.set(tn,Ir)});var vr=zr(Pt.headers.get("Cache-Control")||"");vr["no-store"]||(vr["max-age"]&&cr.headers.set("Expires",new Date(Wt+1e3*vr["max-age"]).toUTCString()),new Date(cr.headers.get("Expires")).getTime()-Wt<42e4||function(Ir,tn){if(Qt===void 0)try{new Response(new ReadableStream),Qt=!0}catch(dn){Qt=!1}Qt?tn(Ir.body):Ir.blob().then(tn)}(Pt,function(Ir){var tn=new N.Response(Ir,cr);hr(),Et&&Et.then(function(dn){return dn.put(Vr(qe.url),tn)}).catch(function(dn){return Xe(dn.message)})}))}}(M,Ge,We),B=!0,v(null,ht,_e.headers.get("Cache-Control"),_e.headers.get("Expires")))}).catch(function(ht){G||v(new Error(ht.message))})};return $?function(_e,Ge){if(hr(),!Et)return Ge(null);var We=Vr(_e.url);Et.then(function(ht){ht.match(We).then(function(qe){var Pt=function(Wt){if(!Wt)return!1;var cr=new Date(Wt.headers.get("Expires")||0),vr=zr(Wt.headers.get("Cache-Control")||"");return cr>Date.now()&&!vr["no-cache"]}(qe);ht.delete(We),Pt&&ht.put(We,qe.clone()),Ge(null,qe,Pt)}).catch(Ge)}).catch(Ge)}(M,ne):ne(null,null),{cancel:function(){G=!0,B||x.abort()}}}(e,t);if(ar()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var y=new N.XMLHttpRequest;for(var x in y.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(y.responseType="arraybuffer"),f.headers)y.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=f.credentials==="include",y.onerror=function(){v(new Error(y.statusText))},y.onload=function(){if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){var M=y.response;if(f.type==="json")try{M=JSON.parse(y.response)}catch(B){return v(B)}v(null,M,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else v(new Dn(y.statusText,y.status,f.url))},y.send(f.body),{cancel:function(){return y.abort()}}}(e,t)},Ri=function(e,t){return Ji(Vt(e,{type:"arrayBuffer"}),t)},Ii=function(e,t){return Ji(Vt(e,{method:"POST"}),t)},Y="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";bi=[],Ui=0;var ce=function(e,t){if(de.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Ui>=nr.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return bi.push(r),r}Ui++;var f=!1,v=function(){if(!f)for(f=!0,Ui--;bi.length&&Ui<nr.MAX_PARALLEL_IMAGE_REQUESTS;){var x=bi.shift();x.cancelled||(x.cancel=ce(x.requestParameters,x.callback).cancel)}},y=Ri(e,function(x,M,B,G){v(),x?t(x):M&&(Jr()?function($,ne){var he=new N.Blob([new Uint8Array($)],{type:"image/png"});N.createImageBitmap(he).then(function(_e){ne(null,_e)}).catch(function(_e){ne(new Error("Could not load image because of "+_e.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,t):function($,ne,he,_e){var Ge=new N.Image,We=N.URL;Ge.onload=function(){ne(null,Ge),We.revokeObjectURL(Ge.src),Ge.onload=null,N.requestAnimationFrame(function(){Ge.src=Y})},Ge.onerror=function(){return ne(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ht=new N.Blob([new Uint8Array($)],{type:"image/png"});Ge.cacheControl=he,Ge.expires=_e,Ge.src=$.byteLength?We.createObjectURL(ht):Y}(M,t,B,G))});return{cancel:function(){y.cancel(),v()}}};function ye(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function z(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var oe=function(e,t){t===void 0&&(t={}),Vt(this,t),this.type=e},me=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Vt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(oe),Ae=function(){};Ae.prototype.on=function(e,t){return this._listeners=this._listeners||{},ye(e,t,this._listeners),this},Ae.prototype.off=function(e,t){return z(e,t,this._listeners),z(e,t,this._oneTimeListeners),this},Ae.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},ye(e,t,this._oneTimeListeners),this},Ae.prototype.fire=function(e,t){typeof e=="string"&&(e=new oe(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var y=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];y<x.length;y+=1){var M=x[y];z(r,M,this._oneTimeListeners),M.call(this,e)}var B=this._eventedParent;B&&(Vt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(e))}else e instanceof me&&console.error(e.error);return this},Ae.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Ae.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var se={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ce=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function ct(e){var t=e.value;return t?[new Ce(e.key,t,"constants have been deprecated as of v8")]:[]}function xr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var y=v[f];for(var x in y)e[x]=y[x]}return e}function Gt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Jt(e){if(Array.isArray(e))return e.map(Jt);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Jt(e[r]);return t}return Gt(e)}var Rr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),Ln=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};Ln.prototype.concat=function(e){return new Ln(this,e)},Ln.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},Ln.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Mn={kind:"null"},$t={kind:"number"},bn={kind:"string"},on={kind:"boolean"},un={kind:"color"},wi={kind:"object"},xn={kind:"value"},Oi={kind:"collator"},Yi={kind:"formatted"},oi={kind:"resolvedImage"};function Ki(e,t){return{kind:"array",itemType:e,N:t}}function zi(e){if(e.kind==="array"){var t=zi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var Ai=[Mn,$t,bn,on,un,Yi,wi,Ki(xn),oi];function ca(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ca(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=Ai;r<f.length;r+=1)if(!ca(f[r],t))return null}}return"Expected "+zi(e)+" but found "+zi(t)+" instead."}function ba(e,t){return t.some(function(r){return r.kind===e.kind})}function ai(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var ti=A(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(M){return(M=Math.round(M))<0?0:M>255?255:M}function v(M){return f(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function y(M){return(B=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:B>1?1:B;var B}function x(M,B,G){return G<0?G+=1:G>1&&(G-=1),6*G<1?M+(B-M)*G*6:2*G<1?B:3*G<2?M+(B-M)*(2/3-G)*6:M}try{t.parseCSSColor=function(M){var B,G=M.replace(/ /g,"").toLowerCase();if(G in r)return r[G].slice();if(G[0]==="#")return G.length===4?(B=parseInt(G.substr(1),16))>=0&&B<=4095?[(3840&B)>>4|(3840&B)>>8,240&B|(240&B)>>4,15&B|(15&B)<<4,1]:null:G.length===7&&(B=parseInt(G.substr(1),16))>=0&&B<=16777215?[(16711680&B)>>16,(65280&B)>>8,255&B,1]:null;var $=G.indexOf("("),ne=G.indexOf(")");if($!==-1&&ne+1===G.length){var he=G.substr(0,$),_e=G.substr($+1,ne-($+1)).split(","),Ge=1;switch(he){case"rgba":if(_e.length!==4)return null;Ge=y(_e.pop());case"rgb":return _e.length!==3?null:[v(_e[0]),v(_e[1]),v(_e[2]),Ge];case"hsla":if(_e.length!==4)return null;Ge=y(_e.pop());case"hsl":if(_e.length!==3)return null;var We=(parseFloat(_e[0])%360+360)%360/360,ht=y(_e[1]),qe=y(_e[2]),Pt=qe<=.5?qe*(ht+1):qe+ht-qe*ht,Wt=2*qe-Pt;return[f(255*x(Wt,Pt,We+1/3)),f(255*x(Wt,Pt,We)),f(255*x(Wt,Pt,We-1/3)),Ge];default:return null}}return null}}catch(M){}}).parseCSSColor,Gi=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Gi.parse=function(e){if(e){if(e instanceof Gi)return e;if(typeof e=="string"){var t=ti(e);if(t)return new Gi(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Gi.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Gi.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Gi.black=new Gi(0,0,0,1),Gi.white=new Gi(1,1,1,1),Gi.transparent=new Gi(0,0,0,0),Gi.red=new Gi(1,0,0,1);var da=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};da.prototype.compare=function(e,t){return this.collator.compare(e,t)},da.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Xo=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},ya=function(e){this.sections=e};ya.fromString=function(e){return new ya([new Xo(e,null,null,null,null)])},ya.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ya.factory=function(e){return e instanceof ya?e:ya.fromString(e)},ya.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ya.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var mi=function(e){this.name=e.name,this.available=e.available};function ga(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Gs(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Gi||e instanceof da||e instanceof ya||e instanceof mi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!Gs(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!Gs(e[f]))return!1;return!0}return!1}function Sa(e){if(e===null)return Mn;if(typeof e=="string")return bn;if(typeof e=="boolean")return on;if(typeof e=="number")return $t;if(e instanceof Gi)return un;if(e instanceof da)return Oi;if(e instanceof ya)return Yi;if(e instanceof mi)return oi;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var y=Sa(v[f]);if(t){if(t===y)continue;t=xn;break}t=y}return Ki(t||xn,r)}return wi}function Co(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Gi||e instanceof ya||e instanceof mi?e.toString():JSON.stringify(e)}mi.prototype.toString=function(){return this.name},mi.fromString=function(e){return e?new mi({name:e,available:!1}):null},mi.prototype.serialize=function(){return["image",this.name]};var Wa=function(e,t){this.type=e,this.value=t};Wa.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!Gs(e[1]))return t.error("invalid value");var r=e[1],f=Sa(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Wa(f,r)},Wa.prototype.evaluate=function(){return this.value},Wa.prototype.eachChild=function(){},Wa.prototype.outputDefined=function(){return!0},Wa.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Gi?["rgba"].concat(this.value.toArray()):this.value instanceof ya?this.value.serialize():this.value};var Xa=function(e){this.name="ExpressionEvaluationError",this.message=e};Xa.prototype.toJSON=function(){return this.message};var Yo={string:bn,number:$t,boolean:on,object:wi},Zi=function(e,t){this.type=e,this.args=t};Zi.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var y,x;if(e.length>2){var M=e[1];if(typeof M!="string"||!(M in Yo)||M==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);y=Yo[M],f++}else y=xn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=Ki(y,x)}else r=Yo[v];for(var B=[];f<e.length;f++){var G=t.parse(e[f],f,xn);if(!G)return null;B.push(G)}return new Zi(r,B)},Zi.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ca(this.type,Sa(r)))return r;if(t===this.args.length-1)throw new Xa("Expected value to be of type "+zi(this.type)+", but found "+zi(Sa(r))+" instead.")}return null},Zi.prototype.eachChild=function(e){this.args.forEach(e)},Zi.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Zi.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Ao=function(e){this.type=Yi,this.sections=e};Ao.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,y=1;y<=e.length-1;++y){var x=e[y];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var M=null;if(x["font-scale"]&&!(M=t.parse(x["font-scale"],1,$t)))return null;var B=null;if(x["text-font"]&&!(B=t.parse(x["text-font"],1,Ki(bn))))return null;var G=null;if(x["text-color"]&&!(G=t.parse(x["text-color"],1,un)))return null;var $=f[f.length-1];$.scale=M,$.font=B,$.textColor=G}else{var ne=t.parse(e[y],1,xn);if(!ne)return null;var he=ne.type.kind;if(he!=="string"&&he!=="value"&&he!=="null"&&he!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:ne,scale:null,font:null,textColor:null})}}return new Ao(f)},Ao.prototype.evaluate=function(e){return new ya(this.sections.map(function(t){var r=t.content.evaluate(e);return Sa(r)===oi?new Xo("",r,null,null,null):new Xo(Co(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Ao.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Ao.prototype.outputDefined=function(){return!1},Ao.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var Lo=function(e){this.type=oi,this.input=e};Lo.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,bn);return r?new Lo(r):t.error("No image name provided.")},Lo.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=mi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},Lo.prototype.eachChild=function(e){e(this.input)},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){return["image",this.input.serialize()]};var so={"to-boolean":on,"to-color":un,"to-number":$t,"to-string":bn},Ro=function(e,t){this.type=e,this.args=t};Ro.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=so[r],v=[],y=1;y<e.length;y++){var x=t.parse(e[y],y,xn);if(!x)return null;v.push(x)}return new Ro(f,v)},Ro.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Gi)return t;if(typeof t=="string"){var y=e.parseColor(t);if(y)return y}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":ga(t[0],t[1],t[2],t[3])))return new Gi(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Xa(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,M=0,B=this.args;M<B.length;M+=1){if((x=B[M].evaluate(e))===null)return 0;var G=Number(x);if(!isNaN(G))return G}throw new Xa("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?ya.fromString(Co(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?mi.fromString(Co(this.args[0].evaluate(e))):Co(this.args[0].evaluate(e))},Ro.prototype.eachChild=function(e){this.args.forEach(e)},Ro.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ro.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Lo(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Hi=["Unknown","Point","LineString","Polygon"],Da=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Da.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Da.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Hi[this.feature.type]:this.feature.type:null},Da.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Da.prototype.canonicalID=function(){return this.canonical},Da.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Da.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Gi.parse(e)),t};var Ba=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};Ba.prototype.evaluate=function(e){return this._evaluate(e,this.args)},Ba.prototype.eachChild=function(e){this.args.forEach(e)},Ba.prototype.outputDefined=function(){return!1},Ba.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},Ba.parse=function(e,t){var r,f=e[0],v=Ba.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var y=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,M=x.filter(function(fi){var zn=fi[0];return!Array.isArray(zn)||zn.length===e.length-1}),B=null,G=0,$=M;G<$.length;G+=1){var ne=$[G],he=ne[0],_e=ne[1];B=new Ts(t.registry,t.path,null,t.scope);for(var Ge=[],We=!1,ht=1;ht<e.length;ht++){var qe=e[ht],Pt=Array.isArray(he)?he[ht-1]:he.type,Wt=B.parse(qe,1+Ge.length,Pt);if(!Wt){We=!0;break}Ge.push(Wt)}if(!We)if(Array.isArray(he)&&he.length!==Ge.length)B.error("Expected "+he.length+" arguments, but found "+Ge.length+" instead.");else{for(var cr=0;cr<Ge.length;cr++){var vr=Array.isArray(he)?he[cr]:he.type,Ir=Ge[cr];B.concat(cr+1).checkSubtype(vr,Ir.type)}if(B.errors.length===0)return new Ba(f,y,_e,Ge)}}if(M.length===1)(r=t.errors).push.apply(r,B.errors);else{for(var tn=(M.length?M:x).map(function(fi){var zn;return zn=fi[0],Array.isArray(zn)?"("+zn.map(zi).join(", ")+")":"("+zi(zn.type)+"...)"}).join(" | "),dn=[],li=1;li<e.length;li++){var Bn=t.parse(e[li],1+dn.length);if(!Bn)return null;dn.push(zi(Bn.type))}t.error("Expected arguments of type "+tn+", but found ("+dn.join(", ")+") instead.")}return null},Ba.register=function(e,t){for(var r in Ba.definitions=t,t)e[r]=Ba};var _s=function(e,t,r){this.type=Oi,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function _a(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function xe(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function ke(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function lt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function Xt(e,t){for(var r,f,v,y,x,M,B,G=!1,$=0,ne=t.length;$<ne;$++)for(var he=t[$],_e=0,Ge=he.length;_e<Ge-1;_e++){if((y=(r=e)[0]-(f=he[_e])[0])*(B=r[1]-(v=he[_e+1])[1])-(M=r[0]-v[0])*(x=r[1]-f[1])==0&&y*M<=0&&x*B<=0)return!1;lt(e,he[_e],he[_e+1])&&(G=!G)}return G}function Xr(e,t){for(var r=0;r<t.length;r++)if(Xt(e,t[r]))return!0;return!1}function $n(e,t,r,f){var v=f[0]-r[0],y=f[1]-r[1],x=(e[0]-r[0])*y-v*(e[1]-r[1]),M=(t[0]-r[0])*y-v*(t[1]-r[1]);return x>0&&M<0||x<0&&M>0}function yi(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var y=v[f],x=0;x<y.length-1;++x)if((ne=[($=y[x+1])[0]-(G=y[x])[0],$[1]-G[1]])[0]*(he=[(B=t)[0]-(M=e)[0],B[1]-M[1]])[1]-ne[1]*he[0]!=0&&$n(M,B,G,$)&&$n(G,$,M,B))return!0;var M,B,G,$,ne,he;return!1}function no(e,t){for(var r=0;r<e.length;++r)if(!Xt(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(yi(e[f],e[f+1],t))return!1;return!0}function Ya(e,t){for(var r=0;r<t.length;r++)if(no(e,t[r]))return!0;return!1}function uo(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var y=[],x=0;x<e[v].length;x++){var M=ke(e[v][x],r);_a(t,M),y.push(M)}f.push(y)}return f}function Ko(e,t,r){for(var f=[],v=0;v<e.length;v++){var y=uo(e[v],t,r);f.push(y)}return f}function Hs(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,y=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;y===0&&(y=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=y}_a(t,e)}function xs(e,t,r,f){for(var v=8192*Math.pow(2,f.z),y=[8192*f.x,8192*f.y],x=[],M=0,B=e;M<B.length;M+=1)for(var G=0,$=B[M];G<$.length;G+=1){var ne=$[G],he=[ne.x+y[0],ne.y+y[1]];Hs(he,t,r,v),x.push(he)}return x}function po(e,t,r,f){for(var v,y=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],M=[],B=0,G=e;B<G.length;B+=1){for(var $=[],ne=0,he=G[B];ne<he.length;ne+=1){var _e=he[ne],Ge=[_e.x+x[0],_e.y+x[1]];_a(t,Ge),$.push(Ge)}M.push($)}if(t[2]-t[0]<=y/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var We=0,ht=M;We<ht.length;We+=1)for(var qe=0,Pt=ht[We];qe<Pt.length;qe+=1)Hs(Pt[qe],t,r,y)}return M}_s.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,on);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,on);if(!v)return null;var y=null;return r.locale&&!(y=t.parse(r.locale,1,bn))?null:new _s(f,v,y)},_s.prototype.evaluate=function(e){return new da(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},_s.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},_s.prototype.outputDefined=function(){return!1},_s.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var fs=function(e,t){this.type=on,this.geojson=e,this.geometries=t};function zo(e){if(e instanceof Ba&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof fs)return!1;var t=!0;return e.eachChild(function(r){t&&!zo(r)&&(t=!1)}),t}function $o(e){if(e instanceof Ba&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!$o(r)&&(t=!1)}),t}function yo(e,t){if(e instanceof Ba&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!yo(f,t)&&(r=!1)}),r}fs.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(Gs(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new fs(r,r.features[f].geometry)}else if(r.type==="Feature"){var y=r.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new fs(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new fs(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},fs.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var x=uo(r.coordinates,v,y),M=xs(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!Xt(G[B],x))return!1}if(r.type==="MultiPolygon"){var $=Ko(r.coordinates,v,y),ne=xs(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var he=0,_e=ne;he<_e.length;he+=1)if(!Xr(_e[he],$))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],y=t.canonicalID();if(r.type==="Polygon"){var x=uo(r.coordinates,v,y),M=po(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var B=0,G=M;B<G.length;B+=1)if(!no(G[B],x))return!1}if(r.type==="MultiPolygon"){var $=Ko(r.coordinates,v,y),ne=po(t.geometry(),f,v,y);if(!xe(f,v))return!1;for(var he=0,_e=ne;he<_e.length;he+=1)if(!Ya(_e[he],$))return!1}return!0}(e,this.geometries)}return!1},fs.prototype.eachChild=function(){},fs.prototype.outputDefined=function(){return!0},fs.prototype.serialize=function(){return["within",this.geojson]};var Si=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Si.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new Si(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Si.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Si.prototype.eachChild=function(){},Si.prototype.outputDefined=function(){return!1},Si.prototype.serialize=function(){return["var",this.name]};var Ts=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new Ln),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(y){return"["+y+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function Ps(e,t){for(var r,f=e.length-1,v=0,y=f,x=0;v<=y;)if((r=e[x=Math.floor((v+y)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new Xa("Input is not a number.");y=x-1}return 0}Ts.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},Ts.prototype._parse=function(e,t){function r(G,$,ne){return ne==="assert"?new Zi($,[G]):ne==="coerce"?new Ro($,[G]):G}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var y=v.parse(e,this);if(!y)return null;if(this.expectedType){var x=this.expectedType,M=y.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||M.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(x,M))return null}else y=r(y,x,t.typeAnnotation||"coerce");else y=r(y,x,t.typeAnnotation||"assert")}if(!(y instanceof Wa)&&y.type.kind!=="resolvedImage"&&function G($){if($ instanceof Si)return G($.boundExpression);if($ instanceof Ba&&$.name==="error"||$ instanceof _s||$ instanceof fs)return!1;var ne=$ instanceof Ro||$ instanceof Zi,he=!0;return $.eachChild(function(_e){he=ne?he&&G(_e):he&&_e instanceof Wa}),!!he&&zo($)&&yo($,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(y)){var B=new Da;try{y=new Wa(y.type,y.evaluate(B))}catch(G){return this.error(G.message),null}}return y}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Ts.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new Ts(this.registry,f,t||null,v,this.errors)},Ts.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Rr(f,e))},Ts.prototype.checkSubtype=function(e,t){var r=ca(e,t);return r&&this.error(r),r};var bs=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var y=v[f],x=y[1];this.labels.push(y[0]),this.outputs.push(x)}};function Ca(e,t,r){return e*(1-r)+t*r}bs.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,$t);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var y=1;y<e.length;y+=2){var x=y===1?-1/0:e[y],M=e[y+1],B=y,G=y+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',B);var $=t.parse(M,G,v);if(!$)return null;v=v||$.type,f.push([x,$])}return new bs(v,r,f)},bs.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[Ps(t,f)].evaluate(e)},bs.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},bs.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},bs.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var To=Object.freeze({__proto__:null,number:Ca,color:function(e,t,r){return new Gi(Ca(e.r,t.r,r),Ca(e.g,t.g,r),Ca(e.b,t.b,r),Ca(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Ca(f,t[v],r)})}}),mu=6/29*3*(6/29),wl=Math.PI/180,Vu=180/Math.PI;function Wl(e){return e>.008856451679035631?Math.pow(e,1/3):e/mu+4/29}function rl(e){return e>6/29?e*e*e:mu*(e-4/29)}function yu(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Na(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Gu(e){var t=Na(e.r),r=Na(e.g),f=Na(e.b),v=Wl((.4124564*t+.3575761*r+.1804375*f)/.95047),y=Wl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*y-16,a:500*(v-y),b:200*(y-Wl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*rl(t),r=.95047*rl(r),f=1.08883*rl(f),new Gi(yu(3.2404542*r-1.5371385*t-.4985314*f),yu(-.969266*r+1.8760108*t+.041556*f),yu(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function S(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var j={forward:Gu,reverse:m,interpolate:function(e,t,r){return{l:Ca(e.l,t.l,r),a:Ca(e.a,t.a,r),b:Ca(e.b,t.b,r),alpha:Ca(e.alpha,t.alpha,r)}}},O={forward:function(e){var t=Gu(e),r=t.l,f=t.a,v=t.b,y=Math.atan2(v,f)*Vu;return{h:y<0?y+360:y,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*wl,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:S(e.h,t.h,r),c:Ca(e.c,t.c,r),l:Ca(e.l,t.l,r),alpha:Ca(e.alpha,t.alpha,r)}}},ue=Object.freeze({__proto__:null,lab:j,hcl:O}),Oe=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var y=0,x=v;y<x.length;y+=1){var M=x[y],B=M[1];this.labels.push(M[0]),this.outputs.push(B)}};function st(e,t,r,f){var v=f-r,y=e-r;return v===0?0:t===1?y/v:(Math.pow(t,y)-1)/(Math.pow(t,v)-1)}Oe.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=st(t,e.base,r,f);else if(e.name==="linear")v=st(t,1,r,f);else if(e.name==="cubic-bezier"){var y=e.controlPoints;v=new Q(y[0],y[1],y[2],y[3]).solve(st(t,1,r,f))}return v},Oe.parse=function(e,t){var r=e[0],f=e[1],v=e[2],y=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var M=f.slice(1);if(M.length!==4||M.some(function(ht){return typeof ht!="number"||ht<0||ht>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,$t)))return null;var B=[],G=null;r==="interpolate-hcl"||r==="interpolate-lab"?G=un:t.expectedType&&t.expectedType.kind!=="value"&&(G=t.expectedType);for(var $=0;$<y.length;$+=2){var ne=y[$],he=y[$+1],_e=$+3,Ge=$+4;if(typeof ne!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',_e);if(B.length&&B[B.length-1][0]>=ne)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',_e);var We=t.parse(he,Ge,G);if(!We)return null;G=G||We.type,B.push([ne,We])}return G.kind==="number"||G.kind==="color"||G.kind==="array"&&G.itemType.kind==="number"&&typeof G.N=="number"?new Oe(G,r,f,v,B):t.error("Type "+zi(G)+" is not interpolatable.")},Oe.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var y=Ps(t,f),x=Oe.interpolationFactor(this.interpolation,f,t[y],t[y+1]),M=r[y].evaluate(e),B=r[y+1].evaluate(e);return this.operator==="interpolate"?To[this.type.kind.toLowerCase()](M,B,x):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(B),x)):j.reverse(j.interpolate(j.forward(M),j.forward(B),x))},Oe.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Oe.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Oe.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Lt=function(e,t){this.type=e,this.args=t};Lt.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],y=0,x=e.slice(1);y<x.length;y+=1){var M=t.parse(x[y],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!M)return null;r=r||M.type,v.push(M)}var B=f&&v.some(function(G){return ca(f,G.type)});return new Lt(B?xn:r,v)},Lt.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,y=this.args;v<y.length&&(f++,(r=y[v].evaluate(e))&&r instanceof mi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Lt.prototype.eachChild=function(e){this.args.forEach(e)},Lt.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Lt.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Mt=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Mt.prototype.evaluate=function(e){return this.result.evaluate(e)},Mt.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Mt.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var y=t.parse(e[f+1],f+1);if(!y)return null;r.push([v,y])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new Mt(r,x):null},Mt.prototype.outputDefined=function(){return this.result.outputDefined()},Mt.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var wr=function(e,t,r){this.type=e,this.index=t,this.input=r};wr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,$t),f=t.parse(e[2],2,Ki(t.expectedType||xn));return r&&f?new wr(f.type.itemType,r,f):null},wr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Xa("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new Xa("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new Xa("Array index must be an integer, but found "+t+" instead.");return r[t]},wr.prototype.eachChild=function(e){e(this.index),e(this.input)},wr.prototype.outputDefined=function(){return!1},wr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var jr=function(e,t){this.type=on,this.needle=e,this.haystack=t};jr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,xn);return r&&f?ba(r.type,[on,bn,$t,Mn,xn])?new jr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+zi(r.type)+" instead"):null},jr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!ai(t,["boolean","string","number","null"]))throw new Xa("Expected first argument to be of type boolean, string, number or null, but found "+zi(Sa(t))+" instead.");if(!ai(r,["string","array"]))throw new Xa("Expected second argument to be of type array or string, but found "+zi(Sa(r))+" instead.");return r.indexOf(t)>=0},jr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},jr.prototype.outputDefined=function(){return!0},jr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var qn=function(e,t,r){this.type=$t,this.needle=e,this.haystack=t,this.fromIndex=r};qn.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,xn);if(!r||!f)return null;if(!ba(r.type,[on,bn,$t,Mn,xn]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+zi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,$t);return v?new qn(r,f,v):null}return new qn(r,f)},qn.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!ai(t,["boolean","string","number","null"]))throw new Xa("Expected first argument to be of type boolean, string, number or null, but found "+zi(Sa(t))+" instead.");if(!ai(r,["string","array"]))throw new Xa("Expected second argument to be of type array or string, but found "+zi(Sa(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},qn.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},qn.prototype.outputDefined=function(){return!1},qn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Pi=function(e,t,r,f,v,y){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=y};Pi.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},y=[],x=2;x<e.length-1;x+=2){var M=e[x],B=e[x+1];Array.isArray(M)||(M=[M]);var G=t.concat(x);if(M.length===0)return G.error("Expected at least one branch label.");for(var $=0,ne=M;$<ne.length;$+=1){var he=ne[$];if(typeof he!="number"&&typeof he!="string")return G.error("Branch labels must be numbers or strings.");if(typeof he=="number"&&Math.abs(he)>Number.MAX_SAFE_INTEGER)return G.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof he=="number"&&Math.floor(he)!==he)return G.error("Numeric branch labels must be integer values.");if(r){if(G.checkSubtype(r,Sa(he)))return null}else r=Sa(he);if(v[String(he)]!==void 0)return G.error("Branch labels must be unique.");v[String(he)]=y.length}var _e=t.parse(B,x,f);if(!_e)return null;f=f||_e.type,y.push(_e)}var Ge=t.parse(e[1],1,xn);if(!Ge)return null;var We=t.parse(e[e.length-1],e.length-1,f);return We?Ge.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ge.type)?null:new Pi(r,f,Ge,v,y,We):null},Pi.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Sa(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Pi.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Pi.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Pi.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,y=Object.keys(this.cases).sort();v<y.length;v+=1){var x=y[v];(ne=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[ne][1].push(x)}for(var M=function(_e){return e.inputType.kind==="number"?Number(_e):_e},B=0,G=r;B<G.length;B+=1){var $=G[B],ne=$[0],he=$[1];t.push(he.length===1?M(he[0]):he.map(M)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var ci=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};ci.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var y=t.parse(e[v],v,on);if(!y)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([y,x]),r=r||x.type}var M=t.parse(e[e.length-1],e.length-1,r);return M?new ci(r,f,M):null},ci.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},ci.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},ci.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},ci.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var ei=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Ea(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Fa(e,t,r,f){return f.compare(t,r)===0}function Qi(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(y,x,M){this.type=on,this.lhs=y,this.rhs=x,this.collator=M,this.hasUntypedArgument=y.type.kind==="value"||x.type.kind==="value"}return v.parse=function(y,x){if(y.length!==3&&y.length!==4)return x.error("Expected two or three arguments.");var M=y[0],B=x.parse(y[1],1,xn);if(!B)return null;if(!Ea(M,B.type))return x.concat(1).error('"'+M+`" comparisons are not supported for type '`+zi(B.type)+"'.");var G=x.parse(y[2],2,xn);if(!G)return null;if(!Ea(M,G.type))return x.concat(2).error('"'+M+`" comparisons are not supported for type '`+zi(G.type)+"'.");if(B.type.kind!==G.type.kind&&B.type.kind!=="value"&&G.type.kind!=="value")return x.error("Cannot compare types '"+zi(B.type)+"' and '"+zi(G.type)+"'.");f&&(B.type.kind==="value"&&G.type.kind!=="value"?B=new Zi(G.type,[B]):B.type.kind!=="value"&&G.type.kind==="value"&&(G=new Zi(B.type,[G])));var $=null;if(y.length===4){if(B.type.kind!=="string"&&G.type.kind!=="string"&&B.type.kind!=="value"&&G.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!($=x.parse(y[3],3,Oi)))return null}return new v(B,G,$)},v.prototype.evaluate=function(y){var x=this.lhs.evaluate(y),M=this.rhs.evaluate(y);if(f&&this.hasUntypedArgument){var B=Sa(x),G=Sa(M);if(B.kind!==G.kind||B.kind!=="string"&&B.kind!=="number")throw new Xa('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+B.kind+", "+G.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var $=Sa(x),ne=Sa(M);if($.kind!=="string"||ne.kind!=="string")return t(y,x,M)}return this.collator?r(y,x,M,this.collator.evaluate(y)):t(y,x,M)},v.prototype.eachChild=function(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var y=[e];return this.eachChild(function(x){y.push(x.serialize())}),y},v}()}ei.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,xn),f=t.parse(e[2],2,$t);if(!r||!f)return null;if(!ba(r.type,[Ki(xn),bn,xn]))return t.error("Expected first argument to be of type array or string, but found "+zi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,$t);return v?new ei(r.type,r,f,v):null}return new ei(r.type,r,f)},ei.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!ai(t,["string","array"]))throw new Xa("Expected first argument to be of type array or string, but found "+zi(Sa(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},ei.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},ei.prototype.outputDefined=function(){return!1},ei.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var hs=Qi("==",function(e,t,r){return t===r},Fa),go=Qi("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!Fa(0,t,r,f)}),Ms=Qi("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),iu=Qi(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Ds=Qi("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),nl=Qi(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),Ws=function(e,t,r,f,v){this.type=bn,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};Ws.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,$t);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,bn)))return null;var y=null;if(f.currency&&!(y=t.parse(f.currency,1,bn)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,$t)))return null;var M=null;return f["max-fraction-digits"]&&!(M=t.parse(f["max-fraction-digits"],1,$t))?null:new Ws(r,v,y,x,M)},Ws.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},Ws.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},Ws.prototype.outputDefined=function(){return!1},Ws.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var Xs=function(e){this.type=$t,this.input=e};Xs.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+zi(r.type)+" instead."):new Xs(r):null},Xs.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new Xa("Expected value to be of type string or array, but found "+zi(Sa(t))+" instead.")},Xs.prototype.eachChild=function(e){e(this.input)},Xs.prototype.outputDefined=function(){return!1},Xs.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ys={"==":hs,"!=":go,">":iu,"<":Ms,">=":nl,"<=":Ds,array:Zi,at:wr,boolean:Zi,case:ci,coalesce:Lt,collator:_s,format:Ao,image:Lo,in:jr,"index-of":qn,interpolate:Oe,"interpolate-hcl":Oe,"interpolate-lab":Oe,length:Xs,let:Mt,literal:Wa,match:Pi,number:Zi,"number-format":Ws,object:Zi,slice:ei,step:bs,string:Zi,"to-boolean":Ro,"to-color":Ro,"to-number":Ro,"to-string":Ro,var:Si,within:fs};function io(e,t){var r=t[0],f=t[1],v=t[2],y=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=y?y.evaluate(e):1,M=ga(r,f,v,x);if(M)throw new Xa(M);return new Gi(r/255*x,f/255*x,v/255*x,x)}function Cu(e,t){return e in t}function il(e,t){var r=t[e];return r===void 0?null:r}function ps(e){return{type:e}}function Xl(e){return{result:"success",value:e}}function au(e){return{result:"error",value:e}}function Fs(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function hc(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Au(e){return!!e.expression&&e.expression.interpolated}function Aa(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function Tu(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Yl(e){return e}function Pu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function pc(e,t,r,f,v){return Pu(typeof r===v?f[r]:void 0,e.default,t.default)}function dc(e,t,r){if(Aa(r)!=="number")return Pu(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=Ps(e.stops.map(function(y){return y[0]}),r);return e.stops[v][1]}function Dc(e,t,r){var f=e.base!==void 0?e.base:1;if(Aa(r)!=="number")return Pu(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var y=Ps(e.stops.map(function(ne){return ne[0]}),r),x=function(ne,he,_e,Ge){var We=Ge-_e,ht=ne-_e;return We===0?0:he===1?ht/We:(Math.pow(he,ht)-1)/(Math.pow(he,We)-1)}(r,f,e.stops[y][0],e.stops[y+1][0]),M=e.stops[y][1],B=e.stops[y+1][1],G=To[t.type]||Yl;if(e.colorSpace&&e.colorSpace!=="rgb"){var $=ue[e.colorSpace];G=function(ne,he){return $.reverse($.interpolate($.forward(ne),$.forward(he),x))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var ne=[],he=arguments.length;he--;)ne[he]=arguments[he];var _e=M.evaluate.apply(void 0,ne),Ge=B.evaluate.apply(void 0,ne);if(_e!==void 0&&Ge!==void 0)return G(_e,Ge,x)}}:G(M,B,x)}function Fc(e,t,r){return t.type==="color"?r=Gi.parse(r):t.type==="formatted"?r=ya.fromString(r.toString()):t.type==="resolvedImage"?r=mi.fromString(r.toString()):Aa(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),Pu(r,e.default,t.default)}Ba.register(Ys,{error:[{kind:"error"},[bn],function(e,t){throw new Xa(t[0].evaluate(e))}],typeof:[bn,[xn],function(e,t){return zi(Sa(t[0].evaluate(e)))}],"to-rgba":[Ki($t,4),[un],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[un,[$t,$t,$t],io],rgba:[un,[$t,$t,$t,$t],io],has:{type:on,overloads:[[[bn],function(e,t){return Cu(t[0].evaluate(e),e.properties())}],[[bn,wi],function(e,t){var r=t[1];return Cu(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:xn,overloads:[[[bn],function(e,t){return il(t[0].evaluate(e),e.properties())}],[[bn,wi],function(e,t){var r=t[1];return il(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[xn,[bn],function(e,t){return il(t[0].evaluate(e),e.featureState||{})}],properties:[wi,[],function(e){return e.properties()}],"geometry-type":[bn,[],function(e){return e.geometryType()}],id:[xn,[],function(e){return e.id()}],zoom:[$t,[],function(e){return e.globals.zoom}],"heatmap-density":[$t,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[$t,[],function(e){return e.globals.lineProgress||0}],accumulated:[xn,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[$t,ps($t),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[$t,ps($t),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:$t,overloads:[[[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[$t],function(e,t){return-t[0].evaluate(e)}]]},"/":[$t,[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[$t,[$t,$t],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[$t,[],function(){return Math.LN2}],pi:[$t,[],function(){return Math.PI}],e:[$t,[],function(){return Math.E}],"^":[$t,[$t,$t],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[$t,[$t],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[$t,[$t],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[$t,[$t],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[$t,[$t],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[$t,[$t],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[$t,[$t],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[$t,[$t],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[$t,[$t],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[$t,ps($t),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[$t,ps($t),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[$t,[$t],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[$t,[$t],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[$t,[$t],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[$t,[$t],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[on,[bn,xn],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[on,[xn],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[on,[bn],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[on,[bn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<y}],"filter-id-<":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[on,[bn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>y}],"filter-id->":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[on,[bn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v<=y}],"filter-id-<=":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[on,[bn,xn],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],y=f.value;return typeof v==typeof y&&v>=y}],"filter-id->=":[on,[xn],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[on,[xn],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[on,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[on,[Ki(bn)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[on,[Ki(xn)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[on,[bn,Ki(xn)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[on,[bn,Ki(xn)],function(e,t){var r=t[0],f=t[1];return function(v,y,x,M){for(;x<=M;){var B=x+M>>1;if(y[B]===v)return!0;y[B]>v?M=B-1:x=B+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:on,overloads:[[[on,on],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[ps(on),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:on,overloads:[[[on,on],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[ps(on),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[on,[on],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[on,[bn],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[bn,[bn],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[bn,[bn],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[bn,ps(xn),function(e,t){return t.map(function(r){return Co(r.evaluate(e))}).join("")}],"resolved-locale":[bn,[Oi],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Cl=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Da,this._defaultValue=t?function(r){return r.type==="color"&&Tu(r.default)?new Gi(0,0,0,0):r.type==="color"?Gi.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function gu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Ys}function al(e,t){var r=new Ts(Ys,[],t?function(v){var y={color:un,string:bn,number:$t,enum:bn,boolean:on,formatted:Yi,resolvedImage:oi};return v.type==="array"?Ki(y[v.value]||xn,v.length):y[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Xl(new Cl(f,t)):au(r.errors)}Cl.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)},Cl.prototype.evaluate=function(e,t,r,f,v,y){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=y||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new Xa("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var ol=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!$o(t.expression)};ol.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},ol.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)};var Hu=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!$o(t.expression),this.interpolationType=f};function sl(e,t){if((e=al(e,t)).result==="error")return e;var r=e.value.expression,f=zo(r);if(!f&&!Fs(t))return au([new Rr("","data expressions not supported")]);var v=yo(r,["zoom"]);if(!v&&!hc(t))return au([new Rr("","zoom expressions not supported")]);var y=function x(M){var B=null;if(M instanceof Mt)B=x(M.result);else if(M instanceof Lt)for(var G=0,$=M.args;G<$.length&&!(B=x($[G]));G+=1);else(M instanceof bs||M instanceof Oe)&&M.input instanceof Ba&&M.input.name==="zoom"&&(B=M);return B instanceof Rr||M.eachChild(function(ne){var he=x(ne);he instanceof Rr?B=he:!B&&he?B=new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):B&&he&&B!==he&&(B=new Rr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),B}(r);return y||v?y instanceof Rr?au([y]):y instanceof Oe&&!Au(t)?au([new Rr("",'"interpolate" expressions cannot be used with this property')]):Xl(y?new Hu(f?"camera":"composite",e.value,y.labels,y instanceof Oe?y.interpolation:void 0):new ol(f?"constant":"source",e.value)):au([new Rr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Hu.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,y){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,y)},Hu.prototype.evaluate=function(e,t,r,f,v,y){return this._styleExpression.evaluate(e,t,r,f,v,y)},Hu.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Oe.interpolationFactor(this.interpolationType,e,t,r):0};var Wu=function(e,t){this._parameters=e,this._specification=t,xr(this,function r(f,v){var y,x,M,B=v.type==="color",G=f.stops&&typeof f.stops[0][0]=="object",$=G||!(G||f.property!==void 0),ne=f.type||(Au(v)?"exponential":"interval");if(B&&((f=xr({},f)).stops&&(f.stops=f.stops.map(function(Bn){return[Bn[0],Gi.parse(Bn[1])]})),f.default=Gi.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!ue[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(ne==="exponential")y=Dc;else if(ne==="interval")y=dc;else if(ne==="categorical"){y=pc,x=Object.create(null);for(var he=0,_e=f.stops;he<_e.length;he+=1){var Ge=_e[he];x[Ge[0]]=Ge[1]}M=typeof f.stops[0][0]}else{if(ne!=="identity")throw new Error('Unknown function type "'+ne+'"');y=Fc}if(G){for(var We={},ht=[],qe=0;qe<f.stops.length;qe++){var Pt=f.stops[qe],Wt=Pt[0].zoom;We[Wt]===void 0&&(We[Wt]={zoom:Wt,type:f.type,property:f.property,default:f.default,stops:[]},ht.push(Wt)),We[Wt].stops.push([Pt[0].value,Pt[1]])}for(var cr=[],vr=0,Ir=ht;vr<Ir.length;vr+=1){var tn=Ir[vr];cr.push([We[tn].zoom,r(We[tn],v)])}var dn={name:"linear"};return{kind:"composite",interpolationType:dn,interpolationFactor:Oe.interpolationFactor.bind(void 0,dn),zoomStops:cr.map(function(Bn){return Bn[0]}),evaluate:function(Bn,fi){var zn=Bn.zoom;return Dc({stops:cr,base:f.base},v,zn).evaluate(zn,fi)}}}if($){var li=ne==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:li,interpolationFactor:Oe.interpolationFactor.bind(void 0,li),zoomStops:f.stops.map(function(Bn){return Bn[0]}),evaluate:function(Bn){return y(f,v,Bn.zoom,x,M)}}}return{kind:"source",evaluate:function(Bn,fi){var zn=fi&&fi.properties?fi.properties[f.property]:void 0;return zn===void 0?Pu(f.default,v.default):y(f,v,zn,x,M)}}}(this._parameters,this._specification))};function Bs(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},y=e.style,x=e.styleSpec,M=[],B=Aa(r);if(B!=="object")return[new Ce(t,r,"object expected, "+B+" found")];for(var G in r){var $=G.split(".")[0],ne=f[$]||f["*"],he=void 0;if(v[$])he=v[$];else if(f[$])he=ra;else if(v["*"])he=v["*"];else{if(!f["*"]){M.push(new Ce(t,r[G],'unknown property "'+G+'"'));continue}he=ra}M=M.concat(he({key:(t&&t+".")+G,value:r[G],valueSpec:ne,style:y,styleSpec:x,object:r,objectKey:G},r))}for(var _e in f)v[_e]||f[_e].required&&f[_e].default===void 0&&r[_e]===void 0&&M.push(new Ce(t,r,'missing required property "'+_e+'"'));return M}function vc(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,y=e.key,x=e.arrayElementValidator||ra;if(Aa(t)!=="array")return[new Ce(y,t,"array expected, "+Aa(t)+" found")];if(r.length&&t.length!==r.length)return[new Ce(y,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Ce(y,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var M={type:r.value,values:r.values};v.$version<7&&(M.function=r.function),Aa(r.value)==="object"&&(M=r.value);for(var B=[],G=0;G<t.length;G++)B=B.concat(x({array:t,arrayIndex:G,value:t[G],valueSpec:M,style:f,styleSpec:v,key:y+"["+G+"]"}));return B}function mc(e){var t=e.key,r=e.value,f=e.valueSpec,v=Aa(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Ce(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Ce(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Ce(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function Bc(e){var t,r,f,v=e.valueSpec,y=Gt(e.value.type),x={},M=y!=="categorical"&&e.value.property===void 0,B=!M,G=Aa(e.value.stops)==="array"&&Aa(e.value.stops[0])==="array"&&Aa(e.value.stops[0][0])==="object",$=Bs({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(_e){if(y==="identity")return[new Ce(_e.key,_e.value,'identity function may not have a "stops" property')];var Ge=[],We=_e.value;return Ge=Ge.concat(vc({key:_e.key,value:We,valueSpec:_e.valueSpec,style:_e.style,styleSpec:_e.styleSpec,arrayElementValidator:ne})),Aa(We)==="array"&&We.length===0&&Ge.push(new Ce(_e.key,We,"array must have at least one stop")),Ge},default:function(_e){return ra({key:_e.key,value:_e.value,valueSpec:v,style:_e.style,styleSpec:_e.styleSpec})}}});return y==="identity"&&M&&$.push(new Ce(e.key,e.value,'missing required property "property"')),y==="identity"||e.value.stops||$.push(new Ce(e.key,e.value,'missing required property "stops"')),y==="exponential"&&e.valueSpec.expression&&!Au(e.valueSpec)&&$.push(new Ce(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(B&&!Fs(e.valueSpec)?$.push(new Ce(e.key,e.value,"property functions not supported")):M&&!hc(e.valueSpec)&&$.push(new Ce(e.key,e.value,"zoom functions not supported"))),y!=="categorical"&&!G||e.value.property!==void 0||$.push(new Ce(e.key,e.value,'"property" property is required')),$;function ne(_e){var Ge=[],We=_e.value,ht=_e.key;if(Aa(We)!=="array")return[new Ce(ht,We,"array expected, "+Aa(We)+" found")];if(We.length!==2)return[new Ce(ht,We,"array length 2 expected, length "+We.length+" found")];if(G){if(Aa(We[0])!=="object")return[new Ce(ht,We,"object expected, "+Aa(We[0])+" found")];if(We[0].zoom===void 0)return[new Ce(ht,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new Ce(ht,We,"object stop key must have value")];if(f&&f>Gt(We[0].zoom))return[new Ce(ht,We[0].zoom,"stop zoom values must appear in ascending order")];Gt(We[0].zoom)!==f&&(f=Gt(We[0].zoom),r=void 0,x={}),Ge=Ge.concat(Bs({key:ht+"[0]",value:We[0],valueSpec:{zoom:{}},style:_e.style,styleSpec:_e.styleSpec,objectElementValidators:{zoom:mc,value:he}}))}else Ge=Ge.concat(he({key:ht+"[0]",value:We[0],valueSpec:{},style:_e.style,styleSpec:_e.styleSpec},We));return gu(Jt(We[1]))?Ge.concat([new Ce(ht+"[1]",We[1],"expressions are not allowed in function stops.")]):Ge.concat(ra({key:ht+"[1]",value:We[1],valueSpec:v,style:_e.style,styleSpec:_e.styleSpec}))}function he(_e,Ge){var We=Aa(_e.value),ht=Gt(_e.value),qe=_e.value!==null?_e.value:Ge;if(t){if(We!==t)return[new Ce(_e.key,qe,We+" stop domain type must match previous stop domain type "+t)]}else t=We;if(We!=="number"&&We!=="string"&&We!=="boolean")return[new Ce(_e.key,qe,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&y!=="categorical"){var Pt="number expected, "+We+" found";return Fs(v)&&y===void 0&&(Pt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ce(_e.key,qe,Pt)]}return y!=="categorical"||We!=="number"||isFinite(ht)&&Math.floor(ht)===ht?y!=="categorical"&&We==="number"&&r!==void 0&&ht<r?[new Ce(_e.key,qe,"stop domain values must appear in ascending order")]:(r=ht,y==="categorical"&&ht in x?[new Ce(_e.key,qe,"stop domain values must be unique")]:(x[ht]=!0,[])):[new Ce(_e.key,qe,"integer expected, found "+ht)]}}function Xu(e){var t=(e.expressionContext==="property"?sl:al)(Jt(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Ce(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Ce(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!$o(r))return[new Ce(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!$o(r))return[new Ce(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!yo(r,["zoom","feature-state"]))return[new Ce(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!zo(r))return[new Ce(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Al(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Gt(r))===-1&&v.push(new Ce(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Gt(r))===-1&&v.push(new Ce(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function Kl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!Kl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}Wu.deserialize=function(e){return new Wu(e._parameters,e._specification)},Wu.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var yc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Yu(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};Kl(e)||(e=Pl(e));var t=al(e,yc);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function Tl(e,t){return e<t?-1:e>t?1:0}function Pl(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Mu(e[1],e[2],"=="):r==="!="?Iu(Mu(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Mu(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Pl))):r==="all"?["all"].concat(e.slice(1).map(Pl)):r==="none"?["all"].concat(e.slice(1).map(Pl).map(Iu)):r==="in"?$l(e[1],e.slice(2)):r==="!in"?Iu($l(e[1],e.slice(2))):r==="has"?Ua(e[1]):r==="!has"?Iu(Ua(e[1])):r!=="within"||e}function Mu(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function $l(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Tl)]]:["filter-in-small",e,["literal",t]]}}function Ua(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Iu(e){return["!",e]}function ul(e){return Kl(Jt(e.value))?Xu(xr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Aa(f)!=="array")return[new Ce(v,f,"array expected, "+Aa(f)+" found")];var y,x=r.styleSpec,M=[];if(f.length<1)return[new Ce(v,f,"filter array must have at least 1 element")];switch(M=M.concat(Al({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),Gt(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Gt(f[1])==="$type"&&M.push(new Ce(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&M.push(new Ce(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(y=Aa(f[1]))!=="string"&&M.push(new Ce(v+"[1]",f[1],"string expected, "+y+" found"));for(var B=2;B<f.length;B++)y=Aa(f[B]),Gt(f[1])==="$type"?M=M.concat(Al({key:v+"["+B+"]",value:f[B],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&M.push(new Ce(v+"["+B+"]",f[B],"string, number, or boolean expected, "+y+" found"));break;case"any":case"all":case"none":for(var G=1;G<f.length;G++)M=M.concat(t({key:v+"["+G+"]",value:f[G],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":y=Aa(f[1]),f.length!==2?M.push(new Ce(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="string"&&M.push(new Ce(v+"[1]",f[1],"string expected, "+y+" found"));break;case"within":y=Aa(f[1]),f.length!==2?M.push(new Ce(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):y!=="object"&&M.push(new Ce(v+"[1]",f[1],"object expected, "+y+" found"))}return M}(e)}function Jl(e,t){var r=e.key,f=e.style,v=e.styleSpec,y=e.value,x=e.objectKey,M=v[t+"_"+e.layerType];if(!M)return[];var B=x.match(/^(.*)-transition$/);if(t==="paint"&&B&&M[B[1]]&&M[B[1]].transition)return ra({key:r,value:y,valueSpec:v.transition,style:f,styleSpec:v});var G,$=e.valueSpec||M[x];if(!$)return[new Ce(r,y,'unknown property "'+x+'"')];if(Aa(y)==="string"&&Fs($)&&!$.tokens&&(G=/^{([^}]+)}$/.exec(y)))return[new Ce(r,y,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(G[1])+" }`.")];var ne=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&ne.push(new Ce(r,y,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&Tu(Jt(y))&&Gt(y.type)==="identity"&&ne.push(new Ce(r,y,'"text-font" does not support identity functions'))),ne.concat(ra({key:e.key,value:y,valueSpec:$,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function Ql(e){return Jl(e,"paint")}function Ku(e){return Jl(e,"layout")}function Jc(e){var t=[],r=e.value,f=e.key,v=e.style,y=e.styleSpec;r.type||r.ref||t.push(new Ce(f,r,'either "type" or "ref" is required'));var x,M=Gt(r.type),B=Gt(r.ref);if(r.id)for(var G=Gt(r.id),$=0;$<e.arrayIndex;$++){var ne=v.layers[$];Gt(ne.id)===G&&t.push(new Ce(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+ne.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ge){Ge in r&&t.push(new Ce(f,r[Ge],'"'+Ge+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ge){Gt(Ge.id)===B&&(x=Ge)}),x?x.ref?t.push(new Ce(f,r.ref,"ref cannot reference another ref layer")):M=Gt(x.type):t.push(new Ce(f,r.ref,'ref layer "'+B+'" not found'));else if(M!=="background")if(r.source){var he=v.sources&&v.sources[r.source],_e=he&&Gt(he.type);he?_e==="vector"&&M==="raster"?t.push(new Ce(f,r.source,'layer "'+r.id+'" requires a raster source')):_e==="raster"&&M!=="raster"?t.push(new Ce(f,r.source,'layer "'+r.id+'" requires a vector source')):_e!=="vector"||r["source-layer"]?_e==="raster-dem"&&M!=="hillshade"?t.push(new Ce(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!r.paint||!r.paint["line-gradient"]||_e==="geojson"&&he.lineMetrics||t.push(new Ce(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Ce(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Ce(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Ce(f,r,'missing required property "source"'));return t=t.concat(Bs({key:f,value:r,valueSpec:y.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ra({key:f+".type",value:r.type,valueSpec:y.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:ul,layout:function(Ge){return Bs({layer:r,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(We){return Ku(xr({layerType:M},We))}}})},paint:function(Ge){return Bs({layer:r,key:Ge.key,value:Ge.value,style:Ge.style,styleSpec:Ge.styleSpec,objectElementValidators:{"*":function(We){return Ql(xr({layerType:M},We))}}})}}}))}function ll(e){var t=e.value,r=e.key,f=Aa(t);return f!=="string"?[new Ce(r,t,"string expected, "+f+" found")]:[]}var Ka={promoteId:function(e){var t=e.key,r=e.value;if(Aa(r)==="string")return ll({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,ll({key:t+"."+v,value:r[v]}));return f}};function cl(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Ce(r,t,'"type" is required')];var y,x=Gt(t.type);switch(x){case"vector":case"raster":case"raster-dem":return Bs({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:Ka});case"geojson":if(y=Bs({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:Ka}),t.cluster)for(var M in t.clusterProperties){var B=t.clusterProperties[M],G=B[0],$=typeof G=="string"?[G,["accumulated"],["get",M]]:G;y.push.apply(y,Xu({key:r+"."+M+".map",value:B[1],expressionContext:"cluster-map"})),y.push.apply(y,Xu({key:r+"."+M+".reduce",value:$,expressionContext:"cluster-reduce"}))}return y;case"video":return Bs({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return Bs({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Ce(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Al({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function $u(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,y=[],x=Aa(t);if(t===void 0)return y;if(x!=="object")return y.concat([new Ce("light",t,"object expected, "+x+" found")]);for(var M in t){var B=M.match(/^(.*)-transition$/);y=y.concat(B&&f[B[1]]&&f[B[1]].transition?ra({key:M,value:t[M],valueSpec:r.transition,style:v,styleSpec:r}):f[M]?ra({key:M,value:t[M],valueSpec:f[M],style:v,styleSpec:r}):[new Ce(M,t[M],'unknown property "'+M+'"')])}return y}var Ks={"*":function(){return[]},array:vc,boolean:function(e){var t=e.value,r=e.key,f=Aa(t);return f!=="boolean"?[new Ce(r,t,"boolean expected, "+f+" found")]:[]},number:mc,color:function(e){var t=e.key,r=e.value,f=Aa(r);return f!=="string"?[new Ce(t,r,"color expected, "+f+" found")]:ti(r)===null?[new Ce(t,r,'color expected, "'+r+'" found')]:[]},constants:ct,enum:Al,filter:ul,function:Bc,layer:Jc,object:Bs,source:cl,light:$u,string:ll,formatted:function(e){return ll(e).length===0?[]:Xu(e)},resolvedImage:function(e){return ll(e).length===0?[]:Xu(e)}};function ra(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&Tu(Gt(t))?Bc(e):r.expression&&gu(Jt(t))?Xu(e):r.type&&Ks[r.type]?Ks[r.type](e):Bs(xr({},e,{valueSpec:r.type?f[r.type]:r}))}function Za(e){var t=e.value,r=e.key,f=ll(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Ce(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Ce(r,t,'"glyphs" url must include a "{range}" token'))),f}function Ss(e,t){t===void 0&&(t=se);var r=[];return r=r.concat(ra({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Za,"*":function(){return[]}}})),e.constants&&(r=r.concat(ct({key:"constants",value:e.constants,style:e,styleSpec:t}))),Ml(r)}function Ml(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function Ou(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return Ml(e.apply(this,t))}}Ss.source=Ou(cl),Ss.light=Ou($u),Ss.layer=Ou(Jc),Ss.filter=Ou(ul),Ss.paintProperty=Ou(Ql),Ss.layoutProperty=Ou(Ku);var Il=Ss,Qc=Il.light,qc=Il.paintProperty,Ol=Il.layoutProperty;function ql(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new me(new Error(v[f].message))),r=!0;return r}var Lu=ko;function ko(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var y=0;y<this.d*this.d;y++){var x=v[3+y],M=v[3+y+1];f.push(x===M?null:v.subarray(x,M))}var B=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],B),this.bboxes=v.subarray(B),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var G=0;G<this.d*this.d;G++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var $=r/t*e;this.min=-$,this.max=e+$}ko.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(e,t,r,f,v,y){this.cells[v].push(y)},ko.prototype.query=function(e,t,r,f,v){var y=this.min,x=this.max;if(e<=y&&t<=y&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(e,t,r,f,this._queryCell,M,{},v),M},ko.prototype._queryCell=function(e,t,r,f,v,y,x,M){var B=this.cells[v];if(B!==null)for(var G=this.keys,$=this.bboxes,ne=0;ne<B.length;ne++){var he=B[ne];if(x[he]===void 0){var _e=4*he;(M?M($[_e+0],$[_e+1],$[_e+2],$[_e+3]):e<=$[_e+2]&&t<=$[_e+3]&&r>=$[_e+0]&&f>=$[_e+1])?(x[he]=!0,y.push(G[he])):x[he]=!1}}},ko.prototype._forEachCell=function(e,t,r,f,v,y,x,M){for(var B=this._convertToCellCoord(e),G=this._convertToCellCoord(t),$=this._convertToCellCoord(r),ne=this._convertToCellCoord(f),he=B;he<=$;he++)for(var _e=G;_e<=ne;_e++){var Ge=this.d*_e+he;if((!M||M(this._convertFromCellCoord(he),this._convertFromCellCoord(_e),this._convertFromCellCoord(he+1),this._convertFromCellCoord(_e+1)))&&v.call(this,e,t,r,f,Ge,y,x,M))return}},ko.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var y=t,x=0;x<e.length;x++){var M=e[x];v[3+x]=y,v.set(M,y),y+=M.length}return v[3+e.length]=y,v.set(this.keys,y),v[3+e.length+1]=y+=this.keys.length,v.set(this.bboxes,y),y+=this.bboxes.length,v.buffer};var Ns=N.ImageData,fl=N.ImageBitmap,_o={};function Fn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),_o[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var lo in Fn("Object",Object),Lu.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Lu.deserialize=function(e){return new Lu(e.buffer)},Fn("Grid",Lu),Fn("Color",Gi),Fn("Error",Error),Fn("ResolvedImage",mi),Fn("StylePropertyFunction",Wu),Fn("StyleExpression",Cl,{omit:["_evaluator"]}),Fn("ZoomDependentExpression",Hu),Fn("ZoomConstantExpression",ol),Fn("CompoundExpression",Ba,{omit:["_evaluate"]}),Ys)Ys[lo]._classRegistryKey||Fn("Expression_"+lo,Ys[lo]);function Ru(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function hl(e){return fl&&e instanceof fl}function $s(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Ru(e)||hl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof Ns)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,y=e;v<y.length;v+=1)f.push($s(y[v],t));return f}if(typeof e=="object"){var x=e.constructor,M=x._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var B=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var G in e)if(e.hasOwnProperty(G)&&!(_o[M].omit.indexOf(G)>=0)){var $=e[G];B[G]=_o[M].shallow.indexOf(G)>=0?$:$s($,t)}e instanceof Error&&(B.message=e.message)}if(B.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(B.$name=M),B}throw new Error("can't serialize object of type "+typeof e)}function Is(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Ru(e)||hl(e)||ArrayBuffer.isView(e)||e instanceof Ns)return e;if(Array.isArray(e))return e.map(Is);if(typeof e=="object"){var t=e.$name||"Object",r=_o[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,y=Object.keys(e);v<y.length;v+=1){var x=y[v];if(x!=="$name"){var M=e[x];f[x]=_o[t].shallow.indexOf(x)>=0?M:Is(M)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var gc=function(){this.first=!0};gc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var vn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function ec(e){for(var t=0,r=e;t<r.length;t+=1)if(tc(r[t].charCodeAt(0)))return!0;return!1}function tc(e){return!(e!==746&&e!==747&&(e<4352||!(vn["Bopomofo Extended"](e)||vn.Bopomofo(e)||vn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||vn["CJK Compatibility Ideographs"](e)||vn["CJK Compatibility"](e)||vn["CJK Radicals Supplement"](e)||vn["CJK Strokes"](e)||!(!vn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||vn["CJK Unified Ideographs Extension A"](e)||vn["CJK Unified Ideographs"](e)||vn["Enclosed CJK Letters and Months"](e)||vn["Hangul Compatibility Jamo"](e)||vn["Hangul Jamo Extended-A"](e)||vn["Hangul Jamo Extended-B"](e)||vn["Hangul Jamo"](e)||vn["Hangul Syllables"](e)||vn.Hiragana(e)||vn["Ideographic Description Characters"](e)||vn.Kanbun(e)||vn["Kangxi Radicals"](e)||vn["Katakana Phonetic Extensions"](e)||vn.Katakana(e)&&e!==12540||!(!vn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!vn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||vn["Unified Canadian Aboriginal Syllabics"](e)||vn["Unified Canadian Aboriginal Syllabics Extended"](e)||vn["Vertical Forms"](e)||vn["Yijing Hexagram Symbols"](e)||vn["Yi Syllables"](e)||vn["Yi Radicals"](e))))}function ku(e){return!(tc(e)||function(t){return!!(vn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||vn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||vn["Letterlike Symbols"](t)||vn["Number Forms"](t)||vn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||vn["Control Pictures"](t)&&t!==9251||vn["Optical Character Recognition"](t)||vn["Enclosed Alphanumerics"](t)||vn["Geometric Shapes"](t)||vn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||vn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||vn["CJK Symbols and Punctuation"](t)||vn.Katakana(t)||vn["Private Use Area"](t)||vn["CJK Compatibility Forms"](t)||vn["Small Form Variants"](t)||vn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function Va(e){return e>=1424&&e<=2303||vn["Arabic Presentation Forms-A"](e)||vn["Arabic Presentation Forms-B"](e)}function Os(e,t){return!(!t&&Va(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||vn.Khmer(e))}function rc(e){for(var t=0,r=e;t<r.length;t+=1)if(Va(r[t].charCodeAt(0)))return!0;return!1}var _u=null,Ls="unavailable",ou=null,Nc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(Ls="error"),_u&&_u(e)};function Ll(){_c.fire(new oe("pluginStateChange",{pluginStatus:Ls,pluginURL:ou}))}var _c=new Ae,zc=function(){return Ls},Js=function(){if(Ls!=="deferred"||!ou)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ls="loading",Ll(),ou&&Ri({url:ou},function(e){e?Nc(e):(Ls="loaded",Ll())})},Rs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Ls==="loaded"||Rs.applyArabicShaping!=null},isLoading:function(){return Ls==="loading"},setState:function(e){Ls=e.pluginStatus,ou=e.pluginURL},isParsed:function(){return Rs.applyArabicShaping!=null&&Rs.processBidirectionalText!=null&&Rs.processStyledBidirectionalText!=null},getPluginURL:function(){return ou}},qi=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new gc,this.transition={})};qi.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Os(v[f].charCodeAt(0),r))return!1;return!0}(e,Rs.isLoaded())},qi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},qi.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var xu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(Tu(r))return new Wu(r,f);if(gu(r)){var v=sl(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var y=r;return typeof r=="string"&&f.type==="color"&&(y=Gi.parse(r)),{kind:"constant",evaluate:function(){return y}}}(t===void 0?e.specification.default:t,e.specification)};xu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},xu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var zs=function(e){this.property=e,this.value=new xu(e,void 0)};zs.prototype.transitioned=function(e,t){return new pl(this.property,this.value,t,Vt({},e.transition,this.transition),e.now)},zs.prototype.untransitioned=function(){return new pl(this.property,this.value,null,{},0)};var Uo=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Uo.prototype.getValue=function(e){return Ke(this._values[e].value.value)},Uo.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new zs(this._values[e].property)),this._values[e].value=new xu(this._values[e].property,t===null?void 0:Ke(t))},Uo.prototype.getTransition=function(e){return Ke(this._values[e].transition)},Uo.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new zs(this._values[e].property)),this._values[e].transition=Ke(t)||void 0},Uo.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var y=this.getTransition(f);y!==void 0&&(e[f+"-transition"]=y)}return e},Uo.prototype.transitioned=function(e,t){for(var r=new su(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var y=v[f];r._values[y]=this._values[y].transitioned(e,t._values[y])}return r},Uo.prototype.untransitioned=function(){for(var e=new su(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var pl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};pl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),y=this.prior;if(y){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return y.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,t,r),v,function(M){if(M<=0)return 0;if(M>=1)return 1;var B=M*M,G=B*M;return 4*(M<.5?G:3*(M-B)+G-.75)}(x))}return v};var su=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};su.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Du(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var x=y[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},su.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var uu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};uu.prototype.getValue=function(e){return Ke(this._values[e].value)},uu.prototype.setValue=function(e,t){this._values[e]=new xu(this._values[e].property,t===null?void 0:Ke(t))},uu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},uu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new Du(this._properties),v=0,y=Object.keys(this._values);v<y.length;v+=1){var x=y[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var xo=function(e,t,r){this.property=e,this.value=t,this.parameters=r};xo.prototype.isConstant=function(){return this.value.kind==="constant"},xo.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},xo.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var Du=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};Du.prototype.get=function(e){return this._values[e]};var ii=function(e){this.specification=e};ii.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},ii.prototype.interpolate=function(e,t,r){var f=To[this.specification.type];return f?f(e,t,r):e};var Wn=function(e,t){this.specification=e,this.overrides=t};Wn.prototype.possiblyEvaluate=function(e,t,r,f){return new xo(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},Wn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new xo(this,{kind:"constant",value:void 0},e.parameters);var f=To[this.specification.type];return f?new xo(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},Wn.prototype.evaluate=function(e,t,r,f,v,y){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,y)};var Rl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,y){if(r.value===void 0)return new xo(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,y),M=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,B=this._calculate(M,M,M,f);return new xo(this,{kind:"constant",value:B},f)}if(r.expression.kind==="camera"){var G=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new xo(this,{kind:"constant",value:G},f)}return new xo(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,y,x,M){if(r.kind==="source"){var B=r.evaluate(f,v,y,x,M);return this._calculate(B,B,B,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,y),r.evaluate({zoom:Math.floor(f.zoom)},v,y),r.evaluate({zoom:Math.floor(f.zoom)+1},v,y),f):r.value},t.prototype._calculate=function(r,f,v,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(Wn),is=function(e){this.specification=e};is.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new qi(Math.floor(t.zoom-1),t)),e.expression.evaluate(new qi(Math.floor(t.zoom),t)),e.expression.evaluate(new qi(Math.floor(t.zoom+1),t)),t)}},is.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},is.prototype.interpolate=function(e){return e};var Qs=function(e){this.specification=e};Qs.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},Qs.prototype.interpolate=function(){return!1};var Jo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new xu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new zs(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Fn("DataDrivenProperty",Wn),Fn("DataConstantProperty",ii),Fn("CrossFadedDataDrivenProperty",Rl),Fn("CrossFadedProperty",is),Fn("ColorRampProperty",Qs);var lu=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new uu(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Uo(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var y in r.layout)this.setLayoutProperty(y,r.layout[y],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Du(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Ol,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return ee(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(qc,"layers."+this.id+".paint."+r,r,f,v))return!1;if(ee(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var y=this._transitionablePaint._values[r],x=y.property.specification["property-type"]==="cross-faded-data-driven",M=y.value.isDataDriven(),B=y.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var G=this._transitionablePaint._values[r].value;return G.isDataDriven()||M||x||this._handleOverridablePaintPropertyUpdate(r,B,G)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ct(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,y,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&ql(this,r.call(Il,{key:f,layerType:this.type,objectKey:v,value:y,styleSpec:se,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof xo&&Fs(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Ae),xc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},nc=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Wi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Do(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var y=xc[v.type].BYTES_PER_ELEMENT,x=r=Uc(r,Math.max(t,y)),M=v.components||1;return f=Math.max(f,y),r+=y*M,{name:v.name,type:v.type,components:M,offset:x}}),size:Uc(r,Math.max(f,t)),alignment:t}}function Uc(e,t){return Math.ceil(e/t)*t}Wi.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},Wi.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},Wi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Wi.prototype.clear=function(){this.length=0},Wi.prototype.resize=function(e){this.reserve(e),this.length=e},Wi.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},Wi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Es=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.int16[y+0]=f,this.int16[y+1]=v,r},t}(Wi);Es.prototype.bytesPerElement=4,Fn("StructArrayLayout2i4",Es);var ic=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var M=4*r;return this.int16[M+0]=f,this.int16[M+1]=v,this.int16[M+2]=y,this.int16[M+3]=x,r},t}(Wi);ic.prototype.bytesPerElement=8,Fn("StructArrayLayout4i8",ic);var ws=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,y,x,M)},t.prototype.emplace=function(r,f,v,y,x,M,B){var G=6*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.int16[G+2]=y,this.int16[G+3]=x,this.int16[G+4]=M,this.int16[G+5]=B,r},t}(Wi);ws.prototype.bytesPerElement=12,Fn("StructArrayLayout2i4i12",ws);var ds=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,y,x,M)},t.prototype.emplace=function(r,f,v,y,x,M,B){var G=4*r,$=8*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.uint8[$+4]=y,this.uint8[$+5]=x,this.uint8[$+6]=M,this.uint8[$+7]=B,r},t}(Wi);ds.prototype.bytesPerElement=8,Fn("StructArrayLayout2i4ub8",ds);var dl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.float32[y+0]=f,this.float32[y+1]=v,r},t}(Wi);dl.prototype.bytesPerElement=8,Fn("StructArrayLayout2f8",dl);var cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,$,ne){var he=this.length;return this.resize(he+1),this.emplace(he,r,f,v,y,x,M,B,G,$,ne)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,$,ne,he){var _e=10*r;return this.uint16[_e+0]=f,this.uint16[_e+1]=v,this.uint16[_e+2]=y,this.uint16[_e+3]=x,this.uint16[_e+4]=M,this.uint16[_e+5]=B,this.uint16[_e+6]=G,this.uint16[_e+7]=$,this.uint16[_e+8]=ne,this.uint16[_e+9]=he,r},t}(Wi);cu.prototype.bytesPerElement=20,Fn("StructArrayLayout10ui20",cu);var kl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,$,ne,he,_e){var Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,r,f,v,y,x,M,B,G,$,ne,he,_e)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,$,ne,he,_e,Ge){var We=12*r;return this.int16[We+0]=f,this.int16[We+1]=v,this.int16[We+2]=y,this.int16[We+3]=x,this.uint16[We+4]=M,this.uint16[We+5]=B,this.uint16[We+6]=G,this.uint16[We+7]=$,this.int16[We+8]=ne,this.int16[We+9]=he,this.int16[We+10]=_e,this.int16[We+11]=Ge,r},t}(Wi);kl.prototype.bytesPerElement=24,Fn("StructArrayLayout4i4ui4i24",kl);var Ju=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=y,r},t}(Wi);Ju.prototype.bytesPerElement=12,Fn("StructArrayLayout3f12",Ju);var Dl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(Wi);Dl.prototype.bytesPerElement=4,Fn("StructArrayLayout1ul4",Dl);var Zc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,$){var ne=this.length;return this.resize(ne+1),this.emplace(ne,r,f,v,y,x,M,B,G,$)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,$,ne){var he=10*r,_e=5*r;return this.int16[he+0]=f,this.int16[he+1]=v,this.int16[he+2]=y,this.int16[he+3]=x,this.int16[he+4]=M,this.int16[he+5]=B,this.uint32[_e+3]=G,this.uint16[he+8]=$,this.uint16[he+9]=ne,r},t}(Wi);Zc.prototype.bytesPerElement=20,Fn("StructArrayLayout6i1ul2ui20",Zc);var Fl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M){var B=this.length;return this.resize(B+1),this.emplace(B,r,f,v,y,x,M)},t.prototype.emplace=function(r,f,v,y,x,M,B){var G=6*r;return this.int16[G+0]=f,this.int16[G+1]=v,this.int16[G+2]=y,this.int16[G+3]=x,this.int16[G+4]=M,this.int16[G+5]=B,r},t}(Wi);Fl.prototype.bytesPerElement=12,Fn("StructArrayLayout2i2i2i12",Fl);var vl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x){var M=this.length;return this.resize(M+1),this.emplace(M,r,f,v,y,x)},t.prototype.emplace=function(r,f,v,y,x,M){var B=4*r,G=8*r;return this.float32[B+0]=f,this.float32[B+1]=v,this.float32[B+2]=y,this.int16[G+6]=x,this.int16[G+7]=M,r},t}(Wi);vl.prototype.bytesPerElement=16,Fn("StructArrayLayout2f1f2i16",vl);var bc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var M=12*r,B=3*r;return this.uint8[M+0]=f,this.uint8[M+1]=v,this.float32[B+1]=y,this.float32[B+2]=x,r},t}(Wi);bc.prototype.bytesPerElement=12,Fn("StructArrayLayout2ub2f12",bc);var Fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=y,r},t}(Wi);Fu.prototype.bytesPerElement=6,Fn("StructArrayLayout3ui6",Fu);var Bu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,$,ne,he,_e,Ge,We,ht,qe,Pt){var Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,r,f,v,y,x,M,B,G,$,ne,he,_e,Ge,We,ht,qe,Pt)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,$,ne,he,_e,Ge,We,ht,qe,Pt,Wt){var cr=24*r,vr=12*r,Ir=48*r;return this.int16[cr+0]=f,this.int16[cr+1]=v,this.uint16[cr+2]=y,this.uint16[cr+3]=x,this.uint32[vr+2]=M,this.uint32[vr+3]=B,this.uint32[vr+4]=G,this.uint16[cr+10]=$,this.uint16[cr+11]=ne,this.uint16[cr+12]=he,this.float32[vr+7]=_e,this.float32[vr+8]=Ge,this.uint8[Ir+36]=We,this.uint8[Ir+37]=ht,this.uint8[Ir+38]=qe,this.uint32[vr+10]=Pt,this.int16[cr+22]=Wt,r},t}(Wi);Bu.prototype.bytesPerElement=48,Fn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Bu);var Sc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y,x,M,B,G,$,ne,he,_e,Ge,We,ht,qe,Pt,Wt,cr,vr,Ir,tn,dn,li,Bn,fi,zn,Xi){var Ci=this.length;return this.resize(Ci+1),this.emplace(Ci,r,f,v,y,x,M,B,G,$,ne,he,_e,Ge,We,ht,qe,Pt,Wt,cr,vr,Ir,tn,dn,li,Bn,fi,zn,Xi)},t.prototype.emplace=function(r,f,v,y,x,M,B,G,$,ne,he,_e,Ge,We,ht,qe,Pt,Wt,cr,vr,Ir,tn,dn,li,Bn,fi,zn,Xi,Ci){var On=34*r,na=17*r;return this.int16[On+0]=f,this.int16[On+1]=v,this.int16[On+2]=y,this.int16[On+3]=x,this.int16[On+4]=M,this.int16[On+5]=B,this.int16[On+6]=G,this.int16[On+7]=$,this.uint16[On+8]=ne,this.uint16[On+9]=he,this.uint16[On+10]=_e,this.uint16[On+11]=Ge,this.uint16[On+12]=We,this.uint16[On+13]=ht,this.uint16[On+14]=qe,this.uint16[On+15]=Pt,this.uint16[On+16]=Wt,this.uint16[On+17]=cr,this.uint16[On+18]=vr,this.uint16[On+19]=Ir,this.uint16[On+20]=tn,this.uint16[On+21]=dn,this.uint16[On+22]=li,this.uint32[na+12]=Bn,this.float32[na+13]=fi,this.float32[na+14]=zn,this.float32[na+15]=Xi,this.float32[na+16]=Ci,r},t}(Wi);Sc.prototype.bytesPerElement=68,Fn("StructArrayLayout8i15ui1ul4f68",Sc);var Nu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(Wi);Nu.prototype.bytesPerElement=4,Fn("StructArrayLayout1f4",Nu);var Us=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=y,r},t}(Wi);Us.prototype.bytesPerElement=6,Fn("StructArrayLayout3i6",Us);var Ec=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var y=this.length;return this.resize(y+1),this.emplace(y,r,f,v)},t.prototype.emplace=function(r,f,v,y){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=y,r},t}(Wi);Ec.prototype.bytesPerElement=8,Fn("StructArrayLayout1ul2ui8",Ec);var zu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var y=2*r;return this.uint16[y+0]=f,this.uint16[y+1]=v,r},t}(Wi);zu.prototype.bytesPerElement=4,Fn("StructArrayLayout2ui4",zu);var Bl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(Wi);Bl.prototype.bytesPerElement=2,Fn("StructArrayLayout1ui2",Bl);var Qu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,y){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,y)},t.prototype.emplace=function(r,f,v,y,x){var M=4*r;return this.float32[M+0]=f,this.float32[M+1]=v,this.float32[M+2]=y,this.float32[M+3]=x,r},t}(Wi);Qu.prototype.bytesPerElement=16,Fn("StructArrayLayout4f16",Qu);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new W(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(nc);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(Zc);Fn("CollisionBoxArray",u);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(nc);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new o(this,r)},t}(Bu);Fn("PlacedSymbolArray",h);var g=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(nc);g.prototype.size=68;var b=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new g(this,r)},t}(Sc);Fn("SymbolInstanceArray",b);var P=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Nu);Fn("GlyphOffsetArray",P);var D=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(Us);Fn("SymbolLineVertexArray",D);var H=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(nc);H.prototype.size=8;var ae=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new H(this,r)},t}(Ec);Fn("FeatureIndexArray",ae);var Se=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,we=function(e){e===void 0&&(e=[]),this.segments=e};function Pe(e,t){return 256*(e=rt(Math.floor(e),0,255))+rt(Math.floor(t),0,255)}we.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>we.MAX_VERTEX_ARRAY_LENGTH&&Xe("Max vertices per segment is "+we.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>we.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},we.prototype.get=function(){return this.segments},we.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},we.simpleSegment=function(e,t,r,f){return new we([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},we.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fn("SegmentVector",we);var He=Do([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),je=A(function(e){e.exports=function(t,r){var f,v,y,x,M,B,G,$;for(v=t.length-(f=3&t.length),y=r,M=3432918353,B=461845907,$=0;$<v;)G=255&t.charCodeAt($)|(255&t.charCodeAt(++$))<<8|(255&t.charCodeAt(++$))<<16|(255&t.charCodeAt(++$))<<24,++$,y=27492+(65535&(x=5*(65535&(y=(y^=G=(65535&(G=(G=(65535&G)*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(G=0,f){case 3:G^=(255&t.charCodeAt($+2))<<16;case 2:G^=(255&t.charCodeAt($+1))<<8;case 1:y^=G=(65535&(G=(G=(65535&(G^=255&t.charCodeAt($)))*M+(((G>>>16)*M&65535)<<16)&4294967295)<<15|G>>>17))*B+(((G>>>16)*B&65535)<<16)&4294967295}return y^=t.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}}),it=A(function(e){e.exports=function(t,r){for(var f,v=t.length,y=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:y^=(255&t.charCodeAt(x+2))<<16;case 2:y^=(255&t.charCodeAt(x+1))<<8;case 1:y=1540483477*(65535&(y^=255&t.charCodeAt(x)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}}),ze=je,ot=it;ze.murmur3=je,ze.murmur2=ot;var bt=function(){this.ids=[],this.positions=[],this.indexed=!1};bt.prototype.add=function(e,t,r,f){this.ids.push(fr(e)),this.positions.push(t,r,f)},bt.prototype.getPositions=function(e){for(var t=fr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var y=[];this.ids[r]===t;)y.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return y},bt.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(y,x,M,B){for(;M<B;){for(var G=y[M+B>>1],$=M-1,ne=B+1;;){do $++;while(y[$]<G);do ne--;while(y[ne]>G);if($>=ne)break;ur(y,$,ne),ur(x,3*$,3*ne),ur(x,3*$+1,3*ne+1),ur(x,3*$+2,3*ne+2)}ne-M<B-ne?(v(y,x,M,ne),M=ne+1):(v(y,x,ne+1,B),B=ne)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},bt.deserialize=function(e){var t=new bt;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Zt=Math.pow(2,53)-1;function fr(e){var t=+e;return!isNaN(t)&&t<=Zt?t:ze(String(e))}function ur(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Fn("FeaturePositionMap",bt);var gr=function(e,t){this.gl=e.gl,this.location=t},Nr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(gr),an=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(gr),Hr=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(gr),Rn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(gr),ri=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(gr),hi=function(e){function t(r,f){e.call(this,r,f),this.current=Gi.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(gr),ni=new Float32Array(16),ea=function(e){function t(r,f){e.call(this,r,f),this.current=ni}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(gr);function Un(e){return[Pe(255*e.r,255*e.g),Pe(255*e.b,255*e.a)]}var gi=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};gi.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},gi.prototype.getBinding=function(e,t,r){return this.type==="color"?new hi(e,t):new an(e,t)};var te=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};te.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},te.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},te.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new ri(e,t):new an(e,t)};var q=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};q.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.paintVertexArray.length,x=this.expression.evaluate(new qi(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)},q.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},q.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Un(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var y=e;y<t;y++)this.paintVertexArray.emplace(y,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},q.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},q.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var R=function(e,t,r,f,v,y){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new y};R.prototype.populatePaintArray=function(e,t,r,f,v){var y=this.expression.evaluate(new qi(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new qi(this.zoom+1),t,{},f,[],v),M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,y,x)},R.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),y=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,y)},R.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Un(r),y=Un(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],y[0],y[1]);else{for(var M=e;M<t;M++)this.paintVertexArray.emplace(M,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},R.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},R.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},R.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=rt(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},R.prototype.getBinding=function(e,t,r){return new an(e,t)};var F=function(e,t,r,f,v,y){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};F.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},F.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},F.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],y=f[r.mid],x=f[r.max];if(v&&y&&x)for(var M=e;M<t;M++)this.zoomInPaintVertexArray.emplace(M,y.tl[0],y.tl[1],y.br[0],y.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],y.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,y.tl[0],y.tl[1],y.br[0],y.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],y.pixelRatio,x.pixelRatio)}},F.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,He.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,He.members,this.expression.isStateDependent))},F.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var re=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var y=e.paint.get(v);if(y instanceof xo&&Fs(y.property.specification)){var x=dt(v,e.type),M=y.value,B=y.property.specification.type,G=y.property.useIntegerZoom,$=y.property.specification["property-type"],ne=$==="cross-faded"||$==="cross-faded-data-driven";if(M.kind==="constant")this.binders[v]=ne?new te(M.value,x):new gi(M.value,x,B),f.push("/u_"+v);else if(M.kind==="source"||ne){var he=wt(v,B,"source");this.binders[v]=ne?new F(M,B,G,t,he,e.id):new q(M,x,B,he),f.push("/a_"+v)}else{var _e=wt(v,B,"composite");this.binders[v]=new R(M,x,B,G,t,_e),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};re.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof q||t instanceof R?t.maxValue:0},re.prototype.populatePaintArrays=function(e,t,r,f,v){for(var y in this.binders){var x=this.binders[y];(x instanceof q||x instanceof R||x instanceof F)&&x.populatePaintArray(e,t,r,f,v)}},re.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof te&&f.setConstantPatternPositions(e,t)}},re.prototype.updatePaintArrays=function(e,t,r,f,v){var y=!1;for(var x in e)for(var M=0,B=t.getPositions(x);M<B.length;M+=1){var G=B[M],$=r.feature(G.index);for(var ne in this.binders){var he=this.binders[ne];if((he instanceof q||he instanceof R||he instanceof F)&&he.expression.isStateDependent===!0){var _e=f.paint.get(ne);he.expression=_e.value,he.updatePaintArray(G.start,G.end,$,e[x],v),y=!0}}}return y},re.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof gi||r instanceof te)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},re.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof q||r instanceof R)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof F)for(var v=0;v<He.members.length;v++)e.push(He.members[v].name)}return e},re.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof gi||r instanceof te||r instanceof R)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},re.prototype.getPaintVertexBuffers=function(){return this._buffers},re.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof gi||v instanceof te||v instanceof R)for(var y=0,x=v.uniformNames;y<x.length;y+=1){var M=x[y];if(t[M]){var B=v.getBinding(e,t[M],M);r.push({name:M,property:f,binding:B})}}}return r},re.prototype.setUniforms=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1){var x=y[v],M=x.name,B=x.property;this.binders[B].setUniform(x.binding,f,r.get(B),M)}},re.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof F){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof q||r instanceof R)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},re.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof q||r instanceof R||r instanceof F)&&r.upload(e)}this.updatePaintBuffers()},re.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof q||t instanceof R||t instanceof F)&&t.destroy()}};var pe=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var y=v[f];this.programConfigurations[y.id]=new re(y,t,r)}this.needsUpload=!1,this._featureMap=new bt,this._bufferOffset=0};function dt(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function wt(e,t,r){var f={color:{source:dl,composite:Qu},number:{source:Nu,composite:dl}},v=function(y){return{"line-pattern":{source:cu,composite:cu},"fill-pattern":{source:cu,composite:cu},"fill-extrusion-pattern":{source:cu,composite:cu}}[y]}(e);return v&&v[r]||f[t][r]}pe.prototype.populatePaintArrays=function(e,t,r,f,v,y){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,y);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},pe.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,y=r;v<y.length;v+=1){var x=y[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},pe.prototype.get=function(e){return this.programConfigurations[e]},pe.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},pe.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Fn("ConstantBinder",gi),Fn("CrossFadedConstantBinder",te),Fn("SourceExpressionBinder",q),Fn("CrossFadedCompositeBinder",F),Fn("CompositeExpressionBinder",R),Fn("ProgramConfiguration",re,{omit:["_buffers"]}),Fn("ProgramConfigurationSet",pe);var At=Math.pow(2,14)-1,qt=-At-1;function Pr(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],y=0;y<v.length;y++){var x=v[y],M=Math.round(x.x*t),B=Math.round(x.y*t);x.x=rt(M,qt,At),x.y=rt(B,qt,At),(M<x.x||M>x.x+1||B<x.y||B>x.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function mn(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Pr(e):[]}}function Zn(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Jn=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Es,this.indexArray=new Fu,this.segments=new we,this.programConfigurations=new pe(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function _i(e,t){for(var r=0;r<e.length;r++)if(ta(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(ta(e,t[f]))return!0;return!!xa(e,t)}function si(e,t,r){return!!ta(e,t)||!!La(t,e,r)}function ji(e,t){if(e.length===1)return Ga(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(ta(e,f[v]))return!0;for(var y=0;y<e.length;y++)if(Ga(t,e[y]))return!0;for(var x=0;x<t.length;x++)if(xa(e,t[x]))return!0;return!1}function $i(e,t,r){if(e.length>1){if(xa(e,t))return!0;for(var f=0;f<t.length;f++)if(La(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(La(e[v],t,r))return!0;return!1}function xa(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],y=0;y<t.length-1;y++)if(ao(f,v,t[y],t[y+1]))return!0;return!1}function ao(e,t,r,f){return Ut(e,r,f)!==Ut(t,r,f)&&Ut(e,t,r)!==Ut(e,t,f)}function La(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(co(e,t[v-1],t[v])<f)return!0;return!1}function co(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function Ga(e,t){for(var r,f,v,y=!1,x=0;x<e.length;x++)for(var M=0,B=(r=e[x]).length-1;M<r.length;B=M++)(f=r[M]).y>t.y!=(v=r[B]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(y=!y);return y}function ta(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var y=e[f],x=e[v];y.y>t.y!=x.y>t.y&&t.x<(x.x-y.x)*(t.y-y.y)/(x.y-y.y)+y.x&&(r=!r)}return r}function va(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var y=Ut(e,t,r[0]);return y!==Ut(e,t,r[1])||y!==Ut(e,t,r[2])||y!==Ut(e,t,r[3])}function za(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function fa(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Ta(e,t,r,f,v){if(!t[0]&&!t[1])return e;var y=W.convert(t)._mult(v);r==="viewport"&&y._rotate(-f);for(var x=[],M=0;M<e.length;M++)x.push(e[M].sub(y));return x}Jn.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],y=null;f.type==="circle"&&(y=f.layout.get("circle-sort-key"));for(var x=0,M=e;x<M.length;x+=1){var B=M[x],G=B.feature,$=B.id,ne=B.index,he=B.sourceLayerIndex,_e=this.layers[0]._featureFilter.needGeometry,Ge=mn(G,_e);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),Ge,r)){var We=y?y.evaluate(Ge,{},r):void 0,ht={id:$,properties:G.properties,type:G.type,sourceLayerIndex:he,index:ne,geometry:_e?Ge.geometry:Pr(G),patterns:{},sortKey:We};v.push(ht)}}y&&v.sort(function(dn,li){return dn.sortKey-li.sortKey});for(var qe=0,Pt=v;qe<Pt.length;qe+=1){var Wt=Pt[qe],cr=Wt.geometry,vr=Wt.index,Ir=Wt.sourceLayerIndex,tn=e[vr].feature;this.addFeature(Wt,cr,vr,r),t.featureIndex.insert(tn,cr,vr,Ir,this.index)}},Jn.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Jn.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Jn.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Jn.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Se),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Jn.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Jn.prototype.addFeature=function(e,t,r,f){for(var v=0,y=t;v<y.length;v+=1)for(var x=0,M=y[v];x<M.length;x+=1){var B=M[x],G=B.x,$=B.y;if(!(G<0||G>=8192||$<0||$>=8192)){var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),he=ne.vertexLength;Zn(this.layoutVertexArray,G,$,-1,-1),Zn(this.layoutVertexArray,G,$,1,-1),Zn(this.layoutVertexArray,G,$,1,1),Zn(this.layoutVertexArray,G,$,-1,1),this.indexArray.emplaceBack(he,he+1,he+2),this.indexArray.emplaceBack(he,he+3,he+2),ne.vertexLength+=4,ne.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Fn("CircleBucket",Jn,{omit:["layers"]});var bo=new Jo({"circle-sort-key":new Wn(se.layout_circle["circle-sort-key"])}),Fo={paint:new Jo({"circle-radius":new Wn(se.paint_circle["circle-radius"]),"circle-color":new Wn(se.paint_circle["circle-color"]),"circle-blur":new Wn(se.paint_circle["circle-blur"]),"circle-opacity":new Wn(se.paint_circle["circle-opacity"]),"circle-translate":new ii(se.paint_circle["circle-translate"]),"circle-translate-anchor":new ii(se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ii(se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ii(se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wn(se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wn(se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wn(se.paint_circle["circle-stroke-opacity"])}),layout:bo},ua=typeof Float32Array!="undefined"?Float32Array:Array;function Zo(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fo(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3],M=t[4],B=t[5],G=t[6],$=t[7],ne=t[8],he=t[9],_e=t[10],Ge=t[11],We=t[12],ht=t[13],qe=t[14],Pt=t[15],Wt=r[0],cr=r[1],vr=r[2],Ir=r[3];return e[0]=Wt*f+cr*M+vr*ne+Ir*We,e[1]=Wt*v+cr*B+vr*he+Ir*ht,e[2]=Wt*y+cr*G+vr*_e+Ir*qe,e[3]=Wt*x+cr*$+vr*Ge+Ir*Pt,e[4]=(Wt=r[4])*f+(cr=r[5])*M+(vr=r[6])*ne+(Ir=r[7])*We,e[5]=Wt*v+cr*B+vr*he+Ir*ht,e[6]=Wt*y+cr*G+vr*_e+Ir*qe,e[7]=Wt*x+cr*$+vr*Ge+Ir*Pt,e[8]=(Wt=r[8])*f+(cr=r[9])*M+(vr=r[10])*ne+(Ir=r[11])*We,e[9]=Wt*v+cr*B+vr*he+Ir*ht,e[10]=Wt*y+cr*G+vr*_e+Ir*qe,e[11]=Wt*x+cr*$+vr*Ge+Ir*Pt,e[12]=(Wt=r[12])*f+(cr=r[13])*M+(vr=r[14])*ne+(Ir=r[15])*We,e[13]=Wt*v+cr*B+vr*he+Ir*ht,e[14]=Wt*y+cr*G+vr*_e+Ir*qe,e[15]=Wt*x+cr*$+vr*Ge+Ir*Pt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var qs,wc=fo;function Nl(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*y+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*y+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*y+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*y+r[15]*x,e}qs=new ua(3),ua!=Float32Array&&(qs[0]=0,qs[1]=0,qs[2]=0),function(){var e=new ua(4);ua!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var qu=(function(){var e=new ua(2);ua!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,Fo)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Jn(r)},t.prototype.queryRadius=function(r){var f=r;return za("circle-radius",this,f)+za("circle-stroke-width",this,f)+fa(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B,G){for(var $=Ta(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,B),ne=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),he=this.paint.get("circle-pitch-alignment")==="map",_e=he?$:function(tn,dn){return tn.map(function(li){return fu(li,dn)})}($,G),Ge=he?ne*B:ne,We=0,ht=y;We<ht.length;We+=1)for(var qe=0,Pt=ht[We];qe<Pt.length;qe+=1){var Wt=Pt[qe],cr=he?Wt:fu(Wt,G),vr=Ge,Ir=Nl([],[Wt.x,Wt.y,0,1],G);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?vr*=Ir[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(vr*=M.cameraToCenterDistance/Ir[3]),si(_e,cr,vr))return!0}return!1},t}(lu));function fu(e,t){var r=Nl([],[e.x,e.y,0,1],t);return new W(r[0]/r[3],r[1]/r[3])}var zl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Jn);function Zs(e,t,r,f){var v=t.width,y=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*y*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*y*r);return e.width=v,e.height=y,e.data=f,e}function ml(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var y=Zs({},{width:f,height:v},r);yl(e,y,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=y.data}}function yl(e,t,r,f,v,y){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,M=t.data,B=0;B<v.height;B++)for(var G=((r.y+B)*e.width+r.x)*y,$=((f.y+B)*t.width+f.x)*y,ne=0;ne<v.width*y;ne++)M[$+ne]=x[G+ne];return t}Fn("HeatmapBucket",zl,{omit:["layers"]});var hu=function(e,t){Zs(this,e,1,t)};hu.prototype.resize=function(e){ml(this,e,1)},hu.prototype.clone=function(){return new hu({width:this.width,height:this.height},new Uint8Array(this.data))},hu.copy=function(e,t,r,f,v){yl(e,t,r,f,v,1)};var Po=function(e,t){Zs(this,e,4,t)};Po.prototype.resize=function(e){ml(this,e,4)},Po.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},Po.prototype.clone=function(){return new Po({width:this.width,height:this.height},new Uint8Array(this.data))},Po.copy=function(e,t,r,f,v){yl(e,t,r,f,v,4)},Fn("AlphaImage",hu),Fn("RGBAImage",Po);var ef={paint:new Jo({"heatmap-radius":new Wn(se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wn(se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ii(se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qs(se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ii(se.paint_heatmap["heatmap-opacity"])})};function tf(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new Po({width:r,height:f}),y=function(Ge,We,ht){t[e.evaluationKey]=ht;var qe=e.expression.evaluate(t);v.data[Ge+We+0]=Math.floor(255*qe.r/qe.a),v.data[Ge+We+1]=Math.floor(255*qe.g/qe.a),v.data[Ge+We+2]=Math.floor(255*qe.b/qe.a),v.data[Ge+We+3]=Math.floor(255*qe.a)};if(e.clips)for(var x=0,M=0;x<f;++x,M+=4*r)for(var B=0,G=0;B<r;B++,G+=4){var $=B/(r-1),ne=e.clips[x];y(M,G,ne.start*(1-$)+ne.end*$)}else for(var he=0,_e=0;he<r;he++,_e+=4)y(0,_e,he/(r-1));return v}var hf=function(e){function t(r){e.call(this,r,ef),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new zl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=tf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(lu),Ff={paint:new Jo({"hillshade-illumination-direction":new ii(se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ii(se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ii(se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ii(se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ii(se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ii(se.paint_hillshade["hillshade-accent-color"])})},eu=function(e){function t(r){e.call(this,r,Ff)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(lu),rf=Do([{name:"a_pos",components:2,type:"Int16"}],4).members,Cc=Ul,dp=Ul;function Ul(e,t,r){r=r||2;var f,v,y,x,M,B,G,$=t&&t.length,ne=$?t[0]*r:e.length,he=nh(e,0,ne,r,!0),_e=[];if(!he||he.next===he.prev)return _e;if($&&(he=function(We,ht,qe,Pt){var Wt,cr,vr,Ir=[];for(Wt=0,cr=ht.length;Wt<cr;Wt++)(vr=nh(We,ht[Wt]*Pt,Wt<cr-1?ht[Wt+1]*Pt:We.length,Pt,!1))===vr.next&&(vr.steiner=!0),Ir.push(Ih(vr));for(Ir.sort(vp),Wt=0;Wt<Ir.length;Wt++)ih(Ir[Wt],qe),qe=Ac(qe,qe.next);return qe}(e,t,he,r)),e.length>80*r){f=y=e[0],v=x=e[1];for(var Ge=r;Ge<ne;Ge+=r)(M=e[Ge])<f&&(f=M),(B=e[Ge+1])<v&&(v=B),M>y&&(y=M),B>x&&(x=B);G=(G=Math.max(y-f,x-v))!==0?1/G:0}return pf(he,_e,r,f,v,G),_e}function nh(e,t,r,f,v){var y,x;if(v===of(e,t,r,f)>0)for(y=t;y<r;y+=f)x=Uf(y,e[y],e[y+1],x);else for(y=r-f;y>=t;y-=f)x=Uf(y,e[y],e[y+1],x);return x&&Nf(x,x.next)&&(gl(x),x=x.next),x}function Ac(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!Nf(f,f.next)&&as(f.prev,f,f.next)!==0)f=f.next;else{if(gl(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function pf(e,t,r,f,v,y,x){if(e){!x&&y&&function($,ne,he,_e){var Ge=$;do Ge.z===null&&(Ge.z=Bf(Ge.x,Ge.y,ne,he,_e)),Ge.prevZ=Ge.prev,Ge.nextZ=Ge.next,Ge=Ge.next;while(Ge!==$);Ge.prevZ.nextZ=null,Ge.prevZ=null,function(We){var ht,qe,Pt,Wt,cr,vr,Ir,tn,dn=1;do{for(qe=We,We=null,cr=null,vr=0;qe;){for(vr++,Pt=qe,Ir=0,ht=0;ht<dn&&(Ir++,Pt=Pt.nextZ);ht++);for(tn=dn;Ir>0||tn>0&&Pt;)Ir!==0&&(tn===0||!Pt||qe.z<=Pt.z)?(Wt=qe,qe=qe.nextZ,Ir--):(Wt=Pt,Pt=Pt.nextZ,tn--),cr?cr.nextZ=Wt:We=Wt,Wt.prevZ=cr,cr=Wt;qe=Pt}cr.nextZ=null,dn*=2}while(vr>1)}(Ge)}(e,f,v,y);for(var M,B,G=e;e.prev!==e.next;)if(M=e.prev,B=e.next,y?df(e,f,v,y):Hp(e))t.push(M.i/r),t.push(e.i/r),t.push(B.i/r),gl(e),e=B.next,G=B.next;else if((e=B)===G){x?x===1?pf(e=Ph(Ac(e),t,r),t,r,f,v,y,2):x===2&&Wp(e,t,r,f,v,y):pf(Ac(e),t,r,f,v,y,1);break}}}function Hp(e){var t=e.prev,r=e,f=e.next;if(as(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(nf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&as(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function df(e,t,r,f){var v=e.prev,y=e,x=e.next;if(as(v,y,x)>=0)return!1;for(var M=v.x>y.x?v.x>x.x?v.x:x.x:y.x>x.x?y.x:x.x,B=v.y>y.y?v.y>x.y?v.y:x.y:y.y>x.y?y.y:x.y,G=Bf(v.x<y.x?v.x<x.x?v.x:x.x:y.x<x.x?y.x:x.x,v.y<y.y?v.y<x.y?v.y:x.y:y.y<x.y?y.y:x.y,t,r,f),$=Bf(M,B,t,r,f),ne=e.prevZ,he=e.nextZ;ne&&ne.z>=G&&he&&he.z<=$;){if(ne!==e.prev&&ne!==e.next&&nf(v.x,v.y,y.x,y.y,x.x,x.y,ne.x,ne.y)&&as(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,he!==e.prev&&he!==e.next&&nf(v.x,v.y,y.x,y.y,x.x,x.y,he.x,he.y)&&as(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ne&&ne.z>=G;){if(ne!==e.prev&&ne!==e.next&&nf(v.x,v.y,y.x,y.y,x.x,x.y,ne.x,ne.y)&&as(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;he&&he.z<=$;){if(he!==e.prev&&he!==e.next&&nf(v.x,v.y,y.x,y.y,x.x,x.y,he.x,he.y)&&as(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function Ph(e,t,r){var f=e;do{var v=f.prev,y=f.next.next;!Nf(v,y)&&Lh(v,f,f.next,y)&&af(v,y)&&af(y,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(y.i/r),gl(f),gl(f.next),f=e=y),f=f.next}while(f!==e);return Ac(f)}function Wp(e,t,r,f,v,y){var x=e;do{for(var M=x.next.next;M!==x.prev;){if(x.i!==M.i&&Oh(x,M)){var B=zf(x,M);return x=Ac(x,x.next),B=Ac(B,B.next),pf(x,t,r,f,v,y),void pf(B,t,r,f,v,y)}M=M.next}x=x.next}while(x!==e)}function vp(e,t){return e.x-t.x}function ih(e,t){if(t=function(f,v){var y,x=v,M=f.x,B=f.y,G=-1/0;do{if(B<=x.y&&B>=x.next.y&&x.next.y!==x.y){var $=x.x+(B-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if($<=M&&$>G){if(G=$,$===M){if(B===x.y)return x;if(B===x.next.y)return x.next}y=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!y)return null;if(M===G)return y;var ne,he=y,_e=y.x,Ge=y.y,We=1/0;x=y;do M>=x.x&&x.x>=_e&&M!==x.x&&nf(B<Ge?M:G,B,_e,Ge,B<Ge?G:M,B,x.x,x.y)&&(ne=Math.abs(B-x.y)/(M-x.x),af(x,f)&&(ne<We||ne===We&&(x.x>y.x||x.x===y.x&&Mh(y,x)))&&(y=x,We=ne)),x=x.next;while(x!==he);return y}(e,t)){var r=zf(t,e);Ac(t,t.next),Ac(r,r.next)}}function Mh(e,t){return as(e.prev,e,t.prev)<0&&as(t.next,e,e.next)<0}function Bf(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ih(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function nf(e,t,r,f,v,y,x,M){return(v-x)*(t-M)-(e-x)*(y-M)>=0&&(e-x)*(f-M)-(r-x)*(t-M)>=0&&(r-x)*(y-M)-(v-x)*(f-M)>=0}function Oh(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&Lh(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(af(e,t)&&af(t,e)&&function(r,f){var v=r,y=!1,x=(r.x+f.x)/2,M=(r.y+f.y)/2;do v.y>M!=v.next.y>M&&v.next.y!==v.y&&x<(v.next.x-v.x)*(M-v.y)/(v.next.y-v.y)+v.x&&(y=!y),v=v.next;while(v!==r);return y}(e,t)&&(as(e.prev,e,t.prev)||as(e,t.prev,t))||Nf(e,t)&&as(e.prev,e,e.next)>0&&as(t.prev,t,t.next)>0)}function as(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Nf(e,t){return e.x===t.x&&e.y===t.y}function Lh(e,t,r,f){var v=oh(as(e,t,r)),y=oh(as(e,t,f)),x=oh(as(r,f,e)),M=oh(as(r,f,t));return v!==y&&x!==M||!(v!==0||!ah(e,r,t))||!(y!==0||!ah(e,f,t))||!(x!==0||!ah(r,e,f))||!(M!==0||!ah(r,t,f))}function ah(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function oh(e){return e>0?1:e<0?-1:0}function af(e,t){return as(e.prev,e,e.next)<0?as(e,t,e.next)>=0&&as(e,e.prev,t)>=0:as(e,t,e.prev)<0||as(e,e.next,t)<0}function zf(e,t){var r=new Zf(e.i,e.x,e.y),f=new Zf(t.i,t.x,t.y),v=e.next,y=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,y.next=f,f.prev=y,f}function Uf(e,t,r,f){var v=new Zf(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function gl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Zf(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function of(e,t,r,f){for(var v=0,y=t,x=r-f;y<r;y+=f)v+=(e[x]-e[y])*(e[y+1]+e[x+1]),x=y;return v}function sh(e,t,r,f,v){(function y(x,M,B,G,$){for(;G>B;){if(G-B>600){var ne=G-B+1,he=M-B+1,_e=Math.log(ne),Ge=.5*Math.exp(2*_e/3),We=.5*Math.sqrt(_e*Ge*(ne-Ge)/ne)*(he-ne/2<0?-1:1);y(x,M,Math.max(B,Math.floor(M-he*Ge/ne+We)),Math.min(G,Math.floor(M+(ne-he)*Ge/ne+We)),$)}var ht=x[M],qe=B,Pt=G;for(Tc(x,B,M),$(x[G],ht)>0&&Tc(x,B,G);qe<Pt;){for(Tc(x,qe,Pt),qe++,Pt--;$(x[qe],ht)<0;)qe++;for(;$(x[Pt],ht)>0;)Pt--}$(x[B],ht)===0?Tc(x,B,Pt):Tc(x,++Pt,G),Pt<=M&&(B=Pt+1),M<=Pt&&(G=Pt-1)}})(e,t,r||0,f||e.length-1,v||Rh)}function Tc(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function Rh(e,t){return e<t?-1:e>t?1:0}function vf(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,y=[],x=0;x<r;x++){var M=_r(e[x]);M!==0&&(e[x].area=Math.abs(M),v===void 0&&(v=M<0),v===M<0?(f&&y.push(f),f=[e[x]]):f.push(e[x]))}if(f&&y.push(f),t>1)for(var B=0;B<y.length;B++)y[B].length<=t||(sh(y[B],t,1,y[B].length-1,mf),y[B]=y[B].slice(0,t));return y}function mf(e,t){return t.area-e.area}function yf(e,t,r){for(var f=r.patternDependencies,v=!1,y=0,x=t;y<x.length;y+=1){var M=x[y].paint.get(e+"-pattern");M.isConstant()||(v=!0);var B=M.constantOr(null);B&&(v=!0,f[B.to]=!0,f[B.from]=!0)}return v}function Zl(e,t,r,f,v){for(var y=v.patternDependencies,x=0,M=t;x<M.length;x+=1){var B=M[x],G=B.paint.get(e+"-pattern").value;if(G.kind!=="constant"){var $=G.evaluate({zoom:f-1},r,{},v.availableImages),ne=G.evaluate({zoom:f},r,{},v.availableImages),he=G.evaluate({zoom:f+1},r,{},v.availableImages);ne=ne&&ne.name?ne.name:ne,he=he&&he.name?he.name:he,y[$=$&&$.name?$.name:$]=!0,y[ne]=!0,y[he]=!0,r.patterns[B.id]={min:$,mid:ne,max:he}}}return r}Ul.deviation=function(e,t,r,f){var v=t&&t.length,y=Math.abs(of(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,M=t.length;x<M;x++)y-=Math.abs(of(e,t[x]*r,x<M-1?t[x+1]*r:e.length,r));var B=0;for(x=0;x<f.length;x+=3){var G=f[x]*r,$=f[x+1]*r,ne=f[x+2]*r;B+=Math.abs((e[G]-e[ne])*(e[$+1]-e[G+1])-(e[G]-e[$])*(e[ne+1]-e[G+1]))}return y===0&&B===0?0:Math.abs((B-y)/y)},Ul.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var y=0;y<e[v].length;y++)for(var x=0;x<t;x++)r.vertices.push(e[v][y][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Cc.default=dp;var bu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Es,this.indexArray=new Fu,this.indexArray2=new zu,this.programConfigurations=new pe(e.layers,e.zoom),this.segments=new we,this.segments2=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};bu.prototype.populate=function(e,t,r){this.hasPattern=yf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],y=0,x=e;y<x.length;y+=1){var M=x[y],B=M.feature,G=M.id,$=M.index,ne=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,_e=mn(B,he);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),_e,r)){var Ge=f?f.evaluate(_e,{},r,t.availableImages):void 0,We={id:G,properties:B.properties,type:B.type,sourceLayerIndex:ne,index:$,geometry:he?_e.geometry:Pr(B),patterns:{},sortKey:Ge};v.push(We)}}f&&v.sort(function(tn,dn){return tn.sortKey-dn.sortKey});for(var ht=0,qe=v;ht<qe.length;ht+=1){var Pt=qe[ht],Wt=Pt.geometry,cr=Pt.index,vr=Pt.sourceLayerIndex;if(this.hasPattern){var Ir=Zl("fill",this.layers,Pt,this.zoom,t);this.patternFeatures.push(Ir)}else this.addFeature(Pt,Wt,cr,r,{});t.featureIndex.insert(e[cr].feature,Wt,cr,vr,this.index)}},bu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},bu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},bu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rf),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},bu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},bu.prototype.addFeature=function(e,t,r,f,v){for(var y=0,x=vf(t,500);y<x.length;y+=1){for(var M=x[y],B=0,G=0,$=M;G<$.length;G+=1)B+=$[G].length;for(var ne=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray),he=ne.vertexLength,_e=[],Ge=[],We=0,ht=M;We<ht.length;We+=1){var qe=ht[We];if(qe.length!==0){qe!==M[0]&&Ge.push(_e.length/2);var Pt=this.segments2.prepareSegment(qe.length,this.layoutVertexArray,this.indexArray2),Wt=Pt.vertexLength;this.layoutVertexArray.emplaceBack(qe[0].x,qe[0].y),this.indexArray2.emplaceBack(Wt+qe.length-1,Wt),_e.push(qe[0].x),_e.push(qe[0].y);for(var cr=1;cr<qe.length;cr++)this.layoutVertexArray.emplaceBack(qe[cr].x,qe[cr].y),this.indexArray2.emplaceBack(Wt+cr-1,Wt+cr),_e.push(qe[cr].x),_e.push(qe[cr].y);Pt.vertexLength+=qe.length,Pt.primitiveLength+=qe.length}}for(var vr=Cc(_e,Ge),Ir=0;Ir<vr.length;Ir+=3)this.indexArray.emplaceBack(he+vr[Ir],he+vr[Ir+1],he+vr[Ir+2]);ne.vertexLength+=B,ne.primitiveLength+=vr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Fn("FillBucket",bu,{omit:["layers","patternFeatures"]});var gf=new Jo({"fill-sort-key":new Wn(se.layout_fill["fill-sort-key"])}),jf={paint:new Jo({"fill-antialias":new ii(se.paint_fill["fill-antialias"]),"fill-opacity":new Wn(se.paint_fill["fill-opacity"]),"fill-color":new Wn(se.paint_fill["fill-color"]),"fill-outline-color":new Wn(se.paint_fill["fill-outline-color"]),"fill-translate":new ii(se.paint_fill["fill-translate"]),"fill-translate-anchor":new ii(se.paint_fill["fill-translate-anchor"]),"fill-pattern":new Rl(se.paint_fill["fill-pattern"])}),layout:gf},_f=function(e){function t(r){e.call(this,r,jf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new bu(r)},t.prototype.queryRadius=function(){return fa(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B){return ji(Ta(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,B),y)},t.prototype.isTileClipped=function(){return!0},t}(lu),kh=Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,xf=_l;function _l(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(uh,this,t)}function uh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var y=f.readVarint()+f.pos;f.pos<y;){var x=v._keys[f.readVarint()],M=v._values[f.readVarint()];v.properties[x]=M}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Vf(e){for(var t,r,f=0,v=0,y=e.length,x=y-1;v<y;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}_l.types=["Unknown","Point","LineString","Polygon"],_l.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,y=0,x=0,M=[];e.pos<r;){if(v<=0){var B=e.readVarint();f=7&B,v=B>>3}if(v--,f===1||f===2)y+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&M.push(t),t=[]),t.push(new W(y,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&M.push(t),M},_l.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,y=0,x=1/0,M=-1/0,B=1/0,G=-1/0;e.pos<t;){if(f<=0){var $=e.readVarint();r=7&$,f=$>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>M&&(M=v),(y+=e.readSVarint())<B&&(B=y),y>G&&(G=y);else if(r!==7)throw new Error("unknown command "+r)}return[x,B,M,G]},_l.prototype.toGeoJSON=function(e,t,r){var f,v,y=this.extent*Math.pow(2,r),x=this.extent*e,M=this.extent*t,B=this.loadGeometry(),G=_l.types[this.type];function $(_e){for(var Ge=0;Ge<_e.length;Ge++){var We=_e[Ge];_e[Ge]=[360*(We.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+M)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var ne=[];for(f=0;f<B.length;f++)ne[f]=B[f][0];$(B=ne);break;case 2:for(f=0;f<B.length;f++)$(B[f]);break;case 3:for(B=function(_e){var Ge=_e.length;if(Ge<=1)return[_e];for(var We,ht,qe=[],Pt=0;Pt<Ge;Pt++){var Wt=Vf(_e[Pt]);Wt!==0&&(ht===void 0&&(ht=Wt<0),ht===Wt<0?(We&&qe.push(We),We=[_e[Pt]]):We.push(_e[Pt]))}return We&&qe.push(We),qe}(B),f=0;f<B.length;f++)for(v=0;v<B[f].length;v++)$(B[f][v])}B.length===1?B=B[0]:G="Multi"+G;var he={type:"Feature",geometry:{type:G,coordinates:B},properties:this.properties};return"id"in this&&(he.id=this.id),he};var Dh=lh;function lh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(mp,this,t),this.length=this._features.length}function mp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,y=f.readVarint()+f.pos;f.pos<y;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function Pc(e,t,r){if(e===3){var f=new Dh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}lh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new xf(this._pbf,t,this.extent,this._keys,this._values)};var jc={VectorTile:function(e,t){this.layers=e.readFields(Pc,{},t)},VectorTileFeature:xf,VectorTileLayer:Dh},Fh=jc.VectorTileFeature.types,bf=Math.pow(2,13);function sf(e,t,r,f,v,y,x,M){e.emplaceBack(t,r,2*Math.floor(f*bf)+x,v*bf*2,y*bf*2,Math.round(M))}var Uu=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ws,this.indexArray=new Fu,this.programConfigurations=new pe(e.layers,e.zoom),this.segments=new we,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function yp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}Uu.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=yf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var y=v[f],x=y.feature,M=y.id,B=y.index,G=y.sourceLayerIndex,$=this.layers[0]._featureFilter.needGeometry,ne=mn(x,$);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),ne,r)){var he={id:M,sourceLayerIndex:G,index:B,geometry:$?ne.geometry:Pr(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Zl("fill-extrusion",this.layers,he,this.zoom,t)):this.addFeature(he,he.geometry,B,r,{}),t.featureIndex.insert(x,he.geometry,B,G,this.index,!0)}}},Uu.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},Uu.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Uu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Uu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uu.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Uu.prototype.addFeature=function(e,t,r,f,v){for(var y=0,x=vf(t,500);y<x.length;y+=1){for(var M=x[y],B=0,G=0,$=M;G<$.length;G+=1)B+=$[G].length;for(var ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),he=0,_e=M;he<_e.length;he+=1){var Ge=_e[he];if(Ge.length!==0&&!((na=Ge).every(function(Bi){return Bi.x<0})||na.every(function(Bi){return Bi.x>8192})||na.every(function(Bi){return Bi.y<0})||na.every(function(Bi){return Bi.y>8192})))for(var We=0,ht=0;ht<Ge.length;ht++){var qe=Ge[ht];if(ht>=1){var Pt=Ge[ht-1];if(!yp(qe,Pt)){ne.vertexLength+4>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Wt=qe.sub(Pt)._perp()._unit(),cr=Pt.dist(qe);We+cr>32768&&(We=0),sf(this.layoutVertexArray,qe.x,qe.y,Wt.x,Wt.y,0,0,We),sf(this.layoutVertexArray,qe.x,qe.y,Wt.x,Wt.y,0,1,We),sf(this.layoutVertexArray,Pt.x,Pt.y,Wt.x,Wt.y,0,0,We+=cr),sf(this.layoutVertexArray,Pt.x,Pt.y,Wt.x,Wt.y,0,1,We);var vr=ne.vertexLength;this.indexArray.emplaceBack(vr,vr+2,vr+1),this.indexArray.emplaceBack(vr+1,vr+2,vr+3),ne.vertexLength+=4,ne.primitiveLength+=2}}}}if(ne.vertexLength+B>we.MAX_VERTEX_ARRAY_LENGTH&&(ne=this.segments.prepareSegment(B,this.layoutVertexArray,this.indexArray)),Fh[e.type]==="Polygon"){for(var Ir=[],tn=[],dn=ne.vertexLength,li=0,Bn=M;li<Bn.length;li+=1){var fi=Bn[li];if(fi.length!==0){fi!==M[0]&&tn.push(Ir.length/2);for(var zn=0;zn<fi.length;zn++){var Xi=fi[zn];sf(this.layoutVertexArray,Xi.x,Xi.y,0,0,1,1,0),Ir.push(Xi.x),Ir.push(Xi.y)}}}for(var Ci=Cc(Ir,tn),On=0;On<Ci.length;On+=3)this.indexArray.emplaceBack(dn+Ci[On],dn+Ci[On+2],dn+Ci[On+1]);ne.primitiveLength+=Ci.length/3,ne.vertexLength+=B}}var na;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Fn("FillExtrusionBucket",Uu,{omit:["layers","features"]});var jl={paint:new Jo({"fill-extrusion-opacity":new ii(se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wn(se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ii(se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ii(se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Rl(se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wn(se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wn(se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ii(se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Bh=function(e){function t(r){e.call(this,r,jl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Uu(r)},t.prototype.queryRadius=function(){return fa(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B,G){var $=Ta(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,B),ne=this.paint.get("fill-extrusion-height").evaluate(f,v),he=this.paint.get("fill-extrusion-base").evaluate(f,v),_e=function(We,ht,qe,Pt){for(var Wt=[],cr=0,vr=We;cr<vr.length;cr+=1){var Ir=vr[cr],tn=[Ir.x,Ir.y,0,1];Nl(tn,tn,ht),Wt.push(new W(tn[0]/tn[3],tn[1]/tn[3]))}return Wt}($,G),Ge=function(We,ht,qe,Pt){for(var Wt=[],cr=[],vr=Pt[8]*ht,Ir=Pt[9]*ht,tn=Pt[10]*ht,dn=Pt[11]*ht,li=Pt[8]*qe,Bn=Pt[9]*qe,fi=Pt[10]*qe,zn=Pt[11]*qe,Xi=0,Ci=We;Xi<Ci.length;Xi+=1){for(var On=[],na=[],Bi=0,wa=Ci[Xi];Bi<wa.length;Bi+=1){var di=wa[Bi],ka=di.x,Io=di.y,Eo=Pt[0]*ka+Pt[4]*Io+Pt[12],ho=Pt[1]*ka+Pt[5]*Io+Pt[13],vo=Pt[2]*ka+Pt[6]*Io+Pt[14],No=Pt[3]*ka+Pt[7]*Io+Pt[15],ys=vo+tn,Oo=No+dn,ks=Eo+li,ls=ho+Bn,tu=vo+fi,ts=No+zn,Wo=new W((Eo+vr)/Oo,(ho+Ir)/Oo);Wo.z=ys/Oo,On.push(Wo);var pa=new W(ks/ts,ls/ts);pa.z=tu/ts,na.push(pa)}Wt.push(On),cr.push(na)}return[Wt,cr]}(y,he,ne,G);return function(We,ht,qe){var Pt=1/0;ji(qe,ht)&&(Pt=ac(qe,ht[0]));for(var Wt=0;Wt<ht.length;Wt++)for(var cr=ht[Wt],vr=We[Wt],Ir=0;Ir<cr.length-1;Ir++){var tn=cr[Ir],dn=[tn,cr[Ir+1],vr[Ir+1],vr[Ir],tn];_i(qe,dn)&&(Pt=Math.min(Pt,ac(qe,dn)))}return Pt!==1/0&&Pt}(Ge[0],Ge[1],_e)},t}(lu);function xl(e,t){return e.x*t.x+e.y*t.y}function ac(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var y=t[f],x=e[0],M=r.sub(v),B=y.sub(v),G=x.sub(v),$=xl(M,M),ne=xl(M,B),he=xl(B,B),_e=xl(G,M),Ge=xl(G,B),We=$*he-ne*ne,ht=(he*_e-ne*Ge)/We,qe=($*Ge-ne*_e)/We,Pt=v.z*(1-ht-qe)+r.z*ht+y.z*qe;if(isFinite(Pt))return Pt}return 1/0}for(var Wt=1/0,cr=0,vr=t;cr<vr.length;cr+=1)Wt=Math.min(Wt,vr[cr].z);return Wt}var Nh=Do([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ch=Do([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Sf=jc.VectorTileFeature.types,fh=Math.cos(Math.PI/180*37.5),vs=Math.pow(2,14)/.5,jo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new ds,this.layoutVertexArray2=new dl,this.indexArray=new Fu,this.programConfigurations=new pe(e.layers,e.zoom),this.segments=new we,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};jo.prototype.populate=function(e,t,r){this.hasPattern=yf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],y=0,x=e;y<x.length;y+=1){var M=x[y],B=M.feature,G=M.id,$=M.index,ne=M.sourceLayerIndex,he=this.layers[0]._featureFilter.needGeometry,_e=mn(B,he);if(this.layers[0]._featureFilter.filter(new qi(this.zoom),_e,r)){var Ge=f?f.evaluate(_e,{},r):void 0,We={id:G,properties:B.properties,type:B.type,sourceLayerIndex:ne,index:$,geometry:he?_e.geometry:Pr(B),patterns:{},sortKey:Ge};v.push(We)}}f&&v.sort(function(tn,dn){return tn.sortKey-dn.sortKey});for(var ht=0,qe=v;ht<qe.length;ht+=1){var Pt=qe[ht],Wt=Pt.geometry,cr=Pt.index,vr=Pt.sourceLayerIndex;if(this.hasPattern){var Ir=Zl("line",this.layers,Pt,this.zoom,t);this.patternFeatures.push(Ir)}else this.addFeature(Pt,Wt,cr,r,{});t.featureIndex.insert(e[cr].feature,Wt,cr,vr,this.index)}},jo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},jo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var y=v[f];this.addFeature(y,y.geometry,y.index,t,r)}},jo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},jo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},jo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ch)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},jo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},jo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},jo.prototype.addFeature=function(e,t,r,f,v){var y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),M=y.get("line-cap"),B=y.get("line-miter-limit"),G=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var $=0,ne=t;$<ne.length;$+=1)this.addLine(ne[$],e,x,M,B,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},jo.prototype.addLine=function(e,t,r,f,v,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Sf[t.type]==="Polygon",B=e.length;B>=2&&e[B-1].equals(e[B-2]);)B--;for(var G=0;G<B-1&&e[G].equals(e[G+1]);)G++;if(!(B<(M?3:2))){r==="bevel"&&(v=1.05);var $,ne=this.overscaling<=16?122880/(512*this.overscaling):0,he=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray),_e=void 0,Ge=void 0,We=void 0,ht=void 0;this.e1=this.e2=-1,M&&(ht=e[G].sub($=e[B-2])._unit()._perp());for(var qe=G;qe<B;qe++)if(!(Ge=qe===B-1?M?e[G+1]:void 0:e[qe+1])||!e[qe].equals(Ge)){ht&&(We=ht),$&&(_e=$),$=e[qe],ht=Ge?Ge.sub($)._unit()._perp():We;var Pt=(We=We||ht).add(ht);Pt.x===0&&Pt.y===0||Pt._unit();var Wt=We.x*ht.x+We.y*ht.y,cr=Pt.x*ht.x+Pt.y*ht.y,vr=cr!==0?1/cr:1/0,Ir=2*Math.sqrt(2-2*cr),tn=cr<fh&&_e&&Ge,dn=We.x*ht.y-We.y*ht.x>0;if(tn&&qe>G){var li=$.dist(_e);if(li>2*ne){var Bn=$.sub($.sub(_e)._mult(ne/li)._round());this.updateDistance(_e,Bn),this.addCurrentVertex(Bn,We,0,0,he),_e=Bn}}var fi=_e&&Ge,zn=fi?r:M?"butt":f;if(fi&&zn==="round"&&(vr<y?zn="miter":vr<=2&&(zn="fakeround")),zn==="miter"&&vr>v&&(zn="bevel"),zn==="bevel"&&(vr>2&&(zn="flipbevel"),vr<v&&(zn="miter")),_e&&this.updateDistance(_e,$),zn==="miter")Pt._mult(vr),this.addCurrentVertex($,Pt,0,0,he);else if(zn==="flipbevel"){if(vr>100)Pt=ht.mult(-1);else{var Xi=vr*We.add(ht).mag()/We.sub(ht).mag();Pt._perp()._mult(Xi*(dn?-1:1))}this.addCurrentVertex($,Pt,0,0,he),this.addCurrentVertex($,Pt.mult(-1),0,0,he)}else if(zn==="bevel"||zn==="fakeround"){var Ci=-Math.sqrt(vr*vr-1),On=dn?Ci:0,na=dn?0:Ci;if(_e&&this.addCurrentVertex($,We,On,na,he),zn==="fakeround")for(var Bi=Math.round(180*Ir/Math.PI/20),wa=1;wa<Bi;wa++){var di=wa/Bi;if(di!==.5){var ka=di-.5;di+=di*ka*(di-1)*((1.0904+Wt*(Wt*(3.55645-1.43519*Wt)-3.2452))*ka*ka+(.848013+Wt*(.215638*Wt-1.06021)))}var Io=ht.sub(We)._mult(di)._add(We)._unit()._mult(dn?-1:1);this.addHalfVertex($,Io.x,Io.y,!1,dn,0,he)}Ge&&this.addCurrentVertex($,ht,-On,-na,he)}else if(zn==="butt")this.addCurrentVertex($,Pt,0,0,he);else if(zn==="square"){var Eo=_e?1:-1;this.addCurrentVertex($,Pt,Eo,Eo,he)}else zn==="round"&&(_e&&(this.addCurrentVertex($,We,0,0,he),this.addCurrentVertex($,We,1,1,he,!0)),Ge&&(this.addCurrentVertex($,ht,-1,-1,he,!0),this.addCurrentVertex($,ht,0,0,he)));if(tn&&qe<B-1){var ho=$.dist(Ge);if(ho>2*ne){var vo=$.add(Ge.sub($)._mult(ne/ho)._round());this.updateDistance($,vo),this.addCurrentVertex(vo,ht,0,0,he),$=vo}}}}},jo.prototype.addCurrentVertex=function(e,t,r,f,v,y){y===void 0&&(y=!1);var x=t.y*f-t.x,M=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,y,!1,r,v),this.addHalfVertex(e,x,M,y,!0,-f,v),this.distance>vs/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,y))},jo.prototype.addHalfVertex=function(e,t,r,f,v,y,x){var M=.5*(this.lineClips?this.scaledDistance*(vs-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(y===0?0:y<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var B=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,B),x.primitiveLength++),v?this.e2=B:this.e1=B},jo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},jo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Fn("LineBucket",jo,{omit:["layers","patternFeatures"]});var os=new Jo({"line-cap":new ii(se.layout_line["line-cap"]),"line-join":new Wn(se.layout_line["line-join"]),"line-miter-limit":new ii(se.layout_line["line-miter-limit"]),"line-round-limit":new ii(se.layout_line["line-round-limit"]),"line-sort-key":new Wn(se.layout_line["line-sort-key"])}),pu={paint:new Jo({"line-opacity":new Wn(se.paint_line["line-opacity"]),"line-color":new Wn(se.paint_line["line-color"]),"line-translate":new ii(se.paint_line["line-translate"]),"line-translate-anchor":new ii(se.paint_line["line-translate-anchor"]),"line-width":new Wn(se.paint_line["line-width"]),"line-gap-width":new Wn(se.paint_line["line-gap-width"]),"line-offset":new Wn(se.paint_line["line-offset"]),"line-blur":new Wn(se.paint_line["line-blur"]),"line-dasharray":new is(se.paint_line["line-dasharray"]),"line-pattern":new Rl(se.paint_line["line-pattern"]),"line-gradient":new Qs(se.paint_line["line-gradient"])}),layout:os},hh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new qi(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,y){return f=Vt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,y)},t}(Wn))(pu.paint.properties["line-width"].specification);hh.useIntegerZoom=!0;var zh=function(e){function t(r){e.call(this,r,pu),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof bs,this.gradientVersion=(this.gradientVersion+1)%Ne)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=hh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new jo(r)},t.prototype.queryRadius=function(r){var f=r,v=Uh(za("line-width",this,f),za("line-gap-width",this,f)),y=za("line-offset",this,f);return v/2+Math.abs(y)+fa(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,y,x,M,B){var G=Ta(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,B),$=B/2*Uh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),ne=this.paint.get("line-offset").evaluate(f,v);return ne&&(y=function(he,_e){for(var Ge=[],We=new W(0,0),ht=0;ht<he.length;ht++){for(var qe=he[ht],Pt=[],Wt=0;Wt<qe.length;Wt++){var cr=qe[Wt],vr=qe[Wt+1],Ir=Wt===0?We:cr.sub(qe[Wt-1])._unit()._perp(),tn=Wt===qe.length-1?We:vr.sub(cr)._unit()._perp(),dn=Ir._add(tn)._unit();dn._mult(1/(dn.x*tn.x+dn.y*tn.y)),Pt.push(dn._mult(_e)._add(cr))}Ge.push(Pt)}return Ge}(y,ne*B)),function(he,_e,Ge){for(var We=0;We<_e.length;We++){var ht=_e[We];if(he.length>=3){for(var qe=0;qe<ht.length;qe++)if(ta(he,ht[qe]))return!0}if($i(he,ht,Ge))return!0}return!1}(G,y,$)},t.prototype.isTileClipped=function(){return!0},t}(lu);function Uh(e,t){return t>0?t+2*e:e}var Zh=Do([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ph=Do([{name:"a_projected_pos",components:3,type:"Float32"}],4),jh=(Do([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Do([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Vh=(Do([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Do([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),gp=Do([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function _p(e,t,r){return e.sections.forEach(function(f){f.text=function(v,y,x){var M=y.layout.get("text-transform").evaluate(x,{});return M==="uppercase"?v=v.toLocaleUpperCase():M==="lowercase"&&(v=v.toLocaleLowerCase()),Rs.applyArabicShaping&&(v=Rs.applyArabicShaping(v)),v}(f.text,t,r)}),e}Do([{name:"triangle",components:3,type:"Uint16"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Do([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Do([{type:"Float32",name:"offsetX"}]),Do([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ef={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Gh=function(e,t,r,f,v){var y,x,M=8*v-f-1,B=(1<<M)-1,G=B>>1,$=-7,ne=r?v-1:0,he=r?-1:1,_e=e[t+ne];for(ne+=he,y=_e&(1<<-$)-1,_e>>=-$,$+=M;$>0;y=256*y+e[t+ne],ne+=he,$-=8);for(x=y&(1<<-$)-1,y>>=-$,$+=f;$>0;x=256*x+e[t+ne],ne+=he,$-=8);if(y===0)y=1-G;else{if(y===B)return x?NaN:1/0*(_e?-1:1);x+=Math.pow(2,f),y-=G}return(_e?-1:1)*x*Math.pow(2,y-f)},Mc=function(e,t,r,f,v,y){var x,M,B,G=8*y-v-1,$=(1<<G)-1,ne=$>>1,he=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,_e=f?0:y-1,Ge=f?1:-1,We=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(M=isNaN(t)?1:0,x=$):(x=Math.floor(Math.log(t)/Math.LN2),t*(B=Math.pow(2,-x))<1&&(x--,B*=2),(t+=x+ne>=1?he/B:he*Math.pow(2,1-ne))*B>=2&&(x++,B/=2),x+ne>=$?(M=0,x=$):x+ne>=1?(M=(t*B-1)*Math.pow(2,v),x+=ne):(M=t*Math.pow(2,ne-1)*Math.pow(2,v),x=0));v>=8;e[r+_e]=255&M,_e+=Ge,M/=256,v-=8);for(x=x<<v|M,G+=v;G>0;e[r+_e]=255&x,_e+=Ge,x/=256,G-=8);e[r+_e-Ge]|=128*We},wf=$a;function $a(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}$a.Varint=0,$a.Fixed64=1,$a.Bytes=2,$a.Fixed32=5;var Hh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function oc(e){return e.type===$a.Bytes?e.readVarint()+e.pos:e.pos+1}function Ic(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function dh(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function V(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Me(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function $e(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function ir(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Mr(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function rr(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Er(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Fr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Gr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Kr(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Qr(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function en(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function pn(e,t,r){e===1&&r.readMessage(Wr,t)}function Wr(e,t,r){if(e===3){var f=r.readMessage(qr,{}),v=f.width,y=f.height,x=f.left,M=f.top,B=f.advance;t.push({id:f.id,bitmap:new hu({width:v+6,height:y+6},f.bitmap),metrics:{width:v,height:y,left:x,top:M,advance:B}})}}function qr(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Rt(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var y=v[f];t+=y.w*y.h,r=Math.max(r,y.w)}e.sort(function(We,ht){return ht.h-We.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],M=0,B=0,G=0,$=e;G<$.length;G+=1)for(var ne=$[G],he=x.length-1;he>=0;he--){var _e=x[he];if(!(ne.w>_e.w||ne.h>_e.h)){if(ne.x=_e.x,ne.y=_e.y,B=Math.max(B,ne.y+ne.h),M=Math.max(M,ne.x+ne.w),ne.w===_e.w&&ne.h===_e.h){var Ge=x.pop();he<x.length&&(x[he]=Ge)}else ne.h===_e.h?(_e.x+=ne.w,_e.w-=ne.w):ne.w===_e.w?(_e.y+=ne.h,_e.h-=ne.h):(x.push({x:_e.x+ne.w,y:_e.y,w:_e.w-ne.w,h:ne.h}),_e.y+=ne.h,_e.h-=ne.h);break}}return{w:M,h:B,fill:t/(M*B)||0}}$a.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,y=this.pos;this.type=7&f,e(v,t,this),this.pos===y&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Kr(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=en(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*Kr(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=Kr(this.buf,this.pos)+4294967296*en(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Gh(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Gh(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,y,x){var M,B,G=x.buf;if(M=(112&(B=G[x.pos++]))>>4,B<128||(M|=(127&(B=G[x.pos++]))<<3,B<128)||(M|=(127&(B=G[x.pos++]))<<10,B<128)||(M|=(127&(B=G[x.pos++]))<<17,B<128)||(M|=(127&(B=G[x.pos++]))<<24,B<128)||(M|=(1&(B=G[x.pos++]))<<31,B<128))return Ic(v,M,y);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Hh?function(r,f,v){return Hh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var y="",x=f;x<v;){var M,B,G,$=r[x],ne=null,he=$>239?4:$>223?3:$>191?2:1;if(x+he>v)break;he===1?$<128&&(ne=$):he===2?(192&(M=r[x+1]))==128&&(ne=(31&$)<<6|63&M)<=127&&(ne=null):he===3?(B=r[x+2],(192&(M=r[x+1]))==128&&(192&B)==128&&((ne=(15&$)<<12|(63&M)<<6|63&B)<=2047||ne>=55296&&ne<=57343)&&(ne=null)):he===4&&(B=r[x+2],G=r[x+3],(192&(M=r[x+1]))==128&&(192&B)==128&&(192&G)==128&&((ne=(15&$)<<18|(63&M)<<12|(63&B)<<6|63&G)<=65535||ne>=1114112)&&(ne=null)),ne===null?(ne=65533,he=1):ne>65535&&(ne-=65536,y+=String.fromCharCode(ne>>>10&1023|55296),ne=56320|1023&ne),y+=String.fromCharCode(ne),x+=he}return y}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==$a.Bytes)return e.push(this.readVarint(t));var r=oc(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==$a.Bytes)return e.push(this.readSVarint());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==$a.Bytes)return e.push(this.readBoolean());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==$a.Bytes)return e.push(this.readFloat());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==$a.Bytes)return e.push(this.readDouble());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed32());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed32());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readFixed64());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==$a.Bytes)return e.push(this.readSFixed64());var t=oc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===$a.Varint)for(;this.buf[this.pos++]>127;);else if(t===$a.Bytes)this.pos=this.readVarint()+this.pos;else if(t===$a.Fixed32)this.pos+=4;else{if(t!==$a.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Qr(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Qr(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Qr(this.buf,-1&e,this.pos),Qr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Qr(this.buf,-1&e,this.pos),Qr(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(y,x,M){M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,y>>>=7,M.buf[M.pos++]=127&y|128,M.buf[M.pos]=127&(y>>>=7)}(f,0,r),function(y,x){var M=(7&y)<<4;x.buf[x.pos++]|=M|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,y){for(var x,M,B=0;B<v.length;B++){if((x=v.charCodeAt(B))>55295&&x<57344){if(!M){x>56319||B+1===v.length?(f[y++]=239,f[y++]=191,f[y++]=189):M=x;continue}if(x<56320){f[y++]=239,f[y++]=191,f[y++]=189,M=x;continue}x=M-55296<<10|x-56320|65536,M=null}else M&&(f[y++]=239,f[y++]=191,f[y++]=189,M=null);x<128?f[y++]=x:(x<2048?f[y++]=x>>6|192:(x<65536?f[y++]=x>>12|224:(f[y++]=x>>18|240,f[y++]=x>>12&63|128),f[y++]=x>>6&63|128),f[y++]=63&x|128)}return y}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&dh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),Mc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Mc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&dh(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,$a.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,V,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Me,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Mr,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,$e,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ir,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,rr,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Er,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Fr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Gr,t)},writeBytesField:function(e,t){this.writeTag(e,$a.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,$a.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,$a.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,$a.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,$a.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,$a.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,$a.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var pr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,y=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=y,this.content=x,this.version=f},Yr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Yr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Yr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Yr.tlbr.get=function(){return this.tl.concat(this.br)},Yr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(pr.prototype,Yr);var wn=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var y=Rt(v),x=new Po({width:y.w||1,height:y.h||1});for(var M in e){var B=e[M],G=r[M].paddedRect;Po.copy(B.data,x,{x:0,y:0},{x:G.x+1,y:G.y+1},B.data)}for(var $ in t){var ne=t[$],he=f[$].paddedRect,_e=he.x+1,Ge=he.y+1,We=ne.data.width,ht=ne.data.height;Po.copy(ne.data,x,{x:0,y:0},{x:_e,y:Ge},ne.data),Po.copy(ne.data,x,{x:0,y:ht-1},{x:_e,y:Ge-1},{width:We,height:1}),Po.copy(ne.data,x,{x:0,y:0},{x:_e,y:Ge+ht},{width:We,height:1}),Po.copy(ne.data,x,{x:We-1,y:0},{x:_e-1,y:Ge},{width:1,height:ht}),Po.copy(ne.data,x,{x:0,y:0},{x:_e+We,y:Ge},{width:1,height:ht})}this.image=x,this.iconPositions=r,this.patternPositions=f};wn.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],y={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(y),t[f]=new pr(y,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},wn.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},wn.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Fn("ImagePosition",pr),Fn("ImageAtlas",wn);var Tr={horizontal:1,vertical:2,horizontalOnly:3},Sn=function(){this.scale=1,this.fontStack="",this.imageName=null};Sn.forText=function(e,t){var r=new Sn;return r.scale=e||1,r.fontStack=t,r},Sn.forImage=function(e){var t=new Sn;return t.imageName=e,t};var rn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function ui(e,t,r,f,v,y,x,M,B,G,$,ne,he,_e,Ge,We){var ht,qe=rn.fromFeature(e,v);ne===Tr.vertical&&qe.verticalizePunctuation();var Pt=Rs.processBidirectionalText,Wt=Rs.processStyledBidirectionalText;if(Pt&&qe.sections.length===1){ht=[];for(var cr=0,vr=Pt(qe.toString(),En(qe,G,y,t,f,_e,Ge));cr<vr.length;cr+=1){var Ir=vr[cr],tn=new rn;tn.text=Ir,tn.sections=qe.sections;for(var dn=0;dn<Ir.length;dn++)tn.sectionIndex.push(0);ht.push(tn)}}else if(Wt){ht=[];for(var li=0,Bn=Wt(qe.text,qe.sectionIndex,En(qe,G,y,t,f,_e,Ge));li<Bn.length;li+=1){var fi=Bn[li],zn=new rn;zn.text=fi[0],zn.sectionIndex=fi[1],zn.sections=qe.sections,ht.push(zn)}}else ht=function(On,na){for(var Bi=[],wa=On.text,di=0,ka=0,Io=na;ka<Io.length;ka+=1){var Eo=Io[ka];Bi.push(On.substring(di,Eo)),di=Eo}return di<wa.length&&Bi.push(On.substring(di,wa.length)),Bi}(qe,En(qe,G,y,t,f,_e,Ge));var Xi=[],Ci={positionedLines:Xi,text:qe.toString(),top:$[1],bottom:$[1],left:$[0],right:$[0],writingMode:ne,iconsInText:!1,verticalizable:!1};return function(On,na,Bi,wa,di,ka,Io,Eo,ho,vo,No,ys){for(var Oo=0,ks=-17,ls=0,tu=0,ts=Eo==="right"?1:Eo==="left"?0:.5,Wo=0,pa=0,ro=di;pa<ro.length;pa+=1){var Qa=ro[pa];Qa.trim();var Ma=Qa.getMaxScale(),Eu=24*(Ma-1),ru={positionedGlyphs:[],lineOffset:0};On.positionedLines[Wo]=ru;var wo=ru.positionedGlyphs,gs=0;if(Qa.length()){for(var nu=0;nu<Qa.length();nu++){var Ia=Qa.getSection(nu),Vl=Qa.getSectionIndex(nu),bl=Qa.getCharCode(nu),uc=0,rs=null,Gc=null,Sl=null,Hf=24,Wf=!(ho===Tr.horizontal||!No&&!tc(bl)||No&&(Ar[bl]||(Gl=bl,vn.Arabic(Gl)||vn["Arabic Supplement"](Gl)||vn["Arabic Extended-A"](Gl)||vn["Arabic Presentation Forms-A"](Gl)||vn["Arabic Presentation Forms-B"](Gl))));if(Ia.imageName){var Pf=wa[Ia.imageName];if(!Pf)continue;Sl=Ia.imageName,On.iconsInText=On.iconsInText||!0,Gc=Pf.paddedRect;var Hc=Pf.displaySize;Ia.scale=24*Ia.scale/ys,uc=Eu+(24-Hc[1]*Ia.scale),Hf=(rs={width:Hc[0],height:Hc[1],left:1,top:-3,advance:Wf?Hc[1]:Hc[0]}).advance;var _h=Wf?Hc[0]*Ia.scale-24*Ma:Hc[1]*Ia.scale-24*Ma;_h>0&&_h>gs&&(gs=_h)}else{var Mf=Bi[Ia.fontStack],Xf=Mf&&Mf[bl];if(Xf&&Xf.rect)Gc=Xf.rect,rs=Xf.metrics;else{var Xh=na[Ia.fontStack],Lc=Xh&&Xh[bl];if(!Lc)continue;rs=Lc.metrics}uc=24*(Ma-Ia.scale)}Wf?(On.verticalizable=!0,wo.push({glyph:bl,imageName:Sl,x:Oo,y:ks+uc,vertical:Wf,scale:Ia.scale,fontStack:Ia.fontStack,sectionIndex:Vl,metrics:rs,rect:Gc}),Oo+=Hf*Ia.scale+vo):(wo.push({glyph:bl,imageName:Sl,x:Oo,y:ks+uc,vertical:Wf,scale:Ia.scale,fontStack:Ia.fontStack,sectionIndex:Vl,metrics:rs,rect:Gc}),Oo+=rs.advance*Ia.scale+vo)}wo.length!==0&&(ls=Math.max(Oo-vo,ls),ki(wo,0,wo.length-1,ts,gs)),Oo=0;var xh=ka*Ma+gs;ru.lineOffset=Math.max(gs,Eu),ks+=xh,tu=Math.max(xh,tu),++Wo}else ks+=ka,++Wo}var Gl,bh=ks- -17,Yf=Ni(Io),El=Yf.horizontalAlign,Kf=Yf.verticalAlign;(function(Yh,bp,Kh,$h,Sp,Jh,Qh,qh,Sh){var If,Ep=(bp-Kh)*Sp;If=Jh!==Qh?-qh*$h- -17:(-$h*Sh+.5)*Qh;for(var lf=0,Wc=Yh;lf<Wc.length;lf+=1)for(var $f=0,Of=Wc[lf].positionedGlyphs;$f<Of.length;$f+=1){var cf=Of[$f];cf.x+=Ep,cf.y+=If}})(On.positionedLines,ts,El,Kf,ls,tu,ka,bh,di.length),On.top+=-Kf*bh,On.bottom=On.top+bh,On.left+=-El*ls,On.right=On.left+ls}(Ci,t,r,f,ht,x,M,B,ne,G,he,We),!function(On){for(var na=0,Bi=On;na<Bi.length;na+=1)if(Bi[na].positionedGlyphs.length!==0)return!1;return!0}(Xi)&&Ci}rn.fromFeature=function(e,t){for(var r=new rn,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},rn.prototype.length=function(){return this.text.length},rn.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},rn.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},rn.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},rn.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&ku(f)&&!Ef[e[r+1]]||v&&ku(v)&&!Ef[e[r-1]]||!Ef[e[r]]?e[r]:Ef[e[r]]}return t}(this.text)},rn.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&Ar[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&Ar[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},rn.prototype.substring=function(e,t){var r=new rn;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},rn.prototype.toString=function(){return this.text},rn.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},rn.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(Sn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},rn.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(Sn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}else Xe("Can't add FormattedSection with an empty image.")},rn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Ar={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},br={};function Xn(e,t,r,f,v,y){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/y+v:0}var M=r[t.fontStack],B=M&&M[e];return B?B.metrics.advance*t.scale+v:0}function fn(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function $r(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function gn(e,t,r,f,v,y){for(var x=null,M=fn(t,r,v,y),B=0,G=f;B<G.length;B+=1){var $=G[B],ne=fn(t-$.x,r,v,y)+$.badness;ne<=M&&(x=$,M=ne)}return{index:e,x:t,priorBreak:x,badness:M}}function En(e,t,r,f,v,y,x){if(y!=="point")return[];if(!e)return[];for(var M,B=[],G=function(ht,qe,Pt,Wt,cr,vr){for(var Ir=0,tn=0;tn<ht.length();tn++){var dn=ht.getSection(tn);Ir+=Xn(ht.getCharCode(tn),dn,Wt,cr,qe,vr)}return Ir/Math.max(1,Math.ceil(Ir/Pt))}(e,t,r,f,v,x),$=e.text.indexOf("\u200B")>=0,ne=0,he=0;he<e.length();he++){var _e=e.getSection(he),Ge=e.getCharCode(he);if(Ar[Ge]||(ne+=Xn(Ge,_e,f,v,t,x)),he<e.length()-1){var We=!((M=Ge)<11904||!(vn["Bopomofo Extended"](M)||vn.Bopomofo(M)||vn["CJK Compatibility Forms"](M)||vn["CJK Compatibility Ideographs"](M)||vn["CJK Compatibility"](M)||vn["CJK Radicals Supplement"](M)||vn["CJK Strokes"](M)||vn["CJK Symbols and Punctuation"](M)||vn["CJK Unified Ideographs Extension A"](M)||vn["CJK Unified Ideographs"](M)||vn["Enclosed CJK Letters and Months"](M)||vn["Halfwidth and Fullwidth Forms"](M)||vn.Hiragana(M)||vn["Ideographic Description Characters"](M)||vn["Kangxi Radicals"](M)||vn["Katakana Phonetic Extensions"](M)||vn.Katakana(M)||vn["Vertical Forms"](M)||vn["Yi Radicals"](M)||vn["Yi Syllables"](M)));(br[Ge]||We||_e.imageName)&&B.push(gn(he+1,ne,G,B,$r(Ge,e.getCharCode(he+1),We&&$),!1))}}return function ht(qe){return qe?ht(qe.priorBreak).concat(qe.index):[]}(gn(e.length(),ne,G,B,0,!0))}function Ni(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function ki(e,t,r,f,v){if(f||v)for(var y=e[r],x=(e[r].x+y.metrics.advance*y.scale)*f,M=t;M<=r;M++)e[M].x-=x,e[M].y+=v}function Tn(e,t,r,f,v,y){var x,M=e.image;if(M.content){var B=M.content,G=M.pixelRatio||1;x=[B[0]/G,B[1]/G,M.displaySize[0]-B[2]/G,M.displaySize[1]-B[3]/G]}var $,ne,he,_e,Ge=t.left*y,We=t.right*y;r==="width"||r==="both"?(_e=v[0]+Ge-f[3],ne=v[0]+We+f[1]):ne=(_e=v[0]+(Ge+We-M.displaySize[0])/2)+M.displaySize[0];var ht=t.top*y,qe=t.bottom*y;return r==="height"||r==="both"?($=v[1]+ht-f[0],he=v[1]+qe+f[2]):he=($=v[1]+(ht+qe-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:$,right:ne,bottom:he,left:_e,collisionPadding:x}}br[10]=!0,br[32]=!0,br[38]=!0,br[40]=!0,br[41]=!0,br[43]=!0,br[45]=!0,br[47]=!0,br[173]=!0,br[183]=!0,br[8203]=!0,br[8208]=!0,br[8211]=!0,br[8231]=!0;var Cn=function(e){function t(r,f,v,y){e.call(this,r,f),this.angle=v,y!==void 0&&(this.segment=y)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(W);function xi(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new qi(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,y=0;y<f.length&&f[y]<=e;)y++;for(var x=y=Math.max(0,y-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var M=f[y],B=f[x];return r.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:B,interpolationType:v}:{kind:"camera",minZoom:M,maxZoom:B,minSize:r.evaluate(new qi(M)),maxSize:r.evaluate(new qi(B)),interpolationType:v}}function Di(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Ca(v/128,r.upperSize/128,t.uSizeT):f}function ia(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,y=v?rt(Oe.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Ca(e.minSize,e.maxSize,y):r=y}return{uSizeT:r,uSize:f}}Fn("Anchor",Cn);var So=Object.freeze({__proto__:null,getSizeData:xi,evaluateSizeForFeature:Di,evaluateSizeForZoom:ia,SIZE_PACK_FACTOR:128});function Mo(e,t,r,f,v){if(t.segment===void 0)return!0;for(var y=t,x=t.segment+1,M=0;M>-r/2;){if(--x<0)return!1;M-=e[x].dist(y),y=e[x]}M+=e[x].dist(e[x+1]),x++;for(var B=[],G=0;M<r/2;){var $=e[x],ne=e[x+1];if(!ne)return!1;var he=e[x-1].angleTo($)-$.angleTo(ne);for(he=Math.abs((he+3*Math.PI)%(2*Math.PI)-Math.PI),B.push({distance:M,angleDelta:he}),G+=he;M-B[0].distance>f;)G-=B.shift().angleDelta;if(G>v)return!1;x++,M+=$.dist(ne)}return!0}function la(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Qo(e,t,r){return e?.6*t*r:0}function to(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Cs(e,t,r,f,v,y){for(var x=Qo(r,v,y),M=to(r,f)*y,B=0,G=la(e)/2,$=0;$<e.length-1;$++){var ne=e[$],he=e[$+1],_e=ne.dist(he);if(B+_e>G){var Ge=(G-B)/_e,We=Ca(ne.x,he.x,Ge),ht=Ca(ne.y,he.y,Ge),qe=new Cn(We,ht,he.angleTo(ne),$);return qe._round(),!x||Mo(e,qe,M,x,t)?qe:void 0}B+=_e}}function ss(e,t,r,f,v,y,x,M,B){var G=Qo(f,y,x),$=to(f,v),ne=$*x,he=e[0].x===0||e[0].x===B||e[0].y===0||e[0].y===B;return t-ne<t/4&&(t=ne+t/4),function _e(Ge,We,ht,qe,Pt,Wt,cr,vr,Ir){for(var tn=Wt/2,dn=la(Ge),li=0,Bn=We-ht,fi=[],zn=0;zn<Ge.length-1;zn++){for(var Xi=Ge[zn],Ci=Ge[zn+1],On=Xi.dist(Ci),na=Ci.angleTo(Xi);Bn+ht<li+On;){var Bi=((Bn+=ht)-li)/On,wa=Ca(Xi.x,Ci.x,Bi),di=Ca(Xi.y,Ci.y,Bi);if(wa>=0&&wa<Ir&&di>=0&&di<Ir&&Bn-tn>=0&&Bn+tn<=dn){var ka=new Cn(wa,di,na,zn);ka._round(),qe&&!Mo(Ge,ka,Wt,qe,Pt)||fi.push(ka)}}li+=On}return vr||fi.length||cr||(fi=_e(Ge,li/2,ht,qe,Pt,Wt,cr,!0,Ir)),fi}(e,he?t/2*M%t:($/2+2*y)*x*M%t,t,G,r,ne,he,!1,B)}function qo(e,t,r,f,v){for(var y=[],x=0;x<e.length;x++)for(var M=e[x],B=void 0,G=0;G<M.length-1;G++){var $=M[G],ne=M[G+1];$.x<t&&ne.x<t||($.x<t?$=new W(t,$.y+(t-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x<t&&(ne=new W(t,$.y+(t-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y<r&&ne.y<r||($.y<r?$=new W($.x+(r-$.y)/(ne.y-$.y)*(ne.x-$.x),r)._round():ne.y<r&&(ne=new W($.x+(r-$.y)/(ne.y-$.y)*(ne.x-$.x),r)._round()),$.x>=f&&ne.x>=f||($.x>=f?$=new W(f,$.y+(f-$.x)/(ne.x-$.x)*(ne.y-$.y))._round():ne.x>=f&&(ne=new W(f,$.y+(f-$.x)/(ne.x-$.x)*(ne.y-$.y))._round()),$.y>=v&&ne.y>=v||($.y>=v?$=new W($.x+(v-$.y)/(ne.y-$.y)*(ne.x-$.x),v)._round():ne.y>=v&&(ne=new W($.x+(v-$.y)/(ne.y-$.y)*(ne.x-$.x),v)._round()),B&&$.equals(B[B.length-1])||y.push(B=[$]),B.push(ne)))))}return y}function us(e,t,r,f){var v=[],y=e.image,x=y.pixelRatio,M=y.paddedRect.w-2,B=y.paddedRect.h-2,G=e.right-e.left,$=e.bottom-e.top,ne=y.stretchX||[[0,M]],he=y.stretchY||[[0,B]],_e=function(wa,di){return wa+di[1]-di[0]},Ge=ne.reduce(_e,0),We=he.reduce(_e,0),ht=M-Ge,qe=B-We,Pt=0,Wt=Ge,cr=0,vr=We,Ir=0,tn=ht,dn=0,li=qe;if(y.content&&f){var Bn=y.content;Pt=es(ne,0,Bn[0]),cr=es(he,0,Bn[1]),Wt=es(ne,Bn[0],Bn[2]),vr=es(he,Bn[1],Bn[3]),Ir=Bn[0]-Pt,dn=Bn[1]-cr,tn=Bn[2]-Bn[0]-Wt,li=Bn[3]-Bn[1]-vr}var fi=function(wa,di,ka,Io){var Eo=Fi(wa.stretch-Pt,Wt,G,e.left),ho=Vo(wa.fixed-Ir,tn,wa.stretch,Ge),vo=Fi(di.stretch-cr,vr,$,e.top),No=Vo(di.fixed-dn,li,di.stretch,We),ys=Fi(ka.stretch-Pt,Wt,G,e.left),Oo=Vo(ka.fixed-Ir,tn,ka.stretch,Ge),ks=Fi(Io.stretch-cr,vr,$,e.top),ls=Vo(Io.fixed-dn,li,Io.stretch,We),tu=new W(Eo,vo),ts=new W(ys,vo),Wo=new W(ys,ks),pa=new W(Eo,ks),ro=new W(ho/x,No/x),Qa=new W(Oo/x,ls/x),Ma=t*Math.PI/180;if(Ma){var Eu=Math.sin(Ma),ru=Math.cos(Ma),wo=[ru,-Eu,Eu,ru];tu._matMult(wo),ts._matMult(wo),pa._matMult(wo),Wo._matMult(wo)}var gs=wa.stretch+wa.fixed,nu=di.stretch+di.fixed;return{tl:tu,tr:ts,bl:pa,br:Wo,tex:{x:y.paddedRect.x+1+gs,y:y.paddedRect.y+1+nu,w:ka.stretch+ka.fixed-gs,h:Io.stretch+Io.fixed-nu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ro,pixelOffsetBR:Qa,minFontScaleX:tn/x/G,minFontScaleY:li/x/$,isSDF:r}};if(f&&(y.stretchX||y.stretchY))for(var zn=Bo(ne,ht,Ge),Xi=Bo(he,qe,We),Ci=0;Ci<zn.length-1;Ci++)for(var On=zn[Ci],na=zn[Ci+1],Bi=0;Bi<Xi.length-1;Bi++)v.push(fi(On,Xi[Bi],na,Xi[Bi+1]));else v.push(fi({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:B+1}));return v}function es(e,t,r){for(var f=0,v=0,y=e;v<y.length;v+=1){var x=y[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function Bo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,y=e;v<y.length;v+=1){var x=y[v],M=x[0],B=x[1],G=f[f.length-1];f.push({fixed:M-G.stretch,stretch:G.stretch}),f.push({fixed:M-G.stretch,stretch:G.stretch+(B-M)})}return f.push({fixed:t+1,stretch:r}),f}function Fi(e,t,r,f){return e/t*r+f}function Vo(e,t,r,f){return e-t*r/f}var Ra=function(e,t,r,f,v,y,x,M,B,G){if(this.boxStartIndex=e.length,B){var $=y.top,ne=y.bottom,he=y.collisionPadding;he&&($-=he[1],ne+=he[3]);var _e=ne-$;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{var Ge=y.top*x-M,We=y.bottom*x+M,ht=y.left*x-M,qe=y.right*x+M,Pt=y.collisionPadding;if(Pt&&(ht-=Pt[0]*x,Ge-=Pt[1]*x,qe+=Pt[2]*x,We+=Pt[3]*x),G){var Wt=new W(ht,Ge),cr=new W(qe,Ge),vr=new W(ht,We),Ir=new W(qe,We),tn=G*Math.PI/180;Wt._rotate(tn),cr._rotate(tn),vr._rotate(tn),Ir._rotate(tn),ht=Math.min(Wt.x,cr.x,vr.x,Ir.x),qe=Math.max(Wt.x,cr.x,vr.x,Ir.x),Ge=Math.min(Wt.y,cr.y,vr.y,Ir.y),We=Math.max(Wt.y,cr.y,vr.y,Ir.y)}e.emplaceBack(t.x,t.y,ht,Ge,qe,We,r,f,v)}this.boxEndIndex=e.length},Go=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Mi),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Mi(e,t){return e<t?-1:e>t?1:0}function aa(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,y=-1/0,x=-1/0,M=e[0],B=0;B<M.length;B++){var G=M[B];(!B||G.x<f)&&(f=G.x),(!B||G.y<v)&&(v=G.y),(!B||G.x>y)&&(y=G.x),(!B||G.y>x)&&(x=G.y)}var $=Math.min(y-f,x-v),ne=$/2,he=new Go([],ha);if($===0)return new W(f,v);for(var _e=f;_e<y;_e+=$)for(var Ge=v;Ge<x;Ge+=$)he.push(new oo(_e+ne,Ge+ne,ne,e));for(var We=function(Pt){for(var Wt=0,cr=0,vr=0,Ir=Pt[0],tn=0,dn=Ir.length,li=dn-1;tn<dn;li=tn++){var Bn=Ir[tn],fi=Ir[li],zn=Bn.x*fi.y-fi.x*Bn.y;cr+=(Bn.x+fi.x)*zn,vr+=(Bn.y+fi.y)*zn,Wt+=3*zn}return new oo(cr/Wt,vr/Wt,0,Pt)}(e),ht=he.length;he.length;){var qe=he.pop();(qe.d>We.d||!We.d)&&(We=qe,r&&console.log("found best %d after %d probes",Math.round(1e4*qe.d)/1e4,ht)),qe.max-We.d<=t||(he.push(new oo(qe.p.x-(ne=qe.h/2),qe.p.y-ne,ne,e)),he.push(new oo(qe.p.x+ne,qe.p.y-ne,ne,e)),he.push(new oo(qe.p.x-ne,qe.p.y+ne,ne,e)),he.push(new oo(qe.p.x+ne,qe.p.y+ne,ne,e)),ht+=4)}return r&&(console.log("num probes: "+ht),console.log("best distance: "+We.d)),We.p}function ha(e,t){return t.max-e.max}function oo(e,t,r,f){this.p=new W(e,t),this.h=r,this.d=function(v,y){for(var x=!1,M=1/0,B=0;B<y.length;B++)for(var G=y[B],$=0,ne=G.length,he=ne-1;$<ne;he=$++){var _e=G[$],Ge=G[he];_e.y>v.y!=Ge.y>v.y&&v.x<(Ge.x-_e.x)*(v.y-_e.y)/(Ge.y-_e.y)+_e.x&&(x=!x),M=Math.min(M,co(v,_e,Ge))}return(x?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}Go.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Go.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Go.prototype.peek=function(){return this.data[0]},Go.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,y=t[v];if(r(f,y)>=0)break;t[e]=y,e=v}t[e]=f},Go.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var y=1+(e<<1),x=t[y],M=y+1;if(M<this.length&&r(t[M],x)<0&&(y=M,x=t[M]),r(x,v)>=0)break;t[e]=x,e=y}t[e]=v};var el=Number.POSITIVE_INFINITY;function Ve(e,t){return t[1]!==el?function(r,f,v){var y=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":y=-f;break;case"top-left":case"bottom-left":case"left":y=f}return[y,x]}(e,t[0],t[1]):function(r,f){var v=0,y=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":y=x-7;break;case"bottom-right":case"bottom-left":y=7-x;break;case"bottom":y=7-f;break;case"top":y=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,y]}(e,t[0])}function lr(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Kt(e,t,r,f,v,y,x,M,B,G,$,ne,he,_e,Ge){var We=function(cr,vr,Ir,tn,dn,li,Bn,fi){for(var zn=tn.layout.get("text-rotate").evaluate(li,{})*Math.PI/180,Xi=[],Ci=0,On=vr.positionedLines;Ci<On.length;Ci+=1)for(var na=On[Ci],Bi=0,wa=na.positionedGlyphs;Bi<wa.length;Bi+=1){var di=wa[Bi];if(di.rect){var ka=di.rect||{},Io=4,Eo=!0,ho=1,vo=0,No=(dn||fi)&&di.vertical,ys=di.metrics.advance*di.scale/2;if(fi&&vr.verticalizable&&(vo=na.lineOffset/2-(di.imageName?-(24-di.metrics.width*di.scale)/2:24*(di.scale-1))),di.imageName){var Oo=Bn[di.imageName];Eo=Oo.sdf,Io=1/(ho=Oo.pixelRatio)}var ks=dn?[di.x+ys,di.y]:[0,0],ls=dn?[0,0]:[di.x+ys+Ir[0],di.y+Ir[1]-vo],tu=[0,0];No&&(tu=ls,ls=[0,0]);var ts=(di.metrics.left-Io)*di.scale-ys+ls[0],Wo=(-di.metrics.top-Io)*di.scale+ls[1],pa=ts+ka.w*di.scale/ho,ro=Wo+ka.h*di.scale/ho,Qa=new W(ts,Wo),Ma=new W(pa,Wo),Eu=new W(ts,ro),ru=new W(pa,ro);if(No){var wo=new W(-ys,ys- -17),gs=-Math.PI/2,nu=12-ys,Ia=new W(22-nu,-(di.imageName?nu:0)),Vl=new(Function.prototype.bind.apply(W,[null].concat(tu)));Qa._rotateAround(gs,wo)._add(Ia)._add(Vl),Ma._rotateAround(gs,wo)._add(Ia)._add(Vl),Eu._rotateAround(gs,wo)._add(Ia)._add(Vl),ru._rotateAround(gs,wo)._add(Ia)._add(Vl)}if(zn){var bl=Math.sin(zn),uc=Math.cos(zn),rs=[uc,-bl,bl,uc];Qa._matMult(rs),Ma._matMult(rs),Eu._matMult(rs),ru._matMult(rs)}var Gc=new W(0,0),Sl=new W(0,0);Xi.push({tl:Qa,tr:Ma,bl:Eu,br:ru,tex:ka,writingMode:vr.writingMode,glyphOffset:ks,sectionIndex:di.sectionIndex,isSDF:Eo,pixelOffsetTL:Gc,pixelOffsetBR:Sl,minFontScaleX:0,minFontScaleY:0})}}return Xi}(0,r,M,v,y,x,f,e.allowVerticalPlacement),ht=e.textSizeData,qe=null;ht.kind==="source"?(qe=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ht.kind==="composite"&&((qe=[128*_e.compositeTextSizes[0].evaluate(x,{},Ge),128*_e.compositeTextSizes[1].evaluate(x,{},Ge)])[0]>32640||qe[1]>32640)&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,We,qe,M,y,x,G,t,B.lineStartIndex,B.lineLength,he,Ge);for(var Pt=0,Wt=$;Pt<Wt.length;Pt+=1)ne[Wt[Pt]]=e.text.placedSymbolArray.length-1;return 4*We.length}function Nn(e){for(var t in e)return e[t];return null}function oa(e,t,r,f){var v=e.compareText;if(t in v){for(var y=v[t],x=y.length-1;x>=0;x--)if(f.dist(y[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var De=jc.VectorTileFeature.types,be=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tt(e,t,r,f,v,y,x,M,B,G,$,ne,he){var _e=M?Math.min(32640,Math.round(M[0])):0,Ge=M?Math.min(32640,Math.round(M[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),y,x,(_e<<1)+(B?1:0),Ge,16*G,16*$,256*ne,256*he)}function kt(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function or(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(rc(r[t].text))return!0;return!1}var mt=function(e){this.layoutVertexArray=new kl,this.indexArray=new Fu,this.programConfigurations=e,this.segments=new we,this.dynamicLayoutVertexArray=new Ju,this.opacityVertexArray=new Dl,this.placedSymbolArray=new h};mt.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},mt.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Zh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ph.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,be,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},mt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Fn("SymbolBuffers",mt);var ut=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new we,this.collisionVertexArray=new bc};ut.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,jh.members,!0)},ut.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Fn("CollisionBuffers",ut);var et=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(y){return y.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Zo([]),this.placementViewportMatrix=Zo([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=xi(this.zoom,t["text-size"]),this.iconSizeData=xi(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(y){return Tr[y]})),this.stateDependentLayerIds=this.layers.filter(function(y){return y.isStateDependent()}).map(function(y){return y.id}),this.sourceID=e.sourceID};et.prototype.createArrays=function(){this.text=new mt(new pe(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new mt(new pe(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new P,this.lineVertexArray=new D,this.symbolInstances=new b},et.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var y=0;y<e.length;y++)if(t[e.charCodeAt(y)]=!0,(r||f)&&v){var x=Ef[e.charAt(y)];x&&(t[x.charCodeAt(0)]=!0)}},et.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,y=v.get("text-font"),x=v.get("text-field"),M=v.get("icon-image"),B=(x.value.kind!=="constant"||x.value.value instanceof ya&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),G=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,$=v.get("symbol-sort-key");if(this.features=[],B||G){for(var ne=t.iconDependencies,he=t.glyphDependencies,_e=t.availableImages,Ge=new qi(this.zoom),We=0,ht=e;We<ht.length;We+=1){var qe=ht[We],Pt=qe.feature,Wt=qe.id,cr=qe.index,vr=qe.sourceLayerIndex,Ir=f._featureFilter.needGeometry,tn=mn(Pt,Ir);if(f._featureFilter.filter(Ge,tn,r)){Ir||(tn.geometry=Pr(Pt));var dn=void 0;if(B){var li=f.getValueAndResolveTokens("text-field",tn,r,_e),Bn=ya.factory(li);or(Bn)&&(this.hasRTLText=!0),(!this.hasRTLText||zc()==="unavailable"||this.hasRTLText&&Rs.isParsed())&&(dn=_p(Bn,f,tn))}var fi=void 0;if(G){var zn=f.getValueAndResolveTokens("icon-image",tn,r,_e);fi=zn instanceof mi?zn:mi.fromString(zn)}if(dn||fi){var Xi=this.sortFeaturesByKey?$.evaluate(tn,{},r):void 0;if(this.features.push({id:Wt,text:dn,icon:fi,index:cr,sourceLayerIndex:vr,geometry:tn.geometry,properties:Pt.properties,type:De[Pt.type],sortKey:Xi}),fi&&(ne[fi.name]=!0),dn){var Ci=y.evaluate(tn,{},r).join(","),On=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Tr.vertical)>=0;for(var na=0,Bi=dn.sections;na<Bi.length;na+=1){var wa=Bi[na];if(wa.image)ne[wa.image.name]=!0;else{var di=ec(dn.toString()),ka=wa.fontStack||Ci,Io=he[ka]=he[ka]||{};this.calculateGlyphDependencies(wa.text,Io,On,this.allowVerticalPlacement,di)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function(Eo){var ho={},vo={},No=[],ys=0;function Oo(wo){No.push(Eo[wo]),ys++}function ks(wo,gs,nu){var Ia=vo[wo];return delete vo[wo],vo[gs]=Ia,No[Ia].geometry[0].pop(),No[Ia].geometry[0]=No[Ia].geometry[0].concat(nu[0]),Ia}function ls(wo,gs,nu){var Ia=ho[gs];return delete ho[gs],ho[wo]=Ia,No[Ia].geometry[0].shift(),No[Ia].geometry[0]=nu[0].concat(No[Ia].geometry[0]),Ia}function tu(wo,gs,nu){var Ia=nu?gs[0][gs[0].length-1]:gs[0][0];return wo+":"+Ia.x+":"+Ia.y}for(var ts=0;ts<Eo.length;ts++){var Wo=Eo[ts],pa=Wo.geometry,ro=Wo.text?Wo.text.toString():null;if(ro){var Qa=tu(ro,pa),Ma=tu(ro,pa,!0);if(Qa in vo&&Ma in ho&&vo[Qa]!==ho[Ma]){var Eu=ls(Qa,Ma,pa),ru=ks(Qa,Ma,No[Eu].geometry);delete ho[Qa],delete vo[Ma],vo[tu(ro,No[ru].geometry,!0)]=ru,No[Eu].geometry=null}else Qa in vo?ks(Qa,Ma,pa):Ma in ho?ls(Qa,Ma,pa):(Oo(ts),ho[Qa]=ys-1,vo[Ma]=ys-1)}else Oo(ts)}return No.filter(function(wo){return wo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Eo,ho){return Eo.sortKey-ho.sortKey})}},et.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},et.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},et.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},et.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},et.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},et.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},et.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),y={},x=e.segment+1;x<t.length;x++)y[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var M=e.segment||0;M>=0;M--)y[M]={x:t[M].x,y:t[M].y,tileUnitDistanceFromAnchor:v},M>0&&(v+=t[M-1].dist(t[M]));for(var B=0;B<t.length;B++){var G=y[B];this.lineVertexArray.emplaceBack(G.x,G.y,G.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},et.prototype.addSymbols=function(e,t,r,f,v,y,x,M,B,G,$,ne){for(var he=e.indexArray,_e=e.layoutVertexArray,Ge=e.segments.prepareSegment(4*t.length,_e,he,this.canOverlap?y.sortKey:void 0),We=this.glyphOffsetArray.length,ht=Ge.vertexLength,qe=this.allowVerticalPlacement&&x===Tr.vertical?Math.PI/2:0,Pt=y.text&&y.text.sections,Wt=0;Wt<t.length;Wt++){var cr=t[Wt],vr=cr.tl,Ir=cr.tr,tn=cr.bl,dn=cr.br,li=cr.tex,Bn=cr.pixelOffsetTL,fi=cr.pixelOffsetBR,zn=cr.minFontScaleX,Xi=cr.minFontScaleY,Ci=cr.glyphOffset,On=cr.isSDF,na=cr.sectionIndex,Bi=Ge.vertexLength,wa=Ci[1];tt(_e,M.x,M.y,vr.x,wa+vr.y,li.x,li.y,r,On,Bn.x,Bn.y,zn,Xi),tt(_e,M.x,M.y,Ir.x,wa+Ir.y,li.x+li.w,li.y,r,On,fi.x,Bn.y,zn,Xi),tt(_e,M.x,M.y,tn.x,wa+tn.y,li.x,li.y+li.h,r,On,Bn.x,fi.y,zn,Xi),tt(_e,M.x,M.y,dn.x,wa+dn.y,li.x+li.w,li.y+li.h,r,On,fi.x,fi.y,zn,Xi),kt(e.dynamicLayoutVertexArray,M,qe),he.emplaceBack(Bi,Bi+1,Bi+2),he.emplaceBack(Bi+1,Bi+2,Bi+3),Ge.vertexLength+=4,Ge.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ci[0]),Wt!==t.length-1&&na===t[Wt+1].sectionIndex||e.programConfigurations.populatePaintArrays(_e.length,y,y.index,{},ne,Pt&&Pt[na])}e.placedSymbolArray.emplaceBack(M.x,M.y,We,this.glyphOffsetArray.length-We,ht,B,G,M.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,$)},et.prototype._addCollisionDebugVertex=function(e,t,r,f,v,y){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(y.x),Math.round(y.y))},et.prototype.addCollisionDebugVertices=function(e,t,r,f,v,y,x){var M=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),B=M.vertexLength,G=v.layoutVertexArray,$=v.collisionVertexArray,ne=x.anchorX,he=x.anchorY;this._addCollisionDebugVertex(G,$,y,ne,he,new W(e,t)),this._addCollisionDebugVertex(G,$,y,ne,he,new W(r,t)),this._addCollisionDebugVertex(G,$,y,ne,he,new W(r,f)),this._addCollisionDebugVertex(G,$,y,ne,he,new W(e,f)),M.vertexLength+=4;var _e=v.indexArray;_e.emplaceBack(B,B+1),_e.emplaceBack(B+1,B+2),_e.emplaceBack(B+2,B+3),_e.emplaceBack(B+3,B),M.primitiveLength+=4},et.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var y=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,r)}},et.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ut(Fl,Vh.members,zu),this.iconCollisionBox=new ut(Fl,Vh.members,zu);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},et.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,y,x,M,B){for(var G={},$=t;$<r;$++){var ne=e.get($);G.textBox={x1:ne.x1,y1:ne.y1,x2:ne.x2,y2:ne.y2,anchorPointX:ne.anchorPointX,anchorPointY:ne.anchorPointY},G.textFeatureIndex=ne.featureIndex;break}for(var he=f;he<v;he++){var _e=e.get(he);G.verticalTextBox={x1:_e.x1,y1:_e.y1,x2:_e.x2,y2:_e.y2,anchorPointX:_e.anchorPointX,anchorPointY:_e.anchorPointY},G.verticalTextFeatureIndex=_e.featureIndex;break}for(var Ge=y;Ge<x;Ge++){var We=e.get(Ge);G.iconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},G.iconFeatureIndex=We.featureIndex;break}for(var ht=M;ht<B;ht++){var qe=e.get(ht);G.verticalIconBox={x1:qe.x1,y1:qe.y1,x2:qe.x2,y2:qe.y2,anchorPointX:qe.anchorPointX,anchorPointY:qe.anchorPointY},G.verticalIconFeatureIndex=qe.featureIndex;break}return G},et.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},et.prototype.hasTextData=function(){return this.text.segments.get().length>0},et.prototype.hasIconData=function(){return this.icon.segments.get().length>0},et.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},et.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},et.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},et.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},et.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],y=[],x=0;x<this.symbolInstances.length;++x){y.push(x);var M=this.symbolInstances.get(x);f.push(0|Math.round(t*M.anchorX+r*M.anchorY)),v.push(M.featureIndex)}return y.sort(function(B,G){return f[B]-f[G]||v[G]-v[B]}),y},et.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},et.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(y,x,M){y>=0&&M.indexOf(y)===x&&t.addIndicesForPlacedSymbol(t.text,y)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Fn("SymbolBucket",et,{omit:["layers","collisionBoxArray","features","compareText"]}),et.MAX_GLYPHS=65535,et.addDynamicAttributes=kt;var Ie=new Jo({"symbol-placement":new ii(se.layout_symbol["symbol-placement"]),"symbol-spacing":new ii(se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ii(se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wn(se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ii(se.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ii(se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ii(se.layout_symbol["icon-ignore-placement"]),"icon-optional":new ii(se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ii(se.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wn(se.layout_symbol["icon-size"]),"icon-text-fit":new ii(se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ii(se.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wn(se.layout_symbol["icon-image"]),"icon-rotate":new Wn(se.layout_symbol["icon-rotate"]),"icon-padding":new ii(se.layout_symbol["icon-padding"]),"icon-keep-upright":new ii(se.layout_symbol["icon-keep-upright"]),"icon-offset":new Wn(se.layout_symbol["icon-offset"]),"icon-anchor":new Wn(se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ii(se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ii(se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ii(se.layout_symbol["text-rotation-alignment"]),"text-field":new Wn(se.layout_symbol["text-field"]),"text-font":new Wn(se.layout_symbol["text-font"]),"text-size":new Wn(se.layout_symbol["text-size"]),"text-max-width":new Wn(se.layout_symbol["text-max-width"]),"text-line-height":new ii(se.layout_symbol["text-line-height"]),"text-letter-spacing":new Wn(se.layout_symbol["text-letter-spacing"]),"text-justify":new Wn(se.layout_symbol["text-justify"]),"text-radial-offset":new Wn(se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ii(se.layout_symbol["text-variable-anchor"]),"text-anchor":new Wn(se.layout_symbol["text-anchor"]),"text-max-angle":new ii(se.layout_symbol["text-max-angle"]),"text-writing-mode":new ii(se.layout_symbol["text-writing-mode"]),"text-rotate":new Wn(se.layout_symbol["text-rotate"]),"text-padding":new ii(se.layout_symbol["text-padding"]),"text-keep-upright":new ii(se.layout_symbol["text-keep-upright"]),"text-transform":new Wn(se.layout_symbol["text-transform"]),"text-offset":new Wn(se.layout_symbol["text-offset"]),"text-allow-overlap":new ii(se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ii(se.layout_symbol["text-ignore-placement"]),"text-optional":new ii(se.layout_symbol["text-optional"])}),at={paint:new Jo({"icon-opacity":new Wn(se.paint_symbol["icon-opacity"]),"icon-color":new Wn(se.paint_symbol["icon-color"]),"icon-halo-color":new Wn(se.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wn(se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wn(se.paint_symbol["icon-halo-blur"]),"icon-translate":new ii(se.paint_symbol["icon-translate"]),"icon-translate-anchor":new ii(se.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wn(se.paint_symbol["text-opacity"]),"text-color":new Wn(se.paint_symbol["text-color"],{runtimeType:un,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Wn(se.paint_symbol["text-halo-color"]),"text-halo-width":new Wn(se.paint_symbol["text-halo-width"]),"text-halo-blur":new Wn(se.paint_symbol["text-halo-blur"]),"text-translate":new ii(se.paint_symbol["text-translate"]),"text-translate-anchor":new ii(se.paint_symbol["text-translate-anchor"])}),layout:Ie},Be=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Mn,this.defaultValue=e};Be.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Be.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Be.prototype.outputDefined=function(){return!1},Be.prototype.serialize=function(){return null},Fn("FormatSectionOverride",Be,{omit:["defaultValue"]});var It=function(e){function t(r){e.call(this,r,at)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var y=[],x=0,M=v;x<M.length;x+=1){var B=M[x];y.indexOf(B)<0&&y.push(B)}this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,y){var x=this.layout.get(r).evaluate(f,{},v,y),M=this._unevaluatedLayout._values[r];return M.isDataDriven()||gu(M.value)||!x?x:function(B,G){return G.replace(/{([^{}]+)}/g,function($,ne){return ne in B?String(B[ne]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new et(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=at.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var y,x=this.paint.get(v),M=new Be(x),B=new Cl(M,x.property.specification);y=x.value.kind==="constant"||x.value.kind==="source"?new ol("source",B):new Hu("composite",B,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new xo(x.property,y,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),y=at.paint.properties[f],x=!1,M=function($){for(var ne=0,he=$;ne<he.length;ne+=1)if(y.overrides&&y.overrides.hasOverride(he[ne]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ya)M(v.value.value.sections);else if(v.value.kind==="source"){var B=function($){x||($ instanceof Wa&&Sa($.value)===Yi?M($.value.sections):$ instanceof Ao?M($.sections):$.eachChild(B))},G=v.value;G._styleExpression&&B(G._styleExpression.expression)}return x},t}(lu),Ht={paint:new Jo({"background-color":new ii(se.paint_background["background-color"]),"background-pattern":new is(se.paint_background["background-pattern"]),"background-opacity":new ii(se.paint_background["background-opacity"])})},Dr=function(e){function t(r){e.call(this,r,Ht)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(lu),hn={paint:new Jo({"raster-opacity":new ii(se.paint_raster["raster-opacity"]),"raster-hue-rotate":new ii(se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ii(se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ii(se.paint_raster["raster-brightness-max"]),"raster-saturation":new ii(se.paint_raster["raster-saturation"]),"raster-contrast":new ii(se.paint_raster["raster-contrast"]),"raster-resampling":new ii(se.paint_raster["raster-resampling"]),"raster-fade-duration":new ii(se.paint_raster["raster-fade-duration"])})},cn=function(e){function t(r){e.call(this,r,hn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(lu),Pn=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(lu),sn={circle:qu,heatmap:hf,hillshade:eu,fill:_f,"fill-extrusion":Bh,line:zh,symbol:It,background:Dr,raster:cn},Kn=N.HTMLImageElement,In=N.HTMLCanvasElement,Gn=N.HTMLVideoElement,An=N.ImageData,jn=N.ImageBitmap,pi=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};pi.prototype.update=function(e,t,r){var f=e.width,v=e.height,y=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,M=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!t||t.premultiply!==!1)),y)this.size=[f,v],e instanceof Kn||e instanceof In||e instanceof Gn||e instanceof An||jn&&e instanceof jn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,e):M.texImage2D(M.TEXTURE_2D,0,this.format,f,v,0,this.format,M.UNSIGNED_BYTE,e.data);else{var B=r||{x:0,y:0},G=B.x,$=B.y;e instanceof Kn||e instanceof In||e instanceof Gn||e instanceof An||jn&&e instanceof jn?M.texSubImage2D(M.TEXTURE_2D,0,G,$,M.RGBA,M.UNSIGNED_BYTE,e):M.texSubImage2D(M.TEXTURE_2D,0,G,$,f,v,M.RGBA,M.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},pi.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},pi.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},pi.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ja=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Ja.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Ja.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ho=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},yr(["receive","process"],this),this.invoker=new Ja(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ar()?e:N};function Zu(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}Ho.prototype.send=function(e,t,r,f,v){var y=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var M=Re(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:$s(t,M)},M),{cancel:function(){r&&delete y.callbacks[x],y.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:y.mapId})}}},Ho.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else ar()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},Ho.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},Ho.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(Is(t.error)):f(null,Is(t.data)))}else{var v=!1,y=Re(this.globalScope)?void 0:[],x=t.hasCallback?function($,ne){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:$?$s($):null,data:$s(ne,y)},y)}:function($){v=!0},M=null,B=Is(t.data);if(this.parent[t.type])M=this.parent[t.type](t.sourceMapId,B,x);else if(this.parent.getWorkerSource){var G=t.type.split(".");M=this.parent.getWorkerSource(t.sourceMapId,G[0],B.source)[G[1]](B,x)}else x(new Error("Could not find function "+t.type));!v&&M&&M.cancel&&(this.cancelCallbacks[e]=M.cancel)}},Ho.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ha=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};Ha.prototype.setNorthEast=function(e){return this._ne=e instanceof Pa?new Pa(e.lng,e.lat):Pa.convert(e),this},Ha.prototype.setSouthWest=function(e){return this._sw=e instanceof Pa?new Pa(e.lng,e.lat):Pa.convert(e),this},Ha.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof Pa)t=e,r=e;else{if(!(e instanceof Ha))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ha.convert(e)):this.extend(Pa.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new Pa(t.lng,t.lat),this._ne=new Pa(r.lng,r.lat)),this},Ha.prototype.getCenter=function(){return new Pa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ha.prototype.getSouthWest=function(){return this._sw},Ha.prototype.getNorthEast=function(){return this._ne},Ha.prototype.getNorthWest=function(){return new Pa(this.getWest(),this.getNorth())},Ha.prototype.getSouthEast=function(){return new Pa(this.getEast(),this.getSouth())},Ha.prototype.getWest=function(){return this._sw.lng},Ha.prototype.getSouth=function(){return this._sw.lat},Ha.prototype.getEast=function(){return this._ne.lng},Ha.prototype.getNorth=function(){return this._ne.lat},Ha.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ha.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ha.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ha.prototype.contains=function(e){var t=Pa.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},Ha.convert=function(e){return!e||e instanceof Ha?e:new Ha(e)};var Pa=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Pa.prototype.wrap=function(){return new Pa(Yt(this.lng,-180,180),this.lat)},Pa.prototype.toArray=function(){return[this.lng,this.lat]},Pa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Pa.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},Pa.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new Ha(new Pa(this.lng-r,this.lat-t),new Pa(this.lng+r,this.lat+t))},Pa.convert=function(e){if(e instanceof Pa)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Pa(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Pa(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var js=2*Math.PI*63710088e-1;function Su(e){return js*Math.cos(e*Math.PI/180)}function du(e){return(180+e)/360}function vh(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function vu(e,t){return e/Su(t)}function sc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Cf=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Cf.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Pa.convert(e);return new Cf(du(r.lng),vh(r.lat),vu(t,r.lat))},Cf.prototype.toLngLat=function(){return new Pa(360*this.x-180,sc(this.y))},Cf.prototype.toAltitude=function(){return this.z*Su(sc(this.y))},Cf.prototype.meterInMercatorCoordinateUnits=function(){return 1/js*(e=sc(this.y),1/Math.cos(e*Math.PI/180));var e};var Af=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Gf(0,e,e,t,r)};Af.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},Af.prototype.url=function(e,t){var r,f,v,y,x,M=(f=this.y,v=this.z,y=Zu(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=Zu(256*(r+1),256*(f+1),v),y[0]+","+y[1]+","+x[0]+","+x[1]),B=function(G,$,ne){for(var he,_e="",Ge=G;Ge>0;Ge--)_e+=($&(he=1<<Ge-1)?1:0)+(ne&he?2:0);return _e}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",B).replace("{bbox-epsg-3857}",M)},Af.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new W(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},Af.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xp=function(e,t){this.wrap=e,this.canonical=t,this.key=Gf(e,t.z,t.z,t.x,t.y)},ms=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new Af(r,+f,+v),this.key=Gf(t,e,r,f,v)};function Gf(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var y=1<<r;return(y*y*e+y*v+f).toString(36)+r.toString(36)+t.toString(36)}ms.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ms.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ms(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ms(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ms.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Gf(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Gf(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ms.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ms.prototype.children=function(e){if(this.overscaledZ>=e)return[new ms(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new ms(t,this.wrap,t,r,f),new ms(t,this.wrap,t,r+1,f),new ms(t,this.wrap,t,r,f+1),new ms(t,this.wrap,t,r+1,f+1)]},ms.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ms.prototype.wrapped=function(){return new ms(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ms.prototype.unwrapTo=function(e){return new ms(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ms.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ms.prototype.toUnwrapped=function(){return new Xp(this.wrap,this.canonical)},ms.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ms.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Cf(e.x-this.wrap,e.y))},Fn("CanonicalTileID",Af),Fn("OverscaledTileID",ms,{omit:["posMatrix"]});var Vc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Xe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Vc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Vc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Vc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Vc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Vc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Vc.prototype.getPixels=function(){return new Po({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Vc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,y=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:y=x-1;break;case 1:x=y+1}for(var M=-t*this.dim,B=-r*this.dim,G=y;G<x;G++)for(var $=f;$<v;$++)this.data[this._idx($,G)]=e.data[this._idx($+M,G+B)]},Fn("DEMData",Vc);var mh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};mh.prototype.encode=function(e){return this._stringToNumber[e]},mh.prototype.decode=function(e){return this._numberToString[e]};var yh=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},Wh={geometry:{configurable:!0}};Wh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Wh.geometry.set=function(e){this._geometry=e},yh.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(yh.prototype,Wh);var Tf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Tf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Vt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var y in this.deletedStates[e][f]={},this.state[e][f])r[y]||(this.deletedStates[e][f][y]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},Tf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Tf.prototype.getState=function(e,t){var r=String(t),f=Vt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var y in v)delete f[y]}return f},Tf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Tf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var y in this.stateChanges[f])this.state[f][y]||(this.state[f][y]={}),Vt(this.state[f][y],this.stateChanges[f][y]),v[y]=this.state[f][y];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var M={};if(this.deletedStates[x]===null)for(var B in this.state[x])M[B]={},this.state[x][B]={};else for(var G in this.deletedStates[x]){if(this.deletedStates[x][G]===null)this.state[x][G]={};else for(var $=0,ne=Object.keys(this.deletedStates[x][G]);$<ne.length;$+=1)delete this.state[x][G][ne[$]];M[G]=this.state[x][G]}r[x]=r[x]||{},Vt(r[x],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var he in e)e[he].setFeatureState(r,t)};var Oc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Lu(8192,16,0),this.grid3D=new Lu(8192,16,0),this.featureIndexArray=new ae,this.promoteId=t};function Yp(e,t,r,f,v){return dr(e,function(y,x){var M=t instanceof Du?t.get(x):null;return M&&M.evaluate?M.evaluate(r,f,v):M})}function gh(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,y=0,x=e;y<x.length;y+=1){var M=x[y];t=Math.min(t,M.x),r=Math.min(r,M.y),f=Math.max(f,M.x),v=Math.max(v,M.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function xp(e,t){return t-e}Oc.prototype.insert=function(e,t,r,f,v,y){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var M=y?this.grid3D:this.grid,B=0;B<t.length;B++){for(var G=t[B],$=[1/0,1/0,-1/0,-1/0],ne=0;ne<G.length;ne++){var he=G[ne];$[0]=Math.min($[0],he.x),$[1]=Math.min($[1],he.y),$[2]=Math.max($[2],he.x),$[3]=Math.max($[3],he.y)}$[0]<8192&&$[1]<8192&&$[2]>=0&&$[3]>=0&&M.insert(x,$[0],$[1],$[2],$[3])}},Oc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new jc.VectorTile(new wf(this.rawTileData)).layers,this.sourceLayerCoder=new mh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Oc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var y=e.params||{},x=8192/e.tileSize/e.scale,M=Yu(y.filter),B=e.queryGeometry,G=e.queryPadding*x,$=gh(B),ne=this.grid.query($.minX-G,$.minY-G,$.maxX+G,$.maxY+G),he=gh(e.cameraQueryGeometry),_e=this.grid3D.query(he.minX-G,he.minY-G,he.maxX+G,he.maxY+G,function(cr,vr,Ir,tn){return function(dn,li,Bn,fi,zn){for(var Xi=0,Ci=dn;Xi<Ci.length;Xi+=1){var On=Ci[Xi];if(li<=On.x&&Bn<=On.y&&fi>=On.x&&zn>=On.y)return!0}var na=[new W(li,Bn),new W(li,zn),new W(fi,zn),new W(fi,Bn)];if(dn.length>2){for(var Bi=0,wa=na;Bi<wa.length;Bi+=1)if(ta(dn,wa[Bi]))return!0}for(var di=0;di<dn.length-1;di++)if(va(dn[di],dn[di+1],na))return!0;return!1}(e.cameraQueryGeometry,cr-G,vr-G,Ir+G,tn+G)}),Ge=0,We=_e;Ge<We.length;Ge+=1)ne.push(We[Ge]);ne.sort(xp);for(var ht,qe={},Pt=function(cr){var vr=ne[cr];if(vr!==ht){ht=vr;var Ir=v.featureIndexArray.get(vr),tn=null;v.loadMatchingFeature(qe,Ir.bucketIndex,Ir.sourceLayerIndex,Ir.featureIndex,M,y.layers,y.availableImages,t,r,f,function(dn,li,Bn){return tn||(tn=Pr(dn)),li.queryIntersectsFeature(B,dn,Bn,tn,v.z,e.transform,x,e.pixelPosMatrix)})}},Wt=0;Wt<ne.length;Wt++)Pt(Wt);return qe},Oc.prototype.loadMatchingFeature=function(e,t,r,f,v,y,x,M,B,G,$){var ne=this.bucketLayerIDs[t];if(!y||function(dn,li){for(var Bn=0;Bn<dn.length;Bn++)if(li.indexOf(dn[Bn])>=0)return!0;return!1}(y,ne)){var he=this.sourceLayerCoder.decode(r),_e=this.vtLayers[he].feature(f);if(v.needGeometry){var Ge=mn(_e,!0);if(!v.filter(new qi(this.tileID.overscaledZ),Ge,this.tileID.canonical))return}else if(!v.filter(new qi(this.tileID.overscaledZ),_e))return;for(var We=this.getId(_e,he),ht=0;ht<ne.length;ht++){var qe=ne[ht];if(!(y&&y.indexOf(qe)<0)){var Pt=M[qe];if(Pt){var Wt={};We!==void 0&&G&&(Wt=G.getState(Pt.sourceLayer||"_geojsonTileLayer",We));var cr=Vt({},B[qe]);cr.paint=Yp(cr.paint,Pt.paint,_e,Wt,x),cr.layout=Yp(cr.layout,Pt.layout,_e,Wt,x);var vr=!$||$(_e,Pt,Wt);if(vr){var Ir=new yh(_e,this.z,this.x,this.y,We);Ir.layer=cr;var tn=e[qe];tn===void 0&&(tn=e[qe]=[]),tn.push({featureIndex:f,feature:Ir,intersectionZ:vr})}}}}}},Oc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,y,x,M){var B={};this.loadVTLayers();for(var G=Yu(v),$=0,ne=e;$<ne.length;$+=1)this.loadMatchingFeature(B,r,f,ne[$],G,y,x,M,t);return B},Oc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Oc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Fn("FeatureIndex",Oc,{omit:["rawTileData","sourceLayerCoder"]});var As=function(e,t){this.tileID=e,this.uid=zt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};As.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<Vi.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},As.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},As.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(G,$){var ne={};if(!$)return ne;for(var he=function(){var We=Ge[_e],ht=We.layerIds.map(function(Wt){return $.getLayer(Wt)}).filter(Boolean);if(ht.length!==0){We.layers=ht,We.stateDependentLayerIds&&(We.stateDependentLayers=We.stateDependentLayerIds.map(function(Wt){return ht.filter(function(cr){return cr.id===Wt})[0]}));for(var qe=0,Pt=ht;qe<Pt.length;qe+=1)ne[Pt[qe].id]=We}},_e=0,Ge=G;_e<Ge.length;_e+=1)he();return ne}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof et){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var y in this.buckets){var x=this.buckets[y];if(x instanceof et&&x.hasRTLText){this.hasRTLText=!0,Rs.isLoading()||Rs.isLoaded()||zc()!=="deferred"||Js();break}}for(var M in this.queryPadding=0,this.buckets){var B=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(M).queryRadius(B))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},As.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},As.prototype.getBucket=function(e){return this.buckets[e.id]},As.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new pi(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new pi(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},As.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},As.prototype.queryRenderedFeatures=function(e,t,r,f,v,y,x,M,B,G){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:y,tileSize:this.tileSize,pixelPosMatrix:G,transform:M,params:x,queryPadding:this.queryPadding*B},e,t,r):{}},As.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",y=f._geojsonTileLayer||f[v];if(y)for(var x=Yu(t&&t.filter),M=this.tileID.canonical,B=M.z,G=M.x,$=M.y,ne={z:B,x:G,y:$},he=0;he<y.length;he++){var _e=y.feature(he);if(x.needGeometry){var Ge=mn(_e,!0);if(!x.filter(new qi(this.tileID.overscaledZ),Ge,this.tileID.canonical))continue}else if(!x.filter(new qi(this.tileID.overscaledZ),_e))continue;var We=r.getId(_e,v),ht=new yh(_e,B,G,$,We);ht.tile=ne,e.push(ht)}}},As.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},As.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},As.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=zr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var y=this.expirationTime-t;y?this.expirationTime=f+Math.max(y,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},As.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},As.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],y=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[y],M=e[y];if(x&&M&&Object.keys(M).length!==0){v.update(M,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var B=t&&t.style&&t.style.getLayer(f);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(v)))}}}},As.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},As.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vi.now()},As.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},As.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=Vi.now()+e},As.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},As.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var y=0,x=t;y<x.length;y+=1)if(v[x[y]])return!0}}return!1};var uf=N.performance,Kp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},uf.mark(this._marks.start)};Kp.prototype.finish=function(){uf.mark(this._marks.end);var e=uf.getEntriesByName(this._marks.measure);return e.length===0&&(uf.measure(this._marks.measure,this._marks.start,this._marks.end),e=uf.getEntriesByName(this._marks.measure),uf.clearMarks(this._marks.start),uf.clearMarks(this._marks.end),uf.clearMeasures(this._marks.measure)),e},d.Actor=Ho,d.AlphaImage=hu,d.CanonicalTileID=Af,d.CollisionBoxArray=u,d.Color=Gi,d.DEMData=Vc,d.DataConstantProperty=ii,d.DictionaryCoder=mh,d.EXTENT=8192,d.ErrorEvent=me,d.EvaluationParameters=qi,d.Event=oe,d.Evented=Ae,d.FeatureIndex=Oc,d.FillBucket=bu,d.FillExtrusionBucket=Uu,d.ImageAtlas=wn,d.ImagePosition=pr,d.LineBucket=jo,d.LngLat=Pa,d.LngLatBounds=Ha,d.MercatorCoordinate=Cf,d.ONE_EM=24,d.OverscaledTileID=ms,d.Point=W,d.Point$1=W,d.Properties=Jo,d.Protobuf=wf,d.RGBAImage=Po,d.RequestManager=er,d.RequestPerformance=Kp,d.ResourceType=Cr,d.SegmentVector=we,d.SourceFeatureState=Tf,d.StructArrayLayout1ui2=Bl,d.StructArrayLayout2f1f2i16=vl,d.StructArrayLayout2i4=Es,d.StructArrayLayout3ui6=Fu,d.StructArrayLayout4i8=ic,d.SymbolBucket=et,d.Texture=pi,d.Tile=As,d.Transitionable=Uo,d.Uniform1f=an,d.Uniform1i=Nr,d.Uniform2f=Hr,d.Uniform3f=Rn,d.Uniform4f=ri,d.UniformColor=hi,d.UniformMatrix4f=ea,d.UnwrappedTileID=Xp,d.ValidationError=Ce,d.WritingMode=Tr,d.ZoomHistory=gc,d.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},d.addDynamicAttributes=kt,d.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),y=null;e.forEach(function(x,M){t(x,function(B,G){B&&(y=B),v[M]=G,--f==0&&r(y,v)})})},d.bezier=Ye,d.bindAll=yr,d.browser=Vi,d.cacheEntryPossiblyAdded=function(e){++nn>vt&&(e.getActor().send("enforceCacheSizeLimit",gt),nn=0)},d.clamp=rt,d.clearTileCache=function(e){var t=N.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},d.clipLine=qo,d.clone=function(e){var t=new ua(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},d.clone$1=Ke,d.clone$2=function(e){var t=new ua(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},d.collisionCircleLayout=gp,d.config=nr,d.create=function(){var e=new ua(16);return ua!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},d.create$1=function(){var e=new ua(9);return ua!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},d.create$2=function(){var e=new ua(4);return ua!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},d.createCommonjsModule=A,d.createExpression=al,d.createLayout=Do,d.createStyleLayer=function(e){return e.type==="custom"?new Pn(e):new sn[e.type](e)},d.cross=function(e,t,r){var f=t[0],v=t[1],y=t[2],x=r[0],M=r[1],B=r[2];return e[0]=v*B-y*M,e[1]=y*x-f*B,e[2]=f*M-v*x,e},d.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},d.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},d.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},d.ease=Je,d.emitValidationErrors=ql,d.endsWith=ee,d.enforceCacheSizeLimit=function(e){hr(),Et&&Et.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},d.evaluateSizeForFeature=Di,d.evaluateSizeForZoom=ia,d.evaluateVariableOffset=Ve,d.evented=_c,d.extend=Vt,d.featureFilter=Yu,d.filterObject=Ct,d.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},d.getAnchorAlignment=Ni,d.getAnchorJustification=lr,d.getArrayBuffer=Ri,d.getImage=ce,d.getJSON=function(e,t){return Ji(Vt(e,{type:"json"}),t)},d.getRTLTextPluginStatus=zc,d.getReferrer=Hn,d.getVideo=function(e,t){var r,f,v=N.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var y=0;y<e.length;y++){var x=N.document.createElement("source");r=e[y],f=void 0,(f=N.document.createElement("a")).href=r,(f.protocol!==N.document.location.protocol||f.host!==N.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[y],v.appendChild(x)}return{cancel:function(){}}},d.identity=Zo,d.invert=function(e,t){var r=t[0],f=t[1],v=t[2],y=t[3],x=t[4],M=t[5],B=t[6],G=t[7],$=t[8],ne=t[9],he=t[10],_e=t[11],Ge=t[12],We=t[13],ht=t[14],qe=t[15],Pt=r*M-f*x,Wt=r*B-v*x,cr=r*G-y*x,vr=f*B-v*M,Ir=f*G-y*M,tn=v*G-y*B,dn=$*We-ne*Ge,li=$*ht-he*Ge,Bn=$*qe-_e*Ge,fi=ne*ht-he*We,zn=ne*qe-_e*We,Xi=he*qe-_e*ht,Ci=Pt*Xi-Wt*zn+cr*fi+vr*Bn-Ir*li+tn*dn;return Ci?(e[0]=(M*Xi-B*zn+G*fi)*(Ci=1/Ci),e[1]=(v*zn-f*Xi-y*fi)*Ci,e[2]=(We*tn-ht*Ir+qe*vr)*Ci,e[3]=(he*Ir-ne*tn-_e*vr)*Ci,e[4]=(B*Bn-x*Xi-G*li)*Ci,e[5]=(r*Xi-v*Bn+y*li)*Ci,e[6]=(ht*cr-Ge*tn-qe*Wt)*Ci,e[7]=($*tn-he*cr+_e*Wt)*Ci,e[8]=(x*zn-M*Bn+G*dn)*Ci,e[9]=(f*Bn-r*zn-y*dn)*Ci,e[10]=(Ge*Ir-We*cr+qe*Pt)*Ci,e[11]=(ne*cr-$*Ir-_e*Pt)*Ci,e[12]=(M*li-x*fi-B*dn)*Ci,e[13]=(r*fi-f*li+v*dn)*Ci,e[14]=(We*Wt-Ge*vr-ht*Pt)*Ci,e[15]=($*vr-ne*Wt+he*Pt)*Ci,e):null},d.isChar=vn,d.isMapboxURL=w,d.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},d.makeRequest=Ji,d.mapObject=dr,d.mercatorXfromLng=du,d.mercatorYfromLat=vh,d.mercatorZfromAltitude=vu,d.mul=wc,d.multiply=fo,d.mvt=jc,d.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},d.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],y=r*r+f*f+v*v;return y>0&&(y=1/Math.sqrt(y)),e[0]=t[0]*y,e[1]=t[1]*y,e[2]=t[2]*y,e},d.number=Ca,d.offscreenCanvasSupported=Jr,d.ortho=function(e,t,r,f,v,y,x){var M=1/(t-r),B=1/(f-v),G=1/(y-x);return e[0]=-2*M,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*B,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*G,e[11]=0,e[12]=(t+r)*M,e[13]=(v+f)*B,e[14]=(x+y)*G,e[15]=1,e},d.parseGlyphPBF=function(e){return new wf(e).readFields(pn,[])},d.pbf=wf,d.performSymbolLayout=function(e,t,r,f,v,y,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var M=e.layers[0].layout,B=e.layers[0]._unevaluatedLayout._values,G={};if(e.textSizeData.kind==="composite"){var $=e.textSizeData,ne=$.maxZoom;G.compositeTextSizes=[B["text-size"].possiblyEvaluate(new qi($.minZoom),x),B["text-size"].possiblyEvaluate(new qi(ne),x)]}if(e.iconSizeData.kind==="composite"){var he=e.iconSizeData,_e=he.maxZoom;G.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new qi(he.minZoom),x),B["icon-size"].possiblyEvaluate(new qi(_e),x)]}G.layoutTextSize=B["text-size"].possiblyEvaluate(new qi(e.zoom+1),x),G.layoutIconSize=B["icon-size"].possiblyEvaluate(new qi(e.zoom+1),x),G.textMaxSize=B["text-size"].possiblyEvaluate(new qi(18));for(var Ge=24*M.get("text-line-height"),We=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",ht=M.get("text-keep-upright"),qe=M.get("text-size"),Pt=function(){var vr=cr[Wt],Ir=M.get("text-font").evaluate(vr,{},x).join(","),tn=qe.evaluate(vr,{},x),dn=G.layoutTextSize.evaluate(vr,{},x),li=G.layoutIconSize.evaluate(vr,{},x),Bn={horizontal:{},vertical:void 0},fi=vr.text,zn=[0,0];if(fi){var Xi=fi.toString(),Ci=24*M.get("text-letter-spacing").evaluate(vr,{},x),On=function(pa){for(var ro=0,Qa=pa;ro<Qa.length;ro+=1)if(Ma=Qa[ro].charCodeAt(0),vn.Arabic(Ma)||vn["Arabic Supplement"](Ma)||vn["Arabic Extended-A"](Ma)||vn["Arabic Presentation Forms-A"](Ma)||vn["Arabic Presentation Forms-B"](Ma))return!1;var Ma;return!0}(Xi)?Ci:0,na=M.get("text-anchor").evaluate(vr,{},x),Bi=M.get("text-variable-anchor");if(!Bi){var wa=M.get("text-radial-offset").evaluate(vr,{},x);zn=wa?Ve(na,[24*wa,el]):M.get("text-offset").evaluate(vr,{},x).map(function(pa){return 24*pa})}var di=We?"center":M.get("text-justify").evaluate(vr,{},x),ka=M.get("symbol-placement"),Io=ka==="point"?24*M.get("text-max-width").evaluate(vr,{},x):0,Eo=function(){e.allowVerticalPlacement&&ec(Xi)&&(Bn.vertical=ui(fi,t,r,v,Ir,Io,Ge,na,"left",On,zn,Tr.vertical,!0,ka,dn,tn))};if(!We&&Bi){for(var ho=di==="auto"?Bi.map(function(pa){return lr(pa)}):[di],vo=!1,No=0;No<ho.length;No++){var ys=ho[No];if(!Bn.horizontal[ys])if(vo)Bn.horizontal[ys]=Bn.horizontal[0];else{var Oo=ui(fi,t,r,v,Ir,Io,Ge,"center",ys,On,zn,Tr.horizontal,!1,ka,dn,tn);Oo&&(Bn.horizontal[ys]=Oo,vo=Oo.positionedLines.length===1)}}Eo()}else{di==="auto"&&(di=lr(na));var ks=ui(fi,t,r,v,Ir,Io,Ge,na,di,On,zn,Tr.horizontal,!1,ka,dn,tn);ks&&(Bn.horizontal[di]=ks),Eo(),ec(Xi)&&We&&ht&&(Bn.vertical=ui(fi,t,r,v,Ir,Io,Ge,na,di,On,zn,Tr.vertical,!1,ka,dn,tn))}}var ls=void 0,tu=!1;if(vr.icon&&vr.icon.name){var ts=f[vr.icon.name];ts&&(ls=function(pa,ro,Qa){var Ma=Ni(Qa),Eu=ro[0]-pa.displaySize[0]*Ma.horizontalAlign,ru=ro[1]-pa.displaySize[1]*Ma.verticalAlign;return{image:pa,top:ru,bottom:ru+pa.displaySize[1],left:Eu,right:Eu+pa.displaySize[0]}}(v[vr.icon.name],M.get("icon-offset").evaluate(vr,{},x),M.get("icon-anchor").evaluate(vr,{},x)),tu=ts.sdf,e.sdfIcons===void 0?e.sdfIcons=ts.sdf:e.sdfIcons!==ts.sdf&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ts.pixelRatio!==e.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Wo=Nn(Bn.horizontal)||Bn.vertical;e.iconsInText=!!Wo&&Wo.iconsInText,(Wo||ls)&&function(pa,ro,Qa,Ma,Eu,ru,wo,gs,nu,Ia,Vl){var bl=ru.textMaxSize.evaluate(ro,{});bl===void 0&&(bl=wo);var uc,rs=pa.layers[0].layout,Gc=rs.get("icon-offset").evaluate(ro,{},Vl),Sl=Nn(Qa.horizontal),Hf=wo/24,Wf=pa.tilePixelRatio*Hf,Pf=pa.tilePixelRatio*bl/24,Hc=pa.tilePixelRatio*gs,_h=pa.tilePixelRatio*rs.get("symbol-spacing"),Mf=rs.get("text-padding")*pa.tilePixelRatio,Xf=rs.get("icon-padding")*pa.tilePixelRatio,Xh=rs.get("text-max-angle")/180*Math.PI,Lc=rs.get("text-rotation-alignment")==="map"&&rs.get("symbol-placement")!=="point",xh=rs.get("icon-rotation-alignment")==="map"&&rs.get("symbol-placement")!=="point",Gl=rs.get("symbol-placement"),bh=_h/2,Yf=rs.get("icon-text-fit");Ma&&Yf!=="none"&&(pa.allowVerticalPlacement&&Qa.vertical&&(uc=Tn(Ma,Qa.vertical,Yf,rs.get("icon-text-fit-padding"),Gc,Hf)),Sl&&(Ma=Tn(Ma,Sl,Yf,rs.get("icon-text-fit-padding"),Gc,Hf)));var El=function(Td,ja){ja.x<0||ja.x>=8192||ja.y<0||ja.y>=8192||function(ns,ju,Eh,ff,Cp,Jp,tp,Rc,wh,Jf,rp,np,Ap,Tp,Ch,Pp,Qp,qp,ed,td,tl,ip,rd,lc,Pd){var nd,Rf,kf,Qf,qf,eh=ns.addToLineVertexArray(ju,Eh),id=0,ad=0,od=0,Mp=0,Ip=-1,Op=-1,Xc={},sd=ze(""),Lp=0,Rp=0;if(Rc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Lp=(nd=Rc.layout.get("text-offset").evaluate(tl,{},lc).map(function(rh){return 24*rh}))[0],Rp=nd[1]):(Lp=24*Rc.layout.get("text-radial-offset").evaluate(tl,{},lc),Rp=el),ns.allowVerticalPlacement&&ff.vertical){var ud=Rc.layout.get("text-rotate").evaluate(tl,{},lc)+90;Qf=new Ra(wh,ju,Jf,rp,np,ff.vertical,Ap,Tp,Ch,ud),tp&&(qf=new Ra(wh,ju,Jf,rp,np,tp,Qp,qp,Ch,ud))}if(Cp){var kp=Rc.layout.get("icon-rotate").evaluate(tl,{}),Dp=Rc.layout.get("icon-text-fit")!=="none",ld=us(Cp,kp,rd,Dp),Fp=tp?us(tp,kp,rd,Dp):void 0;kf=new Ra(wh,ju,Jf,rp,np,Cp,Qp,qp,!1,kp),id=4*ld.length;var cd=ns.iconSizeData,th=null;cd.kind==="source"?(th=[128*Rc.layout.get("icon-size").evaluate(tl,{})])[0]>32640&&Xe(ns.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):cd.kind==="composite"&&((th=[128*ip.compositeIconSizes[0].evaluate(tl,{},lc),128*ip.compositeIconSizes[1].evaluate(tl,{},lc)])[0]>32640||th[1]>32640)&&Xe(ns.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ns.addSymbols(ns.icon,ld,th,td,ed,tl,!1,ju,eh.lineStartIndex,eh.lineLength,-1,lc),Ip=ns.icon.placedSymbolArray.length-1,Fp&&(ad=4*Fp.length,ns.addSymbols(ns.icon,Fp,th,td,ed,tl,Tr.vertical,ju,eh.lineStartIndex,eh.lineLength,-1,lc),Op=ns.icon.placedSymbolArray.length-1)}for(var fd in ff.horizontal){var ap=ff.horizontal[fd];if(!Rf){sd=ze(ap.text);var Md=Rc.layout.get("text-rotate").evaluate(tl,{},lc);Rf=new Ra(wh,ju,Jf,rp,np,ap,Ap,Tp,Ch,Md)}var hd=ap.positionedLines.length===1;if(od+=Kt(ns,ju,ap,Jp,Rc,Ch,tl,Pp,eh,ff.vertical?Tr.horizontal:Tr.horizontalOnly,hd?Object.keys(ff.horizontal):[fd],Xc,Ip,ip,lc),hd)break}ff.vertical&&(Mp+=Kt(ns,ju,ff.vertical,Jp,Rc,Ch,tl,Pp,eh,Tr.vertical,["vertical"],Xc,Op,ip,lc));var Id=Rf?Rf.boxStartIndex:ns.collisionBoxArray.length,Od=Rf?Rf.boxEndIndex:ns.collisionBoxArray.length,pd=Qf?Qf.boxStartIndex:ns.collisionBoxArray.length,Ld=Qf?Qf.boxEndIndex:ns.collisionBoxArray.length,Rd=kf?kf.boxStartIndex:ns.collisionBoxArray.length,kd=kf?kf.boxEndIndex:ns.collisionBoxArray.length,Dd=qf?qf.boxStartIndex:ns.collisionBoxArray.length,Fd=qf?qf.boxEndIndex:ns.collisionBoxArray.length,kc=-1,op=function(rh,Bp){return rh&&rh.circleDiameter?Math.max(rh.circleDiameter,Bp):Bp};kc=op(Rf,kc),kc=op(Qf,kc),kc=op(kf,kc);var dd=(kc=op(qf,kc))>-1?1:0;dd&&(kc*=Pd/24),ns.glyphOffsetArray.length>=et.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tl.sortKey!==void 0&&ns.addToSortKeyRanges(ns.symbolInstances.length,tl.sortKey),ns.symbolInstances.emplaceBack(ju.x,ju.y,Xc.right>=0?Xc.right:-1,Xc.center>=0?Xc.center:-1,Xc.left>=0?Xc.left:-1,Xc.vertical||-1,Ip,Op,sd,Id,Od,pd,Ld,Rd,kd,Dd,Fd,Jf,od,Mp,id,ad,dd,0,Ap,Lp,Rp,kc)}(pa,ja,Td,Qa,Ma,Eu,uc,pa.layers[0],pa.collisionBoxArray,ro.index,ro.sourceLayerIndex,pa.index,Wf,Mf,Lc,nu,Hc,Xf,xh,Gc,ro,ru,Ia,Vl,wo)};if(Gl==="line")for(var Kf=0,Yh=qo(ro.geometry,0,0,8192,8192);Kf<Yh.length;Kf+=1)for(var bp=Yh[Kf],Kh=0,$h=ss(bp,_h,Xh,Qa.vertical||Sl,Ma,24,Pf,pa.overscaling,8192);Kh<$h.length;Kh+=1){var Sp=$h[Kh];Sl&&oa(pa,Sl.text,bh,Sp)||El(bp,Sp)}else if(Gl==="line-center")for(var Jh=0,Qh=ro.geometry;Jh<Qh.length;Jh+=1){var qh=Qh[Jh];if(qh.length>1){var Sh=Cs(qh,Xh,Qa.vertical||Sl,Ma,24,Pf);Sh&&El(qh,Sh)}}else if(ro.type==="Polygon")for(var If=0,Ep=vf(ro.geometry,0);If<Ep.length;If+=1){var lf=Ep[If],Wc=aa(lf,16);El(lf[0],new Cn(Wc.x,Wc.y,0))}else if(ro.type==="LineString")for(var $f=0,Of=ro.geometry;$f<Of.length;$f+=1){var cf=Of[$f];El(cf,new Cn(cf[0].x,cf[0].y,0))}else if(ro.type==="Point")for(var Lf=0,$p=ro.geometry;Lf<$p.length;Lf+=1)for(var ep=0,Vs=$p[Lf];ep<Vs.length;ep+=1){var wp=Vs[ep];El([wp],new Cn(wp.x,wp.y,0))}}(e,vr,Bn,ls,f,G,dn,li,zn,tu,x)},Wt=0,cr=e.features;Wt<cr.length;Wt+=1)Pt();y&&e.generateCollisionDebugBuffers()},d.perspective=function(e,t,r,f,v){var y,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(y=1/(f-v)),e[14]=2*v*f*y):(e[10]=-1,e[14]=-2*f),e},d.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},d.plugin=Rs,d.polygonIntersectsPolygon=_i,d.postMapLoadEvent=nt,d.postTurnstileEvent=Br,d.potpack=Rt,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.register=Fn,d.registerForPluginStateChange=function(e){return e({pluginStatus:Ls,pluginURL:ou}),_c.on("pluginStateChange",e),e},d.renderColorRamp=tf,d.rotate=function(e,t,r){var f=t[0],v=t[1],y=t[2],x=t[3],M=Math.sin(r),B=Math.cos(r);return e[0]=f*B+y*M,e[1]=v*B+x*M,e[2]=f*-M+y*B,e[3]=v*-M+x*B,e},d.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[4],x=t[5],M=t[6],B=t[7],G=t[8],$=t[9],ne=t[10],he=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=y*v+G*f,e[5]=x*v+$*f,e[6]=M*v+ne*f,e[7]=B*v+he*f,e[8]=G*v-y*f,e[9]=$*v-x*f,e[10]=ne*v-M*f,e[11]=he*v-B*f,e},d.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),y=t[0],x=t[1],M=t[2],B=t[3],G=t[4],$=t[5],ne=t[6],he=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=y*v+G*f,e[1]=x*v+$*f,e[2]=M*v+ne*f,e[3]=B*v+he*f,e[4]=G*v-y*f,e[5]=$*v-x*f,e[6]=ne*v-M*f,e[7]=he*v-B*f,e},d.scale=function(e,t,r){var f=r[0],v=r[1],y=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*y,e[9]=t[9]*y,e[10]=t[10]*y,e[11]=t[11]*y,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},d.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},d.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},d.setCacheLimits=function(e,t){gt=e,vt=t},d.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),Ls==="deferred"||Ls==="loading"||Ls==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");ou=Vi.resolveURL(e),Ls="deferred",_u=t,Ll(),r||Js()},d.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},d.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},d.styleSpec=se,d.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},d.symbolSize=So,d.transformMat3=function(e,t,r){var f=t[0],v=t[1],y=t[2];return e[0]=f*r[0]+v*r[3]+y*r[6],e[1]=f*r[1]+v*r[4]+y*r[7],e[2]=f*r[2]+v*r[5]+y*r[8],e},d.transformMat4=Nl,d.translate=function(e,t,r){var f,v,y,x,M,B,G,$,ne,he,_e,Ge,We=r[0],ht=r[1],qe=r[2];return t===e?(e[12]=t[0]*We+t[4]*ht+t[8]*qe+t[12],e[13]=t[1]*We+t[5]*ht+t[9]*qe+t[13],e[14]=t[2]*We+t[6]*ht+t[10]*qe+t[14],e[15]=t[3]*We+t[7]*ht+t[11]*qe+t[15]):(v=t[1],y=t[2],x=t[3],M=t[4],B=t[5],G=t[6],$=t[7],ne=t[8],he=t[9],_e=t[10],Ge=t[11],e[0]=f=t[0],e[1]=v,e[2]=y,e[3]=x,e[4]=M,e[5]=B,e[6]=G,e[7]=$,e[8]=ne,e[9]=he,e[10]=_e,e[11]=Ge,e[12]=f*We+M*ht+ne*qe+t[12],e[13]=v*We+B*ht+he*qe+t[13],e[14]=y*We+G*ht+_e*qe+t[14],e[15]=x*We+$*ht+Ge*qe+t[15]),e},d.triggerPluginCompletionEvent=Nc,d.uniqueId=zt,d.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},d.validateLight=Qc,d.validateStyle=Il,d.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},d.vectorTile=jc,d.version="1.13.1",d.warnOnce=Xe,d.webpSupported=de,d.window=N,d.wrap=Yt}),C(["./shared"],function(d){"use strict";function A(Y){var ce=typeof Y;if(ce==="number"||ce==="boolean"||ce==="string"||Y==null)return JSON.stringify(Y);if(Array.isArray(Y)){for(var ye="[",z=0,oe=Y;z<oe.length;z+=1)ye+=A(oe[z])+",";return ye+"]"}for(var me=Object.keys(Y).sort(),Ae="{",se=0;se<me.length;se++)Ae+=JSON.stringify(me[se])+":"+A(Y[me[se]])+",";return Ae+"}"}function Q(Y){for(var ce="",ye=0,z=d.refProperties;ye<z.length;ye+=1)ce+="/"+A(Y[z[ye]]);return ce}var K=function(Y){this.keyCache={},Y&&this.replace(Y)};K.prototype.replace=function(Y){this._layerConfigs={},this._layers={},this.update(Y,[])},K.prototype.update=function(Y,ce){for(var ye=this,z=0,oe=Y;z<oe.length;z+=1){var me=oe[z];this._layerConfigs[me.id]=me;var Ae=this._layers[me.id]=d.createStyleLayer(me);Ae._featureFilter=d.featureFilter(Ae.filter),this.keyCache[me.id]&&delete this.keyCache[me.id]}for(var se=0,Ce=ce;se<Ce.length;se+=1){var ct=Ce[se];delete this.keyCache[ct],delete this._layerConfigs[ct],delete this._layers[ct]}this.familiesBySource={};for(var xr=0,Gt=function(on,un){for(var wi={},xn=0;xn<on.length;xn++){var Oi=un&&un[on[xn].id]||Q(on[xn]);un&&(un[on[xn].id]=Oi);var Yi=wi[Oi];Yi||(Yi=wi[Oi]=[]),Yi.push(on[xn])}var oi=[];for(var Ki in wi)oi.push(wi[Ki]);return oi}(d.values(this._layerConfigs),this.keyCache);xr<Gt.length;xr+=1){var Jt=Gt[xr].map(function(on){return ye._layers[on.id]}),Rr=Jt[0];if(Rr.visibility!=="none"){var Ln=Rr.source||"",Mn=this.familiesBySource[Ln];Mn||(Mn=this.familiesBySource[Ln]={});var $t=Rr.sourceLayer||"_geojsonTileLayer",bn=Mn[$t];bn||(bn=Mn[$t]=[]),bn.push(Jt)}}};var W=function(Y){var ce={},ye=[];for(var z in Y){var oe=Y[z],me=ce[z]={};for(var Ae in oe){var se=oe[+Ae];if(se&&se.bitmap.width!==0&&se.bitmap.height!==0){var Ce={x:0,y:0,w:se.bitmap.width+2,h:se.bitmap.height+2};ye.push(Ce),me[Ae]={rect:Ce,metrics:se.metrics}}}}var ct=d.potpack(ye),xr=new d.AlphaImage({width:ct.w||1,height:ct.h||1});for(var Gt in Y){var Jt=Y[Gt];for(var Rr in Jt){var Ln=Jt[+Rr];if(Ln&&Ln.bitmap.width!==0&&Ln.bitmap.height!==0){var Mn=ce[Gt][Rr].rect;d.AlphaImage.copy(Ln.bitmap,xr,{x:0,y:0},{x:Mn.x+1,y:Mn.y+1},Ln.bitmap)}}}this.image=xr,this.positions=ce};d.register("GlyphAtlas",W);var L=function(Y){this.tileID=new d.OverscaledTileID(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.uid=Y.uid,this.zoom=Y.zoom,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.collectResourceTiming,this.returnDependencies=!!Y.returnDependencies,this.promoteId=Y.promoteId};function N(Y,ce,ye){for(var z=new d.EvaluationParameters(ce),oe=0,me=Y;oe<me.length;oe+=1)me[oe].recalculate(z,ye)}function Ne(Y,ce){var ye=d.getArrayBuffer(Y.request,function(z,oe,me,Ae){z?ce(z):oe&&ce(null,{vectorTile:new d.vectorTile.VectorTile(new d.pbf(oe)),rawData:oe,cacheControl:me,expires:Ae})});return function(){ye.cancel(),ce()}}L.prototype.parse=function(Y,ce,ye,z,oe){var me=this;this.status="parsing",this.data=Y,this.collisionBoxArray=new d.CollisionBoxArray;var Ae=new d.DictionaryCoder(Object.keys(Y.layers).sort()),se=new d.FeatureIndex(this.tileID,this.promoteId);se.bucketLayerIDs=[];var Ce,ct,xr,Gt,Jt={},Rr={featureIndex:se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ye},Ln=ce.familiesBySource[this.source];for(var Mn in Ln){var $t=Y.layers[Mn];if($t){$t.version===1&&d.warnOnce('Vector tile source "'+this.source+'" layer "'+Mn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var bn=Ae.encode(Mn),on=[],un=0;un<$t.length;un++){var wi=$t.feature(un),xn=se.getId(wi,Mn);on.push({feature:wi,id:xn,index:un,sourceLayerIndex:bn})}for(var Oi=0,Yi=Ln[Mn];Oi<Yi.length;Oi+=1){var oi=Yi[Oi],Ki=oi[0];Ki.minzoom&&this.zoom<Math.floor(Ki.minzoom)||Ki.maxzoom&&this.zoom>=Ki.maxzoom||Ki.visibility!=="none"&&(N(oi,this.zoom,ye),(Jt[Ki.id]=Ki.createBucket({index:se.bucketLayerIDs.length,layers:oi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bn,sourceID:this.source})).populate(on,Rr,this.tileID.canonical),se.bucketLayerIDs.push(oi.map(function(ai){return ai.id})))}}}var zi=d.mapObject(Rr.glyphDependencies,function(ai){return Object.keys(ai).map(Number)});Object.keys(zi).length?z.send("getGlyphs",{uid:this.uid,stacks:zi},function(ai,ti){Ce||(Ce=ai,ct=ti,ba.call(me))}):ct={};var Ai=Object.keys(Rr.iconDependencies);Ai.length?z.send("getImages",{icons:Ai,source:this.source,tileID:this.tileID,type:"icons"},function(ai,ti){Ce||(Ce=ai,xr=ti,ba.call(me))}):xr={};var ca=Object.keys(Rr.patternDependencies);function ba(){if(Ce)return oe(Ce);if(ct&&xr&&Gt){var ai=new W(ct),ti=new d.ImageAtlas(xr,Gt);for(var Gi in Jt){var da=Jt[Gi];da instanceof d.SymbolBucket?(N(da.layers,this.zoom,ye),d.performSymbolLayout(da,ct,ai.positions,xr,ti.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):da.hasPattern&&(da instanceof d.LineBucket||da instanceof d.FillBucket||da instanceof d.FillExtrusionBucket)&&(N(da.layers,this.zoom,ye),da.addFeatures(Rr,this.tileID.canonical,ti.patternPositions))}this.status="done",oe(null,{buckets:d.values(Jt).filter(function(Xo){return!Xo.isEmpty()}),featureIndex:se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ai.image,imageAtlas:ti,glyphMap:this.returnDependencies?ct:null,iconMap:this.returnDependencies?xr:null,glyphPositions:this.returnDependencies?ai.positions:null})}}ca.length?z.send("getImages",{icons:ca,source:this.source,tileID:this.tileID,type:"patterns"},function(ai,ti){Ce||(Ce=ai,Gt=ti,ba.call(me))}):Gt={},ba.call(this)};var Ye=function(Y,ce,ye,z){this.actor=Y,this.layerIndex=ce,this.availableImages=ye,this.loadVectorData=z||Ne,this.loading={},this.loaded={}};Ye.prototype.loadTile=function(Y,ce){var ye=this,z=Y.uid;this.loading||(this.loading={});var oe=!!(Y&&Y.request&&Y.request.collectResourceTiming)&&new d.RequestPerformance(Y.request),me=this.loading[z]=new L(Y);me.abort=this.loadVectorData(Y,function(Ae,se){if(delete ye.loading[z],Ae||!se)return me.status="done",ye.loaded[z]=me,ce(Ae);var Ce=se.rawData,ct={};se.expires&&(ct.expires=se.expires),se.cacheControl&&(ct.cacheControl=se.cacheControl);var xr={};if(oe){var Gt=oe.finish();Gt&&(xr.resourceTiming=JSON.parse(JSON.stringify(Gt)))}me.vectorTile=se.vectorTile,me.parse(se.vectorTile,ye.layerIndex,ye.availableImages,ye.actor,function(Jt,Rr){if(Jt||!Rr)return ce(Jt);ce(null,d.extend({rawTileData:Ce.slice(0)},Rr,ct,xr))}),ye.loaded=ye.loaded||{},ye.loaded[z]=me})},Ye.prototype.reloadTile=function(Y,ce){var ye=this,z=this.loaded,oe=Y.uid,me=this;if(z&&z[oe]){var Ae=z[oe];Ae.showCollisionBoxes=Y.showCollisionBoxes;var se=function(Ce,ct){var xr=Ae.reloadCallback;xr&&(delete Ae.reloadCallback,Ae.parse(Ae.vectorTile,me.layerIndex,ye.availableImages,me.actor,xr)),ce(Ce,ct)};Ae.status==="parsing"?Ae.reloadCallback=se:Ae.status==="done"&&(Ae.vectorTile?Ae.parse(Ae.vectorTile,this.layerIndex,this.availableImages,this.actor,se):se())}},Ye.prototype.abortTile=function(Y,ce){var ye=this.loading,z=Y.uid;ye&&ye[z]&&ye[z].abort&&(ye[z].abort(),delete ye[z]),ce()},Ye.prototype.removeTile=function(Y,ce){var ye=this.loaded,z=Y.uid;ye&&ye[z]&&delete ye[z],ce()};var Je=d.window.ImageBitmap,rt=function(){this.loaded={}};function Yt(Y,ce){if(Y.length!==0){Vt(Y[0],ce);for(var ye=1;ye<Y.length;ye++)Vt(Y[ye],!ce)}}function Vt(Y,ce){for(var ye=0,z=0,oe=Y.length,me=oe-1;z<oe;me=z++)ye+=(Y[z][0]-Y[me][0])*(Y[me][1]+Y[z][1]);ye>=0!=!!ce&&Y.reverse()}rt.prototype.loadTile=function(Y,ce){var ye=Y.uid,z=Y.encoding,oe=Y.rawImageData,me=Je&&oe instanceof Je?this.getImageData(oe):oe,Ae=new d.DEMData(ye,me,z);this.loaded=this.loaded||{},this.loaded[ye]=Ae,ce(null,Ae)},rt.prototype.getImageData=function(Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);var ce=this.offscreenCanvasContext.getImageData(-1,-1,Y.width+2,Y.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:ce.width,height:ce.height},ce.data)},rt.prototype.removeTile=function(Y){var ce=this.loaded,ye=Y.uid;ce&&ce[ye]&&delete ce[ye]};var tr=d.vectorTile.VectorTileFeature.prototype.toGeoJSON,zt=function(Y){this._feature=Y,this.extent=d.EXTENT,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))};zt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var Y=[],ce=0,ye=this._feature.geometry;ce<ye.length;ce+=1){var z=ye[ce];Y.push([new d.Point$1(z[0],z[1])])}return Y}for(var oe=[],me=0,Ae=this._feature.geometry;me<Ae.length;me+=1){for(var se=[],Ce=0,ct=Ae[me];Ce<ct.length;Ce+=1){var xr=ct[Ce];se.push(new d.Point$1(xr[0],xr[1]))}oe.push(se)}return oe},zt.prototype.toGeoJSON=function(Y,ce,ye){return tr.call(this,Y,ce,ye)};var Tt=function(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=Y.length,this._features=Y};Tt.prototype.feature=function(Y){return new zt(this._features[Y])};var xt=d.vectorTile.VectorTileFeature,yr=ee;function ee(Y,ce){this.options=ce||{},this.features=Y,this.length=Y.length}function dr(Y,ce){this.id=typeof Y.id=="number"?Y.id:void 0,this.type=Y.type,this.rawGeometry=Y.type===1?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=ce||4096}ee.prototype.feature=function(Y){return new dr(this.features[Y],this.options.extent)},dr.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var ce=0;ce<Y.length;ce++){for(var ye=Y[ce],z=[],oe=0;oe<ye.length;oe++)z.push(new d.Point$1(ye[oe][0],ye[oe][1]));this.geometry.push(z)}return this.geometry},dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,ce=1/0,ye=-1/0,z=1/0,oe=-1/0,me=0;me<Y.length;me++)for(var Ae=Y[me],se=0;se<Ae.length;se++){var Ce=Ae[se];ce=Math.min(ce,Ce.x),ye=Math.max(ye,Ce.x),z=Math.min(z,Ce.y),oe=Math.max(oe,Ce.y)}return[ce,z,ye,oe]},dr.prototype.toGeoJSON=xt.prototype.toGeoJSON;var Ct=Dt,Ke=yr;function Dt(Y){var ce=new d.pbf;return function(ye,z){for(var oe in ye.layers)z.writeMessage(3,Xe,ye.layers[oe])}(Y,ce),ce.finish()}function Xe(Y,ce){var ye;ce.writeVarintField(15,Y.version||1),ce.writeStringField(1,Y.name||""),ce.writeVarintField(5,Y.extent||4096);var z={keys:[],values:[],keycache:{},valuecache:{}};for(ye=0;ye<Y.length;ye++)z.feature=Y.feature(ye),ce.writeMessage(2,Ut,z);var oe=z.keys;for(ye=0;ye<oe.length;ye++)ce.writeStringField(3,oe[ye]);var me=z.values;for(ye=0;ye<me.length;ye++)ce.writeMessage(4,Re,me[ye])}function Ut(Y,ce){var ye=Y.feature;ye.id!==void 0&&ce.writeVarintField(1,ye.id),ce.writeMessage(2,_r,Y),ce.writeVarintField(3,ye.type),ce.writeMessage(4,fe,ye)}function _r(Y,ce){var ye=Y.feature,z=Y.keys,oe=Y.values,me=Y.keycache,Ae=Y.valuecache;for(var se in ye.properties){var Ce=me[se];Ce===void 0&&(z.push(se),me[se]=Ce=z.length-1),ce.writeVarint(Ce);var ct=ye.properties[se],xr=typeof ct;xr!=="string"&&xr!=="boolean"&&xr!=="number"&&(ct=JSON.stringify(ct));var Gt=xr+":"+ct,Jt=Ae[Gt];Jt===void 0&&(oe.push(ct),Ae[Gt]=Jt=oe.length-1),ce.writeVarint(Jt)}}function ar(Y,ce){return(ce<<3)+(7&Y)}function zr(Y){return Y<<1^Y>>31}function fe(Y,ce){for(var ye=Y.loadGeometry(),z=Y.type,oe=0,me=0,Ae=ye.length,se=0;se<Ae;se++){var Ce=ye[se],ct=1;z===1&&(ct=Ce.length),ce.writeVarint(ar(1,ct));for(var xr=z===3?Ce.length-1:Ce.length,Gt=0;Gt<xr;Gt++){Gt===1&&z!==1&&ce.writeVarint(ar(2,xr-1));var Jt=Ce[Gt].x-oe,Rr=Ce[Gt].y-me;ce.writeVarint(zr(Jt)),ce.writeVarint(zr(Rr)),oe+=Jt,me+=Rr}z===3&&ce.writeVarint(ar(7,1))}}function Re(Y,ce){var ye=typeof Y;ye==="string"?ce.writeStringField(1,Y):ye==="boolean"?ce.writeBooleanField(7,Y):ye==="number"&&(Y%1!=0?ce.writeDoubleField(3,Y):Y<0?ce.writeSVarintField(6,Y):ce.writeVarintField(5,Y))}function ge(Y,ce,ye,z){_t(Y,ye,z),_t(ce,2*ye,2*z),_t(ce,2*ye+1,2*z+1)}function _t(Y,ce,ye){var z=Y[ce];Y[ce]=Y[ye],Y[ye]=z}function pt(Y,ce,ye,z){var oe=Y-ye,me=ce-z;return oe*oe+me*me}Ct.fromVectorTileJs=Dt,Ct.fromGeojsonVt=function(Y,ce){ce=ce||{};var ye={};for(var z in Y)ye[z]=new yr(Y[z].features,ce),ye[z].name=z,ye[z].version=ce.version,ye[z].extent=ce.extent;return Dt({layers:ye})},Ct.GeoJSONWrapper=Ke;var Nt=function(Y){return Y[0]},Bt=function(Y){return Y[1]},kr=function(Y,ce,ye,z,oe){ce===void 0&&(ce=Nt),ye===void 0&&(ye=Bt),z===void 0&&(z=64),oe===void 0&&(oe=Float64Array),this.nodeSize=z,this.points=Y;for(var me=Y.length<65536?Uint16Array:Uint32Array,Ae=this.ids=new me(Y.length),se=this.coords=new oe(2*Y.length),Ce=0;Ce<Y.length;Ce++)Ae[Ce]=Ce,se[2*Ce]=ce(Y[Ce]),se[2*Ce+1]=ye(Y[Ce]);(function ct(xr,Gt,Jt,Rr,Ln,Mn){if(!(Ln-Rr<=Jt)){var $t=Rr+Ln>>1;(function bn(on,un,wi,xn,Oi,Yi){for(;Oi>xn;){if(Oi-xn>600){var oi=Oi-xn+1,Ki=wi-xn+1,zi=Math.log(oi),Ai=.5*Math.exp(2*zi/3),ca=.5*Math.sqrt(zi*Ai*(oi-Ai)/oi)*(Ki-oi/2<0?-1:1);bn(on,un,wi,Math.max(xn,Math.floor(wi-Ki*Ai/oi+ca)),Math.min(Oi,Math.floor(wi+(oi-Ki)*Ai/oi+ca)),Yi)}var ba=un[2*wi+Yi],ai=xn,ti=Oi;for(ge(on,un,xn,wi),un[2*Oi+Yi]>ba&&ge(on,un,xn,Oi);ai<ti;){for(ge(on,un,ai,ti),ai++,ti--;un[2*ai+Yi]<ba;)ai++;for(;un[2*ti+Yi]>ba;)ti--}un[2*xn+Yi]===ba?ge(on,un,xn,ti):ge(on,un,++ti,Oi),ti<=wi&&(xn=ti+1),wi<=ti&&(Oi=ti-1)}})(xr,Gt,$t,Rr,Ln,Mn%2),ct(xr,Gt,Jt,Rr,$t-1,Mn+1),ct(xr,Gt,Jt,$t+1,Ln,Mn+1)}})(Ae,se,z,0,Ae.length-1,0)};kr.prototype.range=function(Y,ce,ye,z){return function(oe,me,Ae,se,Ce,ct,xr){for(var Gt,Jt,Rr=[0,oe.length-1,0],Ln=[];Rr.length;){var Mn=Rr.pop(),$t=Rr.pop(),bn=Rr.pop();if($t-bn<=xr)for(var on=bn;on<=$t;on++)Jt=me[2*on+1],(Gt=me[2*on])>=Ae&&Gt<=Ce&&Jt>=se&&Jt<=ct&&Ln.push(oe[on]);else{var un=Math.floor((bn+$t)/2);Jt=me[2*un+1],(Gt=me[2*un])>=Ae&&Gt<=Ce&&Jt>=se&&Jt<=ct&&Ln.push(oe[un]);var wi=(Mn+1)%2;(Mn===0?Ae<=Gt:se<=Jt)&&(Rr.push(bn),Rr.push(un-1),Rr.push(wi)),(Mn===0?Ce>=Gt:ct>=Jt)&&(Rr.push(un+1),Rr.push($t),Rr.push(wi))}}return Ln}(this.ids,this.coords,Y,ce,ye,z,this.nodeSize)},kr.prototype.within=function(Y,ce,ye){return function(z,oe,me,Ae,se,Ce){for(var ct=[0,z.length-1,0],xr=[],Gt=se*se;ct.length;){var Jt=ct.pop(),Rr=ct.pop(),Ln=ct.pop();if(Rr-Ln<=Ce)for(var Mn=Ln;Mn<=Rr;Mn++)pt(oe[2*Mn],oe[2*Mn+1],me,Ae)<=Gt&&xr.push(z[Mn]);else{var $t=Math.floor((Ln+Rr)/2),bn=oe[2*$t],on=oe[2*$t+1];pt(bn,on,me,Ae)<=Gt&&xr.push(z[$t]);var un=(Jt+1)%2;(Jt===0?me-se<=bn:Ae-se<=on)&&(ct.push(Ln),ct.push($t-1),ct.push(un)),(Jt===0?me+se>=bn:Ae+se>=on)&&(ct.push($t+1),ct.push(Rr),ct.push(un))}}return xr}(this.ids,this.coords,Y,ce,ye,this.nodeSize)};var ln={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Y){return Y}},yn=function(Y){this.options=Ft(Object.create(ln),Y),this.trees=new Array(this.options.maxZoom+1)};function Vi(Y,ce,ye,z,oe){return{x:Y,y:ce,zoom:1/0,id:ye,parentId:-1,numPoints:z,properties:oe}}function nr(Y,ce){var ye=Y.geometry.coordinates,z=ye[1];return{x:Ue(ye[0]),y:Le(z),zoom:1/0,index:ce,parentId:-1}}function de(Y){return{type:"Feature",id:Y.id,properties:Te(Y),geometry:{type:"Point",coordinates:[(z=Y.x,360*(z-.5)),(ce=Y.y,ye=(180-360*ce)*Math.PI/180,360*Math.atan(Math.exp(ye))/Math.PI-90)]}};var ce,ye,z}function Te(Y){var ce=Y.numPoints,ye=ce>=1e4?Math.round(ce/1e3)+"k":ce>=1e3?Math.round(ce/100)/10+"k":ce;return Ft(Ft({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:ce,point_count_abbreviated:ye})}function Ue(Y){return Y/360+.5}function Le(Y){var ce=Math.sin(Y*Math.PI/180),ye=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ye<0?0:ye>1?1:ye}function Ft(Y,ce){for(var ye in ce)Y[ye]=ce[ye];return Y}function er(Y){return Y.x}function w(Y){return Y.y}function Z(Y,ce,ye,z,oe,me){var Ae=oe-ye,se=me-z;if(Ae!==0||se!==0){var Ce=((Y-ye)*Ae+(ce-z)*se)/(Ae*Ae+se*se);Ce>1?(ye=oe,z=me):Ce>0&&(ye+=Ae*Ce,z+=se*Ce)}return(Ae=Y-ye)*Ae+(se=ce-z)*se}function Ee(Y,ce,ye,z){var oe={id:Y===void 0?null:Y,type:ce,geometry:ye,tags:z,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var Ae=me.geometry,se=me.type;if(se==="Point"||se==="MultiPoint"||se==="LineString")Ze(me,Ae);else if(se==="Polygon"||se==="MultiLineString")for(var Ce=0;Ce<Ae.length;Ce++)Ze(me,Ae[Ce]);else if(se==="MultiPolygon")for(Ce=0;Ce<Ae.length;Ce++)for(var ct=0;ct<Ae[Ce].length;ct++)Ze(me,Ae[Ce][ct])}(oe),oe}function Ze(Y,ce){for(var ye=0;ye<ce.length;ye+=3)Y.minX=Math.min(Y.minX,ce[ye]),Y.minY=Math.min(Y.minY,ce[ye+1]),Y.maxX=Math.max(Y.maxX,ce[ye]),Y.maxY=Math.max(Y.maxY,ce[ye+1])}function Qe(Y,ce,ye,z){if(ce.geometry){var oe=ce.geometry.coordinates,me=ce.geometry.type,Ae=Math.pow(ye.tolerance/((1<<ye.maxZoom)*ye.extent),2),se=[],Ce=ce.id;if(ye.promoteId?Ce=ce.properties[ye.promoteId]:ye.generateId&&(Ce=z||0),me==="Point")yt(oe,se);else if(me==="MultiPoint")for(var ct=0;ct<oe.length;ct++)yt(oe[ct],se);else if(me==="LineString")St(oe,se,Ae,!1);else if(me==="MultiLineString"){if(ye.lineMetrics){for(ct=0;ct<oe.length;ct++)St(oe[ct],se=[],Ae,!1),Y.push(Ee(Ce,"LineString",se,ce.properties));return}jt(oe,se,Ae,!1)}else if(me==="Polygon")jt(oe,se,Ae,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(ct=0;ct<ce.geometry.geometries.length;ct++)Qe(Y,{id:Ce,geometry:ce.geometry.geometries[ct],properties:ce.properties},ye,z);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ct=0;ct<oe.length;ct++){var xr=[];jt(oe[ct],xr,Ae,!0),se.push(xr)}}Y.push(Ee(Ce,me,se,ce.properties))}}function yt(Y,ce){ce.push(Et(Y[0])),ce.push(Qt(Y[1])),ce.push(0)}function St(Y,ce,ye,z){for(var oe,me,Ae=0,se=0;se<Y.length;se++){var Ce=Et(Y[se][0]),ct=Qt(Y[se][1]);ce.push(Ce),ce.push(ct),ce.push(0),se>0&&(Ae+=z?(oe*ct-Ce*me)/2:Math.sqrt(Math.pow(Ce-oe,2)+Math.pow(ct-me,2))),oe=Ce,me=ct}var xr=ce.length-3;ce[2]=1,function Gt(Jt,Rr,Ln,Mn){for(var $t,bn=Mn,on=Ln-Rr>>1,un=Ln-Rr,wi=Jt[Rr],xn=Jt[Rr+1],Oi=Jt[Ln],Yi=Jt[Ln+1],oi=Rr+3;oi<Ln;oi+=3){var Ki=Z(Jt[oi],Jt[oi+1],wi,xn,Oi,Yi);if(Ki>bn)$t=oi,bn=Ki;else if(Ki===bn){var zi=Math.abs(oi-on);zi<un&&($t=oi,un=zi)}}bn>Mn&&($t-Rr>3&&Gt(Jt,Rr,$t,Mn),Jt[$t+2]=bn,Ln-$t>3&&Gt(Jt,$t,Ln,Mn))}(ce,0,xr,ye),ce[xr+2]=1,ce.size=Math.abs(Ae),ce.start=0,ce.end=ce.size}function jt(Y,ce,ye,z){for(var oe=0;oe<Y.length;oe++){var me=[];St(Y[oe],me,ye,z),ce.push(me)}}function Et(Y){return Y/360+.5}function Qt(Y){var ce=Math.sin(Y*Math.PI/180),ye=.5-.25*Math.log((1+ce)/(1-ce))/Math.PI;return ye<0?0:ye>1?1:ye}function ie(Y,ce,ye,z,oe,me,Ae,se){if(z/=ce,me>=(ye/=ce)&&Ae<z)return Y;if(Ae<ye||me>=z)return null;for(var Ce=[],ct=0;ct<Y.length;ct++){var xr=Y[ct],Gt=xr.geometry,Jt=xr.type,Rr=oe===0?xr.minX:xr.minY,Ln=oe===0?xr.maxX:xr.maxY;if(Rr>=ye&&Ln<z)Ce.push(xr);else if(!(Ln<ye||Rr>=z)){var Mn=[];if(Jt==="Point"||Jt==="MultiPoint")sr(Gt,Mn,ye,z,oe);else if(Jt==="LineString")Br(Gt,Mn,ye,z,oe,!1,se.lineMetrics);else if(Jt==="MultiLineString")nt(Gt,Mn,ye,z,oe,!1);else if(Jt==="Polygon")nt(Gt,Mn,ye,z,oe,!0);else if(Jt==="MultiPolygon")for(var $t=0;$t<Gt.length;$t++){var bn=[];nt(Gt[$t],bn,ye,z,oe,!0),bn.length&&Mn.push(bn)}if(Mn.length){if(se.lineMetrics&&Jt==="LineString"){for($t=0;$t<Mn.length;$t++)Ce.push(Ee(xr.id,Jt,Mn[$t],xr.tags));continue}Jt!=="LineString"&&Jt!=="MultiLineString"||(Mn.length===1?(Jt="LineString",Mn=Mn[0]):Jt="MultiLineString"),Jt!=="Point"&&Jt!=="MultiPoint"||(Jt=Mn.length===3?"Point":"MultiPoint"),Ce.push(Ee(xr.id,Jt,Mn,xr.tags))}}}return Ce.length?Ce:null}function sr(Y,ce,ye,z,oe){for(var me=0;me<Y.length;me+=3){var Ae=Y[me+oe];Ae>=ye&&Ae<=z&&(ce.push(Y[me]),ce.push(Y[me+1]),ce.push(Y[me+2]))}}function Br(Y,ce,ye,z,oe,me,Ae){for(var se,Ce,ct=Lr(Y),xr=oe===0?vt:hr,Gt=Y.start,Jt=0;Jt<Y.length-3;Jt+=3){var Rr=Y[Jt],Ln=Y[Jt+1],Mn=Y[Jt+2],$t=Y[Jt+3],bn=Y[Jt+4],on=oe===0?Rr:Ln,un=oe===0?$t:bn,wi=!1;Ae&&(se=Math.sqrt(Math.pow(Rr-$t,2)+Math.pow(Ln-bn,2))),on<ye?un>ye&&(Ce=xr(ct,Rr,Ln,$t,bn,ye),Ae&&(ct.start=Gt+se*Ce)):on>z?un<z&&(Ce=xr(ct,Rr,Ln,$t,bn,z),Ae&&(ct.start=Gt+se*Ce)):gt(ct,Rr,Ln,Mn),un<ye&&on>=ye&&(Ce=xr(ct,Rr,Ln,$t,bn,ye),wi=!0),un>z&&on<=z&&(Ce=xr(ct,Rr,Ln,$t,bn,z),wi=!0),!me&&wi&&(Ae&&(ct.end=Gt+se*Ce),ce.push(ct),ct=Lr(Y)),Ae&&(Gt+=se)}var xn=Y.length-3;Rr=Y[xn],Ln=Y[xn+1],Mn=Y[xn+2],(on=oe===0?Rr:Ln)>=ye&&on<=z&&gt(ct,Rr,Ln,Mn),xn=ct.length-3,me&&xn>=3&&(ct[xn]!==ct[0]||ct[xn+1]!==ct[1])&&gt(ct,ct[0],ct[1],ct[2]),ct.length&&ce.push(ct)}function Lr(Y){var ce=[];return ce.size=Y.size,ce.start=Y.start,ce.end=Y.end,ce}function nt(Y,ce,ye,z,oe,me){for(var Ae=0;Ae<Y.length;Ae++)Br(Y[Ae],ce,ye,z,oe,me,!1)}function gt(Y,ce,ye,z){Y.push(ce),Y.push(ye),Y.push(z)}function vt(Y,ce,ye,z,oe,me){var Ae=(me-ce)/(z-ce);return Y.push(me),Y.push(ye+(oe-ye)*Ae),Y.push(1),Ae}function hr(Y,ce,ye,z,oe,me){var Ae=(me-ye)/(oe-ye);return Y.push(ce+(z-ce)*Ae),Y.push(me),Y.push(1),Ae}function Vr(Y,ce){for(var ye=[],z=0;z<Y.length;z++){var oe,me=Y[z],Ae=me.type;if(Ae==="Point"||Ae==="MultiPoint"||Ae==="LineString")oe=Ur(me.geometry,ce);else if(Ae==="MultiLineString"||Ae==="Polygon"){oe=[];for(var se=0;se<me.geometry.length;se++)oe.push(Ur(me.geometry[se],ce))}else if(Ae==="MultiPolygon")for(oe=[],se=0;se<me.geometry.length;se++){for(var Ce=[],ct=0;ct<me.geometry[se].length;ct++)Ce.push(Ur(me.geometry[se][ct],ce));oe.push(Ce)}ye.push(Ee(me.id,Ae,oe,me.tags))}return ye}function Ur(Y,ce){var ye=[];ye.size=Y.size,Y.start!==void 0&&(ye.start=Y.start,ye.end=Y.end);for(var z=0;z<Y.length;z+=3)ye.push(Y[z]+ce,Y[z+1],Y[z+2]);return ye}function nn(Y,ce){if(Y.transformed)return Y;var ye,z,oe,me=1<<Y.z,Ae=Y.x,se=Y.y;for(ye=0;ye<Y.features.length;ye++){var Ce=Y.features[ye],ct=Ce.geometry,xr=Ce.type;if(Ce.geometry=[],xr===1)for(z=0;z<ct.length;z+=2)Ce.geometry.push(Jr(ct[z],ct[z+1],ce,me,Ae,se));else for(z=0;z<ct.length;z++){var Gt=[];for(oe=0;oe<ct[z].length;oe+=2)Gt.push(Jr(ct[z][oe],ct[z][oe+1],ce,me,Ae,se));Ce.geometry.push(Gt)}}return Y.transformed=!0,Y}function Jr(Y,ce,ye,z,oe,me){return[Math.round(ye*(Y*z-oe)),Math.round(ye*(ce*z-me))]}function Cr(Y,ce,ye,z,oe){for(var me=ce===oe.maxZoom?0:oe.tolerance/((1<<ce)*oe.extent),Ae={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ye,y:z,z:ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},se=0;se<Y.length;se++){Ae.numFeatures++,Dn(Ae,Y[se],me,oe);var Ce=Y[se].minX,ct=Y[se].minY,xr=Y[se].maxX,Gt=Y[se].maxY;Ce<Ae.minX&&(Ae.minX=Ce),ct<Ae.minY&&(Ae.minY=ct),xr>Ae.maxX&&(Ae.maxX=xr),Gt>Ae.maxY&&(Ae.maxY=Gt)}return Ae}function Dn(Y,ce,ye,z){var oe=ce.geometry,me=ce.type,Ae=[];if(me==="Point"||me==="MultiPoint")for(var se=0;se<oe.length;se+=3)Ae.push(oe[se]),Ae.push(oe[se+1]),Y.numPoints++,Y.numSimplified++;else if(me==="LineString")Hn(Ae,oe,Y,ye,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(se=0;se<oe.length;se++)Hn(Ae,oe[se],Y,ye,me==="Polygon",se===0);else if(me==="MultiPolygon")for(var Ce=0;Ce<oe.length;Ce++){var ct=oe[Ce];for(se=0;se<ct.length;se++)Hn(Ae,ct[se],Y,ye,!0,se===0)}if(Ae.length){var xr=ce.tags||null;if(me==="LineString"&&z.lineMetrics){for(var Gt in xr={},ce.tags)xr[Gt]=ce.tags[Gt];xr.mapbox_clip_start=oe.start/oe.size,xr.mapbox_clip_end=oe.end/oe.size}var Jt={geometry:Ae,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:xr};ce.id!==null&&(Jt.id=ce.id),Y.features.push(Jt)}}function Hn(Y,ce,ye,z,oe,me){var Ae=z*z;if(z>0&&ce.size<(oe?Ae:z))ye.numPoints+=ce.length/3;else{for(var se=[],Ce=0;Ce<ce.length;Ce+=3)(z===0||ce[Ce+2]>Ae)&&(ye.numSimplified++,se.push(ce[Ce]),se.push(ce[Ce+1])),ye.numPoints++;oe&&function(ct,xr){for(var Gt=0,Jt=0,Rr=ct.length,Ln=Rr-2;Jt<Rr;Ln=Jt,Jt+=2)Gt+=(ct[Jt]-ct[Ln])*(ct[Jt+1]+ct[Ln+1]);if(Gt>0===xr)for(Jt=0,Rr=ct.length;Jt<Rr/2;Jt+=2){var Mn=ct[Jt],$t=ct[Jt+1];ct[Jt]=ct[Rr-2-Jt],ct[Jt+1]=ct[Rr-1-Jt],ct[Rr-2-Jt]=Mn,ct[Rr-1-Jt]=$t}}(se,me),Y.push(se)}}function bi(Y,ce){var ye=(ce=this.options=function(oe,me){for(var Ae in me)oe[Ae]=me[Ae];return oe}(Object.create(this.options),ce)).debug;if(ye&&console.time("preprocess data"),ce.maxZoom<0||ce.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ce.promoteId&&ce.generateId)throw new Error("promoteId and generateId cannot be used together.");var z=function(oe,me){var Ae=[];if(oe.type==="FeatureCollection")for(var se=0;se<oe.features.length;se++)Qe(Ae,oe.features[se],me,se);else Qe(Ae,oe.type==="Feature"?oe:{geometry:oe},me);return Ae}(Y,ce);this.tiles={},this.tileCoords=[],ye&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ce.indexMaxZoom,ce.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(z=function(oe,me){var Ae=me.buffer/me.extent,se=oe,Ce=ie(oe,1,-1-Ae,Ae,0,-1,2,me),ct=ie(oe,1,1-Ae,2+Ae,0,-1,2,me);return(Ce||ct)&&(se=ie(oe,1,-Ae,1+Ae,0,-1,2,me)||[],Ce&&(se=Vr(Ce,1).concat(se)),ct&&(se=se.concat(Vr(ct,-1)))),se}(z,ce)).length&&this.splitTile(z,0,0,0),ye&&(z.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ui(Y,ce,ye){return 32*((1<<Y)*ye+ce)+Y}function Ji(Y,ce){var ye=Y.tileID.canonical;if(!this._geoJSONIndex)return ce(null,null);var z=this._geoJSONIndex.getTile(ye.z,ye.x,ye.y);if(!z)return ce(null,null);var oe=new Tt(z.features),me=Ct(oe);me.byteOffset===0&&me.byteLength===me.buffer.byteLength||(me=new Uint8Array(me)),ce(null,{vectorTile:oe,rawData:me.buffer})}yn.prototype.load=function(Y){var ce=this.options,ye=ce.log,z=ce.minZoom,oe=ce.maxZoom,me=ce.nodeSize;ye&&console.time("total time");var Ae="prepare "+Y.length+" points";ye&&console.time(Ae),this.points=Y;for(var se=[],Ce=0;Ce<Y.length;Ce++)Y[Ce].geometry&&se.push(nr(Y[Ce],Ce));this.trees[oe+1]=new kr(se,er,w,me,Float32Array),ye&&console.timeEnd(Ae);for(var ct=oe;ct>=z;ct--){var xr=+Date.now();se=this._cluster(se,ct),this.trees[ct]=new kr(se,er,w,me,Float32Array),ye&&console.log("z%d: %d clusters in %dms",ct,se.length,+Date.now()-xr)}return ye&&console.timeEnd("total time"),this},yn.prototype.getClusters=function(Y,ce){var ye=((Y[0]+180)%360+360)%360-180,z=Math.max(-90,Math.min(90,Y[1])),oe=Y[2]===180?180:((Y[2]+180)%360+360)%360-180,me=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ye=-180,oe=180;else if(ye>oe){var Ae=this.getClusters([ye,z,180,me],ce),se=this.getClusters([-180,z,oe,me],ce);return Ae.concat(se)}for(var Ce=this.trees[this._limitZoom(ce)],ct=[],xr=0,Gt=Ce.range(Ue(ye),Le(me),Ue(oe),Le(z));xr<Gt.length;xr+=1){var Jt=Ce.points[Gt[xr]];ct.push(Jt.numPoints?de(Jt):this.points[Jt.index])}return ct},yn.prototype.getChildren=function(Y){var ce=this._getOriginId(Y),ye=this._getOriginZoom(Y),z="No cluster with the specified id.",oe=this.trees[ye];if(!oe)throw new Error(z);var me=oe.points[ce];if(!me)throw new Error(z);for(var Ae=this.options.radius/(this.options.extent*Math.pow(2,ye-1)),se=[],Ce=0,ct=oe.within(me.x,me.y,Ae);Ce<ct.length;Ce+=1){var xr=oe.points[ct[Ce]];xr.parentId===Y&&se.push(xr.numPoints?de(xr):this.points[xr.index])}if(se.length===0)throw new Error(z);return se},yn.prototype.getLeaves=function(Y,ce,ye){var z=[];return this._appendLeaves(z,Y,ce=ce||10,ye=ye||0,0),z},yn.prototype.getTile=function(Y,ce,ye){var z=this.trees[this._limitZoom(Y)],oe=Math.pow(2,Y),me=this.options,Ae=me.radius/me.extent,se=(ye-Ae)/oe,Ce=(ye+1+Ae)/oe,ct={features:[]};return this._addTileFeatures(z.range((ce-Ae)/oe,se,(ce+1+Ae)/oe,Ce),z.points,ce,ye,oe,ct),ce===0&&this._addTileFeatures(z.range(1-Ae/oe,se,1,Ce),z.points,oe,ye,oe,ct),ce===oe-1&&this._addTileFeatures(z.range(0,se,Ae/oe,Ce),z.points,-1,ye,oe,ct),ct.features.length?ct:null},yn.prototype.getClusterExpansionZoom=function(Y){for(var ce=this._getOriginZoom(Y)-1;ce<=this.options.maxZoom;){var ye=this.getChildren(Y);if(ce++,ye.length!==1)break;Y=ye[0].properties.cluster_id}return ce},yn.prototype._appendLeaves=function(Y,ce,ye,z,oe){for(var me=0,Ae=this.getChildren(ce);me<Ae.length;me+=1){var se=Ae[me],Ce=se.properties;if(Ce&&Ce.cluster?oe+Ce.point_count<=z?oe+=Ce.point_count:oe=this._appendLeaves(Y,Ce.cluster_id,ye,z,oe):oe<z?oe++:Y.push(se),Y.length===ye)break}return oe},yn.prototype._addTileFeatures=function(Y,ce,ye,z,oe,me){for(var Ae=0,se=Y;Ae<se.length;Ae+=1){var Ce=ce[se[Ae]],ct=Ce.numPoints,xr={type:1,geometry:[[Math.round(this.options.extent*(Ce.x*oe-ye)),Math.round(this.options.extent*(Ce.y*oe-z))]],tags:ct?Te(Ce):this.points[Ce.index].properties},Gt=void 0;ct?Gt=Ce.id:this.options.generateId?Gt=Ce.index:this.points[Ce.index].id&&(Gt=this.points[Ce.index].id),Gt!==void 0&&(xr.id=Gt),me.features.push(xr)}},yn.prototype._limitZoom=function(Y){return Math.max(this.options.minZoom,Math.min(+Y,this.options.maxZoom+1))},yn.prototype._cluster=function(Y,ce){for(var ye=[],z=this.options,oe=z.reduce,me=z.minPoints,Ae=z.radius/(z.extent*Math.pow(2,ce)),se=0;se<Y.length;se++){var Ce=Y[se];if(!(Ce.zoom<=ce)){Ce.zoom=ce;for(var ct=this.trees[ce+1],xr=ct.within(Ce.x,Ce.y,Ae),Gt=Ce.numPoints||1,Jt=Gt,Rr=0,Ln=xr;Rr<Ln.length;Rr+=1){var Mn=ct.points[Ln[Rr]];Mn.zoom>ce&&(Jt+=Mn.numPoints||1)}if(Jt>=me){for(var $t=Ce.x*Gt,bn=Ce.y*Gt,on=oe&&Gt>1?this._map(Ce,!0):null,un=(se<<5)+(ce+1)+this.points.length,wi=0,xn=xr;wi<xn.length;wi+=1){var Oi=ct.points[xn[wi]];if(!(Oi.zoom<=ce)){Oi.zoom=ce;var Yi=Oi.numPoints||1;$t+=Oi.x*Yi,bn+=Oi.y*Yi,Oi.parentId=un,oe&&(on||(on=this._map(Ce,!0)),oe(on,this._map(Oi)))}}Ce.parentId=un,ye.push(Vi($t/Jt,bn/Jt,un,Jt,on))}else if(ye.push(Ce),Jt>1)for(var oi=0,Ki=xr;oi<Ki.length;oi+=1){var zi=ct.points[Ki[oi]];zi.zoom<=ce||(zi.zoom=ce,ye.push(zi))}}}return ye},yn.prototype._getOriginId=function(Y){return Y-this.points.length>>5},yn.prototype._getOriginZoom=function(Y){return(Y-this.points.length)%32},yn.prototype._map=function(Y,ce){if(Y.numPoints)return ce?Ft({},Y.properties):Y.properties;var ye=this.points[Y.index].properties,z=this.options.map(ye);return ce&&z===ye?Ft({},z):z},bi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},bi.prototype.splitTile=function(Y,ce,ye,z,oe,me,Ae){for(var se=[Y,ce,ye,z],Ce=this.options,ct=Ce.debug;se.length;){z=se.pop(),ye=se.pop(),ce=se.pop(),Y=se.pop();var xr=1<<ce,Gt=Ui(ce,ye,z),Jt=this.tiles[Gt];if(!Jt&&(ct>1&&console.time("creation"),Jt=this.tiles[Gt]=Cr(Y,ce,ye,z,Ce),this.tileCoords.push({z:ce,x:ye,y:z}),ct)){ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ce,ye,z,Jt.numFeatures,Jt.numPoints,Jt.numSimplified),console.timeEnd("creation"));var Rr="z"+ce;this.stats[Rr]=(this.stats[Rr]||0)+1,this.total++}if(Jt.source=Y,oe){if(ce===Ce.maxZoom||ce===oe)continue;var Ln=1<<oe-ce;if(ye!==Math.floor(me/Ln)||z!==Math.floor(Ae/Ln))continue}else if(ce===Ce.indexMaxZoom||Jt.numPoints<=Ce.indexMaxPoints)continue;if(Jt.source=null,Y.length!==0){ct>1&&console.time("clipping");var Mn,$t,bn,on,un,wi,xn=.5*Ce.buffer/Ce.extent,Oi=.5-xn,Yi=.5+xn,oi=1+xn;Mn=$t=bn=on=null,un=ie(Y,xr,ye-xn,ye+Yi,0,Jt.minX,Jt.maxX,Ce),wi=ie(Y,xr,ye+Oi,ye+oi,0,Jt.minX,Jt.maxX,Ce),Y=null,un&&(Mn=ie(un,xr,z-xn,z+Yi,1,Jt.minY,Jt.maxY,Ce),$t=ie(un,xr,z+Oi,z+oi,1,Jt.minY,Jt.maxY,Ce),un=null),wi&&(bn=ie(wi,xr,z-xn,z+Yi,1,Jt.minY,Jt.maxY,Ce),on=ie(wi,xr,z+Oi,z+oi,1,Jt.minY,Jt.maxY,Ce),wi=null),ct>1&&console.timeEnd("clipping"),se.push(Mn||[],ce+1,2*ye,2*z),se.push($t||[],ce+1,2*ye,2*z+1),se.push(bn||[],ce+1,2*ye+1,2*z),se.push(on||[],ce+1,2*ye+1,2*z+1)}}},bi.prototype.getTile=function(Y,ce,ye){var z=this.options,oe=z.extent,me=z.debug;if(Y<0||Y>24)return null;var Ae=1<<Y,se=Ui(Y,ce=(ce%Ae+Ae)%Ae,ye);if(this.tiles[se])return nn(this.tiles[se],oe);me>1&&console.log("drilling down to z%d-%d-%d",Y,ce,ye);for(var Ce,ct=Y,xr=ce,Gt=ye;!Ce&&ct>0;)ct--,xr=Math.floor(xr/2),Gt=Math.floor(Gt/2),Ce=this.tiles[Ui(ct,xr,Gt)];return Ce&&Ce.source?(me>1&&console.log("found parent tile z%d-%d-%d",ct,xr,Gt),me>1&&console.time("drilling down"),this.splitTile(Ce.source,ct,xr,Gt,Y,ce,ye),me>1&&console.timeEnd("drilling down"),this.tiles[se]?nn(this.tiles[se],oe):null):null};var Ri=function(Y){function ce(ye,z,oe,me){Y.call(this,ye,z,oe,Ji),me&&(this.loadGeoJSON=me)}return Y&&(ce.__proto__=Y),(ce.prototype=Object.create(Y&&Y.prototype)).constructor=ce,ce.prototype.loadData=function(ye,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=z,this._pendingLoadDataParams=ye,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ce.prototype._loadData=function(){var ye=this;if(this._pendingCallback&&this._pendingLoadDataParams){var z=this._pendingCallback,oe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var me=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new d.RequestPerformance(oe.request);this.loadGeoJSON(oe,function(Ae,se){if(Ae||!se)return z(Ae);if(typeof se!="object")return z(new Error("Input data given to '"+oe.source+"' is not a valid GeoJSON object."));(function Jt(Rr,Ln){var Mn,$t=Rr&&Rr.type;if($t==="FeatureCollection")for(Mn=0;Mn<Rr.features.length;Mn++)Jt(Rr.features[Mn],Ln);else if($t==="GeometryCollection")for(Mn=0;Mn<Rr.geometries.length;Mn++)Jt(Rr.geometries[Mn],Ln);else if($t==="Feature")Jt(Rr.geometry,Ln);else if($t==="Polygon")Yt(Rr.coordinates,Ln);else if($t==="MultiPolygon")for(Mn=0;Mn<Rr.coordinates.length;Mn++)Yt(Rr.coordinates[Mn],Ln);return Rr})(se,!0);try{if(oe.filter){var Ce=d.createExpression(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ce.result==="error")throw new Error(Ce.value.map(function(Jt){return Jt.key+": "+Jt.message}).join(", "));var ct=se.features.filter(function(Jt){return Ce.value.evaluate({zoom:0},Jt)});se={type:"FeatureCollection",features:ct}}ye._geoJSONIndex=oe.cluster?new yn(function(Jt){var Rr=Jt.superclusterOptions,Ln=Jt.clusterProperties;if(!Ln||!Rr)return Rr;for(var Mn={},$t={},bn={accumulated:null,zoom:0},on={properties:null},un=Object.keys(Ln),wi=0,xn=un;wi<xn.length;wi+=1){var Oi=xn[wi],Yi=Ln[Oi],oi=Yi[0],Ki=d.createExpression(Yi[1]),zi=d.createExpression(typeof oi=="string"?[oi,["accumulated"],["get",Oi]]:oi);Mn[Oi]=Ki.value,$t[Oi]=zi.value}return Rr.map=function(Ai){on.properties=Ai;for(var ca={},ba=0,ai=un;ba<ai.length;ba+=1){var ti=ai[ba];ca[ti]=Mn[ti].evaluate(bn,on)}return ca},Rr.reduce=function(Ai,ca){on.properties=ca;for(var ba=0,ai=un;ba<ai.length;ba+=1){var ti=ai[ba];bn.accumulated=Ai[ti],Ai[ti]=$t[ti].evaluate(bn,on)}},Rr}(oe)).load(se.features):function(Jt,Rr){return new bi(Jt,Rr)}(se,oe.geojsonVtOptions)}catch(Jt){return z(Jt)}ye.loaded={};var xr={};if(me){var Gt=me.finish();Gt&&(xr.resourceTiming={},xr.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Gt)))}z(null,xr)})}},ce.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ce.prototype.reloadTile=function(ye,z){var oe=this.loaded;return oe&&oe[ye.uid]?Y.prototype.reloadTile.call(this,ye,z):this.loadTile(ye,z)},ce.prototype.loadGeoJSON=function(ye,z){if(ye.request)d.getJSON(ye.request,z);else{if(typeof ye.data!="string")return z(new Error("Input data given to '"+ye.source+"' is not a valid GeoJSON object."));try{return z(null,JSON.parse(ye.data))}catch(oe){return z(new Error("Input data given to '"+ye.source+"' is not a valid GeoJSON object."))}}},ce.prototype.removeSource=function(ye,z){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),z()},ce.prototype.getClusterExpansionZoom=function(ye,z){try{z(null,this._geoJSONIndex.getClusterExpansionZoom(ye.clusterId))}catch(oe){z(oe)}},ce.prototype.getClusterChildren=function(ye,z){try{z(null,this._geoJSONIndex.getChildren(ye.clusterId))}catch(oe){z(oe)}},ce.prototype.getClusterLeaves=function(ye,z){try{z(null,this._geoJSONIndex.getLeaves(ye.clusterId,ye.limit,ye.offset))}catch(oe){z(oe)}},ce}(Ye),Ii=function(Y){var ce=this;this.self=Y,this.actor=new d.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ye,geojson:Ri},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ye,z){if(ce.workerSourceTypes[ye])throw new Error('Worker source with name "'+ye+'" already registered.');ce.workerSourceTypes[ye]=z},this.self.registerRTLTextPlugin=function(ye){if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=ye.applyArabicShaping,d.plugin.processBidirectionalText=ye.processBidirectionalText,d.plugin.processStyledBidirectionalText=ye.processStyledBidirectionalText}};return Ii.prototype.setReferrer=function(Y,ce){this.referrer=ce},Ii.prototype.setImages=function(Y,ce,ye){for(var z in this.availableImages[Y]=ce,this.workerSources[Y]){var oe=this.workerSources[Y][z];for(var me in oe)oe[me].availableImages=ce}ye()},Ii.prototype.setLayers=function(Y,ce,ye){this.getLayerIndex(Y).replace(ce),ye()},Ii.prototype.updateLayers=function(Y,ce,ye){this.getLayerIndex(Y).update(ce.layers,ce.removedIds),ye()},Ii.prototype.loadTile=function(Y,ce,ye){this.getWorkerSource(Y,ce.type,ce.source).loadTile(ce,ye)},Ii.prototype.loadDEMTile=function(Y,ce,ye){this.getDEMWorkerSource(Y,ce.source).loadTile(ce,ye)},Ii.prototype.reloadTile=function(Y,ce,ye){this.getWorkerSource(Y,ce.type,ce.source).reloadTile(ce,ye)},Ii.prototype.abortTile=function(Y,ce,ye){this.getWorkerSource(Y,ce.type,ce.source).abortTile(ce,ye)},Ii.prototype.removeTile=function(Y,ce,ye){this.getWorkerSource(Y,ce.type,ce.source).removeTile(ce,ye)},Ii.prototype.removeDEMTile=function(Y,ce){this.getDEMWorkerSource(Y,ce.source).removeTile(ce)},Ii.prototype.removeSource=function(Y,ce,ye){if(this.workerSources[Y]&&this.workerSources[Y][ce.type]&&this.workerSources[Y][ce.type][ce.source]){var z=this.workerSources[Y][ce.type][ce.source];delete this.workerSources[Y][ce.type][ce.source],z.removeSource!==void 0?z.removeSource(ce,ye):ye()}},Ii.prototype.loadWorkerSource=function(Y,ce,ye){try{this.self.importScripts(ce.url),ye()}catch(z){ye(z.toString())}},Ii.prototype.syncRTLPluginState=function(Y,ce,ye){try{d.plugin.setState(ce);var z=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&z!=null){this.self.importScripts(z);var oe=d.plugin.isParsed();ye(oe?void 0:new Error("RTL Text Plugin failed to import scripts from "+z),oe)}}catch(me){ye(me.toString())}},Ii.prototype.getAvailableImages=function(Y){var ce=this.availableImages[Y];return ce||(ce=[]),ce},Ii.prototype.getLayerIndex=function(Y){var ce=this.layerIndexes[Y];return ce||(ce=this.layerIndexes[Y]=new K),ce},Ii.prototype.getWorkerSource=function(Y,ce,ye){var z=this;return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][ce]||(this.workerSources[Y][ce]={}),this.workerSources[Y][ce][ye]||(this.workerSources[Y][ce][ye]=new this.workerSourceTypes[ce]({send:function(oe,me,Ae){z.actor.send(oe,me,Ae,Y)}},this.getLayerIndex(Y),this.getAvailableImages(Y))),this.workerSources[Y][ce][ye]},Ii.prototype.getDEMWorkerSource=function(Y,ce){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ce]||(this.demWorkerSources[Y][ce]=new rt),this.demWorkerSources[Y][ce]},Ii.prototype.enforceCacheSizeLimit=function(Y,ce){d.enforceCacheSizeLimit(ce)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ii(self)),Ii}),C(["./shared"],function(d){"use strict";var A=d.createCommonjsModule(function(i){function u(g){return!o(g)}function o(g){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,D,H=new Blob([""],{type:"text/javascript"}),ae=URL.createObjectURL(H);try{D=new Worker(ae),P=!0}catch(Se){P=!1}return D&&D.terminate(),URL.revokeObjectURL(ae),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var D=P.getContext("2d");if(!D)return!1;var H=D.getImageData(0,0,1,1);return H&&H.width===P.width}()?(h[b=g&&g.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(P){var D=function(ae){var Se=document.createElement("canvas"),we=Object.create(u.webGLContextAttributes);return we.failIfMajorPerformanceCaveat=ae,Se.probablySupportsContext?Se.probablySupportsContext("webgl",we)||Se.probablySupportsContext("experimental-webgl",we):Se.supportsContext?Se.supportsContext("webgl",we)||Se.supportsContext("experimental-webgl",we):Se.getContext("webgl",we)||Se.getContext("experimental-webgl",we)}(P);if(!D)return!1;var H=D.createShader(D.VERTEX_SHADER);return!(!H||D.isContextLost())&&(D.shaderSource(H,"void main() {}"),D.compileShader(H),D.getShaderParameter(H,D.COMPILE_STATUS)===!0)}(b)),h[b]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var b}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=o);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Q={create:function(i,u,o){var h=d.window.document.createElement(i);return u!==void 0&&(h.className=u),o&&o.appendChild(h),h},createNS:function(i,u){return d.window.document.createElementNS(i,u)}},K=d.window.document&&d.window.document.documentElement.style;function W(i){if(!K)return i[0];for(var u=0;u<i.length;u++)if(i[u]in K)return i[u];return i[0]}var L,N=W(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Q.disableDrag=function(){K&&N&&(L=K[N],K[N]="none")},Q.enableDrag=function(){K&&N&&(K[N]=L)};var Ne=W(["transform","WebkitTransform"]);Q.setTransform=function(i,u){i.style[Ne]=u};var Ye=!1;try{var Je=Object.defineProperty({},"passive",{get:function(){Ye=!0}});d.window.addEventListener("test",Je,Je),d.window.removeEventListener("test",Je,Je)}catch(i){Ye=!1}Q.addEventListener=function(i,u,o,h){h===void 0&&(h={}),i.addEventListener(u,o,"passive"in h&&Ye?h:h.capture)},Q.removeEventListener=function(i,u,o,h){h===void 0&&(h={}),i.removeEventListener(u,o,"passive"in h&&Ye?h:h.capture)};var rt=function(i){i.preventDefault(),i.stopPropagation(),d.window.removeEventListener("click",rt,!0)};function Yt(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}Q.suppressClick=function(){d.window.addEventListener("click",rt,!0),d.window.setTimeout(function(){d.window.removeEventListener("click",rt,!0)},0)},Q.mousePos=function(i,u){var o=i.getBoundingClientRect();return new d.Point(u.clientX-o.left-i.clientLeft,u.clientY-o.top-i.clientTop)},Q.touchPos=function(i,u){for(var o=i.getBoundingClientRect(),h=[],g=0;g<u.length;g++)h.push(new d.Point(u[g].clientX-o.left-i.clientLeft,u[g].clientY-o.top-i.clientTop));return h},Q.mouseButton=function(i){return d.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},Q.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var Vt=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,g=this.requestors;h<g.length;h+=1){var b=g[h];this._notify(b.ids,b.callback)}this.requestors=[]}},u.prototype.getImage=function(o){return this.images[o]},u.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},u.prototype._validate=function(o,h){var g=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),g=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),g=!1),this._validateContent(h.content,h)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),g=!1),g},u.prototype._validateStretch=function(o,h){if(!o)return!0;for(var g=0,b=0,P=o;b<P.length;b+=1){var D=P[b];if(D[0]<g||D[1]<D[0]||h<D[1])return!1;g=D[1]}return!0},u.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},u.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},u.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(o,h){var g=!0;if(!this.isLoaded())for(var b=0,P=o;b<P.length;b+=1)this.images[P[b]]||(g=!1);this.isLoaded()||g?this._notify(o,h):this.requestors.push({ids:o,callback:h})},u.prototype._notify=function(o,h){for(var g={},b=0,P=o;b<P.length;b+=1){var D=P[b];this.images[D]||this.fire(new d.Event("styleimagemissing",{id:D}));var H=this.images[D];H?g[D]={data:H.data.clone(),pixelRatio:H.pixelRatio,sdf:H.sdf,version:H.version,stretchX:H.stretchX,stretchY:H.stretchY,content:H.content,hasRenderCallback:Boolean(H.userImage&&H.userImage.render)}:d.warnOnce('Image "'+D+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,g)},u.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},u.prototype.getPattern=function(o){var h=this.patterns[o],g=this.getImage(o);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{var b={w:g.data.width+2,h:g.data.height+2,x:0,y:0},P=new d.ImagePosition(b,g);this.patterns[o]={bin:b,position:P}}return this._updatePatternAtlas(),this.patterns[o].position},u.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var g=d.potpack(o),b=g.w,P=g.h,D=this.atlasImage;for(var H in D.resize({width:b||1,height:P||1}),this.patterns){var ae=this.patterns[H].bin,Se=ae.x+1,we=ae.y+1,Pe=this.images[H].data,He=Pe.width,je=Pe.height;d.RGBAImage.copy(Pe,D,{x:0,y:0},{x:Se,y:we},{width:He,height:je}),d.RGBAImage.copy(Pe,D,{x:0,y:je-1},{x:Se,y:we-1},{width:He,height:1}),d.RGBAImage.copy(Pe,D,{x:0,y:0},{x:Se,y:we+je},{width:He,height:1}),d.RGBAImage.copy(Pe,D,{x:He-1,y:0},{x:Se-1,y:we},{width:1,height:je}),d.RGBAImage.copy(Pe,D,{x:0,y:0},{x:Se+He,y:we},{width:1,height:je})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(o){for(var h=0,g=o;h<g.length;h+=1){var b=g[h];if(!this.callbackDispatchedThisFrame[b]){this.callbackDispatchedThisFrame[b]=!0;var P=this.images[b];Yt(P)&&this.updateImage(b,P)}}},u}(d.Evented),tr=xt,zt=xt,Tt=1e20;function xt(i,u,o,h,g,b){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=g||"sans-serif",this.fontWeight=b||"normal",this.radius=o||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function yr(i,u,o,h,g,b,P){for(var D=0;D<u;D++){for(var H=0;H<o;H++)h[H]=i[H*u+D];for(ee(h,g,b,P,o),H=0;H<o;H++)i[H*u+D]=g[H]}for(H=0;H<o;H++){for(D=0;D<u;D++)h[D]=i[H*u+D];for(ee(h,g,b,P,u),D=0;D<u;D++)i[H*u+D]=Math.sqrt(g[D])}}function ee(i,u,o,h,g){o[0]=0,h[0]=-Tt,h[1]=+Tt;for(var b=1,P=0;b<g;b++){for(var D=(i[b]+b*b-(i[o[P]]+o[P]*o[P]))/(2*b-2*o[P]);D<=h[P];)P--,D=(i[b]+b*b-(i[o[P]]+o[P]*o[P]))/(2*b-2*o[P]);o[++P]=b,h[P]=D,h[P+1]=+Tt}for(b=0,P=0;b<g;b++){for(;h[P+1]<b;)P++;u[b]=(b-o[P])*(b-o[P])+i[o[P]]}}xt.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var g=u.data[4*h+3]/255;this.gridOuter[h]=g===1?0:g===0?Tt:Math.pow(Math.max(0,.5-g),2),this.gridInner[h]=g===1?Tt:g===0?0:Math.pow(Math.max(0,g-.5),2)}for(yr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),yr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},tr.default=zt;var dr=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};dr.prototype.setURL=function(i){this.url=i},dr.prototype.getGlyphs=function(i,u){var o=this,h=[];for(var g in i)for(var b=0,P=i[g];b<P.length;b+=1)h.push({stack:g,id:P[b]});d.asyncAll(h,function(D,H){var ae=D.stack,Se=D.id,we=o.entries[ae];we||(we=o.entries[ae]={glyphs:{},requests:{},ranges:{}});var Pe=we.glyphs[Se];if(Pe===void 0){if(Pe=o._tinySDF(we,ae,Se))return we.glyphs[Se]=Pe,void H(null,{stack:ae,id:Se,glyph:Pe});var He=Math.floor(Se/256);if(256*He>65535)H(new Error("glyphs > 65535 not supported"));else if(we.ranges[He])H(null,{stack:ae,id:Se,glyph:Pe});else{var je=we.requests[He];je||(je=we.requests[He]=[],dr.loadGlyphRange(ae,He,o.url,o.requestManager,function(it,ze){if(ze){for(var ot in ze)o._doesCharSupportLocalGlyph(+ot)||(we.glyphs[+ot]=ze[+ot]);we.ranges[He]=!0}for(var bt=0,Zt=je;bt<Zt.length;bt+=1)(0,Zt[bt])(it,ze);delete we.requests[He]})),je.push(function(it,ze){it?H(it):ze&&H(null,{stack:ae,id:Se,glyph:ze[Se]||null})})}}else H(null,{stack:ae,id:Se,glyph:Pe})},function(D,H){if(D)u(D);else if(H){for(var ae={},Se=0,we=H;Se<we.length;Se+=1){var Pe=we[Se],He=Pe.stack,je=Pe.id,it=Pe.glyph;(ae[He]||(ae[He]={}))[je]=it&&{id:it.id,bitmap:it.bitmap.clone(),metrics:it.metrics}}u(null,ae)}})},dr.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(d.isChar["CJK Unified Ideographs"](i)||d.isChar["Hangul Syllables"](i)||d.isChar.Hiragana(i)||d.isChar.Katakana(i))},dr.prototype._tinySDF=function(i,u,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var g=i.tinySDF;if(!g){var b="400";/bold/i.test(u)?b="900":/medium/i.test(u)?b="500":/light/i.test(u)&&(b="200"),g=i.tinySDF=new dr.TinySDF(24,3,8,.25,h,b)}return{id:o,bitmap:new d.AlphaImage({width:30,height:30},g.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},dr.loadGlyphRange=function(i,u,o,h,g){var b=256*u,P=b+255,D=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",b+"-"+P),d.ResourceType.Glyphs);d.getArrayBuffer(D,function(H,ae){if(H)g(H);else if(ae){for(var Se={},we=0,Pe=d.parseGlyphPBF(ae);we<Pe.length;we+=1){var He=Pe[we];Se[He.id]=He}g(null,Se)}})},dr.TinySDF=tr;var Ct=function(){this.specification=d.styleSpec.light.position};Ct.prototype.possiblyEvaluate=function(i,u){return d.sphericalToCartesian(i.expression.evaluate(u))},Ct.prototype.interpolate=function(i,u,o){return{x:d.number(i.x,u.x,o),y:d.number(i.y,u.y,o),z:d.number(i.z,u.z,o)}};var Ke=new d.Properties({anchor:new d.DataConstantProperty(d.styleSpec.light.anchor),position:new Ct,color:new d.DataConstantProperty(d.styleSpec.light.color),intensity:new d.DataConstantProperty(d.styleSpec.light.intensity)}),Dt=function(i){function u(o){i.call(this),this._transitionable=new d.Transitionable(Ke),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(d.validateLight,o,h))for(var g in o){var b=o[g];d.endsWith(g,"-transition")?this._transitionable.setTransition(g.slice(0,-"-transition".length),b):this._transitionable.setValue(g,b)}},u.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},u.prototype._validate=function(o,h,g){return(!g||g.validate!==!1)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.styleSpec})))},u}(d.Evented),Xe=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Xe.prototype.getDash=function(i,u){var o=i.join(",")+String(u);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(i,u)),this.dashEntry[o]},Xe.prototype.getDashRanges=function(i,u,o){var h=[],g=i.length%2==1?-i[i.length-1]*o:0,b=i[0]*o,P=!0;h.push({left:g,right:b,isDash:P,zeroLength:i[0]===0});for(var D=i[0],H=1;H<i.length;H++){var ae=i[H];h.push({left:g=D*o,right:b=(D+=ae)*o,isDash:P=!P,zeroLength:ae===0})}return h},Xe.prototype.addRoundDash=function(i,u,o){for(var h=u/2,g=-o;g<=o;g++)for(var b=this.width*(this.nextRow+o+g),P=0,D=i[P],H=0;H<this.width;H++){H/D.right>1&&(D=i[++P]);var ae=Math.abs(H-D.left),Se=Math.abs(H-D.right),we=Math.min(ae,Se),Pe=void 0,He=g/o*(h+1);if(D.isDash){var je=h-Math.abs(He);Pe=Math.sqrt(we*we+je*je)}else Pe=h-Math.sqrt(we*we+He*He);this.data[b+H]=Math.max(0,Math.min(255,Pe+128))}},Xe.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var o=i[u],h=i[u+1];o.zeroLength?i.splice(u,1):h&&h.isDash===o.isDash&&(h.left=o.left,i.splice(u,1))}var g=i[0],b=i[i.length-1];g.isDash===b.isDash&&(g.left=b.left-this.width,b.right=g.right+this.width);for(var P=this.width*this.nextRow,D=0,H=i[D],ae=0;ae<this.width;ae++){ae/H.right>1&&(H=i[++D]);var Se=Math.abs(ae-H.left),we=Math.abs(ae-H.right),Pe=Math.min(Se,we);this.data[P+ae]=Math.max(0,Math.min(255,(H.isDash?Pe:-Pe)+128))}},Xe.prototype.addDash=function(i,u){var o=u?7:0,h=2*o+1;if(this.nextRow+h>this.height)return d.warnOnce("LineAtlas out of space"),null;for(var g=0,b=0;b<i.length;b++)g+=i[b];if(g!==0){var P=this.width/g,D=this.getDashRanges(i,this.width,P);u?this.addRoundDash(D,P,o):this.addRegularDash(D)}var H={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:g};return this.nextRow+=h,this.dirty=!0,H},Xe.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Ut=function i(u,o){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=d.uniqueId();for(var h=this.workerPool.acquire(this.id),g=0;g<h.length;g++){var b=new i.Actor(h[g],o,this.id);b.name="Worker "+g,this.actors.push(b)}};function _r(i,u,o){var h=function(g,b){if(g)return o(g);if(b){var P=d.pick(d.extend(b,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(P.vectorLayers=b.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(D){return D.id})),P.tiles=u.canonicalizeTileset(P,i.url),o(null,P)}};return i.url?d.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),d.ResourceType.Source),h):d.browser.frame(function(){return h(null,i)})}Ut.prototype.broadcast=function(i,u,o){d.asyncAll(this.actors,function(h,g){h.send(i,u,g)},o=o||function(){})},Ut.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Ut.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},Ut.Actor=d.Actor;var ar=function(i,u,o){this.bounds=d.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=o||24};ar.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},ar.prototype.contains=function(i){var u=Math.pow(2,i.z),o=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),g=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),b=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=o&&i.x<g&&i.y>=h&&i.y<b};var zr=function(i){function u(o,h,g,b){if(i.call(this),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(h,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,function(h,g){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new d.ErrorEvent(h)):g&&(d.extend(o,g),g.bounds&&(o.tileBounds=new ar(g.bounds,o.minzoom,o.maxzoom)),d.postTurnstileEvent(g.tiles,o.map._requestManager._customAccessToken),d.postMapLoadEvent(g.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},u.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.loadTile=function(o,h){var g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(g,d.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(D,H){return delete o.request,o.aborted?h(null):D&&D.status!==404?h(D):(H&&H.resourceTiming&&(o.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&o.setExpiryData(H),o.loadVectorData(H,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}b.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",b,P.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",b,P.bind(this)))},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(d.Evented),fe=function(i){function u(o,h,g,b){i.call(this),this.id=o,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},h),d.extend(this,d.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=_r(this._options,this.map._requestManager,function(h,g){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new d.ErrorEvent(h)):g&&(d.extend(o,g),g.bounds&&(o.tileBounds=new ar(g.bounds,o.minzoom,o.maxzoom)),d.postTurnstileEvent(g.tiles),d.postMapLoadEvent(g.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.loadTile=function(o,h){var g=this,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(b,d.ResourceType.Tile),function(P,D){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(D){g.map._refreshExpiredTiles&&o.setExpiryData(D),delete D.cacheControl,delete D.expires;var H=g.map.painter.context,ae=H.gl;o.texture=g.map.painter.getTileTexture(D.width),o.texture?o.texture.update(D,{useMipmap:!0}):(o.texture=new d.Texture(H,D,ae.RGBA,{useMipmap:!0}),o.texture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE,ae.LINEAR_MIPMAP_NEAREST),H.extTextureFilterAnisotropic&&ae.texParameterf(ae.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax)),o.state="loaded",d.cacheEntryPossiblyAdded(g.dispatcher),h(null)}})},u.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},u.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},u.prototype.hasTransition=function(){return!1},u}(d.Evented),Re=function(i){function u(o,h,g,b){i.call(this,o,h,g,b),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(o,h){var g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function b(P,D){P&&(o.state="errored",h(P)),D&&(o.dem=D,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=d.getImage(this.map._requestManager.transformRequest(g,d.ResourceType.Tile),function(P,D){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(P)o.state="errored",h(P);else if(D){this.map._refreshExpiredTiles&&o.setExpiryData(D),delete D.cacheControl,delete D.expires;var H=d.window.ImageBitmap&&D instanceof d.window.ImageBitmap&&d.offscreenCanvasSupported()?D:d.browser.getImageData(D,1),ae={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:H,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",ae,b.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},u.prototype._getNeighboringTiles=function(o){var h=o.canonical,g=Math.pow(2,h.z),b=(h.x-1+g)%g,P=h.x===0?o.wrap-1:o.wrap,D=(h.x+1+g)%g,H=h.x+1===g?o.wrap+1:o.wrap,ae={};return ae[new d.OverscaledTileID(o.overscaledZ,P,h.z,b,h.y).key]={backfilled:!1},ae[new d.OverscaledTileID(o.overscaledZ,H,h.z,D,h.y).key]={backfilled:!1},h.y>0&&(ae[new d.OverscaledTileID(o.overscaledZ,P,h.z,b,h.y-1).key]={backfilled:!1},ae[new d.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ae[new d.OverscaledTileID(o.overscaledZ,H,h.z,D,h.y-1).key]={backfilled:!1}),h.y+1<g&&(ae[new d.OverscaledTileID(o.overscaledZ,P,h.z,b,h.y+1).key]={backfilled:!1},ae[new d.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ae[new d.OverscaledTileID(o.overscaledZ,H,h.z,D,h.y+1).key]={backfilled:!1}),ae},u.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},u}(fe),ge=function(i){function u(o,h,g,b){i.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(b),this._data=h.data,this._options=d.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var P=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*P,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*P,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:d.EXTENT,radius:(h.clusterRadius||50)*P,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new d.ErrorEvent(h));else{var g={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(g.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new d.Event("data",g))}})},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)h.fire(new d.ErrorEvent(g));else{var b={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(b.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new d.Event("data",b))}}),this},u.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},u.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},u.prototype.getClusterLeaves=function(o,h,g,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:g},b),this},u.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var g=d.extend({},this.workerOptions),b=this._data;typeof b=="string"?(g.request=this.map._requestManager.transformRequest(d.browser.resolveURL(b),d.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(b),this.actor.send(this.type+".loadData",g,function(P,D){h._removed||D&&D.abandoned||(h._loaded=!0,D&&D.resourceTiming&&D.resourceTiming[h.id]&&(h._resourceTiming=D.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:g.source},null),o(P))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(o,h){var g=this,b=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(b,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,D){return delete o.request,o.unloadVectorData(),o.aborted?h(null):P?h(P):(o.loadVectorData(D,g.map.painter,b==="reloadTile"),h(null))})},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},u.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return d.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(d.Evented),_t=d.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),pt=function(i){function u(o,h,g,b){i.call(this),this.id=o,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(o,h){var g=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),function(b,P){g._loaded=!0,b?g.fire(new d.ErrorEvent(b)):P&&(g.image=P,o&&(g.coordinates=o),h&&h(),g._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var g=o.map(d.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var D=1/0,H=1/0,ae=-1/0,Se=-1/0,we=0,Pe=P;we<Pe.length;we+=1){var He=Pe[we];D=Math.min(D,He.x),H=Math.min(H,He.y),ae=Math.max(ae,He.x),Se=Math.max(Se,He.y)}var je=Math.max(ae-D,Se-H),it=Math.max(0,Math.floor(-Math.log(je)/Math.LN2)),ze=Math.pow(2,it);return new d.CanonicalTileID(it,Math.floor((D+ae)/2*ze),Math.floor((H+Se)/2*ze))}(g),this.minzoom=this.maxzoom=this.tileID.z;var b=g.map(function(P){return h.tileID.getTilePoint(P)._round()});return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(d.Evented),Nt=function(i){function u(o,h,g,b){i.call(this,o,h,g,b),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var g=0,b=h.urls;g<b.length;g+=1)this.urls.push(this.map._requestManager.transformRequest(b[g],d.ResourceType.Source).url);d.getVideo(this.urls,function(P,D){o._loaded=!0,P?o.fire(new d.ErrorEvent(P)):D&&(o.video=D,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var g in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(pt),Bt=function(i){function u(o,h,g,b){i.call(this,o,h,g,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(D){return typeof D!="number"})})||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,g=h.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,_t.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(h,this.canvas,g.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[b];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var g=h[o];if(isNaN(g)||g<=0)return!0}return!1},u}(pt),kr={vector:zr,raster:fe,"raster-dem":Re,geojson:ge,video:Nt,image:pt,canvas:Bt};function ln(i,u){var o=d.identity([]);return d.translate(o,o,[1,1,0]),d.scale(o,o,[.5*i.width,.5*i.height,1]),d.multiply(o,o,i.calculatePosMatrix(u.toUnwrapped()))}function yn(i,u,o,h,g,b){var P=function(it,ze,ot){if(it)for(var bt=0,Zt=it;bt<Zt.length;bt+=1){var fr=ze[Zt[bt]];if(fr&&fr.source===ot&&fr.type==="fill-extrusion")return!0}else for(var ur in ze){var gr=ze[ur];if(gr.source===ot&&gr.type==="fill-extrusion")return!0}return!1}(g&&g.layers,u,i.id),D=b.maxPitchScaleFactor(),H=i.tilesIn(h,D,P);H.sort(Vi);for(var ae=[],Se=0,we=H;Se<we.length;Se+=1){var Pe=we[Se];ae.push({wrappedTileID:Pe.tileID.wrapped().key,queryResults:Pe.tile.queryRenderedFeatures(u,o,i._state,Pe.queryGeometry,Pe.cameraQueryGeometry,Pe.scale,g,b,D,ln(i.transform,Pe.tileID))})}var He=function(it){for(var ze={},ot={},bt=0,Zt=it;bt<Zt.length;bt+=1){var fr=Zt[bt],ur=fr.queryResults,gr=fr.wrappedTileID,Nr=ot[gr]=ot[gr]||{};for(var an in ur)for(var Hr=ur[an],Rn=Nr[an]=Nr[an]||{},ri=ze[an]=ze[an]||[],hi=0,ni=Hr;hi<ni.length;hi+=1){var ea=ni[hi];Rn[ea.featureIndex]||(Rn[ea.featureIndex]=!0,ri.push(ea))}}return ze}(ae);for(var je in He)He[je].forEach(function(it){var ze=it.feature,ot=i.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=ot});return He}function Vi(i,u){var o=i.tileID,h=u.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var nr=function(i,u){this.max=i,this.onRemove=u,this.reset()};nr.prototype.reset=function(){for(var i in this.data)for(var u=0,o=this.data[i];u<o.length;u+=1){var h=o[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},nr.prototype.add=function(i,u,o){var h=this,g=i.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);var b={value:u,timeout:void 0};if(o!==void 0&&(b.timeout=setTimeout(function(){h.remove(i,b)},o)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},nr.prototype.has=function(i){return i.wrapped().key in this.data},nr.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},nr.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},nr.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},nr.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},nr.prototype.remove=function(i,u){if(!this.has(i))return this;var o=i.wrapped().key,h=u===void 0?0:this.data[o].indexOf(u),g=this.data[o][h];return this.data[o].splice(h,1),g.timeout&&clearTimeout(g.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(g.value),this.order.splice(this.order.indexOf(o),1),this},nr.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},nr.prototype.filter=function(i){var u=[];for(var o in this.data)for(var h=0,g=this.data[o];h<g.length;h+=1){var b=g[h];i(b.value)||u.push(b)}for(var P=0,D=u;P<D.length;P+=1){var H=D[P];this.remove(H.value.tileID,H)}};var de=function(i,u,o){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};de.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},de.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},de.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Te={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ue=function(i,u,o,h){this.length=u.length,this.attributes=o,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var g=i.gl;this.buffer=g.createBuffer(),i.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ue.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ue.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},Ue.prototype.enableAttributes=function(i,u){for(var o=0;o<this.attributes.length;o++){var h=u.attributes[this.attributes[o].name];h!==void 0&&i.enableVertexAttribArray(h)}},Ue.prototype.setVertexAttribPointers=function(i,u,o){for(var h=0;h<this.attributes.length;h++){var g=this.attributes[h],b=u.attributes[g.name];b!==void 0&&i.vertexAttribPointer(b,g.components,i[Te[g.type]],!1,this.itemSize,g.offset+this.itemSize*(o||0))}},Ue.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Le=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Le.prototype.get=function(){return this.current},Le.prototype.set=function(i){},Le.prototype.getDefault=function(){return this.default},Le.prototype.setDefault=function(){this.set(this.default)};var Ft=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Le),er=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},u}(Le),w=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},u}(Le),Z=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Le),Ee=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},u}(Le),Ze=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},u}(Le),Qe=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},u}(Le),yt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},u}(Le),St=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},u}(Le),jt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Le),Et=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},u}(Le),Qt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},u}(Le),ie=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},u}(Le),sr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Le),Br=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Le),Lr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},u}(Le),nt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},u}(Le),gt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},u}(Le),vt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},u}(Le),hr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},u}(Le),Vr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},u}(Le),Ur=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Le),nn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},u}(Le),Jr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Le),Cr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},u}(Le),Dn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},u}(Le),Hn=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},u}(Le),bi=function(i){function u(o){i.call(this,o),this.vao=o.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},u}(Le),Ui=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},u}(Le),Ji=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},u}(Le),Ri=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},u}(Le),Ii=function(i){function u(o,h){i.call(this,o),this.context=o,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Le),Y=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},u}(Ii),ce=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Ii),ye=function(i,u,o,h){this.context=i,this.width=u,this.height=o;var g=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Y(i,g),h&&(this.depthAttachment=new ce(i,g))};ye.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}i.deleteFramebuffer(this.framebuffer)};var z=function(i,u,o){this.func=i,this.mask=u,this.range=o};z.ReadOnly=!1,z.ReadWrite=!0,z.disabled=new z(519,z.ReadOnly,[0,1]);var oe=function(i,u,o,h,g,b){this.test=i,this.ref=u,this.mask=o,this.fail=h,this.depthFail=g,this.pass=b};oe.disabled=new oe({func:519,mask:0},0,0,7680,7680,7680);var me=function(i,u,o){this.blendFunction=i,this.blendColor=u,this.mask=o};me.disabled=new me(me.Replace=[1,0],d.Color.transparent,[!1,!1,!1,!1]),me.unblended=new me(me.Replace,d.Color.transparent,[!0,!0,!0,!0]),me.alphaBlended=new me([1,771],d.Color.transparent,[!0,!0,!0,!0]);var Ae=function(i,u,o){this.enable=i,this.mode=u,this.frontFace=o};Ae.disabled=new Ae(!1,1029,2305),Ae.backCCW=new Ae(!0,1029,2305);var se=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ft(this),this.clearDepth=new er(this),this.clearStencil=new w(this),this.colorMask=new Z(this),this.depthMask=new Ee(this),this.stencilMask=new Ze(this),this.stencilFunc=new Qe(this),this.stencilOp=new yt(this),this.stencilTest=new St(this),this.depthRange=new jt(this),this.depthTest=new Et(this),this.depthFunc=new Qt(this),this.blend=new ie(this),this.blendFunc=new sr(this),this.blendColor=new Br(this),this.blendEquation=new Lr(this),this.cullFace=new nt(this),this.cullFaceSide=new gt(this),this.frontFace=new vt(this),this.program=new hr(this),this.activeTexture=new Vr(this),this.viewport=new Ur(this),this.bindFramebuffer=new nn(this),this.bindRenderbuffer=new Jr(this),this.bindTexture=new Cr(this),this.bindVertexBuffer=new Dn(this),this.bindElementBuffer=new Hn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new bi(this),this.pixelStoreUnpack=new Ui(this),this.pixelStoreUnpackPremultiplyAlpha=new Ji(this),this.pixelStoreUnpackFlipY=new Ri(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};se.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},se.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},se.prototype.createIndexBuffer=function(i,u){return new de(this,i,u)},se.prototype.createVertexBuffer=function(i,u,o){return new Ue(this,i,u,o)},se.prototype.createRenderbuffer=function(i,u,o){var h=this.gl,g=h.createRenderbuffer();return this.bindRenderbuffer.set(g),h.renderbufferStorage(h.RENDERBUFFER,i,u,o),this.bindRenderbuffer.set(null),g},se.prototype.createFramebuffer=function(i,u,o){return new ye(this,i,u,o)},se.prototype.clear=function(i){var u=i.color,o=i.depth,h=this.gl,g=0;u&&(g|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(g|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(g)},se.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},se.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},se.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},se.prototype.setColorMode=function(i){d.deepEqual(i.blendFunction,me.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},se.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ce=function(i){function u(o,h,g){var b=this;i.call(this),this.id=o,this.dispatcher=g,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(b._sourceLoaded=!0),b._sourceLoaded&&!b._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(b.reload(),b.transform&&b.update(b.transform))}),this.on("error",function(){b._sourceErrored=!0}),this._source=function(P,D,H,ae){var Se=new kr[D.type](P,D,H,ae);if(Se.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+Se.id);return d.bindAll(["load","abort","unload","serialize","prepare"],Se),Se}(o,h,g,this),this._tiles={},this._cache=new nr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new d.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},u.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},u.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},u.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var g=this._tiles[h];g.upload(o),g.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return d.values(this._tiles).map(function(o){return o.tileID}).sort(ct).map(function(o){return o.key})},u.prototype.getRenderableIds=function(o){var h=this,g=[];for(var b in this._tiles)this._isIdRenderable(b,o)&&g.push(this._tiles[b]);return o?g.sort(function(P,D){var H=P.tileID,ae=D.tileID,Se=new d.Point(H.canonical.x,H.canonical.y)._rotate(h.transform.angle),we=new d.Point(ae.canonical.x,ae.canonical.y)._rotate(h.transform.angle);return H.overscaledZ-ae.overscaledZ||we.y-Se.y||we.x-Se.x}).map(function(P){return P.tileID.key}):g.map(function(P){return P.tileID}).sort(ct).map(function(P){return P.key})},u.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},u.prototype._reloadTile=function(o,h){var g=this._tiles[o];g&&(g.state!=="loading"&&(g.state=h),this._loadTile(g,this._tileLoaded.bind(this,g,o,h)))},u.prototype._tileLoaded=function(o,h,g,b){if(b)return o.state="errored",void(b.status!==404?this._source.fire(new d.ErrorEvent(b,{tile:o})):this.update(this.transform));o.timeAdded=d.browser.now(),g==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new d.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},u.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),g=0;g<h.length;g++){var b=h[g];if(o.neighboringTiles&&o.neighboringTiles[b]){var P=this.getTileByID(b);D(o,P),D(P,o)}}function D(H,ae){H.needsHillshadePrepare=!0;var Se=ae.tileID.canonical.x-H.tileID.canonical.x,we=ae.tileID.canonical.y-H.tileID.canonical.y,Pe=Math.pow(2,H.tileID.canonical.z),He=ae.tileID.key;Se===0&&we===0||Math.abs(we)>1||(Math.abs(Se)>1&&(Math.abs(Se+Pe)===1?Se+=Pe:Math.abs(Se-Pe)===1&&(Se-=Pe)),ae.dem&&H.dem&&(H.dem.backfillBorder(ae.dem,Se,we),H.neighboringTiles&&H.neighboringTiles[He]&&(H.neighboringTiles[He].backfilled=!0)))}},u.prototype.getTile=function(o){return this.getTileByID(o.key)},u.prototype.getTileByID=function(o){return this._tiles[o]},u.prototype._retainLoadedChildren=function(o,h,g,b){for(var P in this._tiles){var D=this._tiles[P];if(!(b[P]||!D.hasData()||D.tileID.overscaledZ<=h||D.tileID.overscaledZ>g)){for(var H=D.tileID;D&&D.tileID.overscaledZ>h+1;){var ae=D.tileID.scaledTo(D.tileID.overscaledZ-1);(D=this._tiles[ae.key])&&D.hasData()&&(H=ae)}for(var Se=H;Se.overscaledZ>h;)if(o[(Se=Se.scaledTo(Se.overscaledZ-1)).key]){b[H.key]=H;break}}}},u.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var g=this._loadedParentTiles[o.key];return g&&g.tileID.overscaledZ>=h?g:null}for(var b=o.overscaledZ-1;b>=h;b--){var P=o.scaledTo(b),D=this._getLoadedTile(P);if(D)return D}},u.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},u.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,g=Math.ceil(o.height/this._source.tileSize)+1,b=Math.floor(h*g*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(P)},u.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var g={};for(var b in this._tiles){var P=this._tiles[b];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+h),g[P.tileID.key]=P}for(var D in this._tiles=g,this._timers)clearTimeout(this._timers[D]),delete this._timers[D];for(var H in this._tiles)this._setTileReloadTimer(H,this._tiles[H])}},u.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var g;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?g=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(Nr){return new d.OverscaledTileID(Nr.canonical.z,Nr.wrap,Nr.canonical.z,Nr.canonical.x,Nr.canonical.y)}):(g=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(g=g.filter(function(Nr){return h._source.hasTile(Nr)}))):g=[];var b=o.coveringZoomLevel(this._source),P=Math.max(b-u.maxOverzooming,this._source.minzoom),D=Math.max(b+u.maxUnderzooming,this._source.minzoom),H=this._updateRetainedTiles(g,b);if(xr(this._source.type)){for(var ae={},Se={},we=0,Pe=Object.keys(H);we<Pe.length;we+=1){var He=Pe[we],je=H[He],it=this._tiles[He];if(it&&!(it.fadeEndTime&&it.fadeEndTime<=d.browser.now())){var ze=this.findLoadedParent(je,P);ze&&(this._addTile(ze.tileID),ae[ze.tileID.key]=ze.tileID),Se[He]=je}}for(var ot in this._retainLoadedChildren(Se,b,D,H),ae)H[ot]||(this._coveredTiles[ot]=!0,H[ot]=ae[ot])}for(var bt in H)this._tiles[bt].clearFadeHold();for(var Zt=0,fr=d.keysDifference(this._tiles,H);Zt<fr.length;Zt+=1){var ur=fr[Zt],gr=this._tiles[ur];gr.hasSymbolBuckets&&!gr.holdingForFade()?gr.setHoldDuration(this.map._fadeDuration):gr.hasSymbolBuckets&&!gr.symbolFadeFinished()||this._removeTile(ur)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},u.prototype._updateRetainedTiles=function(o,h){for(var g={},b={},P=Math.max(h-u.maxOverzooming,this._source.minzoom),D=Math.max(h+u.maxUnderzooming,this._source.minzoom),H={},ae=0,Se=o;ae<Se.length;ae+=1){var we=Se[ae],Pe=this._addTile(we);g[we.key]=we,Pe.hasData()||h<this._source.maxzoom&&(H[we.key]=we)}this._retainLoadedChildren(H,h,D,g);for(var He=0,je=o;He<je.length;He+=1){var it=je[He],ze=this._tiles[it.key];if(!ze.hasData()){if(h+1>this._source.maxzoom){var ot=it.children(this._source.maxzoom)[0],bt=this.getTile(ot);if(bt&&bt.hasData()){g[ot.key]=ot;continue}}else{var Zt=it.children(this._source.maxzoom);if(g[Zt[0].key]&&g[Zt[1].key]&&g[Zt[2].key]&&g[Zt[3].key])continue}for(var fr=ze.wasRequested(),ur=it.overscaledZ-1;ur>=P;--ur){var gr=it.scaledTo(ur);if(b[gr.key]||(b[gr.key]=!0,!(ze=this.getTile(gr))&&fr&&(ze=this._addTile(gr)),ze&&(g[gr.key]=gr,fr=ze.wasRequested(),ze.hasData())))break}}}return g},u.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],g=void 0,b=this._tiles[o].tileID;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}h.push(b.key);var P=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(P))break;b=P}for(var D=0,H=h;D<H.length;D+=1)this._loadedParentTiles[H[D]]=g}},u.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var g=Boolean(h);return g||(h=new d.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,g||this._source.fire(new d.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(o,h){var g=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var b=h.getExpiryTimeout();b&&(this._timers[o]=setTimeout(function(){g._reloadTile(o,"expired"),delete g._timers[o]},b))},u.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},u.prototype.tilesIn=function(o,h,g){var b=this,P=[],D=this.transform;if(!D)return P;for(var H=g?D.getCameraQueryGeometry(o):o,ae=o.map(function(ur){return D.pointCoordinate(ur)}),Se=H.map(function(ur){return D.pointCoordinate(ur)}),we=this.getIds(),Pe=1/0,He=1/0,je=-1/0,it=-1/0,ze=0,ot=Se;ze<ot.length;ze+=1){var bt=ot[ze];Pe=Math.min(Pe,bt.x),He=Math.min(He,bt.y),je=Math.max(je,bt.x),it=Math.max(it,bt.y)}for(var Zt=function(ur){var gr=b._tiles[we[ur]];if(!gr.holdingForFade()){var Nr=gr.tileID,an=Math.pow(2,D.zoom-gr.tileID.overscaledZ),Hr=h*gr.queryPadding*d.EXTENT/gr.tileSize/an,Rn=[Nr.getTilePoint(new d.MercatorCoordinate(Pe,He)),Nr.getTilePoint(new d.MercatorCoordinate(je,it))];if(Rn[0].x-Hr<d.EXTENT&&Rn[0].y-Hr<d.EXTENT&&Rn[1].x+Hr>=0&&Rn[1].y+Hr>=0){var ri=ae.map(function(ni){return Nr.getTilePoint(ni)}),hi=Se.map(function(ni){return Nr.getTilePoint(ni)});P.push({tile:gr,tileID:Nr,queryGeometry:ri,cameraQueryGeometry:hi,scale:an})}}},fr=0;fr<we.length;fr++)Zt(fr);return P},u.prototype.getVisibleCoordinates=function(o){for(var h=this,g=this.getRenderableIds(o).map(function(H){return h._tiles[H].tileID}),b=0,P=g;b<P.length;b+=1){var D=P[b];D.posMatrix=this.transform.calculatePosMatrix(D.toUnwrapped())}return g},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(xr(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=d.browser.now())return!0}return!1},u.prototype.setFeatureState=function(o,h,g){this._state.updateState(o=o||"_geojsonTileLayer",h,g)},u.prototype.removeFeatureState=function(o,h,g){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,g)},u.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(o,h,g){var b=this._tiles[o];b&&b.setDependencies(h,g)},u.prototype.reloadTilesForDependencies=function(o,h){for(var g in this._tiles)this._tiles[g].hasDependency(o,h)&&this._reloadTile(g,"reloading");this._cache.filter(function(b){return!b.hasDependency(o,h)})},u}(d.Evented);function ct(i,u){var o=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-o||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function xr(i){return i==="raster"||i==="image"||i==="video"}function Gt(){return new d.window.Worker(Qu.workerUrl)}Ce.maxOverzooming=10,Ce.maxUnderzooming=3;var Jt="mapboxgl_preloaded_worker_pool",Rr=function(){this.active={}};Rr.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<Rr.workerCount;)this.workers.push(new Gt);return this.active[i]=!0,this.workers.slice()},Rr.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Rr.prototype.isPreloaded=function(){return!!this.active[Jt]},Rr.prototype.numActive=function(){return Object.keys(this.active).length};var Ln,Mn=Math.floor(d.browser.hardwareConcurrency/2);function $t(){return Ln||(Ln=new Rr),Ln}function bn(i,u){var o={};for(var h in i)h!=="ref"&&(o[h]=i[h]);return d.refProperties.forEach(function(g){g in u&&(o[g]=u[g])}),o}function on(i){i=i.slice();for(var u=Object.create(null),o=0;o<i.length;o++)u[i[o].id]=i[o];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=bn(i[h],u[i[h].ref]));return i}Rr.workerCount=Math.max(Math.min(Mn,6),1);var un={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function wi(i,u,o){o.push({command:un.addSource,args:[i,u[i]]})}function xn(i,u,o){u.push({command:un.removeSource,args:[i]}),o[i]=!0}function Oi(i,u,o,h){xn(i,o,h),wi(i,u,o)}function Yi(i,u,o){var h;for(h in i[o])if(i[o].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[o][h],u[o][h]))return!1;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[o][h],u[o][h]))return!1;return!0}function oi(i,u,o,h,g,b){var P;for(P in u=u||{},i=i||{})i.hasOwnProperty(P)&&(d.deepEqual(i[P],u[P])||o.push({command:b,args:[h,P,u[P],g]}));for(P in u)u.hasOwnProperty(P)&&!i.hasOwnProperty(P)&&(d.deepEqual(i[P],u[P])||o.push({command:b,args:[h,P,u[P],g]}))}function Ki(i){return i.id}function zi(i,u){return i[u.id]=u,i}var Ai=function(i,u){this.reset(i,u)};Ai.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Ai.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=d.clamp(i,0,1);for(var u=1,o=this._distances[u],h=i*this.paddedLength+this.padding;o<h&&u<this._distances.length;)o=this._distances[++u];var g=u-1,b=this._distances[g],P=o-b,D=P>0?(h-b)/P:0;return this.points[g].mult(1-D).add(this.points[u].mult(D))};var ca=function(i,u,o){var h=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(i/o),this.yCellCount=Math.ceil(u/o);for(var b=0;b<this.xCellCount*this.yCellCount;b++)h.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function ba(i,u,o,h,g){var b=d.create();return u?(d.scale(b,b,[1/g,1/g,1]),o||d.rotateZ(b,b,h.angle)):d.multiply(b,h.labelPlaneMatrix,i),b}function ai(i,u,o,h,g){if(u){var b=d.clone(i);return d.scale(b,b,[g,g,1]),o||d.rotateZ(b,b,-h.angle),b}return h.glCoordMatrix}function ti(i,u){var o=[i.x,i.y,0,1];Xa(o,o,u);var h=o[3];return{point:new d.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function Gi(i,u){return .5+i/u*.5}function da(i,u){var o=i[0]/i[3],h=i[1]/i[3];return o>=-u[0]&&o<=u[0]&&h>=-u[1]&&h<=u[1]}function Xo(i,u,o,h,g,b,P,D){var H=h?i.textSizeData:i.iconSizeData,ae=d.evaluateSizeForZoom(H,o.transform.zoom),Se=[256/o.width*2+1,256/o.height*2+1],we=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;we.clear();for(var Pe=i.lineVertexArray,He=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,je=o.transform.width/o.transform.height,it=!1,ze=0;ze<He.length;ze++){var ot=He.get(ze);if(ot.hidden||ot.writingMode===d.WritingMode.vertical&&!it)Wa(ot.numGlyphs,we);else{it=!1;var bt=[ot.anchorX,ot.anchorY,0,1];if(d.transformMat4(bt,bt,u),da(bt,Se)){var Zt=Gi(o.transform.cameraToCenterDistance,bt[3]),fr=d.evaluateSizeForFeature(H,ae,ot),ur=P?fr/Zt:fr*Zt,gr=new d.Point(ot.anchorX,ot.anchorY),Nr=ti(gr,g).point,an={},Hr=ga(ot,ur,!1,D,u,g,b,i.glyphOffsetArray,Pe,we,Nr,gr,an,je);it=Hr.useVertical,(Hr.notEnoughRoom||it||Hr.needsFlipping&&ga(ot,ur,!0,D,u,g,b,i.glyphOffsetArray,Pe,we,Nr,gr,an,je).notEnoughRoom)&&Wa(ot.numGlyphs,we)}else Wa(ot.numGlyphs,we)}}h?i.text.dynamicLayoutVertexBuffer.updateData(we):i.icon.dynamicLayoutVertexBuffer.updateData(we)}function ya(i,u,o,h,g,b,P,D,H,ae,Se){var we=D.glyphStartIndex+D.numGlyphs,Pe=D.lineStartIndex,He=D.lineStartIndex+D.lineLength,je=u.getoffsetX(D.glyphStartIndex),it=u.getoffsetX(we-1),ze=Sa(i*je,o,h,g,b,P,D.segment,Pe,He,H,ae,Se);if(!ze)return null;var ot=Sa(i*it,o,h,g,b,P,D.segment,Pe,He,H,ae,Se);return ot?{first:ze,last:ot}:null}function mi(i,u,o,h){return i===d.WritingMode.horizontal&&Math.abs(o.y-u.y)>Math.abs(o.x-u.x)*h?{useVertical:!0}:(i===d.WritingMode.vertical?u.y<o.y:u.x>o.x)?{needsFlipping:!0}:null}function ga(i,u,o,h,g,b,P,D,H,ae,Se,we,Pe,He){var je,it=u/24,ze=i.lineOffsetX*it,ot=i.lineOffsetY*it;if(i.numGlyphs>1){var bt=i.glyphStartIndex+i.numGlyphs,Zt=i.lineStartIndex,fr=i.lineStartIndex+i.lineLength,ur=ya(it,D,ze,ot,o,Se,we,i,H,b,Pe);if(!ur)return{notEnoughRoom:!0};var gr=ti(ur.first.point,P).point,Nr=ti(ur.last.point,P).point;if(h&&!o){var an=mi(i.writingMode,gr,Nr,He);if(an)return an}je=[ur.first];for(var Hr=i.glyphStartIndex+1;Hr<bt-1;Hr++)je.push(Sa(it*D.getoffsetX(Hr),ze,ot,o,Se,we,i.segment,Zt,fr,H,b,Pe));je.push(ur.last)}else{if(h&&!o){var Rn=ti(we,g).point,ri=i.lineStartIndex+i.segment+1,hi=new d.Point(H.getx(ri),H.gety(ri)),ni=ti(hi,g),ea=ni.signedDistanceFromCamera>0?ni.point:Gs(we,hi,Rn,1,g),Un=mi(i.writingMode,Rn,ea,He);if(Un)return Un}var gi=Sa(it*D.getoffsetX(i.glyphStartIndex),ze,ot,o,Se,we,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,H,b,Pe);if(!gi)return{notEnoughRoom:!0};je=[gi]}for(var te=0,q=je;te<q.length;te+=1){var R=q[te];d.addDynamicAttributes(ae,R.point,R.angle)}return{}}function Gs(i,u,o,h,g){var b=ti(i.add(i.sub(u)._unit()),g).point,P=o.sub(b);return o.add(P._mult(h/P.mag()))}function Sa(i,u,o,h,g,b,P,D,H,ae,Se,we){var Pe=h?i-u:i+u,He=Pe>0?1:-1,je=0;h&&(He*=-1,je=Math.PI),He<0&&(je+=Math.PI);for(var it=He>0?D+P:D+P+1,ze=g,ot=g,bt=0,Zt=0,fr=Math.abs(Pe),ur=[];bt+Zt<=fr;){if((it+=He)<D||it>=H)return null;if(ot=ze,ur.push(ze),(ze=we[it])===void 0){var gr=new d.Point(ae.getx(it),ae.gety(it)),Nr=ti(gr,Se);if(Nr.signedDistanceFromCamera>0)ze=we[it]=Nr.point;else{var an=it-He;ze=Gs(bt===0?b:new d.Point(ae.getx(an),ae.gety(an)),gr,ot,fr-bt+1,Se)}}bt+=Zt,Zt=ot.dist(ze)}var Hr=(fr-bt)/Zt,Rn=ze.sub(ot),ri=Rn.mult(Hr)._add(ot);ri._add(Rn._unit()._perp()._mult(o*He));var hi=je+Math.atan2(ze.y-ot.y,ze.x-ot.x);return ur.push(ri),{point:ri,angle:hi,path:ur}}ca.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ca.prototype.insert=function(i,u,o,h,g){this._forEachCell(u,o,h,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(g)},ca.prototype.insertCircle=function(i,u,o,h){this._forEachCell(u-h,o-h,u+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(o),this.circles.push(h)},ca.prototype._insertBoxCell=function(i,u,o,h,g,b){this.boxCells[g].push(b)},ca.prototype._insertCircleCell=function(i,u,o,h,g,b){this.circleCells[g].push(b)},ca.prototype._query=function(i,u,o,h,g,b){if(o<0||i>this.width||h<0||u>this.height)return!g&&[];var P=[];if(i<=0&&u<=0&&this.width<=o&&this.height<=h){if(g)return!0;for(var D=0;D<this.boxKeys.length;D++)P.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(var H=0;H<this.circleKeys.length;H++){var ae=this.circles[3*H],Se=this.circles[3*H+1],we=this.circles[3*H+2];P.push({key:this.circleKeys[H],x1:ae-we,y1:Se-we,x2:ae+we,y2:Se+we})}return b?P.filter(b):P}return this._forEachCell(i,u,o,h,this._queryCell,P,{hitTest:g,seenUids:{box:{},circle:{}}},b),g?P.length>0:P},ca.prototype._queryCircle=function(i,u,o,h,g){var b=i-o,P=i+o,D=u-o,H=u+o;if(P<0||b>this.width||H<0||D>this.height)return!h&&[];var ae=[];return this._forEachCell(b,D,P,H,this._queryCellCircle,ae,{hitTest:h,circle:{x:i,y:u,radius:o},seenUids:{box:{},circle:{}}},g),h?ae.length>0:ae},ca.prototype.query=function(i,u,o,h,g){return this._query(i,u,o,h,!1,g)},ca.prototype.hitTest=function(i,u,o,h,g){return this._query(i,u,o,h,!0,g)},ca.prototype.hitTestCircle=function(i,u,o,h){return this._queryCircle(i,u,o,!0,h)},ca.prototype._queryCell=function(i,u,o,h,g,b,P,D){var H=P.seenUids,ae=this.boxCells[g];if(ae!==null)for(var Se=this.bboxes,we=0,Pe=ae;we<Pe.length;we+=1){var He=Pe[we];if(!H.box[He]){H.box[He]=!0;var je=4*He;if(i<=Se[je+2]&&u<=Se[je+3]&&o>=Se[je+0]&&h>=Se[je+1]&&(!D||D(this.boxKeys[He]))){if(P.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[He],x1:Se[je],y1:Se[je+1],x2:Se[je+2],y2:Se[je+3]})}}}var it=this.circleCells[g];if(it!==null)for(var ze=this.circles,ot=0,bt=it;ot<bt.length;ot+=1){var Zt=bt[ot];if(!H.circle[Zt]){H.circle[Zt]=!0;var fr=3*Zt;if(this._circleAndRectCollide(ze[fr],ze[fr+1],ze[fr+2],i,u,o,h)&&(!D||D(this.circleKeys[Zt]))){if(P.hitTest)return b.push(!0),!0;var ur=ze[fr],gr=ze[fr+1],Nr=ze[fr+2];b.push({key:this.circleKeys[Zt],x1:ur-Nr,y1:gr-Nr,x2:ur+Nr,y2:gr+Nr})}}}},ca.prototype._queryCellCircle=function(i,u,o,h,g,b,P,D){var H=P.circle,ae=P.seenUids,Se=this.boxCells[g];if(Se!==null)for(var we=this.bboxes,Pe=0,He=Se;Pe<He.length;Pe+=1){var je=He[Pe];if(!ae.box[je]){ae.box[je]=!0;var it=4*je;if(this._circleAndRectCollide(H.x,H.y,H.radius,we[it+0],we[it+1],we[it+2],we[it+3])&&(!D||D(this.boxKeys[je])))return b.push(!0),!0}}var ze=this.circleCells[g];if(ze!==null)for(var ot=this.circles,bt=0,Zt=ze;bt<Zt.length;bt+=1){var fr=Zt[bt];if(!ae.circle[fr]){ae.circle[fr]=!0;var ur=3*fr;if(this._circlesCollide(ot[ur],ot[ur+1],ot[ur+2],H.x,H.y,H.radius)&&(!D||D(this.circleKeys[fr])))return b.push(!0),!0}}},ca.prototype._forEachCell=function(i,u,o,h,g,b,P,D){for(var H=this._convertToXCellCoord(i),ae=this._convertToYCellCoord(u),Se=this._convertToXCellCoord(o),we=this._convertToYCellCoord(h),Pe=H;Pe<=Se;Pe++)for(var He=ae;He<=we;He++)if(g.call(this,i,u,o,h,this.xCellCount*He+Pe,b,P,D))return},ca.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},ca.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},ca.prototype._circlesCollide=function(i,u,o,h,g,b){var P=h-i,D=g-u,H=o+b;return H*H>P*P+D*D},ca.prototype._circleAndRectCollide=function(i,u,o,h,g,b,P){var D=(b-h)/2,H=Math.abs(i-(h+D));if(H>D+o)return!1;var ae=(P-g)/2,Se=Math.abs(u-(g+ae));if(Se>ae+o)return!1;if(H<=D||Se<=ae)return!0;var we=H-D,Pe=Se-ae;return we*we+Pe*Pe<=o*o};var Co=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Wa(i,u){for(var o=0;o<i;o++){var h=u.length;u.resize(h+4),u.float32.set(Co,3*h)}}function Xa(i,u,o){var h=u[0],g=u[1];return i[0]=o[0]*h+o[4]*g+o[12],i[1]=o[1]*h+o[5]*g+o[13],i[3]=o[3]*h+o[7]*g+o[15],i}var Yo=function(i,u,o){u===void 0&&(u=new ca(i.width+200,i.height+200,25)),o===void 0&&(o=new ca(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=o,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function Zi(i,u,o){return u*(d.EXTENT/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}Yo.prototype.placeCollisionBox=function(i,u,o,h,g){var b=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),P=o*b.perspectiveRatio,D=i.x1*P+b.point.x,H=i.y1*P+b.point.y,ae=i.x2*P+b.point.x,Se=i.y2*P+b.point.y;return!this.isInsideGrid(D,H,ae,Se)||!u&&this.grid.hitTest(D,H,ae,Se,g)?{box:[],offscreen:!1}:{box:[D,H,ae,Se],offscreen:this.isOffscreen(D,H,ae,Se)}},Yo.prototype.placeCollisionCircles=function(i,u,o,h,g,b,P,D,H,ae,Se,we,Pe){var He=[],je=new d.Point(u.anchorX,u.anchorY),it=ti(je,b),ze=Gi(this.transform.cameraToCenterDistance,it.signedDistanceFromCamera),ot=(ae?g/ze:g*ze)/d.ONE_EM,bt=ti(je,P).point,Zt=ya(ot,h,u.lineOffsetX*ot,u.lineOffsetY*ot,!1,bt,je,u,o,P,{}),fr=!1,ur=!1,gr=!0;if(Zt){for(var Nr=.5*we*ze+Pe,an=new d.Point(-100,-100),Hr=new d.Point(this.screenRightBoundary,this.screenBottomBoundary),Rn=new Ai,ri=Zt.first,hi=Zt.last,ni=[],ea=ri.path.length-1;ea>=1;ea--)ni.push(ri.path[ea]);for(var Un=1;Un<hi.path.length;Un++)ni.push(hi.path[Un]);var gi=2.5*Nr;if(D){var te=ni.map(function($i){return ti($i,D)});ni=te.some(function($i){return $i.signedDistanceFromCamera<=0})?[]:te.map(function($i){return $i.point})}var q=[];if(ni.length>0){for(var R=ni[0].clone(),F=ni[0].clone(),re=1;re<ni.length;re++)R.x=Math.min(R.x,ni[re].x),R.y=Math.min(R.y,ni[re].y),F.x=Math.max(F.x,ni[re].x),F.y=Math.max(F.y,ni[re].y);q=R.x>=an.x&&F.x<=Hr.x&&R.y>=an.y&&F.y<=Hr.y?[ni]:F.x<an.x||R.x>Hr.x||F.y<an.y||R.y>Hr.y?[]:d.clipLine([ni],an.x,an.y,Hr.x,Hr.y)}for(var pe=0,dt=q;pe<dt.length;pe+=1){var wt;Rn.reset(dt[pe],.25*Nr),wt=Rn.length<=.5*Nr?1:Math.ceil(Rn.paddedLength/gi)+1;for(var At=0;At<wt;At++){var qt=At/Math.max(wt-1,1),Pr=Rn.lerp(qt),mn=Pr.x+100,Zn=Pr.y+100;He.push(mn,Zn,Nr,0);var Jn=mn-Nr,_i=Zn-Nr,si=mn+Nr,ji=Zn+Nr;if(gr=gr&&this.isOffscreen(Jn,_i,si,ji),ur=ur||this.isInsideGrid(Jn,_i,si,ji),!i&&this.grid.hitTestCircle(mn,Zn,Nr,Se)&&(fr=!0,!H))return{circles:[],offscreen:!1,collisionDetected:fr}}}}return{circles:!H&&fr||!ur?[]:He,offscreen:gr,collisionDetected:fr}},Yo.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],o=1/0,h=1/0,g=-1/0,b=-1/0,P=0,D=i;P<D.length;P+=1){var H=D[P],ae=new d.Point(H.x+100,H.y+100);o=Math.min(o,ae.x),h=Math.min(h,ae.y),g=Math.max(g,ae.x),b=Math.max(b,ae.y),u.push(ae)}for(var Se={},we={},Pe=0,He=this.grid.query(o,h,g,b).concat(this.ignoredGrid.query(o,h,g,b));Pe<He.length;Pe+=1){var je=He[Pe],it=je.key;if(Se[it.bucketInstanceId]===void 0&&(Se[it.bucketInstanceId]={}),!Se[it.bucketInstanceId][it.featureIndex]){var ze=[new d.Point(je.x1,je.y1),new d.Point(je.x2,je.y1),new d.Point(je.x2,je.y2),new d.Point(je.x1,je.y2)];d.polygonIntersectsPolygon(u,ze)&&(Se[it.bucketInstanceId][it.featureIndex]=!0,we[it.bucketInstanceId]===void 0&&(we[it.bucketInstanceId]=[]),we[it.bucketInstanceId].push(it.featureIndex))}}return we},Yo.prototype.insertCollisionBox=function(i,u,o,h,g){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:g},i[0],i[1],i[2],i[3])},Yo.prototype.insertCollisionCircles=function(i,u,o,h,g){for(var b=u?this.ignoredGrid:this.grid,P={bucketInstanceId:o,featureIndex:h,collisionGroupID:g},D=0;D<i.length;D+=4)b.insertCircle(P,i[D],i[D+1],i[D+2])},Yo.prototype.projectAndGetPerspectiveRatio=function(i,u,o){var h=[u,o,0,1];return Xa(h,h,i),{point:new d.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Yo.prototype.isOffscreen=function(i,u,o,h){return o<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Yo.prototype.isInsideGrid=function(i,u,o,h){return o>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Yo.prototype.getViewportMatrix=function(){var i=d.identity([]);return d.translate(i,i,[-100,-100,0]),i};var Ao=function(i,u,o,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&o?1:0,this.placed=o};Ao.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Lo=function(i,u,o,h,g){this.text=new Ao(i?i.text:null,u,o,g),this.icon=new Ao(i?i.icon:null,u,h,g)};Lo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var so=function(i,u,o){this.text=i,this.icon=u,this.skipFade=o},Ro=function(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]},Hi=function(i,u,o,h,g){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=g},Da=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function Ba(i,u,o,h,g){var b=d.getAnchorAlignment(i),P=-(b.horizontalAlign-.5)*u,D=-(b.verticalAlign-.5)*o,H=d.evaluateVariableOffset(i,h);return new d.Point(P+H[0]*g,D+H[1]*g)}function _s(i,u,o,h,g,b){var P=i.x1,D=i.x2,H=i.y1,ae=i.y2,Se=i.anchorPointX,we=i.anchorPointY,Pe=new d.Point(u,o);return h&&Pe._rotate(g?b:-b),{x1:P+Pe.x,y1:H+Pe.y,x2:D+Pe.x,y2:ae+Pe.y,anchorPointX:Se,anchorPointY:we}}Da.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(o){return o.collisionGroupID===u}}}return this.collisionGroups[i]};var _a=function(i,u,o,h){this.transform=i.clone(),this.collisionIndex=new Yo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Da(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function xe(i,u,o,h,g){i.emplaceBack(u?1:0,o?1:0,h||0,g||0),i.emplaceBack(u?1:0,o?1:0,h||0,g||0),i.emplaceBack(u?1:0,o?1:0,h||0,g||0),i.emplaceBack(u?1:0,o?1:0,h||0,g||0)}_a.prototype.getBucketParts=function(i,u,o,h){var g=o.getBucket(u),b=o.latestFeatureIndex;if(g&&b&&u.id===g.layerIds[0]){var P=o.collisionBoxArray,D=g.layers[0].layout,H=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),ae=o.tileSize/d.EXTENT,Se=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),we=D.get("text-pitch-alignment")==="map",Pe=D.get("text-rotation-alignment")==="map",He=Zi(o,1,this.transform.zoom),je=ba(Se,we,Pe,this.transform,He),it=null;if(we){var ze=ai(Se,we,Pe,this.transform,He);it=d.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[g.bucketInstanceId]=new Hi(g.bucketInstanceId,b,g.sourceLayerIndex,g.index,o.tileID);var ot={bucket:g,layout:D,posMatrix:Se,textLabelPlaneMatrix:je,labelToScreenMatrix:it,scale:H,textPixelRatio:ae,holdingForFade:o.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(h)for(var bt=0,Zt=g.sortKeyRanges;bt<Zt.length;bt+=1){var fr=Zt[bt];i.push({sortKey:fr.sortKey,symbolInstanceStart:fr.symbolInstanceStart,symbolInstanceEnd:fr.symbolInstanceEnd,parameters:ot})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ot})}},_a.prototype.attemptAnchorPlacement=function(i,u,o,h,g,b,P,D,H,ae,Se,we,Pe,He,je){var it,ze=[we.textOffset0,we.textOffset1],ot=Ba(i,o,h,ze,g),bt=this.collisionIndex.placeCollisionBox(_s(u,ot.x,ot.y,b,P,this.transform.angle),Se,D,H,ae.predicate);if(!je||this.collisionIndex.placeCollisionBox(_s(je,ot.x,ot.y,b,P,this.transform.angle),Se,D,H,ae.predicate).box.length!==0)return bt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID]&&this.prevPlacement.placements[we.crossTileID].text&&(it=this.prevPlacement.variableOffsets[we.crossTileID].anchor),this.variableOffsets[we.crossTileID]={textOffset:ze,width:o,height:h,anchor:i,textBoxScale:g,prevAnchor:it},this.markUsedJustification(Pe,i,we,He),Pe.allowVerticalPlacement&&(this.markUsedOrientation(Pe,He,we),this.placedOrientations[we.crossTileID]=He),{shift:ot,placedGlyphBoxes:bt}):void 0},_a.prototype.placeLayerBucketPart=function(i,u,o){var h=this,g=i.parameters,b=g.bucket,P=g.layout,D=g.posMatrix,H=g.textLabelPlaneMatrix,ae=g.labelToScreenMatrix,Se=g.textPixelRatio,we=g.holdingForFade,Pe=g.collisionBoxArray,He=g.partiallyEvaluatedTextSize,je=g.collisionGroup,it=P.get("text-optional"),ze=P.get("icon-optional"),ot=P.get("text-allow-overlap"),bt=P.get("icon-allow-overlap"),Zt=P.get("text-rotation-alignment")==="map",fr=P.get("text-pitch-alignment")==="map",ur=P.get("icon-text-fit")!=="none",gr=P.get("symbol-z-order")==="viewport-y",Nr=ot&&(bt||!b.hasIconData()||ze),an=bt&&(ot||!b.hasTextData()||it);!b.collisionArrays&&Pe&&b.deserializeCollisionBoxes(Pe);var Hr=function(Un,gi){if(!u[Un.crossTileID])if(we)h.placements[Un.crossTileID]=new so(!1,!1,!1);else{var te,q=!1,R=!1,F=!0,re=null,pe={box:null,offscreen:null},dt={box:null,offscreen:null},wt=null,At=null,qt=0,Pr=0,mn=0;gi.textFeatureIndex?qt=gi.textFeatureIndex:Un.useRuntimeCollisionCircles&&(qt=Un.featureIndex),gi.verticalTextFeatureIndex&&(Pr=gi.verticalTextFeatureIndex);var Zn=gi.textBox;if(Zn){var Jn=function(ua){var Zo=d.WritingMode.horizontal;if(b.allowVerticalPlacement&&!ua&&h.prevPlacement){var fo=h.prevPlacement.placedOrientations[Un.crossTileID];fo&&(h.placedOrientations[Un.crossTileID]=fo,h.markUsedOrientation(b,Zo=fo,Un))}return Zo},_i=function(ua,Zo){if(b.allowVerticalPlacement&&Un.numVerticalGlyphVertices>0&&gi.verticalTextBox)for(var fo=0,qs=b.writingModes;fo<qs.length&&(qs[fo]===d.WritingMode.vertical?(pe=Zo(),dt=pe):pe=ua(),!(pe&&pe.box&&pe.box.length));fo+=1);else pe=ua()};if(P.get("text-variable-anchor")){var si=P.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Un.crossTileID]){var ji=h.prevPlacement.variableOffsets[Un.crossTileID];si.indexOf(ji.anchor)>0&&(si=si.filter(function(ua){return ua!==ji.anchor})).unshift(ji.anchor)}var $i=function(ua,Zo,fo){for(var qs=ua.x2-ua.x1,wc=ua.y2-ua.y1,Nl=Un.textBoxScale,qu=ur&&!bt?Zo:null,fu={box:[],offscreen:!1},zl=ot?2*si.length:si.length,Zs=0;Zs<zl;++Zs){var ml=h.attemptAnchorPlacement(si[Zs%si.length],ua,qs,wc,Nl,Zt,fr,Se,D,je,Zs>=si.length,Un,b,fo,qu);if(ml&&(fu=ml.placedGlyphBoxes)&&fu.box&&fu.box.length){q=!0,re=ml.shift;break}}return fu};_i(function(){return $i(Zn,gi.iconBox,d.WritingMode.horizontal)},function(){var ua=gi.verticalTextBox;return b.allowVerticalPlacement&&!(pe&&pe.box&&pe.box.length)&&Un.numVerticalGlyphVertices>0&&ua?$i(ua,gi.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),pe&&(q=pe.box,F=pe.offscreen);var xa=Jn(pe&&pe.box);if(!q&&h.prevPlacement){var ao=h.prevPlacement.variableOffsets[Un.crossTileID];ao&&(h.variableOffsets[Un.crossTileID]=ao,h.markUsedJustification(b,ao.anchor,Un,xa))}}else{var La=function(ua,Zo){var fo=h.collisionIndex.placeCollisionBox(ua,ot,Se,D,je.predicate);return fo&&fo.box&&fo.box.length&&(h.markUsedOrientation(b,Zo,Un),h.placedOrientations[Un.crossTileID]=Zo),fo};_i(function(){return La(Zn,d.WritingMode.horizontal)},function(){var ua=gi.verticalTextBox;return b.allowVerticalPlacement&&Un.numVerticalGlyphVertices>0&&ua?La(ua,d.WritingMode.vertical):{box:null,offscreen:null}}),Jn(pe&&pe.box&&pe.box.length)}}if(q=(te=pe)&&te.box&&te.box.length>0,F=te&&te.offscreen,Un.useRuntimeCollisionCircles){var co=b.text.placedSymbolArray.get(Un.centerJustifiedTextSymbolIndex),Ga=d.evaluateSizeForFeature(b.textSizeData,He,co),ta=P.get("text-padding");wt=h.collisionIndex.placeCollisionCircles(ot,co,b.lineVertexArray,b.glyphOffsetArray,Ga,D,H,ae,o,fr,je.predicate,Un.collisionCircleDiameter,ta),q=ot||wt.circles.length>0&&!wt.collisionDetected,F=F&&wt.offscreen}if(gi.iconFeatureIndex&&(mn=gi.iconFeatureIndex),gi.iconBox){var va=function(ua){var Zo=ur&&re?_s(ua,re.x,re.y,Zt,fr,h.transform.angle):ua;return h.collisionIndex.placeCollisionBox(Zo,bt,Se,D,je.predicate)};R=dt&&dt.box&&dt.box.length&&gi.verticalIconBox?(At=va(gi.verticalIconBox)).box.length>0:(At=va(gi.iconBox)).box.length>0,F=F&&At.offscreen}var za=it||Un.numHorizontalGlyphVertices===0&&Un.numVerticalGlyphVertices===0,fa=ze||Un.numIconVertices===0;if(za||fa?fa?za||(R=R&&q):q=R&&q:R=q=R&&q,q&&te&&te.box&&h.collisionIndex.insertCollisionBox(te.box,P.get("text-ignore-placement"),b.bucketInstanceId,dt&&dt.box&&Pr?Pr:qt,je.ID),R&&At&&h.collisionIndex.insertCollisionBox(At.box,P.get("icon-ignore-placement"),b.bucketInstanceId,mn,je.ID),wt&&(q&&h.collisionIndex.insertCollisionCircles(wt.circles,P.get("text-ignore-placement"),b.bucketInstanceId,qt,je.ID),o)){var Ta=b.bucketInstanceId,bo=h.collisionCircleArrays[Ta];bo===void 0&&(bo=h.collisionCircleArrays[Ta]=new Ro);for(var Fo=0;Fo<wt.circles.length;Fo+=4)bo.circles.push(wt.circles[Fo+0]),bo.circles.push(wt.circles[Fo+1]),bo.circles.push(wt.circles[Fo+2]),bo.circles.push(wt.collisionDetected?1:0)}h.placements[Un.crossTileID]=new so(q||Nr,R||an,F||b.justReloaded),u[Un.crossTileID]=!0}};if(gr)for(var Rn=b.getSortedSymbolIndexes(this.transform.angle),ri=Rn.length-1;ri>=0;--ri){var hi=Rn[ri];Hr(b.symbolInstances.get(hi),b.collisionArrays[hi])}else for(var ni=i.symbolInstanceStart;ni<i.symbolInstanceEnd;ni++)Hr(b.symbolInstances.get(ni),b.collisionArrays[ni]);if(o&&b.bucketInstanceId in this.collisionCircleArrays){var ea=this.collisionCircleArrays[b.bucketInstanceId];d.invert(ea.invProjMatrix,D),ea.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1},_a.prototype.markUsedJustification=function(i,u,o,h){var g;g=h===d.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(u)];for(var b=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];b<P.length;b+=1){var D=P[b];D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=g>=0&&D!==g?0:o.crossTileID)}},_a.prototype.markUsedOrientation=function(i,u,o){for(var h=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,g=u===d.WritingMode.vertical?u:0,b=0,P=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];b<P.length;b+=1)i.text.placedSymbolArray.get(P[b]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=g)},_a.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,o=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,g=u?u.opacities:{},b=u?u.variableOffsets:{},P=u?u.placedOrientations:{};for(var D in this.placements){var H=this.placements[D],ae=g[D];ae?(this.opacities[D]=new Lo(ae,h,H.text,H.icon),o=o||H.text!==ae.text.placed||H.icon!==ae.icon.placed):(this.opacities[D]=new Lo(null,h,H.text,H.icon,H.skipFade),o=o||H.text||H.icon)}for(var Se in g){var we=g[Se];if(!this.opacities[Se]){var Pe=new Lo(we,h,!1,!1);Pe.isHidden()||(this.opacities[Se]=Pe,o=o||we.text.placed||we.icon.placed)}}for(var He in b)this.variableOffsets[He]||!this.opacities[He]||this.opacities[He].isHidden()||(this.variableOffsets[He]=b[He]);for(var je in P)this.placedOrientations[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.placedOrientations[je]=P[je]);o?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},_a.prototype.updateLayerOpacities=function(i,u){for(var o={},h=0,g=u;h<g.length;h+=1){var b=g[h],P=b.getBucket(i);P&&b.latestFeatureIndex&&i.id===P.layerIds[0]&&this.updateBucketOpacities(P,o,b.collisionBoxArray)}},_a.prototype.updateBucketOpacities=function(i,u,o){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var g=i.layers[0].layout,b=new Lo(null,0,!1,!1,!0),P=g.get("text-allow-overlap"),D=g.get("icon-allow-overlap"),H=g.get("text-variable-anchor"),ae=g.get("text-rotation-alignment")==="map",Se=g.get("text-pitch-alignment")==="map",we=g.get("icon-text-fit")!=="none",Pe=new Lo(null,0,P&&(D||!i.hasIconData()||g.get("icon-optional")),D&&(P||!i.hasTextData()||g.get("text-optional")),!0);!i.collisionArrays&&o&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(o);for(var He=function(ot,bt,Zt){for(var fr=0;fr<bt/4;fr++)ot.opacityVertexArray.emplaceBack(Zt)},je=function(ot){var bt=i.symbolInstances.get(ot),Zt=bt.numHorizontalGlyphVertices,fr=bt.numVerticalGlyphVertices,ur=bt.crossTileID,gr=h.opacities[ur];u[ur]?gr=b:gr||(h.opacities[ur]=gr=Pe),u[ur]=!0;var Nr=bt.numIconVertices>0,an=h.placedOrientations[bt.crossTileID],Hr=an===d.WritingMode.vertical,Rn=an===d.WritingMode.horizontal||an===d.WritingMode.horizontalOnly;if(Zt>0||fr>0){var ri=Ya(gr.text);He(i.text,Zt,Hr?uo:ri),He(i.text,fr,Rn?uo:ri);var hi=gr.text.isHidden();[bt.rightJustifiedTextSymbolIndex,bt.centerJustifiedTextSymbolIndex,bt.leftJustifiedTextSymbolIndex].forEach(function(pe){pe>=0&&(i.text.placedSymbolArray.get(pe).hidden=hi||Hr?1:0)}),bt.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(bt.verticalPlacedTextSymbolIndex).hidden=hi||Rn?1:0);var ni=h.variableOffsets[bt.crossTileID];ni&&h.markUsedJustification(i,ni.anchor,bt,an);var ea=h.placedOrientations[bt.crossTileID];ea&&(h.markUsedJustification(i,"left",bt,ea),h.markUsedOrientation(i,ea,bt))}if(Nr){var Un=Ya(gr.icon),gi=!(we&&bt.verticalPlacedIconSymbolIndex&&Hr);bt.placedIconSymbolIndex>=0&&(He(i.icon,bt.numIconVertices,gi?Un:uo),i.icon.placedSymbolArray.get(bt.placedIconSymbolIndex).hidden=gr.icon.isHidden()),bt.verticalPlacedIconSymbolIndex>=0&&(He(i.icon,bt.numVerticalIconVertices,gi?uo:Un),i.icon.placedSymbolArray.get(bt.verticalPlacedIconSymbolIndex).hidden=gr.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var te=i.collisionArrays[ot];if(te){var q=new d.Point(0,0);if(te.textBox||te.verticalTextBox){var R=!0;if(H){var F=h.variableOffsets[ur];F?(q=Ba(F.anchor,F.width,F.height,F.textOffset,F.textBoxScale),ae&&q._rotate(Se?h.transform.angle:-h.transform.angle)):R=!1}te.textBox&&xe(i.textCollisionBox.collisionVertexArray,gr.text.placed,!R||Hr,q.x,q.y),te.verticalTextBox&&xe(i.textCollisionBox.collisionVertexArray,gr.text.placed,!R||Rn,q.x,q.y)}var re=Boolean(!Rn&&te.verticalIconBox);te.iconBox&&xe(i.iconCollisionBox.collisionVertexArray,gr.icon.placed,re,we?q.x:0,we?q.y:0),te.verticalIconBox&&xe(i.iconCollisionBox.collisionVertexArray,gr.icon.placed,!re,we?q.x:0,we?q.y:0)}}},it=0;it<i.symbolInstances.length;it++)je(it);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var ze=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ze.invProjMatrix,i.placementViewportMatrix=ze.viewportMatrix,i.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},_a.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},_a.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},_a.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},_a.prototype.stillRecent=function(i,u){var o=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*o>i},_a.prototype.setStale=function(){this.stale=!0};var ke=Math.pow(2,25),lt=Math.pow(2,24),Xt=Math.pow(2,17),Xr=Math.pow(2,16),$n=Math.pow(2,9),yi=Math.pow(2,8),no=Math.pow(2,1);function Ya(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,o=Math.floor(127*i.opacity);return o*ke+u*lt+o*Xt+u*Xr+o*$n+u*yi+o*no+u}var uo=0,Ko=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Ko.prototype.continuePlacement=function(i,u,o,h,g){for(var b=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(b,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(function(P,D){return P.sortKey-D.sortKey}));this._currentPartIndex<b.length;)if(u.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,g())return!0;return!1};var Hs=function(i,u,o,h,g,b,P){this.placement=new _a(i,g,b,P),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};Hs.prototype.isDone=function(){return this._done},Hs.prototype.continuePlacement=function(i,u,o){for(var h=this,g=d.browser.now(),b=function(){var H=d.browser.now()-g;return!h._forceFullPlacement&&H>2};this._currentPlacementIndex>=0;){var P=u[i[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new Ko(P)),this._inProgressLayer.continuePlacement(o[P.source],this.placement,this._showCollisionBoxes,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Hs.prototype.commit=function(i){return this.placement.commit(i),this.placement};var xs=512/d.EXTENT/2,po=function(i,u,o){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<u.length;h++){var g=u.get(h),b=g.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,i)})}};po.prototype.getScaledCoordinates=function(i,u){var o=xs/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+i.anchorX)*o),y:Math.floor((u.canonical.y*d.EXTENT+i.anchorY)*o)}},po.prototype.findMatches=function(i,u,o){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),g=0;g<i.length;g++){var b=i.get(g);if(!b.crossTileID){var P=this.indexedSymbolInstances[b.key];if(P)for(var D=this.getScaledCoordinates(b,u),H=0,ae=P;H<ae.length;H+=1){var Se=ae[H];if(Math.abs(Se.coord.x-D.x)<=h&&Math.abs(Se.coord.y-D.y)<=h&&!o[Se.crossTileID]){o[Se.crossTileID]=!0,b.crossTileID=Se.crossTileID;break}}}}};var fs=function(){this.maxCrossTileID=0};fs.prototype.generate=function(){return++this.maxCrossTileID};var zo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};zo.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var o in this.indexes){var h=this.indexes[o],g={};for(var b in h){var P=h[b];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+u),g[P.tileID.key]=P}this.indexes[o]=g}this.lng=i},zo.prototype.addBucket=function(i,u,o){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var g=this.usedCrossTileIDs[i.overscaledZ];for(var b in this.indexes){var P=this.indexes[b];if(Number(b)>i.overscaledZ)for(var D in P){var H=P[D];H.tileID.isChildOf(i)&&H.findMatches(u.symbolInstances,i,g)}else{var ae=P[i.scaledTo(Number(b)).key];ae&&ae.findMatches(u.symbolInstances,i,g)}}for(var Se=0;Se<u.symbolInstances.length;Se++){var we=u.symbolInstances.get(Se);we.crossTileID||(we.crossTileID=o.generate(),g[we.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new po(i,u.symbolInstances,u.bucketInstanceId),!0},zo.prototype.removeBucketCrossTileIDs=function(i,u){for(var o in u.indexedSymbolInstances)for(var h=0,g=u.indexedSymbolInstances[o];h<g.length;h+=1)delete this.usedCrossTileIDs[i][g[h].crossTileID]},zo.prototype.removeStaleBuckets=function(i){var u=!1;for(var o in this.indexes){var h=this.indexes[o];for(var g in h)i[h[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[g]),delete h[g],u=!0)}return u};var $o=function(){this.layerIndexes={},this.crossTileIDs=new fs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};$o.prototype.addLayer=function(i,u,o){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new zo);var g=!1,b={};h.handleWrapJump(o);for(var P=0,D=u;P<D.length;P+=1){var H=D[P],ae=H.getBucket(i);ae&&i.id===ae.layerIds[0]&&(ae.bucketInstanceId||(ae.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(H.tileID,ae,this.crossTileIDs)&&(g=!0),b[ae.bucketInstanceId]=!0)}return h.removeStaleBuckets(b)&&(g=!0),g},$o.prototype.pruneUnusedLayers=function(i){var u={};for(var o in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[o]||delete this.layerIndexes[o]};var yo=function(i,u){return d.emitValidationErrors(i,u&&u.filter(function(o){return o.identifier!=="source.canvas"}))},Si=d.pick(un,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ts=d.pick(un,["setCenter","setZoom","setBearing","setPitch"]),Ps=function(){var i={},u=d.styleSpec.$version;for(var o in d.styleSpec.$root){var h,g=d.styleSpec.$root[o];g.required&&(h=o==="version"?u:g.type==="array"?[]:{})!=null&&(i[o]=h)}return i}(),bs=function(i){function u(o,h){var g=this;h===void 0&&(h={}),i.call(this),this.map=o,this.dispatcher=new Ut($t(),this),this.imageManager=new Vt,this.imageManager.setEventedParent(this),this.glyphManager=new dr(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Xe(256,512),this.crossTileSymbolIndex=new $o,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());var b=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(P){b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(D,H){if(d.triggerPluginCompletionEvent(D),H&&H.every(function(Se){return Se}))for(var ae in b.sourceCaches)b.sourceCaches[ae].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var D=g.sourceCaches[P.sourceId];if(D){var H=D.getSource();if(H&&H.vectorLayerIds)for(var ae in g._layers){var Se=g._layers[ae];Se.source===H.id&&g._validateLayer(Se)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(o,h){var g=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"}));var b=typeof h.validate=="boolean"?h.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var P=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(P,function(D,H){g._request=null,D?g.fire(new d.ErrorEvent(D)):H&&g._load(H,b)})},u.prototype.loadJSON=function(o,h){var g=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.browser.frame(function(){g._request=null,g._load(o,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(Ps,!1)},u.prototype._load=function(o,h){if(!h||!yo(this,d.validateStyle(o))){for(var g in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(g,o.sources[g],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var b=on(this.stylesheet.layers);this._order=b.map(function(ae){return ae.id}),this._layers={},this._serializedLayers={};for(var P=0,D=b;P<D.length;P+=1){var H=D[P];(H=d.createStyleLayer(H)).setEventedParent(this,{layer:{id:H.id}}),this._layers[H.id]=H,this._serializedLayers[H.id]=H.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Dt(this.stylesheet.light),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}},u.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(g,b,P){var D,H,ae,Se=d.browser.devicePixelRatio>1?"@2x":"",we=d.getJSON(b.transformRequest(b.normalizeSpriteURL(g,Se,".json"),d.ResourceType.SpriteJSON),function(je,it){we=null,ae||(ae=je,D=it,He())}),Pe=d.getImage(b.transformRequest(b.normalizeSpriteURL(g,Se,".png"),d.ResourceType.SpriteImage),function(je,it){Pe=null,ae||(ae=je,H=it,He())});function He(){if(ae)P(ae);else if(D&&H){var je=d.browser.getImageData(H),it={};for(var ze in D){var ot=D[ze],bt=ot.width,Zt=ot.height,fr=ot.x,ur=ot.y,gr=ot.sdf,Nr=ot.pixelRatio,an=ot.stretchX,Hr=ot.stretchY,Rn=ot.content,ri=new d.RGBAImage({width:bt,height:Zt});d.RGBAImage.copy(je,ri,{x:fr,y:ur},{x:0,y:0},{width:bt,height:Zt}),it[ze]={data:ri,pixelRatio:Nr,sdf:gr,stretchX:an,stretchY:Hr,content:Rn}}P(null,it)}}return{cancel:function(){we&&(we.cancel(),we=null),Pe&&(Pe.cancel(),Pe=null)}}}(o,this.map._requestManager,function(g,b){if(h._spriteRequest=null,g)h.fire(new d.ErrorEvent(g));else if(b)for(var P in b)h.imageManager.addImage(P,b[P]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new d.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var g=o.sourceLayer;if(g){var b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(g)===-1)&&this.fire(new d.ErrorEvent(new Error('Source layer "'+g+'" does not exist on source "'+b.id+'" as specified by style layer "'+o.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(o){for(var h=[],g=0,b=o;g<b.length;g+=1){var P=this._layers[b[g]];P.type!=="custom"&&h.push(P.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);for(var P in(g.length||b.length)&&this._updateWorkerLayers(g,b),this._updatedSources){var D=this._updatedSources[P];D==="reload"?this._reloadSource(P):D==="clear"&&this._clearSource(P)}for(var H in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[H].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var ae={};for(var Se in this.sourceCaches){var we=this.sourceCaches[Se];ae[Se]=we.used,we.used=!1}for(var Pe=0,He=this._order;Pe<He.length;Pe+=1){var je=this._layers[He[Pe]];je.recalculate(o,this._availableImages),!je.isHidden(o.zoom)&&je.source&&(this.sourceCaches[je.source].used=!0)}for(var it in ae){var ze=this.sourceCaches[it];ae[it]!==ze.used&&ze.fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:it}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new d.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},u.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(o){var h=this;if(this._checkLoaded(),yo(this,d.validateStyle(o)))return!1;(o=d.clone$1(o)).layers=on(o.layers);var g=function(P,D){if(!P)return[{command:un.setStyle,args:[D]}];var H=[];try{if(!d.deepEqual(P.version,D.version))return[{command:un.setStyle,args:[D]}];d.deepEqual(P.center,D.center)||H.push({command:un.setCenter,args:[D.center]}),d.deepEqual(P.zoom,D.zoom)||H.push({command:un.setZoom,args:[D.zoom]}),d.deepEqual(P.bearing,D.bearing)||H.push({command:un.setBearing,args:[D.bearing]}),d.deepEqual(P.pitch,D.pitch)||H.push({command:un.setPitch,args:[D.pitch]}),d.deepEqual(P.sprite,D.sprite)||H.push({command:un.setSprite,args:[D.sprite]}),d.deepEqual(P.glyphs,D.glyphs)||H.push({command:un.setGlyphs,args:[D.glyphs]}),d.deepEqual(P.transition,D.transition)||H.push({command:un.setTransition,args:[D.transition]}),d.deepEqual(P.light,D.light)||H.push({command:un.setLight,args:[D.light]});var ae={},Se=[];(function(Pe,He,je,it){var ze;for(ze in He=He||{},Pe=Pe||{})Pe.hasOwnProperty(ze)&&(He.hasOwnProperty(ze)||xn(ze,je,it));for(ze in He)He.hasOwnProperty(ze)&&(Pe.hasOwnProperty(ze)?d.deepEqual(Pe[ze],He[ze])||(Pe[ze].type==="geojson"&&He[ze].type==="geojson"&&Yi(Pe,He,ze)?je.push({command:un.setGeoJSONSourceData,args:[ze,He[ze].data]}):Oi(ze,He,je,it)):wi(ze,He,je))})(P.sources,D.sources,Se,ae);var we=[];P.layers&&P.layers.forEach(function(Pe){ae[Pe.source]?H.push({command:un.removeLayer,args:[Pe.id]}):we.push(Pe)}),H=H.concat(Se),function(Pe,He,je){He=He||[];var it,ze,ot,bt,Zt,fr,ur,gr=(Pe=Pe||[]).map(Ki),Nr=He.map(Ki),an=Pe.reduce(zi,{}),Hr=He.reduce(zi,{}),Rn=gr.slice(),ri=Object.create(null);for(it=0,ze=0;it<gr.length;it++)Hr.hasOwnProperty(ot=gr[it])?ze++:(je.push({command:un.removeLayer,args:[ot]}),Rn.splice(Rn.indexOf(ot,ze),1));for(it=0,ze=0;it<Nr.length;it++)Rn[Rn.length-1-it]!==(ot=Nr[Nr.length-1-it])&&(an.hasOwnProperty(ot)?(je.push({command:un.removeLayer,args:[ot]}),Rn.splice(Rn.lastIndexOf(ot,Rn.length-ze),1)):ze++,je.push({command:un.addLayer,args:[Hr[ot],fr=Rn[Rn.length-it]]}),Rn.splice(Rn.length-it,0,ot),ri[ot]=!0);for(it=0;it<Nr.length;it++)if(bt=an[ot=Nr[it]],Zt=Hr[ot],!ri[ot]&&!d.deepEqual(bt,Zt))if(d.deepEqual(bt.source,Zt.source)&&d.deepEqual(bt["source-layer"],Zt["source-layer"])&&d.deepEqual(bt.type,Zt.type)){for(ur in oi(bt.layout,Zt.layout,je,ot,null,un.setLayoutProperty),oi(bt.paint,Zt.paint,je,ot,null,un.setPaintProperty),d.deepEqual(bt.filter,Zt.filter)||je.push({command:un.setFilter,args:[ot,Zt.filter]}),d.deepEqual(bt.minzoom,Zt.minzoom)&&d.deepEqual(bt.maxzoom,Zt.maxzoom)||je.push({command:un.setLayerZoomRange,args:[ot,Zt.minzoom,Zt.maxzoom]}),bt)bt.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?oi(bt[ur],Zt[ur],je,ot,ur.slice(6),un.setPaintProperty):d.deepEqual(bt[ur],Zt[ur])||je.push({command:un.setLayerProperty,args:[ot,ur,Zt[ur]]}));for(ur in Zt)Zt.hasOwnProperty(ur)&&!bt.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?oi(bt[ur],Zt[ur],je,ot,ur.slice(6),un.setPaintProperty):d.deepEqual(bt[ur],Zt[ur])||je.push({command:un.setLayerProperty,args:[ot,ur,Zt[ur]]}))}else je.push({command:un.removeLayer,args:[ot]}),fr=Rn[Rn.lastIndexOf(ot)+1],je.push({command:un.addLayer,args:[Zt,fr]})}(we,D.layers,H)}catch(Pe){console.warn("Unable to compute style diff:",Pe),H=[{command:un.setStyle,args:[D]}]}return H}(this.serialize(),o).filter(function(P){return!(P.command in Ts)});if(g.length===0)return!1;var b=g.filter(function(P){return!(P.command in Si)});if(b.length>0)throw new Error("Unimplemented: "+b.map(function(P){return P.command}).join(", ")+".");return g.forEach(function(P){P.command!=="setTransition"&&h[P.command].apply(h,P.args)}),this.stylesheet=o,!0},u.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},u.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},u.prototype.getImage=function(o){return this.imageManager.getImage(o)},u.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},u.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(o,h,g){var b=this;if(g===void 0&&(g={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(d.validateStyle.source,"sources."+o,h,null,g))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var P=this.sourceCaches[o]=new Ce(o,h,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:b.loaded(),source:P.serialize(),sourceId:o}}),P.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new d.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var g=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],g.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),g.setEventedParent(null),g.clearTiles(),g.onRemove&&g.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},u.prototype.addLayer=function(o,h,g){g===void 0&&(g={}),this._checkLoaded();var b=o.id;if(this.getLayer(b))this.fire(new d.ErrorEvent(new Error('Layer with id "'+b+'" already exists on this map')));else{var P;if(o.type==="custom"){if(yo(this,d.validateCustomStyleLayer(o)))return;P=d.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(b,o.source),o=d.clone$1(o),o=d.extend(o,{source:b})),this._validate(d.validateStyle.layer,"layers."+b,o,{arrayIndex:-1},g))return;P=d.createStyleLayer(o),this._validateLayer(P),P.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[P.id]=P.serialize()}var D=h?this._order.indexOf(h):this._order.length;if(h&&D===-1)this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(D,0,b),this._layerOrderChanged=!0,this._layers[b]=P,this._removedLayers[b]&&P.source&&P.type!=="custom"){var H=this._removedLayers[b];delete this._removedLayers[b],H.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},u.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var g=this._order.indexOf(o);this._order.splice(g,1);var b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(b,0,o),this._layerOrderChanged=!0)}}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var g=this._order.indexOf(o);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(o){return this._layers[o]},u.prototype.hasLayer=function(o){return o in this._layers},u.prototype.setLayerZoomRange=function(o,h,g){this._checkLoaded();var b=this.getLayer(o);b?b.minzoom===h&&b.maxzoom===g||(h!=null&&(b.minzoom=h),g!=null&&(b.maxzoom=g),this._updateLayer(b)):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(o,h,g){g===void 0&&(g={}),this._checkLoaded();var b=this.getLayer(o);if(b){if(!d.deepEqual(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(d.validateStyle.filter,"layers."+b.id+".filter",h,null,g)||(b.filter=d.clone$1(h),this._updateLayer(b)))}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(o){return d.clone$1(this.getLayer(o).filter)},u.prototype.setLayoutProperty=function(o,h,g,b){b===void 0&&(b={}),this._checkLoaded();var P=this.getLayer(o);P?d.deepEqual(P.getLayoutProperty(h),g)||(P.setLayoutProperty(h,g,b),this._updateLayer(P)):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(o,h){var g=this.getLayer(o);if(g)return g.getLayoutProperty(h);this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(o,h,g,b){b===void 0&&(b={}),this._checkLoaded();var P=this.getLayer(o);P?d.deepEqual(P.getPaintProperty(h),g)||(P.setPaintProperty(h,g,b)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},u.prototype.setFeatureState=function(o,h){this._checkLoaded();var g=o.source,b=o.sourceLayer,P=this.sourceCaches[g];if(P!==void 0){var D=P.getSource().type;D==="geojson"&&b?this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):D!=="vector"||b?(o.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(b,o.id,h)):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(o,h){this._checkLoaded();var g=o.source,b=this.sourceCaches[g];if(b!==void 0){var P=b.getSource().type,D=P==="vector"?o.sourceLayer:void 0;P!=="vector"||D?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(D,o.id,h):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,g=o.sourceLayer,b=this.sourceCaches[h];if(b!==void 0){if(b.getSource().type!=="vector"||g)return o.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),b.getFeatureState(g,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:d.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},u.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,g=function(an){return h._layers[an].type==="fill-extrusion"},b={},P=[],D=this._order.length-1;D>=0;D--){var H=this._order[D];if(g(H)){b[H]=D;for(var ae=0,Se=o;ae<Se.length;ae+=1){var we=Se[ae][H];if(we)for(var Pe=0,He=we;Pe<He.length;Pe+=1)P.push(He[Pe])}}}P.sort(function(an,Hr){return Hr.intersectionZ-an.intersectionZ});for(var je=[],it=this._order.length-1;it>=0;it--){var ze=this._order[it];if(g(ze))for(var ot=P.length-1;ot>=0;ot--){var bt=P[ot].feature;if(b[bt.layer.id]<it)break;je.push(bt),P.pop()}else for(var Zt=0,fr=o;Zt<fr.length;Zt+=1){var ur=fr[Zt][ze];if(ur)for(var gr=0,Nr=ur;gr<Nr.length;gr+=1)je.push(Nr[gr].feature)}}return je},u.prototype.queryRenderedFeatures=function(o,h,g){h&&h.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,D=h.layers;P<D.length;P+=1){var H=D[P],ae=this._layers[H];if(!ae)return this.fire(new d.ErrorEvent(new Error("The layer '"+H+"' does not exist in the map's style and cannot be queried for features."))),[];b[ae.source]=!0}}var Se=[];for(var we in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!b[we]||Se.push(yn(this.sourceCaches[we],this._layers,this._serializedLayers,o,h,g));return this.placement&&Se.push(function(Pe,He,je,it,ze,ot,bt){for(var Zt={},fr=ot.queryRenderedSymbols(it),ur=[],gr=0,Nr=Object.keys(fr).map(Number);gr<Nr.length;gr+=1)ur.push(bt[Nr[gr]]);ur.sort(Vi);for(var an=function(){var ni=Rn[Hr],ea=ni.featureIndex.lookupSymbolFeatures(fr[ni.bucketInstanceId],He,ni.bucketIndex,ni.sourceLayerIndex,ze.filter,ze.layers,ze.availableImages,Pe);for(var Un in ea){var gi=Zt[Un]=Zt[Un]||[],te=ea[Un];te.sort(function(F,re){var pe=ni.featureSortOrder;if(pe){var dt=pe.indexOf(F.featureIndex);return pe.indexOf(re.featureIndex)-dt}return re.featureIndex-F.featureIndex});for(var q=0,R=te;q<R.length;q+=1)gi.push(R[q])}},Hr=0,Rn=ur;Hr<Rn.length;Hr+=1)an();var ri=function(ni){Zt[ni].forEach(function(ea){var Un=ea.feature,gi=je[Pe[ni].source].getFeatureState(Un.layer["source-layer"],Un.id);Un.source=Un.layer.source,Un.layer["source-layer"]&&(Un.sourceLayer=Un.layer["source-layer"]),Un.state=gi})};for(var hi in Zt)ri(hi);return Zt}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(Se)},u.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var g=this.sourceCaches[o];return g?function(b,P){for(var D=b.getRenderableIds().map(function(He){return b.getTileByID(He)}),H=[],ae={},Se=0;Se<D.length;Se++){var we=D[Se],Pe=we.tileID.canonical.key;ae[Pe]||(ae[Pe]=!0,we.querySourceFeatures(H,P))}return H}(g,h):[]},u.prototype.addSourceType=function(o,h,g){return u.getSourceType(o)?g(new Error('A source type called "'+o+'" already exists.')):(u.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},g):g(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var g=this.light.getLight(),b=!1;for(var P in o)if(!d.deepEqual(o[P],g[P])){b=!0;break}if(b){var D={now:d.browser.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(D)}},u.prototype._validate=function(o,h,g,b,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&yo(this,o.call(d.validateStyle,d.extend({key:h,style:this.serialize(),value:g,styleSpec:d.styleSpec},b)))},u.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},u.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},u.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},u.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},u.prototype._updatePlacement=function(o,h,g,b,P){P===void 0&&(P=!1);for(var D=!1,H=!1,ae={},Se=0,we=this._order;Se<we.length;Se+=1){var Pe=this._layers[we[Se]];if(Pe.type==="symbol"){if(!ae[Pe.source]){var He=this.sourceCaches[Pe.source];ae[Pe.source]=He.getRenderableIds(!0).map(function(bt){return He.getTileByID(bt)}).sort(function(bt,Zt){return Zt.tileID.overscaledZ-bt.tileID.overscaledZ||(bt.tileID.isLessThan(Zt.tileID)?-1:1)})}var je=this.crossTileSymbolIndex.addLayer(Pe,ae[Pe.source],o.center.lng);D=D||je}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.browser.now(),o.zoom))&&(this.pauseablePlacement=new Hs(o,this._order,P,h,g,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ae),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.browser.now()),H=!0),D&&this.pauseablePlacement.placement.setStale()),H||D)for(var it=0,ze=this._order;it<ze.length;it+=1){var ot=this._layers[ze[it]];ot.type==="symbol"&&this.placement.updateLayerOpacities(ot,ae[ot.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},u.prototype.getImages=function(o,h,g){this.imageManager.getImages(h.icons,g),this._updateTilesForChangedImages();var b=this.sourceCaches[h.source];b&&b.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(o,h,g){this.glyphManager.getGlyphs(h.stacks,g)},u.prototype.getResource=function(o,h,g){return d.makeRequest(h,g)},u}(d.Evented);bs.getSourceType=function(i){return kr[i]},bs.setSourceType=function(i,u){kr[i]=u},bs.registerForPluginStateChange=d.registerForPluginStateChange;var Ca=d.createLayout([{name:"a_pos",type:"Int16",components:2}]),To=Qi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),mu=Qi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),wl=Qi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Vu=Qi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Wl=Qi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),rl=Qi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),yu=Qi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Na=Qi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Gu=Qi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=Qi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),S=Qi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),j=Qi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Qi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ue=Qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Oe=Qi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),st=Qi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Lt=Qi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Mt=Qi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),wr=Qi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),jr=Qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),qn=Qi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Pi=Qi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),ci=Qi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ei=Qi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Ea=Qi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Fa=Qi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Qi(i,u){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),g=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=b?b.concat(g):g,D={};return{fragmentSource:i=i.replace(o,function(H,ae,Se,we,Pe){return D[Pe]=!0,ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
varying `+Se+" "+we+" "+Pe+`;
#else
uniform `+Se+" "+we+" u_"+Pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Pe+`
    `+Se+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),vertexSource:u=u.replace(o,function(H,ae,Se,we,Pe){var He=we==="float"?"vec2":"vec4",je=Pe.match(/color/)?"color":He;return D[Pe]?ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+Se+" "+He+" a_"+Pe+`;
varying `+Se+" "+we+" "+Pe+`;
#else
uniform `+Se+" "+we+" u_"+Pe+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = a_"+Pe+`;
#else
    `+Se+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = unpack_mix_"+je+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+Se+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:ae==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+Se+" "+He+" a_"+Pe+`;
#else
uniform `+Se+" "+we+" u_"+Pe+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Se+" "+we+" "+Pe+" = a_"+Pe+`;
#else
    `+Se+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Se+" "+we+" "+Pe+" = unpack_mix_"+je+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+Se+" "+we+" "+Pe+" = u_"+Pe+`;
#endif
`}),staticAttributes:h,staticUniforms:P}}var hs=Object.freeze({__proto__:null,prelude:To,background:mu,backgroundPattern:wl,circle:Vu,clippingMask:Wl,heatmap:rl,heatmapTexture:yu,collisionBox:Na,collisionCircle:Gu,debug:m,fill:S,fillOutline:j,fillOutlinePattern:O,fillPattern:ue,fillExtrusion:Oe,fillExtrusionPattern:st,hillshadePrepare:Lt,hillshade:Mt,line:wr,lineGradient:jr,linePattern:qn,lineSDF:Pi,raster:ci,symbolIcon:ei,symbolSDF:Ea,symbolTextAndIcon:Fa}),go=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Ms(i){for(var u=[],o=0;o<i.length;o++)if(i[o]!==null){var h=i[o].split(" ");u.push(h.pop())}return u}go.prototype.bind=function(i,u,o,h,g,b,P,D){this.context=i;for(var H=this.boundPaintVertexBuffers.length!==h.length,ae=0;!H&&ae<h.length;ae++)this.boundPaintVertexBuffers[ae]!==h[ae]&&(H=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===o&&!H&&this.boundIndexBuffer===g&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===D?(i.bindVertexArrayOES.set(this.vao),P&&P.bind(),g&&g.dynamicDraw&&g.bind(),D&&D.bind()):this.freshBind(u,o,h,g,b,P,D)},go.prototype.freshBind=function(i,u,o,h,g,b,P){var D,H=i.numAttributes,ae=this.context,Se=ae.gl;if(ae.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ae.extVertexArrayObject.createVertexArrayOES(),ae.bindVertexArrayOES.set(this.vao),D=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=P;else{D=ae.currentNumAttributes||0;for(var we=H;we<D;we++)Se.disableVertexAttribArray(we)}u.enableAttributes(Se,i);for(var Pe=0,He=o;Pe<He.length;Pe+=1)He[Pe].enableAttributes(Se,i);b&&b.enableAttributes(Se,i),P&&P.enableAttributes(Se,i),u.bind(),u.setVertexAttribPointers(Se,i,g);for(var je=0,it=o;je<it.length;je+=1){var ze=it[je];ze.bind(),ze.setVertexAttribPointers(Se,i,g)}b&&(b.bind(),b.setVertexAttribPointers(Se,i,g)),h&&h.bind(),P&&(P.bind(),P.setVertexAttribPointers(Se,i,g)),ae.currentNumAttributes=H},go.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var iu=function(i,u,o,h,g,b){var P=i.gl;this.program=P.createProgram();for(var D=Ms(o.staticAttributes),H=h?h.getBinderAttributes():[],ae=D.concat(H),Se=o.staticUniforms?Ms(o.staticUniforms):[],we=h?h.getBinderUniforms():[],Pe=[],He=0,je=Se.concat(we);He<je.length;He+=1){var it=je[He];Pe.indexOf(it)<0&&Pe.push(it)}var ze=h?h.defines():[];b&&ze.push("#define OVERDRAW_INSPECTOR;");var ot=ze.concat(To.fragmentSource,o.fragmentSource).join(`
`),bt=ze.concat(To.vertexSource,o.vertexSource).join(`
`),Zt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Zt,ot),P.compileShader(Zt),P.attachShader(this.program,Zt);var fr=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(fr,bt),P.compileShader(fr),P.attachShader(this.program,fr),this.attributes={};var ur={};this.numAttributes=ae.length;for(var gr=0;gr<this.numAttributes;gr++)ae[gr]&&(P.bindAttribLocation(this.program,gr,ae[gr]),this.attributes[ae[gr]]=gr);P.linkProgram(this.program),P.deleteShader(fr),P.deleteShader(Zt);for(var Nr=0;Nr<Pe.length;Nr++){var an=Pe[Nr];if(an&&!ur[an]){var Hr=P.getUniformLocation(this.program,an);Hr&&(ur[an]=Hr)}}this.fixedUniforms=g(i,ur),this.binderUniforms=h?h.getUniforms(i,ur):[]}}};function Ds(i,u,o){var h=1/Zi(o,1,u.transform.tileZoom),g=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,u.transform.tileZoom)/g,P=b*(o.tileID.canonical.x+o.tileID.wrap*g),D=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[65535&P,65535&D]}}iu.prototype.draw=function(i,u,o,h,g,b,P,D,H,ae,Se,we,Pe,He,je,it){var ze,ot=i.gl;if(!this.failedToCreate){for(var bt in i.program.set(this.program),i.setDepthMode(o),i.setStencilMode(h),i.setColorMode(g),i.setCullFace(b),this.fixedUniforms)this.fixedUniforms[bt].set(P[bt]);He&&He.setUniforms(i,this.binderUniforms,we,{zoom:Pe});for(var Zt=(ze={},ze[ot.LINES]=2,ze[ot.TRIANGLES]=3,ze[ot.LINE_STRIP]=1,ze)[u],fr=0,ur=Se.get();fr<ur.length;fr+=1){var gr=ur[fr],Nr=gr.vaos||(gr.vaos={});(Nr[D]||(Nr[D]=new go)).bind(i,this,H,He?He.getPaintVertexBuffers():[],ae,gr.vertexOffset,je,it),ot.drawElements(u,gr.primitiveLength*Zt,ot.UNSIGNED_SHORT,gr.primitiveOffset*Zt*2)}}};var nl=function(i,u,o,h){var g=u.style.light,b=g.properties.get("position"),P=[b.x,b.y,b.z],D=d.create$1();g.properties.get("anchor")==="viewport"&&d.fromRotation(D,-u.transform.angle),d.transformMat3(P,P,D);var H=g.properties.get("color");return{u_matrix:i,u_lightpos:P,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+o,u_opacity:h}},Ws=function(i,u,o,h,g,b,P){return d.extend(nl(i,u,o,h),Ds(b,u,P),{u_height_factor:-Math.pow(2,g.overscaledZ)/P.tileSize/8})},Xs=function(i){return{u_matrix:i}},Ys=function(i,u,o,h){return d.extend(Xs(i),Ds(o,u,h))},io=function(i,u){return{u_matrix:i,u_world:u}},Cu=function(i,u,o,h,g){return d.extend(Ys(i,u,o,h),{u_world:g})},il=function(i,u,o,h){var g,b,P=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var D=Zi(o,1,P.zoom);g=!0,b=[D,D]}else g=!1,b=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:d.browser.devicePixelRatio,u_extrude_scale:b}},ps=function(i,u,o){var h=Zi(o,1,u.zoom),g=Math.pow(2,u.zoom-o.tileID.overscaledZ),b=o.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*g),u.pixelsToGLUnits[1]/(h*g)],u_overscale_factor:b}},Xl=function(i,u,o){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},au=function(i,u,o){return o===void 0&&(o=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:o}},Fs=function(i){return{u_matrix:i}},hc=function(i,u,o,h){return{u_matrix:i,u_extrude_scale:Zi(u,1,o),u_intensity:h}},Au=function(i,u,o){var h=i.transform;return{u_matrix:pc(i,u,o),u_ratio:1/Zi(u,1,h.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Aa=function(i,u,o,h){return d.extend(Au(i,u,o),{u_image:0,u_image_height:h})},Tu=function(i,u,o,h){var g=i.transform,b=Pu(u,g);return{u_matrix:pc(i,u,o),u_texsize:u.imageAtlasTexture.size,u_ratio:1/Zi(u,1,g.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_image:0,u_scale:[b,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Yl=function(i,u,o,h,g){var b=i.lineAtlas,P=Pu(u,i.transform),D=o.layout.get("line-cap")==="round",H=b.getDash(h.from,D),ae=b.getDash(h.to,D),Se=H.width*g.fromScale,we=ae.width*g.toScale;return d.extend(Au(i,u,o),{u_patternscale_a:[P/Se,-H.height/2],u_patternscale_b:[P/we,-ae.height/2],u_sdfgamma:b.width/(256*Math.min(Se,we)*d.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:ae.y,u_mix:g.t})};function Pu(i,u){return 1/Zi(i,1,u.tileZoom)}function pc(i,u,o){return i.translatePosMatrix(u.tileID.posMatrix,u,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var dc=function(i,u,o,h,g){return{u_matrix:i,u_tl_parent:u,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(P=g.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Dc(g.paint.get("raster-hue-rotate"))};var b,P};function Dc(i){i*=Math.PI/180;var u=Math.sin(i),o=Math.cos(i);return[(2*o+1)/3,(-Math.sqrt(3)*u-o+1)/3,(Math.sqrt(3)*u-o+1)/3]}var Fc,Cl=function(i,u,o,h,g,b,P,D,H,ae){var Se=g.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:Se.cameraToCenterDistance,u_pitch:Se.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:Se.width/Se.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:P,u_coord_matrix:D,u_is_text:+H,u_pitch_with_map:+h,u_texsize:ae,u_texture:0}},gu=function(i,u,o,h,g,b,P,D,H,ae,Se){var we=g.transform;return d.extend(Cl(i,u,o,h,g,b,P,D,H,ae),{u_gamma_scale:h?Math.cos(we._pitch)*we.cameraToCenterDistance:1,u_device_pixel_ratio:d.browser.devicePixelRatio,u_is_halo:+Se})},al=function(i,u,o,h,g,b,P,D,H,ae){return d.extend(gu(i,u,o,h,g,b,P,D,!0,H,!0),{u_texsize_icon:ae,u_texture_icon:1})},ol=function(i,u,o){return{u_matrix:i,u_opacity:u,u_color:o}},Hu=function(i,u,o,h,g,b){return d.extend(function(P,D,H,ae){var Se=H.imageManager.getPattern(P.from.toString()),we=H.imageManager.getPattern(P.to.toString()),Pe=H.imageManager.getPixelSize(),He=Pe.width,je=Pe.height,it=Math.pow(2,ae.tileID.overscaledZ),ze=ae.tileSize*Math.pow(2,H.transform.tileZoom)/it,ot=ze*(ae.tileID.canonical.x+ae.tileID.wrap*it),bt=ze*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Se.tl,u_pattern_br_a:Se.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[He,je],u_mix:D.t,u_pattern_size_a:Se.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/Zi(ae,1,H.transform.tileZoom),u_pixel_coord_upper:[ot>>16,bt>>16],u_pixel_coord_lower:[65535&ot,65535&bt]}}(h,b,o,g),{u_matrix:i,u_opacity:u})},sl={fillExtrusion:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new d.Uniform1f(i,u.u_height_factor),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new d.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new d.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new d.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new d.UniformColor(i,u.u_color),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_overlay:new d.Uniform1i(i,u.u_overlay),u_overlay_scale:new d.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new d.Uniform1f(i,u.u_extrude_scale),u_intensity:new d.Uniform1f(i,u.u_intensity),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_color_ramp:new d.Uniform1i(i,u.u_color_ramp),u_opacity:new d.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_latrange:new d.Uniform2f(i,u.u_latrange),u_light:new d.Uniform2f(i,u.u_light),u_shadow:new d.UniformColor(i,u.u_shadow),u_highlight:new d.UniformColor(i,u.u_highlight),u_accent:new d.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_dimension:new d.Uniform2f(i,u.u_dimension),u_zoom:new d.Uniform1f(i,u.u_zoom),u_unpack:new d.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_image:new d.Uniform1i(i,u.u_image),u_image_height:new d.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_texsize:new d.Uniform2f(i,u.u_texsize),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_image:new d.Uniform1i(i,u.u_image),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new d.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new d.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new d.Uniform1f(i,u.u_sdfgamma),u_image:new d.Uniform1i(i,u.u_image),u_tex_y_a:new d.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new d.Uniform1f(i,u.u_tex_y_b),u_mix:new d.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new d.Uniform2f(i,u.u_tl_parent),u_scale_parent:new d.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new d.Uniform1f(i,u.u_buffer_scale),u_fade_t:new d.Uniform1f(i,u.u_fade_t),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image0:new d.Uniform1i(i,u.u_image0),u_image1:new d.Uniform1i(i,u.u_image1),u_brightness_low:new d.Uniform1f(i,u.u_brightness_low),u_brightness_high:new d.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new d.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new d.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new d.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texsize_icon:new d.Uniform2f(i,u.u_texsize_icon),u_texture:new d.Uniform1i(i,u.u_texture),u_texture_icon:new d.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_color:new d.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image:new d.Uniform1i(i,u.u_image),u_pattern_tl_a:new d.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(i,u.u_pattern_br_b),u_texsize:new d.Uniform2f(i,u.u_texsize),u_mix:new d.Uniform1f(i,u.u_mix),u_pattern_size_a:new d.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new d.Uniform1f(i,u.u_scale_a),u_scale_b:new d.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(i,u.u_tile_units_to_pixels)}}};function Wu(i,u,o,h,g,b,P){for(var D=i.context,H=D.gl,ae=i.useProgram("collisionBox"),Se=[],we=0,Pe=0,He=0;He<h.length;He++){var je=h[He],it=u.getTile(je),ze=it.getBucket(o);if(ze){var ot=je.posMatrix;g[0]===0&&g[1]===0||(ot=i.translatePosMatrix(je.posMatrix,it,g,b));var bt=P?ze.textCollisionBox:ze.iconCollisionBox,Zt=ze.collisionCircleArray;if(Zt.length>0){var fr=d.create(),ur=ot;d.mul(fr,ze.placementInvProjMatrix,i.transform.glCoordMatrix),d.mul(fr,fr,ze.placementViewportMatrix),Se.push({circleArray:Zt,circleOffset:Pe,transform:ur,invTransform:fr}),Pe=we+=Zt.length/4}bt&&ae.draw(D,H.LINES,z.disabled,oe.disabled,i.colorModeForRenderPass(),Ae.disabled,ps(ot,i.transform,it),o.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,i.transform.zoom,null,null,bt.collisionVertexBuffer)}}if(P&&Se.length){var gr=i.useProgram("collisionCircle"),Nr=new d.StructArrayLayout2f1f2i16;Nr.resize(4*we),Nr._trim();for(var an=0,Hr=0,Rn=Se;Hr<Rn.length;Hr+=1)for(var ri=Rn[Hr],hi=0;hi<ri.circleArray.length/4;hi++){var ni=4*hi,ea=ri.circleArray[ni+0],Un=ri.circleArray[ni+1],gi=ri.circleArray[ni+2],te=ri.circleArray[ni+3];Nr.emplace(an++,ea,Un,gi,te,0),Nr.emplace(an++,ea,Un,gi,te,1),Nr.emplace(an++,ea,Un,gi,te,2),Nr.emplace(an++,ea,Un,gi,te,3)}(!Fc||Fc.length<2*we)&&(Fc=function(wt){var At=2*wt,qt=new d.StructArrayLayout3ui6;qt.resize(At),qt._trim();for(var Pr=0;Pr<At;Pr++){var mn=6*Pr;qt.uint16[mn+0]=4*Pr+0,qt.uint16[mn+1]=4*Pr+1,qt.uint16[mn+2]=4*Pr+2,qt.uint16[mn+3]=4*Pr+2,qt.uint16[mn+4]=4*Pr+3,qt.uint16[mn+5]=4*Pr+0}return qt}(we));for(var q=D.createIndexBuffer(Fc,!0),R=D.createVertexBuffer(Nr,d.collisionCircleLayout.members,!0),F=0,re=Se;F<re.length;F+=1){var pe=re[F],dt=Xl(pe.transform,pe.invTransform,i.transform);gr.draw(D,H.TRIANGLES,z.disabled,oe.disabled,i.colorModeForRenderPass(),Ae.disabled,dt,o.id,R,q,d.SegmentVector.simpleSegment(0,2*pe.circleOffset,pe.circleArray.length,pe.circleArray.length/2),null,i.transform.zoom,null,null,null)}R.destroy(),q.destroy()}}var Bs=d.identity(new Float32Array(16));function vc(i,u,o,h,g,b){var P=d.getAnchorAlignment(i),D=-(P.horizontalAlign-.5)*u,H=-(P.verticalAlign-.5)*o,ae=d.evaluateVariableOffset(i,h);return new d.Point((D/g+ae[0])*b,(H/g+ae[1])*b)}function mc(i,u,o,h,g,b,P,D,H,ae,Se){var we=i.text.placedSymbolArray,Pe=i.text.dynamicLayoutVertexArray,He=i.icon.dynamicLayoutVertexArray,je={};Pe.clear();for(var it=0;it<we.length;it++){var ze=we.get(it),ot=ze.hidden||!ze.crossTileID||i.allowVerticalPlacement&&!ze.placedOrientation?null:h[ze.crossTileID];if(ot){var bt=new d.Point(ze.anchorX,ze.anchorY),Zt=ti(bt,o?D:P),fr=Gi(b.cameraToCenterDistance,Zt.signedDistanceFromCamera),ur=g.evaluateSizeForFeature(i.textSizeData,ae,ze)*fr/d.ONE_EM;o&&(ur*=i.tilePixelRatio/H);for(var gr=vc(ot.anchor,ot.width,ot.height,ot.textOffset,ot.textBoxScale,ur),Nr=o?ti(bt.add(gr),P).point:Zt.point.add(u?gr.rotate(-b.angle):gr),an=i.allowVerticalPlacement&&ze.placedOrientation===d.WritingMode.vertical?Math.PI/2:0,Hr=0;Hr<ze.numGlyphs;Hr++)d.addDynamicAttributes(Pe,Nr,an);Se&&ze.associatedIconIndex>=0&&(je[ze.associatedIconIndex]={shiftedAnchor:Nr,angle:an})}else Wa(ze.numGlyphs,Pe)}if(Se){He.clear();for(var Rn=i.icon.placedSymbolArray,ri=0;ri<Rn.length;ri++){var hi=Rn.get(ri);if(hi.hidden)Wa(hi.numGlyphs,He);else{var ni=je[ri];if(ni)for(var ea=0;ea<hi.numGlyphs;ea++)d.addDynamicAttributes(He,ni.shiftedAnchor,ni.angle);else Wa(hi.numGlyphs,He)}}i.icon.dynamicLayoutVertexBuffer.updateData(He)}i.text.dynamicLayoutVertexBuffer.updateData(Pe)}function Bc(i,u,o){return o.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function Xu(i,u,o,h,g,b,P,D,H,ae,Se,we){for(var Pe=i.context,He=Pe.gl,je=i.transform,it=D==="map",ze=H==="map",ot=it&&o.layout.get("symbol-placement")!=="point",bt=it&&!ze&&!ot,Zt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,fr=!1,ur=i.depthModeForSublayer(0,z.ReadOnly),gr=o.layout.get("text-variable-anchor"),Nr=[],an=0,Hr=h;an<Hr.length;an+=1){var Rn=Hr[an],ri=u.getTile(Rn),hi=ri.getBucket(o);if(hi){var ni=g?hi.text:hi.icon;if(ni&&ni.segments.get().length){var ea=ni.programConfigurations.get(o.id),Un=g||hi.sdfIcons,gi=g?hi.textSizeData:hi.iconSizeData,te=ze||je.pitch!==0,q=i.useProgram(Bc(Un,g,hi),ea),R=d.evaluateSizeForZoom(gi,je.zoom),F=void 0,re=[0,0],pe=void 0,dt=void 0,wt=null,At=void 0;if(g)pe=ri.glyphAtlasTexture,dt=He.LINEAR,F=ri.glyphAtlasTexture.size,hi.iconsInText&&(re=ri.imageAtlasTexture.size,wt=ri.imageAtlasTexture,At=te||i.options.rotating||i.options.zooming||gi.kind==="composite"||gi.kind==="camera"?He.LINEAR:He.NEAREST);else{var qt=o.layout.get("icon-size").constantOr(0)!==1||hi.iconsNeedLinear;pe=ri.imageAtlasTexture,dt=Un||i.options.rotating||i.options.zooming||qt||te?He.LINEAR:He.NEAREST,F=ri.imageAtlasTexture.size}var Pr=Zi(ri,1,i.transform.zoom),mn=ba(Rn.posMatrix,ze,it,i.transform,Pr),Zn=ai(Rn.posMatrix,ze,it,i.transform,Pr),Jn=gr&&hi.hasTextData(),_i=o.layout.get("icon-text-fit")!=="none"&&Jn&&hi.hasIconData();ot&&Xo(hi,Rn.posMatrix,i,g,mn,Zn,ze,ae);var si=i.translatePosMatrix(Rn.posMatrix,ri,b,P),ji=ot||g&&gr||_i?Bs:mn,$i=i.translatePosMatrix(Zn,ri,b,P,!0),xa=Un&&o.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0,ao={program:q,buffers:ni,uniformValues:Un?hi.iconsInText?al(gi.kind,R,bt,ze,i,si,ji,$i,F,re):gu(gi.kind,R,bt,ze,i,si,ji,$i,g,F,!0):Cl(gi.kind,R,bt,ze,i,si,ji,$i,g,F),atlasTexture:pe,atlasTextureIcon:wt,atlasInterpolation:dt,atlasInterpolationIcon:At,isSDF:Un,hasHalo:xa};if(Zt&&hi.canOverlap){fr=!0;for(var La=0,co=ni.segments.get();La<co.length;La+=1){var Ga=co[La];Nr.push({segments:new d.SegmentVector([Ga]),sortKey:Ga.sortKey,state:ao})}}else Nr.push({segments:ni.segments,sortKey:0,state:ao})}}}fr&&Nr.sort(function(bo,Fo){return bo.sortKey-Fo.sortKey});for(var ta=0,va=Nr;ta<va.length;ta+=1){var za=va[ta],fa=za.state;if(Pe.activeTexture.set(He.TEXTURE0),fa.atlasTexture.bind(fa.atlasInterpolation,He.CLAMP_TO_EDGE),fa.atlasTextureIcon&&(Pe.activeTexture.set(He.TEXTURE1),fa.atlasTextureIcon&&fa.atlasTextureIcon.bind(fa.atlasInterpolationIcon,He.CLAMP_TO_EDGE)),fa.isSDF){var Ta=fa.uniformValues;fa.hasHalo&&(Ta.u_is_halo=1,Al(fa.buffers,za.segments,o,i,fa.program,ur,Se,we,Ta)),Ta.u_is_halo=0}Al(fa.buffers,za.segments,o,i,fa.program,ur,Se,we,fa.uniformValues)}}function Al(i,u,o,h,g,b,P,D,H){var ae=h.context;g.draw(ae,ae.gl.TRIANGLES,b,P,D,Ae.disabled,H,o.id,i.layoutVertexBuffer,i.indexBuffer,u,o.paint,h.transform.zoom,i.programConfigurations.get(o.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function Kl(i,u,o,h,g,b,P){var D,H,ae,Se,we,Pe=i.context.gl,He=o.paint.get("fill-pattern"),je=He&&He.constantOr(1),it=o.getCrossfadeParameters();P?(H=je&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=Pe.LINES):(H=je?"fillPattern":"fill",D=Pe.TRIANGLES);for(var ze=0,ot=h;ze<ot.length;ze+=1){var bt=ot[ze],Zt=u.getTile(bt);if(!je||Zt.patternsLoaded()){var fr=Zt.getBucket(o);if(fr){var ur=fr.programConfigurations.get(o.id),gr=i.useProgram(H,ur);je&&(i.context.activeTexture.set(Pe.TEXTURE0),Zt.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),ur.updatePaintBuffers(it));var Nr=He.constantOr(null);if(Nr&&Zt.imageAtlas){var an=Zt.imageAtlas,Hr=an.patternPositions[Nr.to.toString()],Rn=an.patternPositions[Nr.from.toString()];Hr&&Rn&&ur.setConstantPatternPositions(Hr,Rn)}var ri=i.translatePosMatrix(bt.posMatrix,Zt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(P){Se=fr.indexBuffer2,we=fr.segments2;var hi=[Pe.drawingBufferWidth,Pe.drawingBufferHeight];ae=H==="fillOutlinePattern"&&je?Cu(ri,i,it,Zt,hi):io(ri,hi)}else Se=fr.indexBuffer,we=fr.segments,ae=je?Ys(ri,i,it,Zt):Xs(ri);gr.draw(i.context,D,g,i.stencilModeForClipping(bt),b,Ae.disabled,ae,o.id,fr.layoutVertexBuffer,Se,we,o.paint,i.transform.zoom,ur)}}}}function yc(i,u,o,h,g,b,P){for(var D=i.context,H=D.gl,ae=o.paint.get("fill-extrusion-pattern"),Se=ae.constantOr(1),we=o.getCrossfadeParameters(),Pe=o.paint.get("fill-extrusion-opacity"),He=0,je=h;He<je.length;He+=1){var it=je[He],ze=u.getTile(it),ot=ze.getBucket(o);if(ot){var bt=ot.programConfigurations.get(o.id),Zt=i.useProgram(Se?"fillExtrusionPattern":"fillExtrusion",bt);Se&&(i.context.activeTexture.set(H.TEXTURE0),ze.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),bt.updatePaintBuffers(we));var fr=ae.constantOr(null);if(fr&&ze.imageAtlas){var ur=ze.imageAtlas,gr=ur.patternPositions[fr.to.toString()],Nr=ur.patternPositions[fr.from.toString()];gr&&Nr&&bt.setConstantPatternPositions(gr,Nr)}var an=i.translatePosMatrix(it.posMatrix,ze,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Hr=o.paint.get("fill-extrusion-vertical-gradient"),Rn=Se?Ws(an,i,Hr,Pe,it,we,ze):nl(an,i,Hr,Pe);Zt.draw(D,D.gl.TRIANGLES,g,b,P,Ae.backCCW,Rn,o.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,o.paint,i.transform.zoom,bt)}}}function Yu(i,u,o,h,g,b){var P=i.context,D=P.gl,H=u.fbo;if(H){var ae=i.useProgram("hillshade");P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,H.colorAttachment.get());var Se=function(we,Pe,He){var je=He.paint.get("hillshade-shadow-color"),it=He.paint.get("hillshade-highlight-color"),ze=He.paint.get("hillshade-accent-color"),ot=He.paint.get("hillshade-illumination-direction")*(Math.PI/180);He.paint.get("hillshade-illumination-anchor")==="viewport"&&(ot-=we.transform.angle);var bt,Zt,fr,ur=!we.options.moving;return{u_matrix:we.transform.calculatePosMatrix(Pe.tileID.toUnwrapped(),ur),u_image:0,u_latrange:(bt=Pe.tileID,Zt=Math.pow(2,bt.canonical.z),fr=bt.canonical.y,[new d.MercatorCoordinate(0,fr/Zt).toLngLat().lat,new d.MercatorCoordinate(0,(fr+1)/Zt).toLngLat().lat]),u_light:[He.paint.get("hillshade-exaggeration"),ot],u_shadow:je,u_highlight:it,u_accent:ze}}(i,u,o);ae.draw(P,D.TRIANGLES,h,g,b,Ae.disabled,Se,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function Tl(i,u,o,h,g,b){var P=i.context,D=P.gl,H=u.dem;if(H&&H.data){var ae=H.dim,Se=H.stride,we=H.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(Se),u.demTexture){var Pe=u.demTexture;Pe.update(we,{premultiply:!1}),Pe.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else u.demTexture=new d.Texture(P,we,D.RGBA,{premultiply:!1}),u.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);var He=u.fbo;if(!He){var je=new d.Texture(P,{width:ae,height:ae,data:null},D.RGBA);je.bind(D.LINEAR,D.CLAMP_TO_EDGE),(He=u.fbo=P.createFramebuffer(ae,ae,!0)).colorAttachment.set(je.texture)}P.bindFramebuffer.set(He.framebuffer),P.viewport.set([0,0,ae,ae]),i.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,h,g,b,Ae.disabled,function(it,ze){var ot=ze.stride,bt=d.create();return d.ortho(bt,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(bt,bt,[0,-d.EXTENT,0]),{u_matrix:bt,u_image:1,u_dimension:[ot,ot],u_zoom:it.overscaledZ,u_unpack:ze.getUnpackVector()}}(u.tileID,H),o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Pl(i,u,o,h,g){var b=h.paint.get("raster-fade-duration");if(b>0){var P=d.browser.now(),D=(P-i.timeAdded)/b,H=u?(P-u.timeAdded)/b:-1,ae=o.getSource(),Se=g.coveringZoomLevel({tileSize:ae.tileSize,roundZoom:ae.roundZoom}),we=!u||Math.abs(u.tileID.overscaledZ-Se)>Math.abs(i.tileID.overscaledZ-Se),Pe=we&&i.refreshedUponExpiration?1:d.clamp(we?D:1-H,0,1);return i.refreshedUponExpiration&&D>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Pe}:{opacity:Pe,mix:0}}return{opacity:1,mix:0}}var Mu=new d.Color(1,0,0,1),$l=new d.Color(0,1,0,1),Ua=new d.Color(0,0,1,1),Iu=new d.Color(1,0,1,1),ul=new d.Color(0,1,1,1);function Jl(i,u,o,h){Ku(i,0,u+o/2,i.transform.width,o,h)}function Ql(i,u,o,h){Ku(i,u-o/2,0,o,i.transform.height,h)}function Ku(i,u,o,h,g,b){var P=i.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(u*d.browser.devicePixelRatio,o*d.browser.devicePixelRatio,h*d.browser.devicePixelRatio,g*d.browser.devicePixelRatio),P.clear({color:b}),D.disable(D.SCISSOR_TEST)}function Jc(i,u,o){var h=i.context,g=h.gl,b=o.posMatrix,P=i.useProgram("debug"),D=z.disabled,H=oe.disabled,ae=i.colorModeForRenderPass();h.activeTexture.set(g.TEXTURE0),i.emptyTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),P.draw(h,g.LINE_STRIP,D,H,ae,Ae.disabled,au(b,d.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var Se=u.getTileByID(o.key).latestRawTileData,we=Math.floor((Se&&Se.byteLength||0)/1024),Pe=u.getTile(o).tileSize,He=512/Math.min(Pe,512)*(o.overscaledZ/i.transform.zoom)*.5,je=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(je+=" => "+o.overscaledZ),function(it,ze){it.initDebugOverlayCanvas();var ot=it.debugOverlayCanvas,bt=it.context.gl,Zt=it.debugOverlayCanvas.getContext("2d");Zt.clearRect(0,0,ot.width,ot.height),Zt.shadowColor="white",Zt.shadowBlur=2,Zt.lineWidth=1.5,Zt.strokeStyle="white",Zt.textBaseline="top",Zt.font="bold 36px Open Sans, sans-serif",Zt.fillText(ze,5,5),Zt.strokeText(ze,5,5),it.debugOverlayTexture.update(ot),it.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(i,je+" "+we+"kb"),P.draw(h,g.TRIANGLES,D,H,me.alphaBlended,Ae.disabled,au(b,d.Color.transparent,He),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var ll={symbol:function(i,u,o,h,g){if(i.renderPass==="translucent"){var b=oe.disabled,P=i.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(D,H,ae,Se,we,Pe,He){for(var je=H.transform,it=we==="map",ze=Pe==="map",ot=0,bt=D;ot<bt.length;ot+=1){var Zt=bt[ot],fr=Se.getTile(Zt),ur=fr.getBucket(ae);if(ur&&ur.text&&ur.text.segments.get().length){var gr=d.evaluateSizeForZoom(ur.textSizeData,je.zoom),Nr=Zi(fr,1,H.transform.zoom),an=ba(Zt.posMatrix,ze,it,H.transform,Nr),Hr=ae.layout.get("icon-text-fit")!=="none"&&ur.hasIconData();if(gr){var Rn=Math.pow(2,je.zoom-fr.tileID.overscaledZ);mc(ur,it,ze,He,d.symbolSize,je,an,Zt.posMatrix,Rn,gr,Hr)}}}}(h,i,o,u,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),g),o.paint.get("icon-opacity").constantOr(1)!==0&&Xu(i,u,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),b,P),o.paint.get("text-opacity").constantOr(1)!==0&&Xu(i,u,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),b,P),u.map.showCollisionBoxes&&(Wu(i,u,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),Wu(i,u,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,o,h){if(i.renderPass==="translucent"){var g=o.paint.get("circle-opacity"),b=o.paint.get("circle-stroke-width"),P=o.paint.get("circle-stroke-opacity"),D=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(g.constantOr(1)!==0||b.constantOr(1)!==0&&P.constantOr(1)!==0){for(var H=i.context,ae=H.gl,Se=i.depthModeForSublayer(0,z.ReadOnly),we=oe.disabled,Pe=i.colorModeForRenderPass(),He=[],je=0;je<h.length;je++){var it=h[je],ze=u.getTile(it),ot=ze.getBucket(o);if(ot){var bt=ot.programConfigurations.get(o.id),Zt={programConfiguration:bt,program:i.useProgram("circle",bt),layoutVertexBuffer:ot.layoutVertexBuffer,indexBuffer:ot.indexBuffer,uniformValues:il(i,it,ze,o)};if(D)for(var fr=0,ur=ot.segments.get();fr<ur.length;fr+=1){var gr=ur[fr];He.push({segments:new d.SegmentVector([gr]),sortKey:gr.sortKey,state:Zt})}else He.push({segments:ot.segments,sortKey:0,state:Zt})}}D&&He.sort(function(ri,hi){return ri.sortKey-hi.sortKey});for(var Nr=0,an=He;Nr<an.length;Nr+=1){var Hr=an[Nr],Rn=Hr.state;Rn.program.draw(H,ae.TRIANGLES,Se,we,Pe,Ae.disabled,Rn.uniformValues,o.id,Rn.layoutVertexBuffer,Rn.indexBuffer,Hr.segments,o.paint,i.transform.zoom,Rn.programConfiguration)}}}},heatmap:function(i,u,o,h){if(o.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var g=i.context,b=g.gl,P=oe.disabled,D=new me([b.ONE,b.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(He,je,it){var ze=He.gl;He.activeTexture.set(ze.TEXTURE1),He.viewport.set([0,0,je.width/4,je.height/4]);var ot=it.heatmapFbo;if(ot)ze.bindTexture(ze.TEXTURE_2D,ot.colorAttachment.get()),He.bindFramebuffer.set(ot.framebuffer);else{var bt=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,bt),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),ot=it.heatmapFbo=He.createFramebuffer(je.width/4,je.height/4,!1),function(Zt,fr,ur,gr){var Nr=Zt.gl;Nr.texImage2D(Nr.TEXTURE_2D,0,Nr.RGBA,fr.width/4,fr.height/4,0,Nr.RGBA,Zt.extRenderToTextureHalfFloat?Zt.extTextureHalfFloat.HALF_FLOAT_OES:Nr.UNSIGNED_BYTE,null),gr.colorAttachment.set(ur)}(He,je,bt,ot)}})(g,i,o),g.clear({color:d.Color.transparent});for(var H=0;H<h.length;H++){var ae=h[H];if(!u.hasRenderableParent(ae)){var Se=u.getTile(ae),we=Se.getBucket(o);if(we){var Pe=we.programConfigurations.get(o.id);i.useProgram("heatmap",Pe).draw(g,b.TRIANGLES,z.disabled,P,D,Ae.disabled,hc(ae.posMatrix,Se,i.transform.zoom,o.paint.get("heatmap-intensity")),o.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,o.paint,i.transform.zoom,Pe)}}}g.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(He,je){var it=He.context,ze=it.gl,ot=je.heatmapFbo;if(ot){it.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,ot.colorAttachment.get()),it.activeTexture.set(ze.TEXTURE1);var bt=je.colorRampTexture;bt||(bt=je.colorRampTexture=new d.Texture(it,je.colorRamp,ze.RGBA)),bt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),He.useProgram("heatmapTexture").draw(it,ze.TRIANGLES,z.disabled,oe.disabled,He.colorModeForRenderPass(),Ae.disabled,function(Zt,fr,ur,gr){var Nr=d.create();d.ortho(Nr,0,Zt.width,Zt.height,0,0,1);var an=Zt.context.gl;return{u_matrix:Nr,u_world:[an.drawingBufferWidth,an.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:fr.paint.get("heatmap-opacity")}}(He,je),je.id,He.viewportBuffer,He.quadTriangleIndexBuffer,He.viewportSegments,je.paint,He.transform.zoom)}}(i,o))},line:function(i,u,o,h){if(i.renderPass==="translucent"){var g=o.paint.get("line-opacity"),b=o.paint.get("line-width");if(g.constantOr(1)!==0&&b.constantOr(1)!==0)for(var P=i.depthModeForSublayer(0,z.ReadOnly),D=i.colorModeForRenderPass(),H=o.paint.get("line-dasharray"),ae=o.paint.get("line-pattern"),Se=ae.constantOr(1),we=o.paint.get("line-gradient"),Pe=o.getCrossfadeParameters(),He=Se?"linePattern":H?"lineSDF":we?"lineGradient":"line",je=i.context,it=je.gl,ze=!0,ot=0,bt=h;ot<bt.length;ot+=1){var Zt=bt[ot],fr=u.getTile(Zt);if(!Se||fr.patternsLoaded()){var ur=fr.getBucket(o);if(ur){var gr=ur.programConfigurations.get(o.id),Nr=i.context.program.get(),an=i.useProgram(He,gr),Hr=ze||an.program!==Nr,Rn=ae.constantOr(null);if(Rn&&fr.imageAtlas){var ri=fr.imageAtlas,hi=ri.patternPositions[Rn.to.toString()],ni=ri.patternPositions[Rn.from.toString()];hi&&ni&&gr.setConstantPatternPositions(hi,ni)}var ea=Se?Tu(i,fr,o,Pe):H?Yl(i,fr,o,H,Pe):we?Aa(i,fr,o,ur.lineClipsArray.length):Au(i,fr,o);if(Se)je.activeTexture.set(it.TEXTURE0),fr.imageAtlasTexture.bind(it.LINEAR,it.CLAMP_TO_EDGE),gr.updatePaintBuffers(Pe);else if(H&&(Hr||i.lineAtlas.dirty))je.activeTexture.set(it.TEXTURE0),i.lineAtlas.bind(je);else if(we){var Un=ur.gradients[o.id],gi=Un.texture;if(o.gradientVersion!==Un.version){var te=256;if(o.stepInterpolant){var q=u.getSource().maxzoom,R=Zt.canonical.z===q?Math.ceil(1<<i.transform.maxZoom-Zt.canonical.z):1;te=d.clamp(d.nextPowerOfTwo(ur.maxLineLength/d.EXTENT*1024*R),256,je.maxTextureSize)}Un.gradient=d.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:te,image:Un.gradient||void 0,clips:ur.lineClipsArray}),Un.texture?Un.texture.update(Un.gradient):Un.texture=new d.Texture(je,Un.gradient,it.RGBA),Un.version=o.gradientVersion,gi=Un.texture}je.activeTexture.set(it.TEXTURE0),gi.bind(o.stepInterpolant?it.NEAREST:it.LINEAR,it.CLAMP_TO_EDGE)}an.draw(je,it.TRIANGLES,P,i.stencilModeForClipping(Zt),D,Ae.disabled,ea,o.id,ur.layoutVertexBuffer,ur.indexBuffer,ur.segments,o.paint,i.transform.zoom,gr,ur.layoutVertexBuffer2),ze=!1}}}}},fill:function(i,u,o,h){var g=o.paint.get("fill-color"),b=o.paint.get("fill-opacity");if(b.constantOr(1)!==0){var P=i.colorModeForRenderPass(),D=o.paint.get("fill-pattern"),H=i.opaquePassEnabledForLayer()&&!D.constantOr(1)&&g.constantOr(d.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===H){var ae=i.depthModeForSublayer(1,i.renderPass==="opaque"?z.ReadWrite:z.ReadOnly);Kl(i,u,o,h,ae,P,!1)}if(i.renderPass==="translucent"&&o.paint.get("fill-antialias")){var Se=i.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,z.ReadOnly);Kl(i,u,o,h,Se,P,!0)}}},"fill-extrusion":function(i,u,o,h){var g=o.paint.get("fill-extrusion-opacity");if(g!==0&&i.renderPass==="translucent"){var b=new z(i.context.gl.LEQUAL,z.ReadWrite,i.depthRangeFor3D);if(g!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))yc(i,u,o,h,b,oe.disabled,me.disabled),yc(i,u,o,h,b,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var P=i.colorModeForRenderPass();yc(i,u,o,h,b,oe.disabled,P)}}},hillshade:function(i,u,o,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var g=i.context,b=i.depthModeForSublayer(0,z.ReadOnly),P=i.colorModeForRenderPass(),D=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],H=D[0],ae=0,Se=D[1];ae<Se.length;ae+=1){var we=Se[ae],Pe=u.getTile(we);Pe.needsHillshadePrepare&&i.renderPass==="offscreen"?Tl(i,Pe,o,b,oe.disabled,P):i.renderPass==="translucent"&&Yu(i,Pe,o,b,H[we.overscaledZ],P)}g.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,o,h){if(i.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var g=i.context,b=g.gl,P=u.getSource(),D=i.useProgram("raster"),H=i.colorModeForRenderPass(),ae=P instanceof pt?[{},h]:i.stencilConfigForOverlap(h),Se=ae[0],we=ae[1],Pe=we[we.length-1].overscaledZ,He=!i.options.moving,je=0,it=we;je<it.length;je+=1){var ze=it[je],ot=i.depthModeForSublayer(ze.overscaledZ-Pe,o.paint.get("raster-opacity")===1?z.ReadWrite:z.ReadOnly,b.LESS),bt=u.getTile(ze),Zt=i.transform.calculatePosMatrix(ze.toUnwrapped(),He);bt.registerFadeDuration(o.paint.get("raster-fade-duration"));var fr=u.findLoadedParent(ze,0),ur=Pl(bt,fr,u,o,i.transform),gr=void 0,Nr=void 0,an=o.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;g.activeTexture.set(b.TEXTURE0),bt.texture.bind(an,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.activeTexture.set(b.TEXTURE1),fr?(fr.texture.bind(an,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),gr=Math.pow(2,fr.tileID.overscaledZ-bt.tileID.overscaledZ),Nr=[bt.tileID.canonical.x*gr%1,bt.tileID.canonical.y*gr%1]):bt.texture.bind(an,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);var Hr=dc(Zt,Nr||[0,0],gr||1,ur,o);P instanceof pt?D.draw(g,b.TRIANGLES,ot,oe.disabled,H,Ae.disabled,Hr,o.id,P.boundsBuffer,i.quadTriangleIndexBuffer,P.boundsSegments):D.draw(g,b.TRIANGLES,ot,Se[ze.overscaledZ],H,Ae.disabled,Hr,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,o){var h=o.paint.get("background-color"),g=o.paint.get("background-opacity");if(g!==0){var b=i.context,P=b.gl,D=i.transform,H=D.tileSize,ae=o.paint.get("background-pattern");if(!i.isPatternMissing(ae)){var Se=!ae&&h.a===1&&g===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===Se){var we=oe.disabled,Pe=i.depthModeForSublayer(0,Se==="opaque"?z.ReadWrite:z.ReadOnly),He=i.colorModeForRenderPass(),je=i.useProgram(ae?"backgroundPattern":"background"),it=D.coveringTiles({tileSize:H});ae&&(b.activeTexture.set(P.TEXTURE0),i.imageManager.bind(i.context));for(var ze=o.getCrossfadeParameters(),ot=0,bt=it;ot<bt.length;ot+=1){var Zt=bt[ot],fr=i.transform.calculatePosMatrix(Zt.toUnwrapped()),ur=ae?Hu(fr,g,i,ae,{tileID:Zt,tileSize:H},ze):ol(fr,g,h);je.draw(b,P.TRIANGLES,Pe,we,He,Ae.disabled,ur,o.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,o){for(var h=0;h<o.length;h++)Jc(i,u,o[h])},custom:function(i,u,o){var h=i.context,g=o.implementation;if(i.renderPass==="offscreen"){var b=g.prerender;b&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),b.call(g,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(oe.disabled);var P=g.renderingMode==="3d"?new z(i.context.gl.LEQUAL,z.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,z.ReadOnly);h.setDepthMode(P),g.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},Ka=function(i,u){this.context=new se(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Ce.maxUnderzooming+Ce.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $o,this.gpuTimers={}};Ka.prototype.resize=function(i,u){if(this.width=i*d.browser.devicePixelRatio,this.height=u*d.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},Ka.prototype.setup=function(){var i=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,Ca.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);var o=new d.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(d.EXTENT,0),o.emplaceBack(0,d.EXTENT),o.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=i.createVertexBuffer(o,Ca.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);var h=new d.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(d.EXTENT,0,d.EXTENT,0),h.emplaceBack(0,d.EXTENT,0,d.EXTENT),h.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,_t.members),this.rasterBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);var g=new d.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(g,Ca.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);var b=new d.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(b);var P=new d.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(P),this.emptyTexture=new d.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var D=this.context.gl;this.stencilClearMode=new oe({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)},Ka.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=d.create();d.ortho(o,0,this.width,this.height,0,0,1),d.scale(o,o,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,z.disabled,this.stencilClearMode,me.disabled,Ae.disabled,Fs(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ka.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var o=this.context,h=o.gl;this.nextStencilID+u.length>256&&this.clearStencil(),o.setColorMode(me.disabled),o.setDepthMode(z.disabled);var g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var b=0,P=u;b<P.length;b+=1){var D=P[b],H=this._tileClippingMaskIDs[D.key]=this.nextStencilID++;g.draw(o,h.TRIANGLES,z.disabled,new oe({func:h.ALWAYS,mask:0},H,255,h.KEEP,h.KEEP,h.REPLACE),me.disabled,Ae.disabled,Fs(D.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ka.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new oe({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},Ka.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new oe({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},Ka.prototype.stencilConfigForOverlap=function(i){var u,o=this.context.gl,h=i.sort(function(H,ae){return ae.overscaledZ-H.overscaledZ}),g=h[h.length-1].overscaledZ,b=h[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();for(var P={},D=0;D<b;D++)P[D+g]=new oe({func:o.GEQUAL,mask:255},D+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=b,[P,h]}return[(u={},u[g]=oe.disabled,u),h]},Ka.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new me([i.CONSTANT_COLOR,i.ONE],new d.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?me.unblended:me.alphaBlended},Ka.prototype.depthModeForSublayer=function(i,u,o){if(!this.opaquePassEnabledForLayer())return z.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new z(o||this.context.gl.LEQUAL,u,[h,h])},Ka.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ka.prototype.render=function(i,u){var o=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(d.browser.now()),this.imageManager.beginFrame();var h=this.style._order,g=this.style.sourceCaches;for(var b in g){var P=g[b];P.used&&P.prepare(this.context)}var D,H,ae={},Se={},we={};for(var Pe in g){var He=g[Pe];ae[Pe]=He.getVisibleCoordinates(),Se[Pe]=ae[Pe].slice().reverse(),we[Pe]=He.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var je=0;je<h.length;je++)if(this.style._layers[h[je]].is3D()){this.opaquePassCutoff=je;break}this.renderPass="offscreen";for(var it=0,ze=h;it<ze.length;it+=1){var ot=this.style._layers[ze[it]];if(ot.hasOffscreenPass()&&!ot.isHidden(this.transform.zoom)){var bt=Se[ot.source];(ot.type==="custom"||bt.length)&&this.renderLayer(this,g[ot.source],ot,bt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Zt=this.style._layers[h[this.currentLayer]],fr=g[Zt.source],ur=ae[Zt.source];this._renderTileClippingMasks(Zt,ur),this.renderLayer(this,fr,Zt,ur)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var gr=this.style._layers[h[this.currentLayer]],Nr=g[gr.source],an=(gr.type==="symbol"?we:Se)[gr.source];this._renderTileClippingMasks(gr,ae[gr.source]),this.renderLayer(this,Nr,gr,an)}this.options.showTileBoundaries&&(d.values(this.style._layers).forEach(function(Hr){Hr.source&&!Hr.isHidden(o.transform.zoom)&&(Hr.source!==(H&&H.id)&&(H=o.style.sourceCaches[Hr.source]),(!D||D.getSource().maxzoom<H.getSource().maxzoom)&&(D=H))}),D&&ll.debug(this,D,D.getVisibleCoordinates())),this.options.showPadding&&function(Hr){var Rn=Hr.transform.padding;Jl(Hr,Hr.transform.height-(Rn.top||0),3,Mu),Jl(Hr,Rn.bottom||0,3,$l),Ql(Hr,Rn.left||0,3,Ua),Ql(Hr,Hr.transform.width-(Rn.right||0),3,Iu);var ri=Hr.transform.centerPoint;(function(hi,ni,ea,Un){Ku(hi,ni-1,ea-10,2,20,Un),Ku(hi,ni-10,ea-1,20,2,Un)})(Hr,ri.x,Hr.transform.height-ri.y,ul)}(this),this.context.setDefault()},Ka.prototype.renderLayer=function(i,u,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),ll[o.type](i,u,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ka.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,o=this.gpuTimers[i.id];o||(o=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),o.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,o.query)}},Ka.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},Ka.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},Ka.prototype.queryGpuTimers=function(i){var u={};for(var o in i){var h=i[o],g=this.context.extTimerQuery,b=g.getQueryObjectEXT(h.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(h.query),u[o]=b}return u},Ka.prototype.translatePosMatrix=function(i,u,o,h,g){if(!o[0]&&!o[1])return i;var b=g?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(b){var P=Math.sin(b),D=Math.cos(b);o=[o[0]*D-o[1]*P,o[0]*P+o[1]*D]}var H=[g?o[0]:Zi(u,o[0],this.transform.zoom),g?o[1]:Zi(u,o[1],this.transform.zoom),0],ae=new Float32Array(16);return d.translate(ae,i,H),ae},Ka.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},Ka.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},Ka.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),o=this.imageManager.getPattern(i.to.toString());return!u||!o},Ka.prototype.useProgram=function(i,u){this.cache=this.cache||{};var o=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new iu(this.context,i,hs[i],u,sl[i],this._showOverdrawInspector)),this.cache[o]},Ka.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ka.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},Ka.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ka.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var cl=function(i,u){this.points=i,this.planes=u};cl.fromInvProjectionMatrix=function(i,u,o){var h=Math.pow(2,o),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return d.transformMat4([],P,i)}).map(function(P){return d.scale$1([],P,1/P[3]/u*h)}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var D=d.sub([],g[P[0]],g[P[1]]),H=d.sub([],g[P[2]],g[P[1]]),ae=d.normalize([],d.cross([],D,H)),Se=-d.dot(ae,g[P[1]]);return ae.concat(Se)});return new cl(g,b)};var $u=function(i,u){this.min=i,this.max=u,this.center=d.scale$2([],d.add([],this.min,this.max),.5)};$u.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],o=d.clone$2(this.min),h=d.clone$2(this.max),g=0;g<u.length;g++)o[g]=u[g]?this.min[g]:this.center[g],h[g]=u[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new $u(o,h)},$u.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},$u.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},$u.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<i.planes.length;h++){for(var g=i.planes[h],b=0,P=0;P<u.length;P++)b+=d.dot$1(g,u[P])>=0;if(b===0)return 0;b!==u.length&&(o=!1)}if(o)return 2;for(var D=0;D<3;D++){for(var H=Number.MAX_VALUE,ae=-Number.MAX_VALUE,Se=0;Se<i.points.length;Se++){var we=i.points[Se][D]-this.min[D];H=Math.min(H,we),ae=Math.max(ae,we)}if(ae<0||H>this.max[D]-this.min[D])return 0}return 1};var Ks=function(i,u,o,h){if(i===void 0&&(i=0),u===void 0&&(u=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=o,this.right=h};Ks.prototype.interpolate=function(i,u,o){return u.top!=null&&i.top!=null&&(this.top=d.number(i.top,u.top,o)),u.bottom!=null&&i.bottom!=null&&(this.bottom=d.number(i.bottom,u.bottom,o)),u.left!=null&&i.left!=null&&(this.left=d.number(i.left,u.left,o)),u.right!=null&&i.right!=null&&(this.right=d.number(i.right,u.right,o)),this},Ks.prototype.getCenter=function(i,u){var o=d.clamp((this.left+i-this.right)/2,0,i),h=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.Point(o,h)},Ks.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},Ks.prototype.clone=function(){return new Ks(this.top,this.bottom,this.left,this.right)},Ks.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ra=function(i,u,o,h,g){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=g===void 0||g,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ks,this._posMatrixCache={},this._alignedPosMatrixCache={}},Za={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ra.prototype.clone=function(){var i=new ra(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Za.minZoom.get=function(){return this._minZoom},Za.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Za.maxZoom.get=function(){return this._maxZoom},Za.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Za.minPitch.get=function(){return this._minPitch},Za.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Za.maxPitch.get=function(){return this._maxPitch},Za.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Za.renderWorldCopies.get=function(){return this._renderWorldCopies},Za.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Za.worldSize.get=function(){return this.tileSize*this.scale},Za.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Za.size.get=function(){return new d.Point(this.width,this.height)},Za.bearing.get=function(){return-this.angle/Math.PI*180},Za.bearing.set=function(i){var u=-d.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=d.create$2(),d.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Za.pitch.get=function(){return this._pitch/Math.PI*180},Za.pitch.set=function(i){var u=d.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Za.fov.get=function(){return this._fov/Math.PI*180},Za.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Za.zoom.get=function(){return this._zoom},Za.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Za.center.get=function(){return this._center},Za.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Za.padding.get=function(){return this._edgeInsets.toJSON()},Za.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Za.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ra.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},ra.prototype.interpolatePadding=function(i,u,o){this._unmodified=!1,this._edgeInsets.interpolate(i,u,o),this._constrain(),this._calcMatrices()},ra.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},ra.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new d.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new d.Point(0,0)),h=this.pointCoordinate(new d.Point(this.width,0)),g=this.pointCoordinate(new d.Point(this.width,this.height)),b=this.pointCoordinate(new d.Point(0,this.height)),P=Math.floor(Math.min(o.x,h.x,g.x,b.x)),D=Math.floor(Math.max(o.x,h.x,g.x,b.x)),H=P-1;H<=D+1;H++)H!==0&&u.push(new d.UnwrappedTileID(H,i));return u},ra.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),o=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=d.MercatorCoordinate.fromLngLat(this.center),g=Math.pow(2,u),b=[g*h.x,g*h.y,0],P=cl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),D=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(D=u);var H=function(Hr){return{aabb:new $u([Hr*g,0,0],[(Hr+1)*g,g,0]),zoom:0,x:0,y:0,wrap:Hr,fullyVisible:!1}},ae=[],Se=[],we=u,Pe=i.reparseOverscaled?o:u;if(this._renderWorldCopies)for(var He=1;He<=3;He++)ae.push(H(-He)),ae.push(H(He));for(ae.push(H(0));ae.length>0;){var je=ae.pop(),it=je.x,ze=je.y,ot=je.fullyVisible;if(!ot){var bt=je.aabb.intersects(P);if(bt===0)continue;ot=bt===2}var Zt=je.aabb.distanceX(b),fr=je.aabb.distanceY(b),ur=Math.max(Math.abs(Zt),Math.abs(fr));if(je.zoom===we||ur>3+(1<<we-je.zoom)-2&&je.zoom>=D)Se.push({tileID:new d.OverscaledTileID(je.zoom===we?Pe:je.zoom,je.wrap,je.zoom,it,ze),distanceSq:d.sqrLen([b[0]-.5-it,b[1]-.5-ze])});else for(var gr=0;gr<4;gr++){var Nr=(it<<1)+gr%2,an=(ze<<1)+(gr>>1);ae.push({aabb:je.aabb.quadrant(gr),zoom:je.zoom+1,x:Nr,y:an,wrap:je.wrap,fullyVisible:ot})}}return Se.sort(function(Hr,Rn){return Hr.distanceSq-Rn.distanceSq}).map(function(Hr){return Hr.tileID})},ra.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Za.unmodified.get=function(){return this._unmodified},ra.prototype.zoomScale=function(i){return Math.pow(2,i)},ra.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},ra.prototype.project=function(i){var u=d.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new d.Point(d.mercatorXfromLng(i.lng)*this.worldSize,d.mercatorYfromLat(u)*this.worldSize)},ra.prototype.unproject=function(i){return new d.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Za.point.get=function(){return this.project(this.center)},ra.prototype.setLocationAtPoint=function(i,u){var o=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(i),b=new d.MercatorCoordinate(g.x-(o.x-h.x),g.y-(o.y-h.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())},ra.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},ra.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},ra.prototype.locationCoordinate=function(i){return d.MercatorCoordinate.fromLngLat(i)},ra.prototype.coordinateLocation=function(i){return i.toLngLat()},ra.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],o=[i.x,i.y,1,1];d.transformMat4(u,u,this.pixelMatrixInverse),d.transformMat4(o,o,this.pixelMatrixInverse);var h=u[3],g=o[3],b=u[1]/h,P=o[1]/g,D=u[2]/h,H=o[2]/g,ae=D===H?0:(0-D)/(H-D);return new d.MercatorCoordinate(d.number(u[0]/h,o[0]/g,ae)/this.worldSize,d.number(b,P,ae)/this.worldSize)},ra.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix),new d.Point(u[0]/u[3],u[1]/u[3])},ra.prototype.getBounds=function(){return new d.LngLatBounds().extend(this.pointLocation(new d.Point(0,0))).extend(this.pointLocation(new d.Point(this.width,0))).extend(this.pointLocation(new d.Point(this.width,this.height))).extend(this.pointLocation(new d.Point(0,this.height)))},ra.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new d.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ra.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ra.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var o=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var g=i.canonical,b=this.worldSize/this.zoomScale(g.z),P=g.x+Math.pow(2,g.z)*i.wrap,D=d.identity(new Float64Array(16));return d.translate(D,D,[P*b,g.y*b,0]),d.scale(D,D,[b/d.EXTENT,b/d.EXTENT,1]),d.multiply(D,u?this.alignedProjMatrix:this.projMatrix,D),h[o]=new Float32Array(D),h[o]},ra.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ra.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,o,h,g=-90,b=90,P=-180,D=180,H=this.size,ae=this._unmodified;if(this.latRange){var Se=this.latRange;g=d.mercatorYfromLat(Se[1])*this.worldSize,i=(b=d.mercatorYfromLat(Se[0])*this.worldSize)-g<H.y?H.y/(b-g):0}if(this.lngRange){var we=this.lngRange;P=d.mercatorXfromLng(we[0])*this.worldSize,u=(D=d.mercatorXfromLng(we[1])*this.worldSize)-P<H.x?H.x/(D-P):0}var Pe=this.point,He=Math.max(u||0,i||0);if(He)return this.center=this.unproject(new d.Point(u?(D+P)/2:Pe.x,i?(b+g)/2:Pe.y)),this.zoom+=this.scaleZoom(He),this._unmodified=ae,void(this._constraining=!1);if(this.latRange){var je=Pe.y,it=H.y/2;je-it<g&&(h=g+it),je+it>b&&(h=b-it)}if(this.lngRange){var ze=Pe.x,ot=H.x/2;ze-ot<P&&(o=P+ot),ze+ot>D&&(o=D-ot)}o===void 0&&h===void 0||(this.center=this.unproject(new d.Point(o!==void 0?o:Pe.x,h!==void 0?h:Pe.y))),this._unmodified=ae,this._constraining=!1}},ra.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,o=this._fov*(.5+i.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(d.clamp(Math.PI-u-o,.01,Math.PI-.01)),g=this.point,b=g.x,P=g.y,D=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),H=this.height/50,ae=new Float64Array(16);d.perspective(ae,this._fov,this.width/this.height,H,D),ae[8]=2*-i.x/this.width,ae[9]=2*i.y/this.height,d.scale(ae,ae,[1,-1,1]),d.translate(ae,ae,[0,0,-this.cameraToCenterDistance]),d.rotateX(ae,ae,this._pitch),d.rotateZ(ae,ae,this.angle),d.translate(ae,ae,[-b,-P,0]),this.mercatorMatrix=d.scale([],ae,[this.worldSize,this.worldSize,this.worldSize]),d.scale(ae,ae,[1,1,d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ae,this.invProjMatrix=d.invert([],this.projMatrix);var Se=this.width%2/2,we=this.height%2/2,Pe=Math.cos(this.angle),He=Math.sin(this.angle),je=b-Math.round(b)+Pe*Se+He*we,it=P-Math.round(P)+Pe*we+He*Se,ze=new Float64Array(ae);if(d.translate(ze,ze,[je>.5?je-1:je,it>.5?it-1:it,0]),this.alignedProjMatrix=ze,ae=d.create(),d.scale(ae,ae,[this.width/2,-this.height/2,1]),d.translate(ae,ae,[1,-1,0]),this.labelPlaneMatrix=ae,ae=d.create(),d.scale(ae,ae,[1,-1,1]),d.translate(ae,ae,[-1,-1,0]),d.scale(ae,ae,[2/this.width,2/this.height,1]),this.glCoordMatrix=ae,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ae=d.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ae,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ra.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new d.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},ra.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.Point(0,i))},ra.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var o=u.x,h=u.y,g=u.x,b=u.y,P=0,D=i;P<D.length;P+=1){var H=D[P];o=Math.min(o,H.x),h=Math.min(h,H.y),g=Math.max(g,H.x),b=Math.max(b,H.y)}return[new d.Point(o,h),new d.Point(g,h),new d.Point(g,b),new d.Point(o,b),new d.Point(o,h)]},Object.defineProperties(ra.prototype,Za);var Ss=function(i){var u,o,h,g;this._hashName=i&&encodeURIComponent(i),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),o=!1,h=null,g=function(){h=null,o&&(u(),h=setTimeout(g,300),o=!1)},function(){return o=!0,h||g(),h})};Ss.prototype.addTo=function(i){return this._map=i,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ss.prototype.remove=function(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ss.prototype.getHashString=function(i){var u=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,h),b=Math.round(u.lng*g)/g,P=Math.round(u.lat*g)/g,D=this._map.getBearing(),H=this._map.getPitch(),ae="";if(ae+=i?"/"+b+"/"+P+"/"+o:o+"/"+P+"/"+b,(D||H)&&(ae+="/"+Math.round(10*D)/10),H&&(ae+="/"+Math.round(H)),this._hashName){var Se=this._hashName,we=!1,Pe=d.window.location.hash.slice(1).split("&").map(function(He){var je=He.split("=")[0];return je===Se?(we=!0,je+"="+ae):He}).filter(function(He){return He});return we||Pe.push(Se+"="+ae),"#"+Pe.join("&")}return"#"+ae},Ss.prototype._getCurrentHash=function(){var i,u=this,o=d.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):o.split("/")},Ss.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(o){return isNaN(o)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},Ss.prototype._updateHashUnthrottled=function(){var i=d.window.location.href.replace(/(#.+)?$/,this.getHashString());try{d.window.history.replaceState(d.window.history.state,null,i)}catch(u){}};var Ml={linearity:.3,easing:d.bezier(0,0,.3,1)},Ou=d.extend({deceleration:2500,maxSpeed:1400},Ml),Il=d.extend({deceleration:20,maxSpeed:1400},Ml),Qc=d.extend({deceleration:1e3,maxSpeed:360},Ml),qc=d.extend({deceleration:1e3,maxSpeed:90},Ml),Ol=function(i){this._map=i,this.clear()};function ql(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function Lu(i,u,o){var h=o.maxSpeed,g=o.linearity,b=o.deceleration,P=d.clamp(i*g/(u/1e3),-h,h),D=Math.abs(P)/(b*g);return{easing:o.easing,duration:1e3*D,amount:P*(D/2)}}Ol.prototype.clear=function(){this._inertiaBuffer=[]},Ol.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.browser.now(),settings:i})},Ol.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=d.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},Ol.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new d.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var g=h[o].settings;u.zoom+=g.zoomDelta||0,u.bearing+=g.bearingDelta||0,u.pitch+=g.pitchDelta||0,g.panDelta&&u.pan._add(g.panDelta),g.around&&(u.around=g.around),g.pinchAround&&(u.pinchAround=g.pinchAround)}var b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(u.pan.mag()){var D=Lu(u.pan.mag(),b,d.extend({},Ou,i||{}));P.offset=u.pan.mult(D.amount/u.pan.mag()),P.center=this._map.transform.center,ql(P,D)}if(u.zoom){var H=Lu(u.zoom,b,Il);P.zoom=this._map.transform.zoom+H.amount,ql(P,H)}if(u.bearing){var ae=Lu(u.bearing,b,Qc);P.bearing=this._map.transform.bearing+d.clamp(ae.amount,-179,179),ql(P,ae)}if(u.pitch){var Se=Lu(u.pitch,b,qc);P.pitch=this._map.transform.pitch+Se.amount,ql(P,Se)}if(P.zoom||P.bearing){var we=u.pinchAround===void 0?u.around:u.pinchAround;P.around=we?this._map.unproject(we):this._map.getCenter()}return this.clear(),d.extend(P,{noMoveStart:!0})}};var ko=function(i){function u(h,g,b,P){P===void 0&&(P={});var D=Q.mousePos(g.getCanvasContainer(),b),H=g.unproject(D);i.call(this,h,d.extend({point:D,lngLat:H,originalEvent:b},P)),this._defaultPrevented=!1,this.target=g}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),Ns=function(i){function u(h,g,b){var P=h==="touchend"?b.changedTouches:b.touches,D=Q.touchPos(g.getCanvasContainer(),P),H=D.map(function(we){return g.unproject(we)}),ae=D.reduce(function(we,Pe,He,je){return we.add(Pe.div(je.length))},new d.Point(0,0)),Se=g.unproject(ae);i.call(this,h,{points:D,point:ae,lngLats:H,lngLat:Se,originalEvent:b}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),fl=function(i){function u(h,g,b){i.call(this,h,{originalEvent:b}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),_o=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};_o.prototype.reset=function(){delete this._mousedownPos},_o.prototype.wheel=function(i){return this._firePreventable(new fl(i.type,this._map,i))},_o.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new ko(i.type,this._map,i))},_o.prototype.mouseup=function(i){this._map.fire(new ko(i.type,this._map,i))},_o.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new ko(i.type,this._map,i))},_o.prototype.dblclick=function(i){return this._firePreventable(new ko(i.type,this._map,i))},_o.prototype.mouseover=function(i){this._map.fire(new ko(i.type,this._map,i))},_o.prototype.mouseout=function(i){this._map.fire(new ko(i.type,this._map,i))},_o.prototype.touchstart=function(i){return this._firePreventable(new Ns(i.type,this._map,i))},_o.prototype.touchmove=function(i){this._map.fire(new Ns(i.type,this._map,i))},_o.prototype.touchend=function(i){this._map.fire(new Ns(i.type,this._map,i))},_o.prototype.touchcancel=function(i){this._map.fire(new Ns(i.type,this._map,i))},_o.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},_o.prototype.isEnabled=function(){return!0},_o.prototype.isActive=function(){return!1},_o.prototype.enable=function(){},_o.prototype.disable=function(){};var Fn=function(i){this._map=i};Fn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Fn.prototype.mousemove=function(i){this._map.fire(new ko(i.type,this._map,i))},Fn.prototype.mousedown=function(){this._delayContextMenu=!0},Fn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Fn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new ko(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},Fn.prototype.isEnabled=function(){return!0},Fn.prototype.isActive=function(){return!1},Fn.prototype.enable=function(){},Fn.prototype.disable=function(){};var lo=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function Ru(i,u){for(var o={},h=0;h<i.length;h++)o[i[h].identifier]=u[h];return o}lo.prototype.isEnabled=function(){return!!this._enabled},lo.prototype.isActive=function(){return!!this._active},lo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},lo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},lo.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},lo.prototype.mousemoveWindow=function(i,u){if(this._active){var o=u;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=Q.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var g=Math.min(h.x,o.x),b=Math.max(h.x,o.x),P=Math.min(h.y,o.y),D=Math.max(h.y,o.y);Q.setTransform(this._box,"translate("+g+"px,"+P+"px)"),this._box.style.width=b-g+"px",this._box.style.height=D-P+"px"}}},lo.prototype.mouseupWindow=function(i,u){var o=this;if(this._active&&i.button===0){var h=this._startPos,g=u;if(this.reset(),Q.suppressClick(),h.x!==g.x||h.y!==g.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(b){return b.fitScreenCoordinates(h,g,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},lo.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},lo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos},lo.prototype._fireEvent=function(i,u){return this._map.fire(new d.Event(i,{originalEvent:u}))};var hl=function(i){this.reset(),this.numTouches=i.numTouches};hl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},hl.prototype.touchstart=function(i,u,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var g=new d.Point(0,0),b=0,P=h;b<P.length;b+=1)g._add(P[b]);return g.div(h.length)}(u),this.touches=Ru(o,u)))},hl.prototype.touchmove=function(i,u,o){if(!this.aborted&&this.centroid){var h=Ru(o,u);for(var g in this.touches){var b=h[g];(!b||b.dist(this.touches[g])>30)&&(this.aborted=!0)}}},hl.prototype.touchend=function(i,u,o){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var $s=function(i){this.singleTap=new hl(i),this.numTaps=i.numTaps,this.reset()};$s.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},$s.prototype.touchstart=function(i,u,o){this.singleTap.touchstart(i,u,o)},$s.prototype.touchmove=function(i,u,o){this.singleTap.touchmove(i,u,o)},$s.prototype.touchend=function(i,u,o){var h=this.singleTap.touchend(i,u,o);if(h){var g=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(h)<30;if(g&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var Is=function(){this._zoomIn=new $s({numTouches:1,numTaps:2}),this._zoomOut=new $s({numTouches:2,numTaps:1}),this.reset()};Is.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Is.prototype.touchstart=function(i,u,o){this._zoomIn.touchstart(i,u,o),this._zoomOut.touchstart(i,u,o)},Is.prototype.touchmove=function(i,u,o){this._zoomIn.touchmove(i,u,o),this._zoomOut.touchmove(i,u,o)},Is.prototype.touchend=function(i,u,o){var h=this,g=this._zoomIn.touchend(i,u,o),b=this._zoomOut.touchend(i,u,o);return g?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(g)},{originalEvent:i})}}):b?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(b)},{originalEvent:i})}}):void 0},Is.prototype.touchcancel=function(){this.reset()},Is.prototype.enable=function(){this._enabled=!0},Is.prototype.disable=function(){this._enabled=!1,this.reset()},Is.prototype.isEnabled=function(){return this._enabled},Is.prototype.isActive=function(){return this._active};var gc={0:1,2:2},vn=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};vn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},vn.prototype._correctButton=function(i,u){return!1},vn.prototype._move=function(i,u){return{}},vn.prototype.mousedown=function(i,u){if(!this._lastPoint){var o=Q.mouseButton(i);this._correctButton(i,o)&&(this._lastPoint=u,this._eventButton=o)}},vn.prototype.mousemoveWindow=function(i,u){var o=this._lastPoint;if(o){if(i.preventDefault(),function(h,g){var b=gc[g];return h.buttons===void 0||(h.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(o,u)}},vn.prototype.mouseupWindow=function(i){this._lastPoint&&Q.mouseButton(i)===this._eventButton&&(this._moved&&Q.suppressClick(),this.reset())},vn.prototype.enable=function(){this._enabled=!0},vn.prototype.disable=function(){this._enabled=!1,this.reset()},vn.prototype.isEnabled=function(){return this._enabled},vn.prototype.isActive=function(){return this._active};var ec=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(o,h){i.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},u.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},u}(vn),tc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var g=.8*(h.x-o.x);if(g)return this._active=!0,{bearingDelta:g}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(vn),ku=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var g=-.5*(h.y-o.y);if(g)return this._active=!0,{pitchDelta:g}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(vn),Va=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};Va.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new d.Point(0,0)},Va.prototype.touchstart=function(i,u,o){return this._calculateTransform(i,u,o)},Va.prototype.touchmove=function(i,u,o){if(this._active&&!(o.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,o)},Va.prototype.touchend=function(i,u,o){this._calculateTransform(i,u,o),this._active&&o.length<this._minTouches&&this.reset()},Va.prototype.touchcancel=function(){this.reset()},Va.prototype._calculateTransform=function(i,u,o){o.length>0&&(this._active=!0);var h=Ru(o,u),g=new d.Point(0,0),b=new d.Point(0,0),P=0;for(var D in h){var H=h[D],ae=this._touches[D];ae&&(g._add(H),b._add(H.sub(ae)),P++,h[D]=H)}if(this._touches=h,!(P<this._minTouches)&&b.mag()){var Se=b.div(P);if(this._sum._add(Se),!(this._sum.mag()<this._clickTolerance))return{around:g.div(P),panDelta:Se}}},Va.prototype.enable=function(){this._enabled=!0},Va.prototype.disable=function(){this._enabled=!1,this.reset()},Va.prototype.isEnabled=function(){return this._enabled},Va.prototype.isActive=function(){return this._active};var Os=function(){this.reset()};function rc(i,u,o){for(var h=0;h<i.length;h++)if(i[h].identifier===o)return u[h]}function _u(i,u){return Math.log(i/u)/Math.LN2}Os.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Os.prototype._start=function(i){},Os.prototype._move=function(i,u,o){return{}},Os.prototype.touchstart=function(i,u,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([u[0],u[1]]))},Os.prototype.touchmove=function(i,u,o){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,g=h[1],b=rc(o,u,h[0]),P=rc(o,u,g);if(b&&P){var D=this._aroundCenter?null:b.add(P).div(2);return this._move([b,P],D,i)}}},Os.prototype.touchend=function(i,u,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,g=h[1],b=rc(o,u,h[0]),P=rc(o,u,g);b&&P||(this._active&&Q.suppressClick(),this.reset())}},Os.prototype.touchcancel=function(){this.reset()},Os.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},Os.prototype.disable=function(){this._enabled=!1,this.reset()},Os.prototype.isEnabled=function(){return this._enabled},Os.prototype.isActive=function(){return this._active};var Ls=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},u.prototype._move=function(o,h){var g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(_u(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_u(this._distance,g),pinchAround:h}},u}(Os);function ou(i,u){return 180*i.angleWith(u)/Math.PI}var Nc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},u.prototype._move=function(o,h){var g=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ou(this._vector,g),pinchAround:h}},u.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,g=ou(o,this._startVector);return Math.abs(g)<h},u}(Os);function Ll(i){return Math.abs(i.y)>Math.abs(i.x)}var _c=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(o){this._lastPoints=o,Ll(o[0].sub(o[1]))&&(this._valid=!1)},u.prototype._move=function(o,h,g){var b=o[0].sub(this._lastPoints[0]),P=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,P,g.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+P.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(o,h,g){if(this._valid!==void 0)return this._valid;var b=o.mag()>=2,P=h.mag()>=2;if(b||P){if(!b||!P)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;var D=o.y>0==h.y>0;return Ll(o)&&Ll(h)&&D}},u}(Os),zc={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var i=zc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Rs(i){return i*(2-i)}Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0,h=0,g=0,b=0,P=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?g=1:(i.preventDefault(),P=-1);break;case 40:i.shiftKey?g=-1:(i.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(h=0,g=0),{cameraAnimation:function(D){var H=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:Rs,zoom:o?Math.round(H)+o*(i.shiftKey?2:1):H,bearing:D.getBearing()+h*u._bearingStep,pitch:D.getPitch()+g*u._pitchStep,offset:[-b*u._panStep,-P*u._panStep],center:D.getCenter()},{originalEvent:i})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var qi=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,d.bindAll(["_onTimeout"],this)};qi.prototype.setZoomRate=function(i){this._defaultZoomRate=i},qi.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},qi.prototype.isEnabled=function(){return!!this._enabled},qi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},qi.prototype.isZooming=function(){return!!this._zooming},qi.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},qi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},qi.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,o=d.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},qi.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},qi.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=Q.mousePos(this._el,i);this._around=d.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},qi.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var g=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(g*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var b,P=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,D=this._startZoom,H=this._easing,ae=!1;if(this._type==="wheel"&&D&&H){var Se=Math.min((d.browser.now()-this._lastWheelEventTime)/200,1),we=H(Se);b=d.number(D,P,we),Se<1?this._frameId||(this._frameId=!0):ae=!0}else b=P,ae=!0;return this._active=!0,ae&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ae,zoomDelta:b-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},qi.prototype._smoothOutEasing=function(i){var u=d.ease;if(this._prevEase){var o=this._prevEase,h=(d.browser.now()-o.start)/o.duration,g=o.easing(h+.01)-o.easing(h),b=.27/Math.sqrt(g*g+1e-4)*.01,P=Math.sqrt(.0729-b*b);u=d.bezier(b,P,.25,1)}return this._prevEase={start:d.browser.now(),duration:i,easing:u},u},qi.prototype.reset=function(){this._active=!1};var xu=function(i,u){this._clickZoom=i,this._tapZoom=u};xu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},xu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},xu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},xu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var zs=function(){this.reset()};zs.prototype.reset=function(){this._active=!1},zs.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(i.shiftKey?-1:1),around:o.unproject(u)},{originalEvent:i})}}},zs.prototype.enable=function(){this._enabled=!0},zs.prototype.disable=function(){this._enabled=!1,this.reset()},zs.prototype.isEnabled=function(){return this._enabled},zs.prototype.isActive=function(){return this._active};var Uo=function(){this._tap=new $s({numTouches:1,numTaps:1}),this.reset()};Uo.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Uo.prototype.touchstart=function(i,u,o){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=u[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(i,u,o))},Uo.prototype.touchmove=function(i,u,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=u[0],g=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(i,u,o)},Uo.prototype.touchend=function(i,u,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(i,u,o)&&(this._tapTime=i.timeStamp)},Uo.prototype.touchcancel=function(){this.reset()},Uo.prototype.enable=function(){this._enabled=!0},Uo.prototype.disable=function(){this._enabled=!1,this.reset()},Uo.prototype.isEnabled=function(){return this._enabled},Uo.prototype.isActive=function(){return this._active};var pl=function(i,u,o){this._el=i,this._mousePan=u,this._touchPan=o};pl.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},pl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},pl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},pl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var su=function(i,u,o){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=o};su.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},su.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},su.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},su.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var uu=function(i,u,o,h){this._el=i,this._touchZoom=u,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};uu.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},uu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},uu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},uu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},uu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},uu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var xo=function(i){return i.zoom||i.drag||i.pitch||i.rotate},Du=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(d.Event);function ii(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var Wn=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ol(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[d.window,"blur",void 0]];for(var h=0,g=this._listeners;h<g.length;h+=1){var b=g[h],P=b[0];Q.addEventListener(P,b[1],P===d.window.document?this.handleWindowEvent:this.handleEvent,b[2])}};Wn.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var o=u[i],h=o[0];Q.removeEventListener(h,o[1],h===d.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},Wn.prototype._addDefaultHandlers=function(i){var u=this._map,o=u.getCanvasContainer();this._add("mapEvent",new _o(u,i));var h=u.boxZoom=new lo(u,i);this._add("boxZoom",h);var g=new Is,b=new zs;u.doubleClickZoom=new xu(b,g),this._add("tapZoom",g),this._add("clickZoom",b);var P=new Uo;this._add("tapDragZoom",P);var D=u.touchPitch=new _c;this._add("touchPitch",D);var H=new tc(i),ae=new ku(i);u.dragRotate=new su(i,H,ae),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",ae,["mouseRotate"]);var Se=new ec(i),we=new Va(i);u.dragPan=new pl(o,Se,we),this._add("mousePan",Se),this._add("touchPan",we,["touchZoom","touchRotate"]);var Pe=new Nc,He=new Ls;u.touchZoomRotate=new uu(o,He,Pe,P),this._add("touchRotate",Pe,["touchPan","touchZoom"]),this._add("touchZoom",He,["touchPan","touchRotate"]);var je=u.scrollZoom=new qi(u,this);this._add("scrollZoom",je,["mousePan"]);var it=u.keyboard=new Js;this._add("keyboard",it),this._add("blockableMapEvent",new Fn(u));for(var ze=0,ot=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ze<ot.length;ze+=1){var bt=ot[ze];i.interactive&&i[bt]&&u[bt].enable(i[bt])}},Wn.prototype._add=function(i,u,o){this._handlers.push({handlerName:i,handler:u,allowed:o}),this._handlersById[i]=u},Wn.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,o=this._handlers;u<o.length;u+=1)o[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},Wn.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},Wn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Wn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Wn.prototype.isMoving=function(){return Boolean(xo(this._eventsInProgress))||this.isZooming()},Wn.prototype._blockedByActive=function(i,u,o){for(var h in i)if(h!==o&&(!u||u.indexOf(h)<0))return!0;return!1},Wn.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},Wn.prototype._getMapTouches=function(i){for(var u=[],o=0,h=i;o<h.length;o+=1){var g=h[o];this._el.contains(g.target)&&u.push(g)}return u},Wn.prototype.handleEvent=function(i,u){if(i.type!=="blur"){this._updatingCamera=!0;for(var o=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},g={},b={},P=i.touches?this._getMapTouches(i.touches):void 0,D=P?Q.touchPos(this._el,P):Q.mousePos(this._el,i),H=0,ae=this._handlers;H<ae.length;H+=1){var Se=ae[H],we=Se.handlerName,Pe=Se.handler,He=Se.allowed;if(Pe.isEnabled()){var je=void 0;this._blockedByActive(b,He,we)?Pe.reset():Pe[u||i.type]&&(je=Pe[u||i.type](i,D,P),this.mergeHandlerResult(h,g,je,we,o),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Pe.isActive())&&(b[we]=Pe)}}var it={};for(var ze in this._previousActiveHandlers)b[ze]||(it[ze]=o);this._previousActiveHandlers=b,(Object.keys(it).length||ii(h))&&(this._changes.push([h,g,it]),this._triggerRenderFrame()),(Object.keys(b).length||ii(h))&&this._map._stop(!0),this._updatingCamera=!1;var ot=h.cameraAnimation;ot&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ot(this._map))}else this.stop(!0)},Wn.prototype.mergeHandlerResult=function(i,u,o,h,g){if(o){d.extend(i,o);var b={handlerName:h,originalEvent:o.originalEvent||g};o.zoomDelta!==void 0&&(u.zoom=b),o.panDelta!==void 0&&(u.drag=b),o.pitchDelta!==void 0&&(u.pitch=b),o.bearingDelta!==void 0&&(u.rotate=b)}},Wn.prototype._applyChanges=function(){for(var i={},u={},o={},h=0,g=this._changes;h<g.length;h+=1){var b=g[h],P=b[0],D=b[1],H=b[2];P.panDelta&&(i.panDelta=(i.panDelta||new d.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(i.around=P.around),P.pinchAround!==void 0&&(i.pinchAround=P.pinchAround),P.noInertia&&(i.noInertia=P.noInertia),d.extend(u,D),d.extend(o,H)}this._updateMapTransform(i,u,o),this._changes=[]},Wn.prototype._updateMapTransform=function(i,u,o){var h=this._map,g=h.transform;if(!ii(i))return this._fireEvents(u,o,!0);var b=i.panDelta,P=i.zoomDelta,D=i.bearingDelta,H=i.pitchDelta,ae=i.around,Se=i.pinchAround;Se!==void 0&&(ae=Se),h._stop(!0),ae=ae||h.transform.centerPoint;var we=g.pointLocation(b?ae.sub(b):ae);D&&(g.bearing+=D),H&&(g.pitch+=H),P&&(g.zoom+=P),g.setLocationAtPoint(we,ae),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,o,!0)},Wn.prototype._fireEvents=function(i,u,o){var h=this,g=xo(this._eventsInProgress),b=xo(i),P={};for(var D in i)this._eventsInProgress[D]||(P[D+"start"]=i[D].originalEvent),this._eventsInProgress[D]=i[D];for(var H in!g&&b&&this._fireEvent("movestart",b.originalEvent),P)this._fireEvent(H,P[H]);for(var ae in b&&this._fireEvent("move",b.originalEvent),i)this._fireEvent(ae,i[ae].originalEvent);var Se,we={};for(var Pe in this._eventsInProgress){var He=this._eventsInProgress[Pe],je=He.handlerName,it=He.originalEvent;this._handlersById[je].isActive()||(delete this._eventsInProgress[Pe],we[Pe+"end"]=Se=u[je]||it)}for(var ze in we)this._fireEvent(ze,we[ze]);var ot=xo(this._eventsInProgress);if(o&&(g||b)&&!ot){this._updatingCamera=!0;var bt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Zt=function(fr){return fr!==0&&-h._bearingSnap<fr&&fr<h._bearingSnap};bt?(Zt(bt.bearing||this._map.getBearing())&&(bt.bearing=0),this._map.easeTo(bt,{originalEvent:Se})):(this._map.fire(new d.Event("moveend",{originalEvent:Se})),Zt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Wn.prototype._fireEvent=function(i,u){this._map.fire(new d.Event(i,u?{originalEvent:u}:{}))},Wn.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new Du("renderFrame",{timeStamp:u})),i._applyChanges()})},Wn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Rl=function(i){function u(o,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},u.prototype.panBy=function(o,h,g){return o=d.Point.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},h),g)},u.prototype.panTo=function(o,h,g){return this.easeTo(d.extend({center:o},h),g)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},u.prototype.zoomTo=function(o,h,g){return this.easeTo(d.extend({zoom:o},h),g)},u.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},u.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},u.prototype.rotateTo=function(o,h,g){return this.easeTo(d.extend({bearing:o},h),g)},u.prototype.resetNorth=function(o,h){return this.rotateTo(0,d.extend({duration:1e3},o),h),this},u.prototype.resetNorthPitch=function(o,h){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),h),this},u.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},u.prototype.cameraForBounds=function(o,h){o=d.LngLatBounds.convert(o);var g=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),g,h)},u.prototype._cameraForBoxAndBearing=function(o,h,g,b){var P={top:0,bottom:0,right:0,left:0};if(typeof(b=d.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){var D=b.padding;b.padding={top:D,bottom:D,right:D,left:D}}b.padding=d.extend(P,b.padding);var H=this.transform,ae=H.padding,Se=H.project(d.LngLat.convert(o)),we=H.project(d.LngLat.convert(h)),Pe=Se.rotate(-g*Math.PI/180),He=we.rotate(-g*Math.PI/180),je=new d.Point(Math.max(Pe.x,He.x),Math.max(Pe.y,He.y)),it=new d.Point(Math.min(Pe.x,He.x),Math.min(Pe.y,He.y)),ze=je.sub(it),ot=(H.width-(ae.left+ae.right+b.padding.left+b.padding.right))/ze.x,bt=(H.height-(ae.top+ae.bottom+b.padding.top+b.padding.bottom))/ze.y;if(!(bt<0||ot<0)){var Zt=Math.min(H.scaleZoom(H.scale*Math.min(ot,bt)),b.maxZoom),fr=typeof b.offset.x=="number"?new d.Point(b.offset.x,b.offset.y):d.Point.convert(b.offset),ur=new d.Point((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),gr=fr.add(ur).mult(H.scale/H.zoomScale(Zt));return{center:H.unproject(Se.add(we).div(2).sub(gr)),zoom:Zt,bearing:g}}d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(o,h,g){return this._fitInternal(this.cameraForBounds(o,h),h,g)},u.prototype.fitScreenCoordinates=function(o,h,g,b,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.Point.convert(o)),this.transform.pointLocation(d.Point.convert(h)),g,b),b,P)},u.prototype._fitInternal=function(o,h,g){return o?(delete(h=d.extend(o,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this},u.prototype.jumpTo=function(o,h){this.stop();var g=this.transform,b=!1,P=!1,D=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(b=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=d.LngLat.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(P=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(D=!0,g.pitch=+o.pitch),o.padding==null||g.isPaddingEqual(o.padding)||(g.padding=o.padding),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),b&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),P&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),D&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h))},u.prototype.easeTo=function(o,h){var g=this;this._stop(!1,o.easeId),((o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate===!1||!o.essential&&d.browser.prefersReducedMotion)&&(o.duration=0);var b=this.transform,P=this.getZoom(),D=this.getBearing(),H=this.getPitch(),ae=this.getPadding(),Se="zoom"in o?+o.zoom:P,we="bearing"in o?this._normalizeBearing(o.bearing,D):D,Pe="pitch"in o?+o.pitch:H,He="padding"in o?o.padding:b.padding,je=d.Point.convert(o.offset),it=b.centerPoint.add(je),ze=b.pointLocation(it),ot=d.LngLat.convert(o.center||ze);this._normalizeCenter(ot);var bt,Zt,fr=b.project(ze),ur=b.project(ot).sub(fr),gr=b.zoomScale(Se-P);o.around&&(bt=d.LngLat.convert(o.around),Zt=b.locationPoint(bt));var Nr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Se!==P,this._rotating=this._rotating||D!==we,this._pitching=this._pitching||Pe!==H,this._padding=!b.isPaddingEqual(He),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Nr),this._ease(function(an){if(g._zooming&&(b.zoom=d.number(P,Se,an)),g._rotating&&(b.bearing=d.number(D,we,an)),g._pitching&&(b.pitch=d.number(H,Pe,an)),g._padding&&(b.interpolatePadding(ae,He,an),it=b.centerPoint.add(je)),bt)b.setLocationAtPoint(bt,Zt);else{var Hr=b.zoomScale(b.zoom-P),Rn=Se>P?Math.min(2,gr):Math.max(.5,gr),ri=Math.pow(Rn,1-an),hi=b.unproject(fr.add(ur.mult(an*ri)).mult(Hr));b.setLocationAtPoint(b.renderWorldCopies?hi.wrap():hi,it)}g._fireMoveEvents(h)},function(an){g._afterEase(h,an)},o),this},u.prototype._prepareEase=function(o,h,g){g===void 0&&(g={}),this._moving=!0,h||g.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!g.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new d.Event("pitchstart",o))},u.prototype._fireMoveEvents=function(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))},u.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var g=this._zooming,b=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new d.Event("zoomend",o)),b&&this.fire(new d.Event("rotateend",o)),P&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}},u.prototype.flyTo=function(o,h){var g=this;if(!o.essential&&d.browser.prefersReducedMotion){var b=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(b,h)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);var P=this.transform,D=this.getZoom(),H=this.getBearing(),ae=this.getPitch(),Se=this.getPadding(),we="zoom"in o?d.clamp(+o.zoom,P.minZoom,P.maxZoom):D,Pe="bearing"in o?this._normalizeBearing(o.bearing,H):H,He="pitch"in o?+o.pitch:ae,je="padding"in o?o.padding:P.padding,it=P.zoomScale(we-D),ze=d.Point.convert(o.offset),ot=P.centerPoint.add(ze),bt=P.pointLocation(ot),Zt=d.LngLat.convert(o.center||bt);this._normalizeCenter(Zt);var fr=P.project(bt),ur=P.project(Zt).sub(fr),gr=o.curve,Nr=Math.max(P.width,P.height),an=Nr/it,Hr=ur.mag();if("minZoom"in o){var Rn=d.clamp(Math.min(o.minZoom,D,we),P.minZoom,P.maxZoom),ri=Nr/P.zoomScale(Rn-D);gr=Math.sqrt(ri/Hr*2)}var hi=gr*gr;function ni(re){var pe=(an*an-Nr*Nr+(re?-1:1)*hi*hi*Hr*Hr)/(2*(re?an:Nr)*hi*Hr);return Math.log(Math.sqrt(pe*pe+1)-pe)}function ea(re){return(Math.exp(re)-Math.exp(-re))/2}function Un(re){return(Math.exp(re)+Math.exp(-re))/2}var gi=ni(0),te=function(re){return Un(gi)/Un(gi+gr*re)},q=function(re){return Nr*((Un(gi)*(ea(pe=gi+gr*re)/Un(pe))-ea(gi))/hi)/Hr;var pe},R=(ni(1)-gi)/gr;if(Math.abs(Hr)<1e-6||!isFinite(R)){if(Math.abs(Nr-an)<1e-6)return this.easeTo(o,h);var F=an<Nr?-1:1;R=Math.abs(Math.log(an/Nr))/gr,q=function(){return 0},te=function(re){return Math.exp(F*gr*re)}}return o.duration="duration"in o?+o.duration:1e3*R/("screenSpeed"in o?+o.screenSpeed/gr:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=H!==Pe,this._pitching=He!==ae,this._padding=!P.isPaddingEqual(je),this._prepareEase(h,!1),this._ease(function(re){var pe=re*R,dt=1/te(pe);P.zoom=re===1?we:D+P.scaleZoom(dt),g._rotating&&(P.bearing=d.number(H,Pe,re)),g._pitching&&(P.pitch=d.number(ae,He,re)),g._padding&&(P.interpolatePadding(Se,je,re),ot=P.centerPoint.add(ze));var wt=re===1?Zt:P.unproject(fr.add(ur.mult(q(pe))).mult(dt));P.setLocationAtPoint(P.renderWorldCopies?wt.wrap():wt,ot),g._fireMoveEvents(h)},function(){return g._afterEase(h)},o),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,h)}if(!o){var b=this.handlers;b&&b.stop(!1)}return this},u.prototype._ease=function(o,h,g){g.animate===!1||g.duration===0?(o(1),h()):(this._easeStart=d.browser.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var o=Math.min((d.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(o,h){o=d.wrap(o,-180,180);var g=Math.abs(o-h);return Math.abs(o-360-h)<g&&(o-=360),Math.abs(o+360-h)<g&&(o+=360),o},u.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var g=o.lng-h.center.lng;o.lng+=g>180?-360:g<-180?360:0}},u}(d.Evented),is=function(i){i===void 0&&(i={}),this.options=i,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};is.prototype.getDefaultPosition=function(){return"bottom-right"},is.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},is.prototype.onRemove=function(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},is.prototype._setElementTitle=function(i,u){var o=this._map._getUIString("AttributionControl."+u);i.title=o,i.setAttribute("aria-label",o)},is.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},is.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(i){var o=u.reduce(function(h,g,b){return g.value&&(h+=g.key+"="+g.value+(b<u.length-1?"&":"")),h},"?");i.href=d.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},is.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},is.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(D){return typeof D!="string"?"":D})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var o=this._map.style.sourceCaches;for(var h in o){var g=o[h];if(g.used){var b=g.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort(function(D,H){return D.length-H.length});var P=(i=i.filter(function(D,H){for(var ae=H+1;ae<i.length;ae++)if(i[ae].indexOf(D)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,i.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},is.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Qs=function(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)};Qs.prototype.onAdd=function(i){this._map=i,this._container=Q.create("div","mapboxgl-ctrl");var u=Q.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Qs.prototype.onRemove=function(){Q.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Qs.prototype.getDefaultPosition=function(){return"bottom-left"},Qs.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Qs.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},Qs.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var Jo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Jo.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},Jo.prototype.remove=function(i){for(var u=this._currentlyRunning,o=0,h=u?this._queue.concat(u):this._queue;o<h.length;o+=1){var g=h[o];if(g.id===i)return void(g.cancelled=!0)}},Jo.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=u;o<h.length;o+=1){var g=h[o];if(!g.cancelled&&(g.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Jo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var lu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},xc=d.window.HTMLImageElement,nc=d.window.HTMLElement,Wi=d.window.ImageBitmap,Do={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Uc=function(i){function u(h){var g=this;if((h=d.extend({},Do,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var b=new ra(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,b,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Jo,this._controls=[],this._mapId=d.uniqueId(),this._locale=d.extend({},lu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new d.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=d.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof nc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return g._update(!1)}),this.on("moveend",function(){return g._update(!1)}),this.on("zoom",function(){return g._update(!0)}),d.window!==void 0&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Wn(this,h),this._hash=h.hash&&new Ss(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,d.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new is({customAttribution:h.customAttribution})),this.addControl(new Qs,h.logoPosition),this.on("style.load",function(){g.transform.unmodified&&g.jumpTo(g.style.stylesheet)}),this.on("data",function(P){g._update(P.dataType==="style"),g.fire(new d.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){g.fire(new d.Event(P.dataType+"dataloading",P))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,g){if(g===void 0&&(g=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var b=h.onAdd(this);this._controls.push(h);var P=this._controlPositions[g];return g.indexOf("bottom")!==-1?P.insertBefore(b,P.firstChild):P.appendChild(b),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var g=this._controls.indexOf(h);return g>-1&&this._controls.splice(g,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var g=this._containerDimensions(),b=g[0],P=g[1];this._resizeCanvas(b,P),this.transform.resize(b,P),this.painter.resize(b,P);var D=!this._moving;return D&&(this.stop(),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h))),this.fire(new d.Event("resize",h)),D&&this.fire(new d.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(d.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(d.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(d.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,g,b){var P,D=this;if(h==="mouseenter"||h==="mouseover"){var H=!1;return{layer:g,listener:b,delegates:{mousemove:function(Se){var we=D.getLayer(g)?D.queryRenderedFeatures(Se.point,{layers:[g]}):[];we.length?H||(H=!0,b.call(D,new ko(h,D,Se.originalEvent,{features:we}))):H=!1},mouseout:function(){H=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ae=!1;return{layer:g,listener:b,delegates:{mousemove:function(Se){(D.getLayer(g)?D.queryRenderedFeatures(Se.point,{layers:[g]}):[]).length?ae=!0:ae&&(ae=!1,b.call(D,new ko(h,D,Se.originalEvent)))},mouseout:function(Se){ae&&(ae=!1,b.call(D,new ko(h,D,Se.originalEvent)))}}}}return{layer:g,listener:b,delegates:(P={},P[h]=function(Se){var we=D.getLayer(g)?D.queryRenderedFeatures(Se.point,{layers:[g]}):[];we.length&&(Se.features=we,b.call(D,Se),delete Se.features)},P)}},u.prototype.on=function(h,g,b){if(b===void 0)return i.prototype.on.call(this,h,g);var P=this._createDelegatedListener(h,g,b);for(var D in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(P),P.delegates)this.on(D,P.delegates[D]);return this},u.prototype.once=function(h,g,b){if(b===void 0)return i.prototype.once.call(this,h,g);var P=this._createDelegatedListener(h,g,b);for(var D in P.delegates)this.once(D,P.delegates[D]);return this},u.prototype.off=function(h,g,b){var P=this;return b===void 0?i.prototype.off.call(this,h,g):(this._delegatedListeners&&this._delegatedListeners[h]&&function(D){for(var H=D[h],ae=0;ae<H.length;ae++){var Se=H[ae];if(Se.layer===g&&Se.listener===b){for(var we in Se.delegates)P.off(we,Se.delegates[we]);return H.splice(ae,1),P}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,g){if(!this.style)return[];var b;if(g!==void 0||h===void 0||h instanceof d.Point||Array.isArray(h)||(g=h,h=void 0),g=g||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof d.Point||typeof h[0]=="number")b=[d.Point.convert(h)];else{var P=d.Point.convert(h[0]),D=d.Point.convert(h[1]);b=[P,new d.Point(D.x,P.y),D,new d.Point(P.x,D.y),P]}return this.style.queryRenderedFeatures(b,g,this.transform)},u.prototype.querySourceFeatures=function(h,g){return this.style.querySourceFeatures(h,g)},u.prototype.setStyle=function(h,g){return(g=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},g)).diff!==!1&&g.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,g),this):(this._localIdeographFontFamily=g.localIdeographFontFamily,this._updateStyle(h,g))},u.prototype._getUIString=function(h){var g=this._locale[h];if(g==null)throw new Error("Missing UI string '"+h+"'");return g},u.prototype._updateStyle=function(h,g){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new bs(this,g||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new bs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,g){var b=this;if(typeof h=="string"){var P=this._requestManager.normalizeStyleURL(h),D=this._requestManager.transformRequest(P,d.ResourceType.Style);d.getJSON(D,function(H,ae){H?b.fire(new d.ErrorEvent(H)):ae&&b._updateDiff(ae,g)})}else typeof h=="object"&&this._updateDiff(h,g)},u.prototype._updateDiff=function(h,g){try{this.style.setState(h)&&this._update(!0)}catch(b){d.warnOnce("Unable to perform style diff: "+(b.message||b.error||b)+".  Rebuilding the style from scratch."),this._updateStyle(h,g)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,g){return this._lazyInitEmptyStyle(),this.style.addSource(h,g),this._update(!0)},u.prototype.isSourceLoaded=function(h){var g=this.style&&this.style.sourceCaches[h];if(g!==void 0)return g.loaded();this.fire(new d.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var g in h){var b=h[g]._tiles;for(var P in b){var D=b[P];if(D.state!=="loaded"&&D.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,g,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,g,b)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,g,b){b===void 0&&(b={});var P=b.pixelRatio;P===void 0&&(P=1);var D=b.sdf;D===void 0&&(D=!1);var H=b.stretchX,ae=b.stretchY,Se=b.content;if(this._lazyInitEmptyStyle(),g instanceof xc||Wi&&g instanceof Wi){var we=d.browser.getImageData(g);this.style.addImage(h,{data:new d.RGBAImage({width:we.width,height:we.height},we.data),pixelRatio:P,stretchX:H,stretchY:ae,content:Se,sdf:D,version:0})}else{if(g.width===void 0||g.height===void 0)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Pe=g;this.style.addImage(h,{data:new d.RGBAImage({width:g.width,height:g.height},new Uint8Array(g.data)),pixelRatio:P,stretchX:H,stretchY:ae,content:Se,sdf:D,version:0,userImage:Pe}),Pe.onAdd&&Pe.onAdd(this,h)}},u.prototype.updateImage=function(h,g){var b=this.style.getImage(h);if(!b)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=g instanceof xc||Wi&&g instanceof Wi?d.browser.getImageData(g):g,D=P.width,H=P.height,ae=P.data;return D===void 0||H===void 0?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):D!==b.data.width||H!==b.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(b.data.replace(ae,!(g instanceof xc||Wi&&g instanceof Wi)),void this.style.updateImage(h,b))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,g){d.getImage(this._requestManager.transformRequest(h,d.ResourceType.Image),g)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,g){return this._lazyInitEmptyStyle(),this.style.addLayer(h,g),this._update(!0)},u.prototype.moveLayer=function(h,g){return this.style.moveLayer(h,g),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,g,b){return this.style.setLayerZoomRange(h,g,b),this._update(!0)},u.prototype.setFilter=function(h,g,b){return b===void 0&&(b={}),this.style.setFilter(h,g,b),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,g,b,P){return P===void 0&&(P={}),this.style.setPaintProperty(h,g,b,P),this._update(!0)},u.prototype.getPaintProperty=function(h,g){return this.style.getPaintProperty(h,g)},u.prototype.setLayoutProperty=function(h,g,b,P){return P===void 0&&(P={}),this.style.setLayoutProperty(h,g,b,P),this._update(!0)},u.prototype.getLayoutProperty=function(h,g){return this.style.getLayoutProperty(h,g)},u.prototype.setLight=function(h,g){return g===void 0&&(g={}),this._lazyInitEmptyStyle(),this.style.setLight(h,g),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,g){return this.style.setFeatureState(h,g),this._update()},u.prototype.removeFeatureState=function(h,g){return this.style.removeFeatureState(h,g),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,g=0;return this._container&&(h=this._container.clientWidth||400,g=this._container.clientHeight||300),[h,g]},u.prototype._detectMissingCSS=function(){d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var g=this._canvasContainer=Q.create("div","mapboxgl-canvas-container",h);this._interactive&&g.classList.add("mapboxgl-interactive"),this._canvas=Q.create("canvas","mapboxgl-canvas",g),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var b=this._containerDimensions();this._resizeCanvas(b[0],b[1]);var P=this._controlContainer=Q.create("div","mapboxgl-control-container",h),D=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(H){D[H]=Q.create("div","mapboxgl-ctrl-"+H,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,g){var b=d.browser.devicePixelRatio||1;this._canvas.width=b*h,this._canvas.height=b*g,this._canvas.style.width=h+"px",this._canvas.style.height=g+"px"},u.prototype._setupPainter=function(){var h=d.extend({},A.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),g=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);g?(this.painter=new Ka(g,this.transform),d.webpSupported.testSupport(g)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var g,b=this,P=0,D=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(g=D.createQueryEXT(),D.beginQueryEXT(D.TIME_ELAPSED_EXT,g),P=d.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var H=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ae=this.transform.zoom,Se=d.browser.now();this.style.zoomHistory.update(ae,Se);var we=new d.EvaluationParameters(ae,{now:Se,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Pe=we.crossFadingFactor();Pe===1&&Pe===this._crossFadingFactor||(H=!0,this._crossFadingFactor=Pe),this.style.update(we)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||H)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var He=d.browser.now()-P;D.endQueryEXT(D.TIME_ELAPSED_EXT,g),setTimeout(function(){var ze=D.getQueryObjectEXT(g,D.QUERY_RESULT_EXT)/1e6;D.deleteQueryEXT(g),b.fire(new d.Event("gpu-timing-frame",{cpuTime:He,gpuTime:ze}))},50)}if(this.listens("gpu-timing-layer")){var je=this.painter.collectGpuTimers();setTimeout(function(){var ze=b.painter.queryGpuTimers(je);b.fire(new d.Event("gpu-timing-layer",{layerTimes:ze}))},50)}var it=this._sourcesDirty||this._styleDirty||this._placementDirty;return it||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.Event("idle")),!this._loaded||this._fullyLoaded||it||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,g=this._controls;h<g.length;h+=1)g[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),d.window!==void 0&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));var b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),Es(this._canvasContainer),Es(this._controlContainer),Es(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new d.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=d.browser.frame(function(g){h._frame=null,h._render(g)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,g){d.setCacheLimits(h,g)},o.version.get=function(){return d.version},Object.defineProperties(u.prototype,o),u}(Rl);function Es(i){i.parentNode&&i.parentNode.removeChild(i)}var ic={showCompass:!0,showZoom:!0,visualizePitch:!1},ws=function(i){var u=this;this.options=d.extend({},ic,i),this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return u._map.zoomIn({},{originalEvent:o})}),Q.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return u._map.zoomOut({},{originalEvent:o})}),Q.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:o}):u._map.resetNorth({},{originalEvent:o})}),this._compassIcon=Q.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};ws.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),o=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},ws.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},ws.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ds(this._map,this._compass,this.options.visualizePitch)),this._container},ws.prototype.onRemove=function(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},ws.prototype._createButton=function(i,u){var o=Q.create("button",i,this._container);return o.type="button",o.addEventListener("click",u),o},ws.prototype._setButtonTitle=function(i,u){var o=this._map._getUIString("NavigationControl."+u);i.title=o,i.setAttribute("aria-label",o)};var ds=function(i,u,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new tc({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,o&&(this.mousePitch=new ku({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Q.addEventListener(u,"mousedown",this.mousedown),Q.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(u,"touchmove",this.touchmove),Q.addEventListener(u,"touchend",this.touchend),Q.addEventListener(u,"touchcancel",this.reset)};function dl(i,u,o){if(i=new d.LngLat(i.lng,i.lat),u){var h=new d.LngLat(i.lng-360,i.lat),g=new d.LngLat(i.lng+360,i.lat),b=o.locationPoint(i).distSqr(u);o.locationPoint(h).distSqr(u)<b?i=h:o.locationPoint(g).distSqr(u)<b&&(i=g)}for(;Math.abs(i.lng-o.center.lng)>180;){var P=o.locationPoint(i);if(P.x>=0&&P.y>=0&&P.x<=o.width&&P.y<=o.height)break;i.lng>o.center.lng?i.lng-=360:i.lng+=360}return i}ds.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),Q.disableDrag()},ds.prototype.move=function(i,u){var o=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var g=this.mousePitch.mousemoveWindow(i,u);g&&g.pitchDelta&&o.setPitch(o.getPitch()+g.pitchDelta)}},ds.prototype.off=function(){var i=this.element;Q.removeEventListener(i,"mousedown",this.mousedown),Q.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(i,"touchmove",this.touchmove),Q.removeEventListener(i,"touchend",this.touchend),Q.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},ds.prototype.offTemp=function(){Q.enableDrag(),Q.removeEventListener(d.window,"mousemove",this.mousemove),Q.removeEventListener(d.window,"mouseup",this.mouseup)},ds.prototype.mousedown=function(i){this.down(d.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),Q.mousePos(this.element,i)),Q.addEventListener(d.window,"mousemove",this.mousemove),Q.addEventListener(d.window,"mouseup",this.mouseup)},ds.prototype.mousemove=function(i){this.move(i,Q.mousePos(this.element,i))},ds.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},ds.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},ds.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},ds.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ds.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function kl(i,u,o){var h=i.classList;for(var g in cu)h.remove("mapboxgl-"+o+"-anchor-"+g);h.add("mapboxgl-"+o+"-anchor-"+u)}var Ju,Dl=function(i){function u(o,h){if(i.call(this),(o instanceof d.window.HTMLElement||h)&&(o=d.extend({element:o},h)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=d.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div"),this._element.setAttribute("aria-label","Map marker");var g=Q.createNS("http://www.w3.org/2000/svg","svg");g.setAttributeNS(null,"display","block"),g.setAttributeNS(null,"height","41px"),g.setAttributeNS(null,"width","27px"),g.setAttributeNS(null,"viewBox","0 0 27 41");var b=Q.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");var P=Q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var D=Q.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");for(var H=0,ae=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];H<ae.length;H+=1){var Se=ae[H],we=Q.createNS("http://www.w3.org/2000/svg","ellipse");we.setAttributeNS(null,"opacity","0.04"),we.setAttributeNS(null,"cx","10.5"),we.setAttributeNS(null,"cy","5.80029008"),we.setAttributeNS(null,"rx",Se.rx),we.setAttributeNS(null,"ry",Se.ry),D.appendChild(we)}var Pe=Q.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"fill",this._color);var He=Q.createNS("http://www.w3.org/2000/svg","path");He.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Pe.appendChild(He);var je=Q.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"opacity","0.25"),je.setAttributeNS(null,"fill","#000000");var it=Q.createNS("http://www.w3.org/2000/svg","path");it.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),je.appendChild(it);var ze=Q.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ze.setAttributeNS(null,"fill","#FFFFFF");var ot=Q.createNS("http://www.w3.org/2000/svg","g");ot.setAttributeNS(null,"transform","translate(8.0, 8.0)");var bt=Q.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#000000"),bt.setAttributeNS(null,"opacity","0.25"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962");var Zt=Q.createNS("http://www.w3.org/2000/svg","circle");Zt.setAttributeNS(null,"fill","#FFFFFF"),Zt.setAttributeNS(null,"cx","5.5"),Zt.setAttributeNS(null,"cy","5.5"),Zt.setAttributeNS(null,"r","5.4999962"),ot.appendChild(bt),ot.appendChild(Zt),P.appendChild(D),P.appendChild(Pe),P.appendChild(je),P.appendChild(ze),P.appendChild(ot),g.appendChild(P),g.setAttributeNS(null,"height",41*this._scale+"px"),g.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(g),this._offset=d.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(fr){fr.preventDefault()}),this._element.addEventListener("mousedown",function(fr){fr.preventDefault()}),kl(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(o){var h=o.code,g=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&g!==32&&g!==13||this.togglePopup()},u.prototype._onMapClick=function(o){var h=o.originalEvent.target,g=this._element;this._popup&&(h===g||g.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},u.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=dl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var g="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?g="rotateX(0deg)":this._pitchAlignment==="map"&&(g="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,cu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+g+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(o){return this._offset=d.Point.convert(o),this._update(),this},u.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(d.Evented),Zc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Fl=0,vl=!1,bc=function(i){function u(o){i.call(this),this.options=d.extend({},Zc,o),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){var h;return this._map=o,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Ju!==void 0?h(Ju):d.window.navigator.permissions!==void 0?d.window.navigator.permissions.query({name:"geolocation"}).then(function(g){h(Ju=g.state!=="denied")}):h(Ju=!!d.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fl=0,vl=!1},u.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),g=o.coords;return h&&(g.longitude<h.getWest()||g.longitude>h.getEast()||g.latitude<h.getSouth()||g.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",o)),this._finish()}},u.prototype._updateCamera=function(o){var h=new d.LngLat(o.coords.longitude,o.coords.latitude),g=o.coords.accuracy,b=this._map.getBearing(),P=d.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(g),P,{geolocateSource:!0})},u.prototype._updateMarker=function(o){if(o){var h=new d.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),g=this._map.unproject([1,o]),b=h.distanceTo(g),P=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&vl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",o)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=Q.create("button","mapboxgl-ctrl-geolocate",this._container),Q.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g)}else{var b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Dl(this._dotElement),this._circleElement=Q.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Dl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||h._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new d.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fl--,vl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Fl>1?(o={maximumAge:6e5,timeout:0},vl=!0):(o=this.options.positionOptions,vl=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(d.Evented),Fu={maxWidth:100,unit:"metric"},Bu=function(i){this.options=d.extend({},Fu,i),d.bindAll(["_onMove","setUnit"],this)};function Sc(i,u,o){var h=o&&o.maxWidth||100,g=i._container.clientHeight/2,b=i.unproject([0,g]),P=i.unproject([h,g]),D=b.distanceTo(P);if(o&&o.unit==="imperial"){var H=3.2808*D;H>5280?Nu(u,h,H/5280,i._getUIString("ScaleControl.Miles")):Nu(u,h,H,i._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Nu(u,h,D/1852,i._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Nu(u,h,D/1e3,i._getUIString("ScaleControl.Kilometers")):Nu(u,h,D,i._getUIString("ScaleControl.Meters"))}function Nu(i,u,o,h){var g,b,P,D=(g=o,(b=Math.pow(10,(""+Math.floor(g)).length-1))*(P=(P=g/b)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(H){var ae=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*ae)/ae}(P)));i.style.width=u*(D/o)+"px",i.innerHTML=D+"&nbsp;"+h}Bu.prototype.getDefaultPosition=function(){return"bottom-left"},Bu.prototype._onMove=function(){Sc(this._map,this._container,this.options)},Bu.prototype.onAdd=function(i){return this._map=i,this._container=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Bu.prototype.onRemove=function(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Bu.prototype.setUnit=function(i){this.options.unit=i,Sc(this._map,this._container,this.options)};var Us=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof d.window.HTMLElement?this._container=i.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in d.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in d.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in d.window.document&&(this._fullscreenchange="MSFullscreenChange")};Us.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Us.prototype.onRemove=function(){Q.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Us.prototype._checkFullscreenSupport=function(){return!!(d.window.document.fullscreenEnabled||d.window.document.mozFullScreenEnabled||d.window.document.msFullscreenEnabled||d.window.document.webkitFullscreenEnabled)},Us.prototype._setupUI=function(){var i=this._fullscreenButton=Q.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Us.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},Us.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Us.prototype._isFullscreen=function(){return this._fullscreen},Us.prototype._changeIcon=function(){(d.window.document.fullscreenElement||d.window.document.mozFullScreenElement||d.window.document.webkitFullscreenElement||d.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Us.prototype._onClickFullscreen=function(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.mozCancelFullScreen?d.window.document.mozCancelFullScreen():d.window.document.msExitFullscreen?d.window.document.msExitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Ec={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Bl=function(i){function u(o){i.call(this),this.options=d.extend(Object.create(Ec),o),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(o){return this.setDOMContent(d.window.document.createTextNode(o))},u.prototype.setHTML=function(o){var h,g=d.window.document.createDocumentFragment(),b=d.window.document.createElement("body");for(b.innerHTML=o;h=b.firstChild;)g.appendChild(h);return this.setDOMContent(g)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},u.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},u.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},u.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},u.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Q.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(o){this._update(o.point)},u.prototype._onMouseMove=function(o){this._update(o.point)},u.prototype._onDrag=function(o){this._update(o.point)},u.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Q.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Q.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(we){return h._container.classList.add(we)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=dl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var g=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),b=this.options.anchor,P=function we(Pe){if(Pe){if(typeof Pe=="number"){var He=Math.round(Math.sqrt(.5*Math.pow(Pe,2)));return{center:new d.Point(0,0),top:new d.Point(0,Pe),"top-left":new d.Point(He,He),"top-right":new d.Point(-He,He),bottom:new d.Point(0,-Pe),"bottom-left":new d.Point(He,-He),"bottom-right":new d.Point(-He,-He),left:new d.Point(Pe,0),right:new d.Point(-Pe,0)}}if(Pe instanceof d.Point||Array.isArray(Pe)){var je=d.Point.convert(Pe);return{center:je,top:je,"top-left":je,"top-right":je,bottom:je,"bottom-left":je,"bottom-right":je,left:je,right:je}}return{center:d.Point.convert(Pe.center||[0,0]),top:d.Point.convert(Pe.top||[0,0]),"top-left":d.Point.convert(Pe["top-left"]||[0,0]),"top-right":d.Point.convert(Pe["top-right"]||[0,0]),bottom:d.Point.convert(Pe.bottom||[0,0]),"bottom-left":d.Point.convert(Pe["bottom-left"]||[0,0]),"bottom-right":d.Point.convert(Pe["bottom-right"]||[0,0]),left:d.Point.convert(Pe.left||[0,0]),right:d.Point.convert(Pe.right||[0,0])}}return we(new d.Point(0,0))}(this.options.offset);if(!b){var D,H=this._container.offsetWidth,ae=this._container.offsetHeight;D=g.y+P.bottom.y<ae?["top"]:g.y>this._map.transform.height-ae?["bottom"]:[],g.x<H/2?D.push("left"):g.x>this._map.transform.width-H/2&&D.push("right"),b=D.length===0?"bottom":D.join("-")}var Se=g.add(P[b]).round();Q.setTransform(this._container,cu[b]+" translate("+Se.x+"px,"+Se.y+"px)"),kl(this._container,b,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(zu);o&&o.focus()}},u.prototype._onClose=function(){this.remove()},u}(d.Evented),Qu={version:d.version,supported:A,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:Uc,NavigationControl:ws,GeolocateControl:bc,AttributionControl:is,ScaleControl:Bu,FullscreenControl:Us,Popup:Bl,Marker:Dl,Style:bs,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.Point,MercatorCoordinate:d.MercatorCoordinate,Evented:d.Evented,config:d.config,prewarm:function(){$t().acquire(Jt)},clearPrewarmedResources:function(){var i=Ln;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(Jt),Ln=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(i){d.config.ACCESS_TOKEN=i},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(i){d.config.API_URL=i},get workerCount(){return Rr.workerCount},set workerCount(i){Rr.workerCount=i},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){d.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){d.clearTileCache(i)},workerUrl:""};return Qu}),le})},28660:function(Or,U,E){var le=E(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var C;(function(d){(function(A){var Q=typeof E.g=="object"?E.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),K=W(d);typeof Q.Reflect=="undefined"?Q.Reflect=d:K=W(Q.Reflect,K),A(K);function W(L,N){return function(Ne,Ye){typeof L[Ne]!="function"&&Object.defineProperty(L,Ne,{configurable:!0,writable:!0,value:Ye}),N&&N(Ne,Ye)}}})(function(A){var Q=Object.prototype.hasOwnProperty,K=typeof Symbol=="function",W=K&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",L=K&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",N=typeof Object.create=="function",Ne={__proto__:[]}instanceof Array,Ye=!N&&!Ne,Je={create:N?function(){return Lr(Object.create(null))}:Ne?function(){return Lr({__proto__:null})}:function(){return Lr({})},has:Ye?function(nt,gt){return Q.call(nt,gt)}:function(nt,gt){return gt in nt},get:Ye?function(nt,gt){return Q.call(nt,gt)?nt[gt]:void 0}:function(nt,gt){return nt[gt]}},rt=Object.getPrototypeOf(Function),Yt=typeof le=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Vt=!Yt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ie(),tr=!Yt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:sr(),zt=!Yt&&typeof WeakMap=="function"?WeakMap:Br(),Tt=new zt;function xt(nt,gt,vt,hr){if(yn(vt)){if(!w(nt))throw new TypeError;if(!Ee(gt))throw new TypeError;return ar(nt,gt)}else{if(!w(nt))throw new TypeError;if(!de(gt))throw new TypeError;if(!de(hr)&&!yn(hr)&&!Vi(hr))throw new TypeError;return Vi(hr)&&(hr=void 0),vt=er(vt),zr(nt,gt,vt,hr)}}A("decorate",xt);function yr(nt,gt){function vt(hr,Vr){if(!de(hr))throw new TypeError;if(!yn(Vr)&&!Ze(Vr))throw new TypeError;Nt(nt,gt,hr,Vr)}return vt}A("metadata",yr);function ee(nt,gt,vt,hr){if(!de(vt))throw new TypeError;return yn(hr)||(hr=er(hr)),Nt(nt,gt,vt,hr)}A("defineMetadata",ee);function dr(nt,gt,vt){if(!de(gt))throw new TypeError;return yn(vt)||(vt=er(vt)),Re(nt,gt,vt)}A("hasMetadata",dr);function Ct(nt,gt,vt){if(!de(gt))throw new TypeError;return yn(vt)||(vt=er(vt)),ge(nt,gt,vt)}A("hasOwnMetadata",Ct);function Ke(nt,gt,vt){if(!de(gt))throw new TypeError;return yn(vt)||(vt=er(vt)),_t(nt,gt,vt)}A("getMetadata",Ke);function Dt(nt,gt,vt){if(!de(gt))throw new TypeError;return yn(vt)||(vt=er(vt)),pt(nt,gt,vt)}A("getOwnMetadata",Dt);function Xe(nt,gt){if(!de(nt))throw new TypeError;return yn(gt)||(gt=er(gt)),Bt(nt,gt)}A("getMetadataKeys",Xe);function Ut(nt,gt){if(!de(nt))throw new TypeError;return yn(gt)||(gt=er(gt)),kr(nt,gt)}A("getOwnMetadataKeys",Ut);function _r(nt,gt,vt){if(!de(gt))throw new TypeError;yn(vt)||(vt=er(vt));var hr=fe(gt,vt,!1);if(yn(hr)||!hr.delete(nt))return!1;if(hr.size>0)return!0;var Vr=Tt.get(gt);return Vr.delete(vt),Vr.size>0||Tt.delete(gt),!0}A("deleteMetadata",_r);function ar(nt,gt){for(var vt=nt.length-1;vt>=0;--vt){var hr=nt[vt],Vr=hr(gt);if(!yn(Vr)&&!Vi(Vr)){if(!Ee(Vr))throw new TypeError;gt=Vr}}return gt}function zr(nt,gt,vt,hr){for(var Vr=nt.length-1;Vr>=0;--Vr){var Ur=nt[Vr],nn=Ur(gt,vt,hr);if(!yn(nn)&&!Vi(nn)){if(!de(nn))throw new TypeError;hr=nn}}return hr}function fe(nt,gt,vt){var hr=Tt.get(nt);if(yn(hr)){if(!vt)return;hr=new Vt,Tt.set(nt,hr)}var Vr=hr.get(gt);if(yn(Vr)){if(!vt)return;Vr=new Vt,hr.set(gt,Vr)}return Vr}function Re(nt,gt,vt){var hr=ge(nt,gt,vt);if(hr)return!0;var Vr=Qt(gt);return Vi(Vr)?!1:Re(nt,Vr,vt)}function ge(nt,gt,vt){var hr=fe(gt,vt,!1);return yn(hr)?!1:Le(hr.has(nt))}function _t(nt,gt,vt){var hr=ge(nt,gt,vt);if(hr)return pt(nt,gt,vt);var Vr=Qt(gt);if(!Vi(Vr))return _t(nt,Vr,vt)}function pt(nt,gt,vt){var hr=fe(gt,vt,!1);if(!yn(hr))return hr.get(nt)}function Nt(nt,gt,vt,hr){var Vr=fe(vt,hr,!0);Vr.set(nt,gt)}function Bt(nt,gt){var vt=kr(nt,gt),hr=Qt(nt);if(hr===null)return vt;var Vr=Bt(hr,gt);if(Vr.length<=0)return vt;if(vt.length<=0)return Vr;for(var Ur=new tr,nn=[],Jr=0,Cr=vt;Jr<Cr.length;Jr++){var Dn=Cr[Jr],Hn=Ur.has(Dn);Hn||(Ur.add(Dn),nn.push(Dn))}for(var bi=0,Ui=Vr;bi<Ui.length;bi++){var Dn=Ui[bi],Hn=Ur.has(Dn);Hn||(Ur.add(Dn),nn.push(Dn))}return nn}function kr(nt,gt){var vt=[],hr=fe(nt,gt,!1);if(yn(hr))return vt;for(var Vr=hr.keys(),Ur=yt(Vr),nn=0;;){var Jr=jt(Ur);if(!Jr)return vt.length=nn,vt;var Cr=St(Jr);try{vt[nn]=Cr}catch(Dn){try{Et(Ur)}finally{throw Dn}}nn++}}function ln(nt){if(nt===null)return 1;switch(typeof nt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return nt===null?1:6;default:return 6}}function yn(nt){return nt===void 0}function Vi(nt){return nt===null}function nr(nt){return typeof nt=="symbol"}function de(nt){return typeof nt=="object"?nt!==null:typeof nt=="function"}function Te(nt,gt){switch(ln(nt)){case 0:return nt;case 1:return nt;case 2:return nt;case 3:return nt;case 4:return nt;case 5:return nt}var vt=gt===3?"string":gt===5?"number":"default",hr=Qe(nt,W);if(hr!==void 0){var Vr=hr.call(nt,vt);if(de(Vr))throw new TypeError;return Vr}return Ue(nt,vt==="default"?"number":vt)}function Ue(nt,gt){if(gt==="string"){var vt=nt.toString;if(Z(vt)){var hr=vt.call(nt);if(!de(hr))return hr}var Vr=nt.valueOf;if(Z(Vr)){var hr=Vr.call(nt);if(!de(hr))return hr}}else{var Vr=nt.valueOf;if(Z(Vr)){var hr=Vr.call(nt);if(!de(hr))return hr}var Ur=nt.toString;if(Z(Ur)){var hr=Ur.call(nt);if(!de(hr))return hr}}throw new TypeError}function Le(nt){return!!nt}function Ft(nt){return""+nt}function er(nt){var gt=Te(nt,3);return nr(gt)?gt:Ft(gt)}function w(nt){return Array.isArray?Array.isArray(nt):nt instanceof Object?nt instanceof Array:Object.prototype.toString.call(nt)==="[object Array]"}function Z(nt){return typeof nt=="function"}function Ee(nt){return typeof nt=="function"}function Ze(nt){switch(ln(nt)){case 3:return!0;case 4:return!0;default:return!1}}function Qe(nt,gt){var vt=nt[gt];if(vt!=null){if(!Z(vt))throw new TypeError;return vt}}function yt(nt){var gt=Qe(nt,L);if(!Z(gt))throw new TypeError;var vt=gt.call(nt);if(!de(vt))throw new TypeError;return vt}function St(nt){return nt.value}function jt(nt){var gt=nt.next();return gt.done?!1:gt}function Et(nt){var gt=nt.return;gt&&gt.call(nt)}function Qt(nt){var gt=Object.getPrototypeOf(nt);if(typeof nt!="function"||nt===rt||gt!==rt)return gt;var vt=nt.prototype,hr=vt&&Object.getPrototypeOf(vt);if(hr==null||hr===Object.prototype)return gt;var Vr=hr.constructor;return typeof Vr!="function"||Vr===nt?gt:Vr}function ie(){var nt={},gt=[],vt=function(){function nn(Jr,Cr,Dn){this._index=0,this._keys=Jr,this._values=Cr,this._selector=Dn}return nn.prototype["@@iterator"]=function(){return this},nn.prototype[L]=function(){return this},nn.prototype.next=function(){var Jr=this._index;if(Jr>=0&&Jr<this._keys.length){var Cr=this._selector(this._keys[Jr],this._values[Jr]);return Jr+1>=this._keys.length?(this._index=-1,this._keys=gt,this._values=gt):this._index++,{value:Cr,done:!1}}return{value:void 0,done:!0}},nn.prototype.throw=function(Jr){throw this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),Jr},nn.prototype.return=function(Jr){return this._index>=0&&(this._index=-1,this._keys=gt,this._values=gt),{value:Jr,done:!0}},nn}();return function(){function nn(){this._keys=[],this._values=[],this._cacheKey=nt,this._cacheIndex=-2}return Object.defineProperty(nn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),nn.prototype.has=function(Jr){return this._find(Jr,!1)>=0},nn.prototype.get=function(Jr){var Cr=this._find(Jr,!1);return Cr>=0?this._values[Cr]:void 0},nn.prototype.set=function(Jr,Cr){var Dn=this._find(Jr,!0);return this._values[Dn]=Cr,this},nn.prototype.delete=function(Jr){var Cr=this._find(Jr,!1);if(Cr>=0){for(var Dn=this._keys.length,Hn=Cr+1;Hn<Dn;Hn++)this._keys[Hn-1]=this._keys[Hn],this._values[Hn-1]=this._values[Hn];return this._keys.length--,this._values.length--,Jr===this._cacheKey&&(this._cacheKey=nt,this._cacheIndex=-2),!0}return!1},nn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=nt,this._cacheIndex=-2},nn.prototype.keys=function(){return new vt(this._keys,this._values,hr)},nn.prototype.values=function(){return new vt(this._keys,this._values,Vr)},nn.prototype.entries=function(){return new vt(this._keys,this._values,Ur)},nn.prototype["@@iterator"]=function(){return this.entries()},nn.prototype[L]=function(){return this.entries()},nn.prototype._find=function(Jr,Cr){return this._cacheKey!==Jr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jr)),this._cacheIndex<0&&Cr&&(this._cacheIndex=this._keys.length,this._keys.push(Jr),this._values.push(void 0)),this._cacheIndex},nn}();function hr(nn,Jr){return nn}function Vr(nn,Jr){return Jr}function Ur(nn,Jr){return[nn,Jr]}}function sr(){return function(){function nt(){this._map=new Vt}return Object.defineProperty(nt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),nt.prototype.has=function(gt){return this._map.has(gt)},nt.prototype.add=function(gt){return this._map.set(gt,gt),this},nt.prototype.delete=function(gt){return this._map.delete(gt)},nt.prototype.clear=function(){this._map.clear()},nt.prototype.keys=function(){return this._map.keys()},nt.prototype.values=function(){return this._map.values()},nt.prototype.entries=function(){return this._map.entries()},nt.prototype["@@iterator"]=function(){return this.keys()},nt.prototype[L]=function(){return this.keys()},nt}()}function Br(){var nt=16,gt=Je.create(),vt=hr();return function(){function Cr(){this._key=hr()}return Cr.prototype.has=function(Dn){var Hn=Vr(Dn,!1);return Hn!==void 0?Je.has(Hn,this._key):!1},Cr.prototype.get=function(Dn){var Hn=Vr(Dn,!1);return Hn!==void 0?Je.get(Hn,this._key):void 0},Cr.prototype.set=function(Dn,Hn){var bi=Vr(Dn,!0);return bi[this._key]=Hn,this},Cr.prototype.delete=function(Dn){var Hn=Vr(Dn,!1);return Hn!==void 0?delete Hn[this._key]:!1},Cr.prototype.clear=function(){this._key=hr()},Cr}();function hr(){var Cr;do Cr="@@WeakMap@@"+Jr();while(Je.has(gt,Cr));return gt[Cr]=!0,Cr}function Vr(Cr,Dn){if(!Q.call(Cr,vt)){if(!Dn)return;Object.defineProperty(Cr,vt,{value:Je.create()})}return Cr[vt]}function Ur(Cr,Dn){for(var Hn=0;Hn<Dn;++Hn)Cr[Hn]=Math.random()*255|0;return Cr}function nn(Cr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Cr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Cr)):Ur(new Uint8Array(Cr),Cr):Ur(new Array(Cr),Cr)}function Jr(){var Cr=nn(nt);Cr[6]=Cr[6]&79|64,Cr[8]=Cr[8]&191|128;for(var Dn="",Hn=0;Hn<nt;++Hn){var bi=Cr[Hn];(Hn===4||Hn===6||Hn===8)&&(Dn+="-"),bi<16&&(Dn+="0"),Dn+=bi.toString(16).toLowerCase()}return Dn}}function Lr(nt){return nt.__=void 0,delete nt.__,nt}})})(C||(C={}))},69848:function(Or){(function(U,E){Or.exports=E()})(this,function(){"use strict";function U(Ct,Ke,Dt,Xe,Ut,_r){if(!(Ut-Xe<=Dt)){var ar=Xe+Ut>>1;E(Ct,Ke,ar,Xe,Ut,_r%2),U(Ct,Ke,Dt,Xe,ar-1,_r+1),U(Ct,Ke,Dt,ar+1,Ut,_r+1)}}function E(Ct,Ke,Dt,Xe,Ut,_r){for(;Ut>Xe;){if(Ut-Xe>600){var ar=Ut-Xe+1,zr=Dt-Xe+1,fe=Math.log(ar),Re=.5*Math.exp(2*fe/3),ge=.5*Math.sqrt(fe*Re*(ar-Re)/ar)*(zr-ar/2<0?-1:1),_t=Math.max(Xe,Math.floor(Dt-zr*Re/ar+ge)),pt=Math.min(Ut,Math.floor(Dt+(ar-zr)*Re/ar+ge));E(Ct,Ke,Dt,_t,pt,_r)}var Nt=Ke[2*Dt+_r],Bt=Xe,kr=Ut;for(le(Ct,Ke,Xe,Dt),Ke[2*Ut+_r]>Nt&&le(Ct,Ke,Xe,Ut);Bt<kr;){for(le(Ct,Ke,Bt,kr),Bt++,kr--;Ke[2*Bt+_r]<Nt;)Bt++;for(;Ke[2*kr+_r]>Nt;)kr--}Ke[2*Xe+_r]===Nt?le(Ct,Ke,Xe,kr):(kr++,le(Ct,Ke,kr,Ut)),kr<=Dt&&(Xe=kr+1),Dt<=kr&&(Ut=kr-1)}}function le(Ct,Ke,Dt,Xe){C(Ct,Dt,Xe),C(Ke,2*Dt,2*Xe),C(Ke,2*Dt+1,2*Xe+1)}function C(Ct,Ke,Dt){var Xe=Ct[Ke];Ct[Ke]=Ct[Dt],Ct[Dt]=Xe}function d(Ct,Ke,Dt,Xe,Ut,_r,ar){for(var zr=[0,Ct.length-1,0],fe=[],Re,ge;zr.length;){var _t=zr.pop(),pt=zr.pop(),Nt=zr.pop();if(pt-Nt<=ar){for(var Bt=Nt;Bt<=pt;Bt++)Re=Ke[2*Bt],ge=Ke[2*Bt+1],Re>=Dt&&Re<=Ut&&ge>=Xe&&ge<=_r&&fe.push(Ct[Bt]);continue}var kr=Math.floor((Nt+pt)/2);Re=Ke[2*kr],ge=Ke[2*kr+1],Re>=Dt&&Re<=Ut&&ge>=Xe&&ge<=_r&&fe.push(Ct[kr]);var ln=(_t+1)%2;(_t===0?Dt<=Re:Xe<=ge)&&(zr.push(Nt),zr.push(kr-1),zr.push(ln)),(_t===0?Ut>=Re:_r>=ge)&&(zr.push(kr+1),zr.push(pt),zr.push(ln))}return fe}function A(Ct,Ke,Dt,Xe,Ut,_r){for(var ar=[0,Ct.length-1,0],zr=[],fe=Ut*Ut;ar.length;){var Re=ar.pop(),ge=ar.pop(),_t=ar.pop();if(ge-_t<=_r){for(var pt=_t;pt<=ge;pt++)Q(Ke[2*pt],Ke[2*pt+1],Dt,Xe)<=fe&&zr.push(Ct[pt]);continue}var Nt=Math.floor((_t+ge)/2),Bt=Ke[2*Nt],kr=Ke[2*Nt+1];Q(Bt,kr,Dt,Xe)<=fe&&zr.push(Ct[Nt]);var ln=(Re+1)%2;(Re===0?Dt-Ut<=Bt:Xe-Ut<=kr)&&(ar.push(_t),ar.push(Nt-1),ar.push(ln)),(Re===0?Dt+Ut>=Bt:Xe+Ut>=kr)&&(ar.push(Nt+1),ar.push(ge),ar.push(ln))}return zr}function Q(Ct,Ke,Dt,Xe){var Ut=Ct-Dt,_r=Ke-Xe;return Ut*Ut+_r*_r}var K=function(Ct){return Ct[0]},W=function(Ct){return Ct[1]},L=function(Ke,Dt,Xe,Ut,_r){Dt===void 0&&(Dt=K),Xe===void 0&&(Xe=W),Ut===void 0&&(Ut=64),_r===void 0&&(_r=Float64Array),this.nodeSize=Ut,this.points=Ke;for(var ar=Ke.length<65536?Uint16Array:Uint32Array,zr=this.ids=new ar(Ke.length),fe=this.coords=new _r(Ke.length*2),Re=0;Re<Ke.length;Re++)zr[Re]=Re,fe[2*Re]=Dt(Ke[Re]),fe[2*Re+1]=Xe(Ke[Re]);U(zr,fe,Ut,0,zr.length-1,0)};L.prototype.range=function(Ke,Dt,Xe,Ut){return d(this.ids,this.coords,Ke,Dt,Xe,Ut,this.nodeSize)},L.prototype.within=function(Ke,Dt,Xe){return A(this.ids,this.coords,Ke,Dt,Xe,this.nodeSize)};var N={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ct){return Ct}},Ne=Math.fround||function(Ct){return function(Ke){return Ct[0]=+Ke,Ct[0]}}(new Float32Array(1)),Ye=function(Ke){this.options=yr(Object.create(N),Ke),this.trees=new Array(this.options.maxZoom+1)};Ye.prototype.load=function(Ke){var Dt=this.options,Xe=Dt.log,Ut=Dt.minZoom,_r=Dt.maxZoom,ar=Dt.nodeSize;Xe&&console.time("total time");var zr="prepare "+Ke.length+" points";Xe&&console.time(zr),this.points=Ke;for(var fe=[],Re=0;Re<Ke.length;Re++)!Ke[Re].geometry||fe.push(rt(Ke[Re],Re));this.trees[_r+1]=new L(fe,ee,dr,ar,Float32Array),Xe&&console.timeEnd(zr);for(var ge=_r;ge>=Ut;ge--){var _t=+Date.now();fe=this._cluster(fe,ge),this.trees[ge]=new L(fe,ee,dr,ar,Float32Array),Xe&&console.log("z%d: %d clusters in %dms",ge,fe.length,+Date.now()-_t)}return Xe&&console.timeEnd("total time"),this},Ye.prototype.getClusters=function(Ke,Dt){var Xe=((Ke[0]+180)%360+360)%360-180,Ut=Math.max(-90,Math.min(90,Ke[1])),_r=Ke[2]===180?180:((Ke[2]+180)%360+360)%360-180,ar=Math.max(-90,Math.min(90,Ke[3]));if(Ke[2]-Ke[0]>=360)Xe=-180,_r=180;else if(Xe>_r){var zr=this.getClusters([Xe,Ut,180,ar],Dt),fe=this.getClusters([-180,Ut,_r,ar],Dt);return zr.concat(fe)}for(var Re=this.trees[this._limitZoom(Dt)],ge=Re.range(tr(Xe),zt(ar),tr(_r),zt(Ut)),_t=[],pt=0,Nt=ge;pt<Nt.length;pt+=1){var Bt=Nt[pt],kr=Re.points[Bt];_t.push(kr.numPoints?Yt(kr):this.points[kr.index])}return _t},Ye.prototype.getChildren=function(Ke){var Dt=this._getOriginId(Ke),Xe=this._getOriginZoom(Ke),Ut="No cluster with the specified id.",_r=this.trees[Xe];if(!_r)throw new Error(Ut);var ar=_r.points[Dt];if(!ar)throw new Error(Ut);for(var zr=this.options.radius/(this.options.extent*Math.pow(2,Xe-1)),fe=_r.within(ar.x,ar.y,zr),Re=[],ge=0,_t=fe;ge<_t.length;ge+=1){var pt=_t[ge],Nt=_r.points[pt];Nt.parentId===Ke&&Re.push(Nt.numPoints?Yt(Nt):this.points[Nt.index])}if(Re.length===0)throw new Error(Ut);return Re},Ye.prototype.getLeaves=function(Ke,Dt,Xe){Dt=Dt||10,Xe=Xe||0;var Ut=[];return this._appendLeaves(Ut,Ke,Dt,Xe,0),Ut},Ye.prototype.getTile=function(Ke,Dt,Xe){var Ut=this.trees[this._limitZoom(Ke)],_r=Math.pow(2,Ke),ar=this.options,zr=ar.extent,fe=ar.radius,Re=fe/zr,ge=(Xe-Re)/_r,_t=(Xe+1+Re)/_r,pt={features:[]};return this._addTileFeatures(Ut.range((Dt-Re)/_r,ge,(Dt+1+Re)/_r,_t),Ut.points,Dt,Xe,_r,pt),Dt===0&&this._addTileFeatures(Ut.range(1-Re/_r,ge,1,_t),Ut.points,_r,Xe,_r,pt),Dt===_r-1&&this._addTileFeatures(Ut.range(0,ge,Re/_r,_t),Ut.points,-1,Xe,_r,pt),pt.features.length?pt:null},Ye.prototype.getClusterExpansionZoom=function(Ke){for(var Dt=this._getOriginZoom(Ke)-1;Dt<=this.options.maxZoom;){var Xe=this.getChildren(Ke);if(Dt++,Xe.length!==1)break;Ke=Xe[0].properties.cluster_id}return Dt},Ye.prototype._appendLeaves=function(Ke,Dt,Xe,Ut,_r){for(var ar=this.getChildren(Dt),zr=0,fe=ar;zr<fe.length;zr+=1){var Re=fe[zr],ge=Re.properties;if(ge&&ge.cluster?_r+ge.point_count<=Ut?_r+=ge.point_count:_r=this._appendLeaves(Ke,ge.cluster_id,Xe,Ut,_r):_r<Ut?_r++:Ke.push(Re),Ke.length===Xe)break}return _r},Ye.prototype._addTileFeatures=function(Ke,Dt,Xe,Ut,_r,ar){for(var zr=0,fe=Ke;zr<fe.length;zr+=1){var Re=fe[zr],ge=Dt[Re],_t=ge.numPoints,pt=void 0,Nt=void 0,Bt=void 0;if(_t)pt=Vt(ge),Nt=ge.x,Bt=ge.y;else{var kr=this.points[ge.index];pt=kr.properties,Nt=tr(kr.geometry.coordinates[0]),Bt=zt(kr.geometry.coordinates[1])}var ln={type:1,geometry:[[Math.round(this.options.extent*(Nt*_r-Xe)),Math.round(this.options.extent*(Bt*_r-Ut))]],tags:pt},yn=void 0;_t?yn=ge.id:this.options.generateId?yn=ge.index:this.points[ge.index].id&&(yn=this.points[ge.index].id),yn!==void 0&&(ln.id=yn),ar.features.push(ln)}},Ye.prototype._limitZoom=function(Ke){return Math.max(this.options.minZoom,Math.min(+Ke,this.options.maxZoom+1))},Ye.prototype._cluster=function(Ke,Dt){for(var Xe=[],Ut=this.options,_r=Ut.radius,ar=Ut.extent,zr=Ut.reduce,fe=Ut.minPoints,Re=_r/(ar*Math.pow(2,Dt)),ge=0;ge<Ke.length;ge++){var _t=Ke[ge];if(!(_t.zoom<=Dt)){_t.zoom=Dt;for(var pt=this.trees[Dt+1],Nt=pt.within(_t.x,_t.y,Re),Bt=_t.numPoints||1,kr=Bt,ln=0,yn=Nt;ln<yn.length;ln+=1){var Vi=yn[ln],nr=pt.points[Vi];nr.zoom>Dt&&(kr+=nr.numPoints||1)}if(kr>=fe){for(var de=_t.x*Bt,Te=_t.y*Bt,Ue=zr&&Bt>1?this._map(_t,!0):null,Le=(ge<<5)+(Dt+1)+this.points.length,Ft=0,er=Nt;Ft<er.length;Ft+=1){var w=er[Ft],Z=pt.points[w];if(!(Z.zoom<=Dt)){Z.zoom=Dt;var Ee=Z.numPoints||1;de+=Z.x*Ee,Te+=Z.y*Ee,Z.parentId=Le,zr&&(Ue||(Ue=this._map(_t,!0)),zr(Ue,this._map(Z)))}}_t.parentId=Le,Xe.push(Je(de/kr,Te/kr,Le,kr,Ue))}else if(Xe.push(_t),kr>1)for(var Ze=0,Qe=Nt;Ze<Qe.length;Ze+=1){var yt=Qe[Ze],St=pt.points[yt];St.zoom<=Dt||(St.zoom=Dt,Xe.push(St))}}}return Xe},Ye.prototype._getOriginId=function(Ke){return Ke-this.points.length>>5},Ye.prototype._getOriginZoom=function(Ke){return(Ke-this.points.length)%32},Ye.prototype._map=function(Ke,Dt){if(Ke.numPoints)return Dt?yr({},Ke.properties):Ke.properties;var Xe=this.points[Ke.index].properties,Ut=this.options.map(Xe);return Dt&&Ut===Xe?yr({},Ut):Ut};function Je(Ct,Ke,Dt,Xe,Ut){return{x:Ne(Ct),y:Ne(Ke),zoom:Infinity,id:Dt,parentId:-1,numPoints:Xe,properties:Ut}}function rt(Ct,Ke){var Dt=Ct.geometry.coordinates,Xe=Dt[0],Ut=Dt[1];return{x:Ne(tr(Xe)),y:Ne(zt(Ut)),zoom:Infinity,index:Ke,parentId:-1}}function Yt(Ct){return{type:"Feature",id:Ct.id,properties:Vt(Ct),geometry:{type:"Point",coordinates:[Tt(Ct.x),xt(Ct.y)]}}}function Vt(Ct){var Ke=Ct.numPoints,Dt=Ke>=1e4?Math.round(Ke/1e3)+"k":Ke>=1e3?Math.round(Ke/100)/10+"k":Ke;return yr(yr({},Ct.properties),{cluster:!0,cluster_id:Ct.id,point_count:Ke,point_count_abbreviated:Dt})}function tr(Ct){return Ct/360+.5}function zt(Ct){var Ke=Math.sin(Ct*Math.PI/180),Dt=.5-.25*Math.log((1+Ke)/(1-Ke))/Math.PI;return Dt<0?0:Dt>1?1:Dt}function Tt(Ct){return(Ct-.5)*360}function xt(Ct){var Ke=(180-Ct*360)*Math.PI/180;return 360*Math.atan(Math.exp(Ke))/Math.PI-90}function yr(Ct,Ke){for(var Dt in Ke)Ct[Dt]=Ke[Dt];return Ct}function ee(Ct){return Ct.x}function dr(Ct){return Ct.y}return Ye})},75752:function(Or){Or.exports.RADIUS=6378137,Or.exports.FLATTENING=1/298.257223563,Or.exports.POLAR_RADIUS=63567523142e-4}}]);
